<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
 <head>
  <title>
   1 Transform Library
  </title>
  <meta charset="utf-8"/>
  <meta content="TeX4ht (https://tug.org/tex4ht/)" name="generator"/>
  <meta content="width=device-width,initial-scale=1" name="viewport"/>
  <link href="MobileRoboticsLectureBook.css" rel="stylesheet" type="text/css"/>
  <meta content="MobileRoboticsLectureBook.tex" name="src"/>
  <script async="async" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/mml-chtml.js" type="text/javascript">
  </script>
  <link href="flatweb.css" rel="stylesheet" type="text/css"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js">
  </script>
  <script src="flatjs.js">
  </script>
  <link href="http://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css"/>
  <link href="https://unpkg.com/nord-highlightjs@0.1.0/dist/nord.css" rel="stylesheet" type="text/css"/>
  <script src="https://unpkg.com/@highlightjs/cdn-assets@11.3.1/highlight.min.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/dockerfile.min.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/cmake.min.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/cpp.min.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/makefile.min.js">
  </script>
  <script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js">
  </script>
  <link href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css" rel="stylesheet"/>
  <script src="flatjs.js">
  </script>
  <header>
  </header>
 </head>
 <body id="top">
  <nav class="wide">
   <div class="contents">
    <h3 style="font-weight:lighter; padding: 20px 0 20px 0;">
     1
   
     
   

   Transform Library
    </h3>
    <h4 style="font-weight:lighter">
     Chapter Table of Contents
    </h4>
    <ul>
     <div class="chapterTOCS">
      <li>
       <span class="sectionToc">
        <small>
         1.1
        </small>
        <a href="#x3-30001.1">
         A Gentle Introduction
        </a>
       </span>
      </li>
      <li>
       <span class="sectionToc">
        <small>
         1.2
        </small>
        <a href="#x3-110001.2">
         Writing a Static Broadcaster
        </a>
       </span>
      </li>
      <li>
       <span class="sectionToc">
        <small>
         1.3
        </small>
        <a href="#x3-200001.3">
         Writing a Listener
        </a>
       </span>
      </li>
      <li>
       <span class="sectionToc">
        <small>
         1.4
        </small>
        <a href="#x3-270001.4">
         Adding a Frame
        </a>
       </span>
      </li>
      <li>
       <span class="sectionToc">
        <small>
         1.5
        </small>
        <a href="#x3-410001.5">
         Writing a Broadcaster
        </a>
       </span>
      </li>
     </div>
    </ul>
    <div class="prev-next" style="text-align: center">
     <p class="noindent">
      <a href="MobileRoboticsLectureBookli2.html" style="float:right; font-size:10px">
       NEXT →
      </a>
      <a href="index.html" style="float:left; font-size:10px">
       ← PREV
      </a>
      <a href="index.html">
       TOP
      </a>
     </p>
    </div>
    <div id="author-info" style="bottom: 0; padding-bottom: 10px;">
     <div id="author-logo">
      <img src="figures/logo.svg" style="margin: 10px 0;"/>
      <div>
       <div>
        <h4 style="color:#7aa0b8; font-weight:lighter;">
         WebBook | D. T. McGuiness, P.hD
        </h4>
       </div>
      </div>
     </div>
    </div>
   </div>
  </nav>
  <div class="page">
   <article class="chapter">
    <h1 class="chapterHead">
     <div class="number">
      1
     </div>
     <a id="x3-20001">
     </a>
     Transform Library
    </h1>
    <div class="section-control" style="text-align: center">
     <a id="prev-section" onclick="goPrev()" style="float:left;">
      ← Previous Section
     </a>
     <a id="next-section" onclick="goNext()" style="float:right;">
      Next Section →
     </a>
    </div>
    <div class="section-head" id="section-1" sec="section-1">
     <h2 class="sectionHead">
      <a aria-label="Link to this section in PDF version" class="pdf-link" href="MobileRoboticsLectureBook.pdf#section.1.1" style="color: red;  position: absolute;  left: -30px;" target="_blank">
       <svg class="bi bi-file-pdf" fill="currentColor" height="20" viewbox="0 0 16 16" width="20" xmlns="http://www.w3.org/2000/svg">
        <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z">
        </path>
        <path d="M4.603 12.087a.81.81 0 0 1-.438-.42c-.195-.388-.13-.776.08-1.102.198-.307.526-.568.897-.787a7.68 7.68 0 0 1 1.482-.645 19.701 19.701 0 0 0 1.062-2.227 7.269 7.269 0 0 1-.43-1.295c-.086-.4-.119-.796-.046-1.136.075-.354.274-.672.65-.823.192-.077.4-.12.602-.077a.7.7 0 0 1 .477.365c.088.164.12.356.127.538.007.187-.012.395-.047.614-.084.51-.27 1.134-.52 1.794a10.954 10.954 0 0 0 .98 1.686 5.753 5.753 0 0 1 1.334.05c.364.065.734.195.96.465.12.144.193.32.2.518.007.192-.047.382-.138.563a1.04 1.04 0 0 1-.354.416.856.856 0 0 1-.51.138c-.331-.014-.654-.196-.933-.417a5.716 5.716 0 0 1-.911-.95 11.642 11.642 0 0 0-1.997.406 11.311 11.311 0 0 1-1.021 1.51c-.29.35-.608.655-.926.787a.793.793 0 0 1-.58.029zm1.379-1.901c-.166.076-.32.156-.459.238-.328.194-.541.383-.647.547-.094.145-.096.25-.04.361.01.022.02.036.026.044a.27.27 0 0 0 .035-.012c.137-.056.355-.235.635-.572a8.18 8.18 0 0 0 .45-.606zm1.64-1.33a12.647 12.647 0 0 1 1.01-.193 11.666 11.666 0 0 1-.51-.858 20.741 20.741 0 0 1-.5 1.05zm2.446.45c.15.162.296.3.435.41.24.19.407.253.498.256a.107.107 0 0 0 .07-.015.307.307 0 0 0 .094-.125.436.436 0 0 0 .059-.2.095.095 0 0 0-.026-.063c-.052-.062-.2-.152-.518-.209a3.881 3.881 0 0 0-.612-.053zM8.078 5.8a6.7 6.7 0 0 0 .2-.828c.031-.188.043-.343.038-.465a.613.613 0 0 0-.032-.198.517.517 0 0 0-.145.04c-.087.035-.158.106-.196.283-.04.192-.03.469.046.822.024.111.054.227.09.346z">
        </path>
       </svg>
      </a>
      <small class="titlemark">
       1.1
      </small>
      <a id="x3-30001.1">
      </a>
      A Gentle Introduction
     </h2>
     <p class="noindent"> <span id="textcolor1"><code class="verb">tf2</code></span>
      is the
      <alert style="color: #821131;">
       transform library
      </alert>
      , which lets the user keep track of multiple coordinate frames over
time. <span id="textcolor2"><code class="verb">tf2</code></span>
      maintains the relationship between coordinate frames in a tree structure buffered in time and
lets the user transform points, vectors, etc., between any two <alert style="color: #821131;">(2)</alert> coordinate frames at any desired
point in time.
     </p>
     <aside class="wrapfig-r">
      <img alt="PIC" height="" src="figures/Transform-Library/raster/tf2-sample.png" width="100%"/>
      <a id="x3-3001r1">
      </a>
      <figcaption class="caption">
       <span class="id">
        Figure
       1.1:
       </span>
       <span class="content">
        A  robot  is  comprised  of
       numerous  coordinate  system  as  can  be
       seen  from  this  robot  and  needs  to  be
       constantly  be  kept  in  check  which <span id="textcolor4"><code class="verb">tf2</code></span>
        allows <span class="cite"><a href="MobileRoboticsLectureBookad1.html#ros2iron2025">[1]</a></span>.
       </span>
      </figcaption>
     </aside>
     <p class="noindent">
      A robotic system typically various types of 3D coordinate frames which change over time.
     </p>
     <div class="quoteblock">
      <p class="noindent">
       Examples include a world frame, base frame, gripper frame, head frame, etc.
      </p>
     </div>
     <p class="noindent">
      The key use-case for <span id="textcolor5"><code class="verb">tf2</code></span>
      is to keep track of all these frames over time, and allows us to ask questions
like:
     </p>
     <ul class="itemize1">
      <li class="itemize">
       <p class="noindent">
        Where was the head frame relative to the world frame 5 seconds ago?
       </p>
      </li>
      <li class="itemize">
       <p class="noindent">
        What is the pose of the object in my gripper relative to my base?
       </p>
      </li>
      <li class="itemize">
       <p class="noindent">
        What is the current pose of the base frame in the map frame?
       </p>
      </li>
     </ul>
     <p class="noindent"> <span id="textcolor9"><code class="verb">tf2</code></span>
      can operate in a distributed system. This means all the information about the coordinate frames of
a robot is available to
      <alert style="color: #821131;">
       all
      </alert>
      <a class="glossary" href="MobileRoboticsLectureBookli2.html#glo:ros">
       Robot Operating System 2 (ROS)
      </a>
      components on any computer in the
system. In addition, <span id="textcolor10"><code class="verb">tf2</code></span>
      can have every component in your distributed system build its own
transform information database or have a central node that gathers and stores all transform
information.
     </p>
     <h4 class="likesubsectionHead">
      <a id="x3-4000">
      </a>
      A Simple Test
     </h4>
     <p class="noindent">
      To get started with the <span id="textcolor11"><code class="verb">tf2</code></span>
      library, we are going to run a demo and see some of the power of <span id="textcolor12"><code class="verb">tf2</code></span>
      in a
multi-robot example using turtlesim, which we should already be familiar with.
      <a id="paragraph*.2">
      </a>
     </p>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-5000">
       </a>
       Installing the Demo
      </span>
      We will start by installing the demo package and its dependencies, like we did previously. This might
have been already installed depending on the way
      <a class="glossary" href="MobileRoboticsLectureBookli2.html#glo:ros">
       ROS
      </a>
      was installed, but it doesn’t hurt to run the
command again:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb1" style="padding:20px;border-radius: 3px;"><a id="x3-5002r63"></a>sudo<span id="textcolor13"> </span>apt-get<span id="textcolor14"> </span>install<span id="textcolor15"> </span><span id="textcolor16">\</span> 
<a id="x3-5004r64"></a><span id="textcolor17">     </span>ros-humble-rviz2<span id="textcolor18"> </span><span id="textcolor19">\</span> 
<a id="x3-5006r65"></a><span id="textcolor20">     </span>ros-humble-turtle-tf2-py<span id="textcolor21"> </span><span id="textcolor22">\</span> 
<a id="x3-5008r66"></a><span id="textcolor23">     </span>ros-humble-tf2-ros<span id="textcolor24"> </span><span id="textcolor25">\</span> 
<a id="x3-5010r67"></a><span id="textcolor26">     </span>ros-humble-tf2-tools<span id="textcolor27"> </span><span id="textcolor28">\</span> 
<a id="x3-5012r68"></a><span id="textcolor29">     </span>ros-humble-turtlesim</div></pre>
     </div>
     <p class="noindent">
      Now
that
we’ve
installed
the <span id="textcolor30"><code class="verb">turtle_tf2_py</code></span>
      tutorial
package
let’s
run
the
demo.
First,
open
a
      <alert style="color: #821131;">
       new
terminal
      </alert>
      and
source
your
      <a class="glossary" href="MobileRoboticsLectureBookli2.html#glo:ros">
       ROS
      </a>
      installation
so
that <span id="textcolor31"><code class="verb">ros2</code></span>
      commands
will
                                                                                
                                                                                
work.
      <alert style="color: #821131;">
       <span id="bold" style="font-weight:bold;">
        <sup class="textsuperscript">
         1
        </sup>
       </span>
      </alert>
      <span class="marginnote">
       <alert style="color: #821131;">
        <span id="bold" style="font-weight:bold;">
         <sup class="textsuperscript">
          1
         </sup>
        </span>
       </alert>
       <span id="textcolor32">
        While
the
docker
container
setup
has
the
source
predefined,
it
is
nevertheless
a
good
practice
to
do
this
if
you
are
working
with
multiple
versions.
       </span>
      </span>
      Then
run
the
following
command:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb2" style="padding:20px;border-radius: 3px;"><a id="x3-5014r75"></a>ros2<span id="textcolor33"> </span>launch<span id="textcolor34"> </span>turtle_tf2_py<span id="textcolor35"> </span>turtle_tf2_demo.launch.py</div></pre>
     </div>
     <p class="noindent">
      You
will
see
the
turtlesim
start
with
two
<alert style="color: #821131;">(2)</alert> turtles.
In
the
      <alert style="color: #821131;">
       second
terminal
      </alert>
      window
type
the
following
command:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb3" style="padding:20px;border-radius: 3px;"><a id="x3-5016r80"></a>ros2<span id="textcolor36"> </span>run<span id="textcolor37"> </span>turtlesim<span id="textcolor38"> </span>turtle_teleop_key</div></pre>
     </div>
     <p class="noindent">
      Once
the
turtlesim
is
started
you
can
drive
                                                                                
                                                                                
the
central
turtle
around
in
the
turtlesim
using
the
keyboard
arrow
keys,
select
the
second
terminal
window
so
that
our
keystrokes
will
be
captured
to
drive
the
turtle.
     </p>
     <p class="noindent">
      You
can
see
that
one
turtle
continuously
moves
to
follow
the
turtle
you
are
driving
around.
      <a id="paragraph*.3">
      </a>
     </p>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-6000">
       </a>
       Looking at the Behaviour
      </span>
      This demo is using the <span id="textcolor39"><code class="verb">tf2</code></span>
      library to create three <alert style="color: #821131;">(3)</alert> coordinate frames:
     </p>
     <dl class="enumerate-enumitem">
      <dt class="enumerate-enumitem">
       1.
      </dt>
      <dd class="enumerate-enumitem">
       a
world
frame,
      </dd>
      <dt class="enumerate-enumitem">
       2.
      </dt>
      <dd class="enumerate-enumitem">
       a <span id="textcolor40"><code class="verb">turtle1</code></span>
       frame,
and
      </dd>
      <dt class="enumerate-enumitem">
       3.
      </dt>
      <dd class="enumerate-enumitem">
       a <span id="textcolor41"><code class="verb">turtle2</code></span>
       frame.
      </dd>
     </dl>
     <p class="noindent">
      In this tutorial, we use a <span id="textcolor42"><code class="verb">tf2</code></span>
      <span id="bold" style="font-weight:bold;">
       broadcaster
      </span>
      to publish the turtle coordinate frames and a <span id="textcolor43"><code class="verb">tf2</code></span>
      <span id="bold" style="font-weight:bold;">
       listener
      </span>
      to calculate the difference
in the turtle frames and move one turtle to follow the other.
     </p>
     <h5 class="likesubsubsectionHead">
      <a id="x3-7000">
      </a>
      Useful Tools
     </h5>
     <p class="noindent">
      It is time to see how <span id="textcolor44"><code class="verb">tf2</code></span>
      is being used to create this simple exercise. We can use <span id="textcolor45"><code class="verb">tf2_tools</code></span>
      to look at what <span id="textcolor46"><code class="verb">tf2</code></span>
      is doing behind
the scenes.
      <a id="paragraph*.4">
      </a>
     </p>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-8000">
       </a>
       Viewing the Frames
      </span>
      If we want to see visually what is going on, we can use <span id="textcolor47"><code class="verb">view_frames</code></span>
      which creates a diagram of the frames being broadcast by <span id="textcolor48"><code class="verb">tf2</code></span>
      over
      <a class="glossary" href="MobileRoboticsLectureBookli2.html#glo:ros">
       ROS
      </a>.
     </p>
     <div class="warning">
      <p class="noindent">
       As of this writing <span id="textcolor49"><code class="verb">view_frames</code></span>
       only works on Linux.
      </p>
     </div>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb4" style="padding:20px;border-radius: 3px;"><a id="x3-8002r87"></a>ros2<span id="textcolor50"> </span>run<span id="textcolor51"> </span>tf2_tools<span id="textcolor52"> </span>view_frames</div></pre>
     </div>
     <div class="tcolorbox tcolorbox" id="tcolobox-1">
      <div class="tcolorbox-content">
       <div class="code-block">
        <div class="code-lang">
         text
        </div>
        <pre><div class="language-text" id="fancyvrb5" style="padding:20px;border-radius: 3px;"><a id="x3-8004r1"></a>Listening to tf data during 5 seconds... 
<a id="x3-8006r2"></a>Generating graph in frames.pdf file...</div></pre>
       </div>
      </div>
     </div>
     <p class="noindent">
      Here a <span id="textcolor53"><code class="verb">tf2</code></span>
      listener is listening to the frames which are being broadcast over
      <a class="glossary" href="MobileRoboticsLectureBookli2.html#glo:ros">
       ROS
      </a>
      and drawing a tree of how the frames are
connected.
     </p>
     <div class="knowledge">
      <p class="noindent">
       If we want to view the tree, open the resulting <span id="textcolor54"><code class="verb">frames.pdf</code></span>
       with a PDF viewer.
      </p>
     </div>
     <p class="noindent">
      Here we can see three <alert style="color: #821131;">(3)</alert> frames that are broadcast by <span id="textcolor55"><code class="verb">tf2</code></span>
      :
     </p>
     <div class="quoteblock">
      <p class="noindent"> <span id="textcolor56"><code class="verb">world</code></span>, <span id="textcolor57"><code class="verb">turtle1</code></span>,
and <span id="textcolor58"><code class="verb">turtle2</code></span>.
      </p>
     </div>
     <p class="noindent">
      The <span id="textcolor59"><code class="verb">world</code></span>
      frame is the parent of the <span id="textcolor60"><code class="verb">turtle1</code></span>
      and <span id="textcolor61"><code class="verb">turtle2</code></span>
      frames. <span id="textcolor62"><code class="verb">view_frames</code></span>
      also reports some diagnostic information about
when the oldest and most recent frame transforms were received and how fast the <span id="textcolor63"><code class="verb">tf2</code></span>
      frame is published to <span id="textcolor64"><code class="verb">tf2</code></span>
      for debugging
purposes.
      <a id="paragraph*.5">
      </a>
     </p>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-9000">
       </a>
       Using Echo
      </span> <span id="textcolor65"><code class="verb">tf2_echo</code></span>
      reports the transform between any two <alert style="color: #821131;">(2)</alert> frames broadcast over
      <a class="glossary" href="MobileRoboticsLectureBookli2.html#glo:ros">
       ROS
      </a>. The syntax of this command is as
follows:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb6" style="padding:20px;border-radius: 3px;"><a id="x3-9002r100"></a>ros2<span id="textcolor66"> </span>run<span id="textcolor67"> </span>tf2_ros<span id="textcolor68"> </span>tf2_echo<span id="textcolor69"> </span><span id="textcolor70">[</span>source_frame<span id="textcolor71">]</span><span id="textcolor72"> </span><span id="textcolor73">[</span>target_frame<span id="textcolor74">]</span></div></pre>
     </div>
     <p class="noindent">
      Let’s look at the transform of the <span id="textcolor75"><code class="verb">turtle2</code></span>
      frame with respect to <span id="textcolor76"><code class="verb">turtle1</code></span>
      frame which is equivalent to:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb7" style="padding:20px;border-radius: 3px;"><a id="x3-9004r106"></a>ros2<span id="textcolor77"> </span>run<span id="textcolor78"> </span>tf2_ros<span id="textcolor79"> </span>tf2_echo<span id="textcolor80"> </span>turtle2<span id="textcolor81"> </span>turtle1</div></pre>
     </div>
     <div class="tcolorbox tcolorbox" id="tcolobox-2">
      <div class="tcolorbox-content">
       <div class="code-block">
        <div class="code-lang">
         text
        </div>
        <pre><div class="language-text" id="fancyvrb8" style="padding:20px;border-radius: 3px;"><a id="x3-9006r1"></a>At time 1683385337.850619099 
<a id="x3-9008r2"></a>- Translation: [2.157, 0.901, 0.000] 
<a id="x3-9010r3"></a>- Rotation: in Quaternion [0.000, 0.000, 0.172, 0.985] 
<a id="x3-9012r4"></a>- Rotation: in RPY (radian) [0.000, -0.000, 0.345] 
<a id="x3-9014r5"></a>- Rotation: in RPY (degree) [0.000, -0.000, 19.760] 
<a id="x3-9016r6"></a>- Matrix: 
<a id="x3-9018r7"></a>  0.941 -0.338  0.000  2.157 
<a id="x3-9020r8"></a>  0.338  0.941  0.000  0.901 
<a id="x3-9022r9"></a>  0.000  0.000  1.000  0.000 
<a id="x3-9024r10"></a>  0.000  0.000  0.000  1.000 
<a id="x3-9026r11"></a>At time 1683385338.841997774 
<a id="x3-9028r12"></a>- Translation: [1.256, 0.216, 0.000] 
<a id="x3-9030r13"></a>- Rotation: in Quaternion [0.000, 0.000, -0.016, 1.000] 
<a id="x3-9032r14"></a>- Rotation: in RPY (radian) [0.000, 0.000, -0.032] 
<a id="x3-9034r15"></a>- Rotation: in RPY (degree) [0.000, 0.000, -1.839] 
<a id="x3-9036r16"></a>- Matrix: 
<a id="x3-9038r17"></a>  0.999  0.032  0.000  1.256 
<a id="x3-9040r18"></a> -0.032  0.999 -0.000  0.216 
<a id="x3-9042r19"></a> -0.000  0.000  1.000  0.000 
<a id="x3-9044r20"></a>  0.000  0.000  0.000  1.000</div></pre>
       </div>
      </div>
     </div>
     <p class="noindent">
      We will see the transform displayed as the <span id="textcolor82"><code class="verb">tf2_echo</code></span>
      listener receives the frames broadcast over
      <a class="glossary" href="MobileRoboticsLectureBookli2.html#glo:ros">
       ROS
      </a>. As we drive our turtle
around we will see the transform change as the two <alert style="color: #821131;">(2)</alert> turtles move relative to each other.
      <a id="paragraph*.6">
      </a>
     </p>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-10000">
       </a>
       rviz2 and tf2
      </span> <span id="textcolor83"><code class="verb">rviz2</code></span>
      is a three-dimensional visualization platform in
      <a class="glossary" href="MobileRoboticsLectureBookli2.html#glo:ros">
       ROS
      </a>. On the one hand, it can realize the graphical display of external
information, and on the other hand, it can also release control information to the object through rviz, so as to realize the
monitoring and control of the robot. It is also useful for examining <span id="textcolor84"><code class="verb">tf2</code></span>
      frames. Let’s look at our turtle frames using <span id="textcolor85"><code class="verb">rviz2</code></span>
      by
starting it with a configuration file using the <span id="textcolor86"><code class="verb">-d</code></span>
      option:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb9" style="padding:20px;border-radius: 3px;"><a id="x3-10002r137"></a>ros2<span id="textcolor87"> </span>run<span id="textcolor88"> </span>rviz2<span id="textcolor89"> </span>rviz2<span id="textcolor90"> </span>-d<span id="textcolor91"> </span><span id="textcolor92">\</span> 
<a id="x3-10004r138"></a><span id="textcolor93">    </span><span id="textcolor94">$(</span>ros2<span id="textcolor95"> </span>pkg<span id="textcolor96"> </span>prefix<span id="textcolor97"> </span>--share<span id="textcolor98"> </span>turtle_tf2_py<span id="textcolor99">)</span>/rviz/turtle_rviz.rviz</div></pre>
     </div>
     <p class="noindent">
      In the side bar you will see the frames broadcasted by tf2. As you drive the turtle around you will see the frames move in <span id="textcolor100"><code class="verb">rviz</code></span>.
     </p>
     <p class="noindent">
     </p>
    </div>
    <div class="section-head" id="section-2" sec="section-2">
     <h2 class="sectionHead">
      <a aria-label="Link to this section in PDF version" class="pdf-link" href="MobileRoboticsLectureBook.pdf#section.1.2" style="color: red;  position: absolute;  left: -30px;" target="_blank">
       <svg class="bi bi-file-pdf" fill="currentColor" height="20" viewbox="0 0 16 16" width="20" xmlns="http://www.w3.org/2000/svg">
        <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z">
        </path>
        <path d="M4.603 12.087a.81.81 0 0 1-.438-.42c-.195-.388-.13-.776.08-1.102.198-.307.526-.568.897-.787a7.68 7.68 0 0 1 1.482-.645 19.701 19.701 0 0 0 1.062-2.227 7.269 7.269 0 0 1-.43-1.295c-.086-.4-.119-.796-.046-1.136.075-.354.274-.672.65-.823.192-.077.4-.12.602-.077a.7.7 0 0 1 .477.365c.088.164.12.356.127.538.007.187-.012.395-.047.614-.084.51-.27 1.134-.52 1.794a10.954 10.954 0 0 0 .98 1.686 5.753 5.753 0 0 1 1.334.05c.364.065.734.195.96.465.12.144.193.32.2.518.007.192-.047.382-.138.563a1.04 1.04 0 0 1-.354.416.856.856 0 0 1-.51.138c-.331-.014-.654-.196-.933-.417a5.716 5.716 0 0 1-.911-.95 11.642 11.642 0 0 0-1.997.406 11.311 11.311 0 0 1-1.021 1.51c-.29.35-.608.655-.926.787a.793.793 0 0 1-.58.029zm1.379-1.901c-.166.076-.32.156-.459.238-.328.194-.541.383-.647.547-.094.145-.096.25-.04.361.01.022.02.036.026.044a.27.27 0 0 0 .035-.012c.137-.056.355-.235.635-.572a8.18 8.18 0 0 0 .45-.606zm1.64-1.33a12.647 12.647 0 0 1 1.01-.193 11.666 11.666 0 0 1-.51-.858 20.741 20.741 0 0 1-.5 1.05zm2.446.45c.15.162.296.3.435.41.24.19.407.253.498.256a.107.107 0 0 0 .07-.015.307.307 0 0 0 .094-.125.436.436 0 0 0 .059-.2.095.095 0 0 0-.026-.063c-.052-.062-.2-.152-.518-.209a3.881 3.881 0 0 0-.612-.053zM8.078 5.8a6.7 6.7 0 0 0 .2-.828c.031-.188.043-.343.038-.465a.613.613 0 0 0-.032-.198.517.517 0 0 0-.145.04c-.087.035-.158.106-.196.283-.04.192-.03.469.046.822.024.111.054.227.09.346z">
        </path>
       </svg>
      </a>
      <small class="titlemark">
       1.2
      </small>
      <a id="x3-110001.2">
      </a>
      Writing a Static Broadcaster
     </h2>
     <p class="noindent">
      Publishing static transforms is useful to define the relationship between a robot base and its sensors or non-moving
parts.
     </p>
     <p class="noindent">
     </p>
     <div class="quoteblock">
      <p class="noindent">
       For
example,
it
is
easiest
to
reason
about
laser
scan
measurements
in
a
frame
at
the
centre
of
the
laser
scanner.
      </p>
     </div>
     <p class="noindent">
      In this section, we will be covering the basics of static transforms, which consists of two <alert style="color: #821131;">(2)</alert> parts:
     </p>
     <ul class="itemize1">
      <li class="itemize">
       <p class="noindent">
        In
the
first
part
we
will
write
code
to
publish
static
transforms
to
tf2.
       </p>
      </li>
      <li class="itemize">
       <p class="noindent">
        In
the
second
part
we
                                                                                
                                                                                
     
will
explain
how
to
use
the
command-line <span id="textcolor103"><code class="verb">static_transform_publisher</code></span>
        executable
tool
in <span id="textcolor104"><code class="verb">tf2_ros</code></span>.
       </p>
      </li>
     </ul>
     <p class="noindent">
      In the next two <alert style="color: #821131;">(2)</alert> sections we will write the code to
      <span id="bold" style="font-weight:bold;">
       reproduce
      </span>
      the exercise we did at the beginning of the
chapter.
      <a id="paragraph*.7">
      </a>
     </p>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-12000">
       </a>
       Creating the Package
      </span>
      As with almost all
      <a class="glossary" href="MobileRoboticsLectureBookli2.html#glo:ros">
       ROS
      </a>
      applications, we first need to create a package will be used for this section and the following ones. The
package called <span id="textcolor105"><code class="verb">learning_tf2_py</code></span>
      will depend on:
     </p>
     <p class="noindent">
     </p>
     <div class="quoteblock">
      <p class="noindent"> <span id="textcolor106"><code class="verb">geometry_msgs</code></span>, <span id="textcolor107"><code class="verb">python3-numpy</code></span>, <span id="textcolor108"><code class="verb">rclpy</code></span>, <span id="textcolor109"><code class="verb">tf2_ros_py</code></span>,
and <span id="textcolor110"><code class="verb">turtlesim</code></span>
      </p>
     </div>
     <div class="warning">
      <p class="noindent">
       This package will be used in the following sections as well.
      </p>
     </div>
     <p class="noindent">
      Open a new terminal and source your
      <a class="glossary" href="MobileRoboticsLectureBookli2.html#glo:ros">
       ROS
      </a>
      installation so that <span id="textcolor111"><code class="verb">ros2</code></span>
      commands will work. Navigate to workspace’s <span id="textcolor112"><code class="verb">src</code></span>
      folder and
create a new package:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb10" style="padding:20px;border-radius: 3px;"><a id="x3-12002r145"></a>ros2<span id="textcolor113"> </span>pkg<span id="textcolor114"> </span>create<span id="textcolor115"> </span>--build-type<span id="textcolor116"> </span>ament_python<span id="textcolor117"> </span><span id="textcolor118">\</span> 
<a id="x3-12004r146"></a><span id="textcolor119">    </span>--license<span id="textcolor120"> </span>Apache-2.0<span id="textcolor121"> </span><span id="textcolor122">\</span> 
<a id="x3-12006r147"></a><span id="textcolor123">    </span>--<span id="textcolor124"> </span>learning_tf2_py</div></pre>
     </div>
     <p class="noindent">
      Once the command has been executed, our terminal will return a message verifying the creation of our package <span id="textcolor125"><code class="verb">learning\_tf2\_py</code></span>
      and all its necessary files and folders.
      <a id="paragraph*.8">
      </a>
     </p>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-13000">
       </a>
       Writing a Static Broadcaster Node
      </span>
      We will start, of course, by first creating the source files. Within the <span id="textcolor126"><code class="verb">[</code></span>
      /]src/learning_tf2_py/learning_tf2_py directory
download the example static broadcaster code by entering the following command:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb11" style="padding:20px;border-radius: 3px;"><a id="x3-13002r152"></a>wget<span id="textcolor127"> </span>https://raw.githubusercontent.com/ros/geometry_tutorials/humble/turtle_tf2_py/turtle_tf2_py/static_turtle_tf2_broadcaster.py</div></pre>
     </div>
     <p class="noindent">
      Now let’s open the file called <span id="textcolor128"><code class="verb">static\_turtle\_tf2\_broadcaster.py</code></span>
      and have a look at it.
      <a id="paragraph*.9">
      </a>
     </p>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-14000">
       </a>
       Looking at the Code
      </span>
      Now let’s look at the code that is relevant to publishing the static turtle pose to <span id="textcolor129"><code class="verb">tf2</code></span>. The first lines import required packages.
First we import the <span id="textcolor130"><code class="verb">TransformStamped</code></span>
      from the <span id="textcolor131"><code class="verb">geometry_msgs</code></span>, which provides us a template for the message that we will publish
to the transformation tree.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb12" style="padding:20px;border-radius: 3px;"><a id="x3-14002r260"></a><span id="textcolor132">from</span><span id="textcolor133"> </span><span id="textcolor134">geometry_msgs</span><span id="textcolor135">.</span><span id="textcolor136">msg</span><span id="textcolor137"> </span><span id="textcolor138">import</span> <span id="textcolor139">TransformStamped</span></div></pre>
     </div>
     <p class="noindent">
      Afterwards, <span id="textcolor140"><code class="verb">rclpy</code></span>
      is imported so its Node class can be used.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb13" style="padding:20px;border-radius: 3px;"><a id="x3-14004r265"></a><span id="textcolor141">import</span><span id="textcolor142"> </span><span id="textcolor143">rclpy</span> 
<a id="x3-14006r266"></a><span id="textcolor144">from</span><span id="textcolor145"> </span><span id="textcolor146">rclpy</span><span id="textcolor147">.</span><span id="textcolor148">node</span><span id="textcolor149"> </span><span id="textcolor150">import</span> <span id="textcolor151">Node</span></div></pre>
     </div>
     <p class="noindent">
      The <span id="textcolor152"><code class="verb">tf2_ros</code></span>
      package provides a <span id="textcolor153"><code class="verb">StaticTransformBroadcaster</code></span>
      to make the publishing of static transforms easy. To use the <span id="textcolor154"><code class="verb">StaticTransformBroadcaster</code></span>, we need to import it from the <span id="textcolor155"><code class="verb">tf2_ros</code></span>
      module.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb14" style="padding:20px;border-radius: 3px;"><a id="x3-14008r271"></a><span id="textcolor156">from</span><span id="textcolor157"> </span><span id="textcolor158">tf2_ros</span><span id="textcolor159">.</span><span id="textcolor160">static_transform_broadcaster</span><span id="textcolor161"> </span><span id="textcolor162">import</span> <span id="textcolor163">StaticTransformBroadcaster</span></div></pre>
     </div>
     <p class="noindent">
      The <span id="textcolor164"><code class="verb">StaticFramePublisher</code></span>
      class constructor initializes the node with the name <span id="textcolor165"><code class="verb">static_turtle_tf2_broadcaster</code></span>. Then, <span id="textcolor166"><code class="verb">StaticTransformBroadcaster</code></span>
      is created, which will send one static transformation upon the startup.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb15" style="padding:20px;border-radius: 3px;"><a id="x3-14010r276"></a><span id="textcolor167">self</span><span id="textcolor168">.</span><span id="textcolor169">tf_static_broadcaster</span> <span id="textcolor170">=</span> <span id="textcolor171">StaticTransformBroadcaster</span><span id="textcolor172">(</span><span id="textcolor173">self</span><span id="textcolor174">)</span> 
<a id="x3-14012r277"></a><span id="textcolor175">self</span><span id="textcolor176">.</span><span id="textcolor177">make_transforms</span><span id="textcolor178">(</span><span id="textcolor179">transformation</span><span id="textcolor180">)</span></div></pre>
     </div>
     <p class="noindent">
      Here we create a <span id="textcolor181"><code class="verb">TransformStamped</code></span>
      object, which will be the message we will send over once populated. Before passing the actual
transform values we need to give it the appropriate metadata.
     </p>
     <ul class="itemize1">
      <li class="itemize">
       <p class="noindent">
        We
need
to
give
the
transform
being
published
a
timestamp
and
well
just
stamp
it
with
the
current
time, <span id="textcolor183"><code class="verb">self.get_clock().now()</code></span>
       </p>
      </li>
      <li class="itemize">
       <p class="noindent">
        Then
we
need
to
set
the
name
of
the
parent
frame
of
the
link
were
creating,
                                                                                
                                                                                
     
in
this
case <span id="textcolor185"><code class="verb">world</code></span>.
       </p>
      </li>
      <li class="itemize">
       <p class="noindent">
        Finally,
we
need
to
set
the
name
of
the
child
frame
of
the
link
were
creating
       </p>
      </li>
     </ul>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb16" style="padding:20px;border-radius: 3px;"><a id="x3-14014r282"></a><span id="textcolor187">t</span> <span id="textcolor188">=</span> <span id="textcolor189">TransformStamped</span><span id="textcolor190">(</span><span id="textcolor191">)</span> 
<a id="x3-14016r283"></a> 
<a id="x3-14018r284"></a><span id="textcolor192">t</span><span id="textcolor193">.</span><span id="textcolor194">header</span><span id="textcolor195">.</span><span id="textcolor196">stamp</span> <span id="textcolor197">=</span> <span id="textcolor198">self</span><span id="textcolor199">.</span><span id="textcolor200">get_clock</span><span id="textcolor201">(</span><span id="textcolor202">)</span><span id="textcolor203">.</span><span id="textcolor204">now</span><span id="textcolor205">(</span><span id="textcolor206">)</span><span id="textcolor207">.</span><span id="textcolor208">to_msg</span><span id="textcolor209">(</span><span id="textcolor210">)</span> 
<a id="x3-14020r285"></a><span id="textcolor211">t</span><span id="textcolor212">.</span><span id="textcolor213">header</span><span id="textcolor214">.</span><span id="textcolor215">frame_id</span> <span id="textcolor216">=</span> <span id="textcolor217">'</span><span id="textcolor218">world</span><span id="textcolor219">'</span> 
<a id="x3-14022r286"></a><span id="textcolor220">t</span><span id="textcolor221">.</span><span id="textcolor222">child_frame_id</span> <span id="textcolor223">=</span> <span id="textcolor224">transformation</span><span id="textcolor225">[</span><span id="textcolor226">1</span><span id="textcolor227">]</span></div></pre>
     </div>
     <p class="noindent">
      Here we populate the 6D pose (translation and rotation) of the turtle.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb17" style="padding:20px;border-radius: 3px;"><a id="x3-14024r291"></a><span id="textcolor228">t</span><span id="textcolor229">.</span><span id="textcolor230">transform</span><span id="textcolor231">.</span><span id="textcolor232">translation</span><span id="textcolor233">.</span><span id="textcolor234">x</span> <span id="textcolor235">=</span> <span id="textcolor236">float</span><span id="textcolor237">(</span><span id="textcolor238">transformation</span><span id="textcolor239">[</span><span id="textcolor240">2</span><span id="textcolor241">]</span><span id="textcolor242">)</span> 
<a id="x3-14026r292"></a><span id="textcolor243">t</span><span id="textcolor244">.</span><span id="textcolor245">transform</span><span id="textcolor246">.</span><span id="textcolor247">translation</span><span id="textcolor248">.</span><span id="textcolor249">y</span> <span id="textcolor250">=</span> <span id="textcolor251">float</span><span id="textcolor252">(</span><span id="textcolor253">transformation</span><span id="textcolor254">[</span><span id="textcolor255">3</span><span id="textcolor256">]</span><span id="textcolor257">)</span> 
<a id="x3-14028r293"></a><span id="textcolor258">t</span><span id="textcolor259">.</span><span id="textcolor260">transform</span><span id="textcolor261">.</span><span id="textcolor262">translation</span><span id="textcolor263">.</span><span id="textcolor264">z</span> <span id="textcolor265">=</span> <span id="textcolor266">float</span><span id="textcolor267">(</span><span id="textcolor268">transformation</span><span id="textcolor269">[</span><span id="textcolor270">4</span><span id="textcolor271">]</span><span id="textcolor272">)</span> 
<a id="x3-14030r294"></a><span id="textcolor273">quat</span> <span id="textcolor274">=</span> <span id="textcolor275">quaternion_from_euler</span><span id="textcolor276">(</span> 
<a id="x3-14032r295"></a>   <span id="textcolor277">float</span><span id="textcolor278">(</span><span id="textcolor279">transformation</span><span id="textcolor280">[</span><span id="textcolor281">5</span><span id="textcolor282">]</span><span id="textcolor283">)</span><span id="textcolor284">,</span> <span id="textcolor285">float</span><span id="textcolor286">(</span><span id="textcolor287">transformation</span><span id="textcolor288">[</span><span id="textcolor289">6</span><span id="textcolor290">]</span><span id="textcolor291">)</span><span id="textcolor292">,</span> <span id="textcolor293">float</span><span id="textcolor294">(</span><span id="textcolor295">transformation</span><span id="textcolor296">[</span><span id="textcolor297">7</span><span id="textcolor298">]</span><span id="textcolor299">)</span><span id="textcolor300">)</span> 
<a id="x3-14034r296"></a><span id="textcolor301">t</span><span id="textcolor302">.</span><span id="textcolor303">transform</span><span id="textcolor304">.</span><span id="textcolor305">rotation</span><span id="textcolor306">.</span><span id="textcolor307">x</span> <span id="textcolor308">=</span> <span id="textcolor309">quat</span><span id="textcolor310">[</span><span id="textcolor311">0</span><span id="textcolor312">]</span> 
<a id="x3-14036r297"></a><span id="textcolor313">t</span><span id="textcolor314">.</span><span id="textcolor315">transform</span><span id="textcolor316">.</span><span id="textcolor317">rotation</span><span id="textcolor318">.</span><span id="textcolor319">y</span> <span id="textcolor320">=</span> <span id="textcolor321">quat</span><span id="textcolor322">[</span><span id="textcolor323">1</span><span id="textcolor324">]</span> 
<a id="x3-14038r298"></a><span id="textcolor325">t</span><span id="textcolor326">.</span><span id="textcolor327">transform</span><span id="textcolor328">.</span><span id="textcolor329">rotation</span><span id="textcolor330">.</span><span id="textcolor331">z</span> <span id="textcolor332">=</span> <span id="textcolor333">quat</span><span id="textcolor334">[</span><span id="textcolor335">2</span><span id="textcolor336">]</span> 
<a id="x3-14040r299"></a><span id="textcolor337">t</span><span id="textcolor338">.</span><span id="textcolor339">transform</span><span id="textcolor340">.</span><span id="textcolor341">rotation</span><span id="textcolor342">.</span><span id="textcolor343">w</span> <span id="textcolor344">=</span> <span id="textcolor345">quat</span><span id="textcolor346">[</span><span id="textcolor347">3</span><span id="textcolor348">]</span></div></pre>
     </div>
     <p class="noindent">
      Finally, we broadcast static transform using the <span id="textcolor349"><code class="verb">sendTransform()</code></span>
      function.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb18" style="padding:20px;border-radius: 3px;"><a id="x3-14042r304"></a><span id="textcolor350">self</span><span id="textcolor351">.</span><span id="textcolor352">tf_static_broadcaster</span><span id="textcolor353">.</span><span id="textcolor354">sendTransform</span><span id="textcolor355">(</span><span id="textcolor356">t</span><span id="textcolor357">)</span></div></pre>
     </div>
     <a id="paragraph*.10">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-15000">
       </a>
       Updating the Package Information
      </span>
      Navigate one level back to the <span id="textcolor358"><code class="verb">src/learning\_tf2\_py</code></span>
      directory, where the <span id="textcolor359"><code class="verb">setup.py</code></span>, <span id="textcolor360"><code class="verb">setup.cfg</code></span>, and <span id="textcolor361"><code class="verb">package.xml</code></span>
      files have been
created for you.
     </p>
     <p class="noindent">
      Open <span id="textcolor362"><code class="verb">package.xml</code></span>
      and make sure to fill in the &lt;description&gt;, &lt;maintainer&gt; and &lt;license&gt; tags:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       xml
      </div>
      <pre><div class="language-xml" id="fancyvrb19" style="padding:20px;border-radius: 3px;"><a id="x3-15002r311"></a><span id="textcolor363">&lt;description</span><span id="textcolor364">&gt;</span>Learning<span id="textcolor365"> </span>tf2<span id="textcolor366"> </span>with<span id="textcolor367"> </span>rclpy<span id="textcolor368">&lt;/description&gt;</span> 
<a id="x3-15004r312"></a><span id="textcolor369">&lt;maintainer</span><span id="textcolor370"> </span><span id="textcolor371">email=</span><span id="textcolor372">"you@email.com"</span><span id="textcolor373">&gt;</span>Your<span id="textcolor374"> </span>Name<span id="textcolor375">&lt;/maintainer&gt;</span> 
<a id="x3-15006r313"></a><span id="textcolor376">&lt;license</span><span id="textcolor377">&gt;</span>Apache<span id="textcolor378"> </span>License<span id="textcolor379"> </span>2.0<span id="textcolor380">&lt;/license&gt;</span></div></pre>
     </div>
     <p class="noindent">
      After the lines above, add the following dependencies corresponding to your nodes import statements:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       xml
      </div>
      <pre><div class="language-xml" id="fancyvrb20" style="padding:20px;border-radius: 3px;"><a id="x3-15008r318"></a><span id="textcolor381">&lt;exec_depend</span><span id="textcolor382">&gt;</span>geometry_msgs<span id="textcolor383">&lt;/exec_depend&gt;</span> 
<a id="x3-15010r319"></a><span id="textcolor384">&lt;exec_depend</span><span id="textcolor385">&gt;</span>python3-numpy<span id="textcolor386">&lt;/exec_depend&gt;</span> 
<a id="x3-15012r320"></a><span id="textcolor387">&lt;exec_depend</span><span id="textcolor388">&gt;</span>rclpy<span id="textcolor389">&lt;/exec_depend&gt;</span> 
<a id="x3-15014r321"></a><span id="textcolor390">&lt;exec_depend</span><span id="textcolor391">&gt;</span>tf2_ros_py<span id="textcolor392">&lt;/exec_depend&gt;</span> 
<a id="x3-15016r322"></a><span id="textcolor393">&lt;exec_depend</span><span id="textcolor394">&gt;</span>turtlesim<span id="textcolor395">&lt;/exec_depend&gt;</span></div></pre>
     </div>
     <p class="noindent">
      This declares the required <span id="textcolor396"><code class="verb">geometry_msgs</code></span>, <span id="textcolor397"><code class="verb">python3-numpy</code></span>, <span id="textcolor398"><code class="verb">rclpy</code></span>, <span id="textcolor399"><code class="verb">tf2_ros_py</code></span>, and <span id="textcolor400"><code class="verb">turtlesim</code></span>
      dependencies when its code is
executed.
      <a id="paragraph*.11">
      </a>
     </p>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-16000">
       </a>
       Adding an Entry Point
      </span>
      To allow the ros2 run command to run your node, you must add the entry point to <span id="textcolor401"><code class="verb">setup.py</code></span>. Add the following line between the <span id="textcolor402"><code class="verb">'console_scripts':</code></span>
      brackets:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb21" style="padding:20px;border-radius: 3px;"><a id="x3-16002r329"></a><span id="textcolor403">'</span><span id="textcolor404">static_turtle_tf2_broadcaster = learning_tf2_py.static_turtle_tf2_broadcaster:main</span><span id="textcolor405">'</span><span id="textcolor406">,</span></div></pre>
     </div>
     <a id="paragraph*.12">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-17000">
       </a>
       Build
      </span>
      Its good practice to run rosdep in the root of your workspace to check for missing dependencies before building:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb22" style="padding:20px;border-radius: 3px;"><a id="x3-17002r336"></a>rosdep<span id="textcolor407"> </span>install<span id="textcolor408"> </span>-i<span id="textcolor409"> </span>--from-path<span id="textcolor410"> </span>src<span id="textcolor411"> </span>--rosdistro<span id="textcolor412"> </span>humble<span id="textcolor413"> </span>-y</div></pre>
     </div>
     <p class="noindent">
      Still in the root of your workspace, build your new package:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb23" style="padding:20px;border-radius: 3px;"><a id="x3-17004r341"></a>colcon<span id="textcolor414"> </span>build<span id="textcolor415"> </span>--packages-select<span id="textcolor416"> </span>learning_tf2_py</div></pre>
     </div>
     <p class="noindent">
      Open a new terminal, navigate to the root of your workspace, and source the setup files:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb24" style="padding:20px;border-radius: 3px;"><a id="x3-17006r346"></a>.<span id="textcolor417"> </span>install/setup.bash</div></pre>
     </div>
     <a id="paragraph*.13">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-18000">
       </a>
       Run
      </span>
      Now run the <span id="textcolor418"><code class="verb">static_turtle_tf2_broadcaster</code></span>
      node:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb25" style="padding:20px;border-radius: 3px;"><a id="x3-18002r353"></a>ros2<span id="textcolor419"> </span>run<span id="textcolor420"> </span><span id="textcolor421">\</span> 
<a id="x3-18004r354"></a><span id="textcolor422">    </span>learning_tf2_py<span id="textcolor423"> </span>static_turtle_tf2_broadcaster<span id="textcolor424"> </span>mystaticturtle<span id="textcolor425"> </span><span id="textcolor426">0</span><span id="textcolor427"> </span><span id="textcolor428">0</span><span id="textcolor429"> </span><span id="textcolor430">1</span><span id="textcolor431"> </span><span id="textcolor432">0</span><span id="textcolor433"> </span><span id="textcolor434">0</span><span id="textcolor435"> </span><span id="textcolor436">0</span></div></pre>
     </div>
     <p class="noindent">
      This sets a turtle pose broadcast for mystaticturtle to float 1 meter above the ground.
     </p>
     <p class="noindent">
      We can now check that the static transform has been published by echoing the <span id="textcolor437"><code class="verb">tf_static</code></span>
      topic If everything is well you should
see a single static transform:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb26" style="padding:20px;border-radius: 3px;"><a id="x3-18006r359"></a>ros2<span id="textcolor438"> </span>topic<span id="textcolor439"> </span><span id="textcolor440">echo</span><span id="textcolor441"> </span>/tf_static</div></pre>
     </div>
     <div class="tcolorbox tcolorbox" id="tcolobox-3">
      <div class="tcolorbox-content">
       <div class="code-block">
        <div class="code-lang">
         text
        </div>
        <pre><div class="language-text" id="fancyvrb27" style="padding:20px;border-radius: 3px;"><a id="x3-18008r1"></a>transforms: 
<a id="x3-18010r2"></a>- header: 
<a id="x3-18012r3"></a>   stamp: 
<a id="x3-18014r4"></a>      sec: 1622908754 
<a id="x3-18016r5"></a>      nanosec: 208515730 
<a id="x3-18018r6"></a>   frame_id: world 
<a id="x3-18020r7"></a>child_frame_id: mystaticturtle 
<a id="x3-18022r8"></a>transform: 
<a id="x3-18024r9"></a>   translation: 
<a id="x3-18026r10"></a>      x: 0.0 
<a id="x3-18028r11"></a>      y: 0.0 
<a id="x3-18030r12"></a>      z: 1.0 
<a id="x3-18032r13"></a>   rotation: 
<a id="x3-18034r14"></a>      x: 0.0 
<a id="x3-18036r15"></a>      y: 0.0 
<a id="x3-18038r16"></a>      z: 0.0 
<a id="x3-18040r17"></a>      w: 1.0</div></pre>
       </div>
      </div>
     </div>
     <h5 class="likesubsubsectionHead">
      <a id="x3-19000">
      </a>
      The Proper way to Publish Static Transforms
     </h5>
     <p class="noindent">
      This tutorial aimed to show how <span id="textcolor442"><code class="verb">StaticTransformBroadcaster</code></span>
      can be used to publish static transforms. In your real development
process you shouldnt have to write this code yourself and should use the dedicated <span id="textcolor443"><code class="verb">tf2_ros</code></span>
      tool to do so. <span id="textcolor444"><code class="verb">tf2_ros</code></span>
      provides an
executable named <span id="textcolor445"><code class="verb">static_transform_publisher</code></span>
      that can be used either as a commandline tool or a node that you can add to your
launchfiles.
     </p>
     <p class="noindent">
      The following command publishes a static coordinate transform to <span id="textcolor446"><code class="verb">tf2</code></span>
      resulting in a 1 meter offset in z and no rotation between
the frames world and mystaticturtle. In ROS 2, roll/pitch/yaw refers to rotation in radians about the x/y/z-axis,
respectively.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb28" style="padding:20px;border-radius: 3px;"><a id="x3-19002r387"></a>ros2<span id="textcolor447"> </span>run<span id="textcolor448"> </span>tf2_ros<span id="textcolor449"> </span><span id="textcolor450">\</span> 
<a id="x3-19004r388"></a><span id="textcolor451">    </span>static_transform_publisher<span id="textcolor452"> </span><span id="textcolor453">\</span> 
<a id="x3-19006r389"></a><span id="textcolor454">    </span>--x<span id="textcolor455"> </span><span id="textcolor456">0</span><span id="textcolor457"> </span>--y<span id="textcolor458"> </span><span id="textcolor459">0</span><span id="textcolor460"> </span>--z<span id="textcolor461"> </span><span id="textcolor462">1</span><span id="textcolor463"> </span><span id="textcolor464">\</span> 
<a id="x3-19008r390"></a><span id="textcolor465">    </span>--yaw<span id="textcolor466"> </span><span id="textcolor467">0</span><span id="textcolor468"> </span>--pitch<span id="textcolor469"> </span><span id="textcolor470">0</span><span id="textcolor471"> </span>--roll<span id="textcolor472"> </span><span id="textcolor473">0</span><span id="textcolor474"> </span><span id="textcolor475">\</span> 
<a id="x3-19010r391"></a><span id="textcolor476">    </span>--frame-id<span id="textcolor477"> </span>world<span id="textcolor478"> </span>--child-frame-id<span id="textcolor479"> </span>mystaticturtle</div></pre>
     </div>
     <p class="noindent">
      The following command publishes the same static coordinate transform to tf2, but using quaternion representation for the
rotation.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb29" style="padding:20px;border-radius: 3px;"><a id="x3-19012r397"></a>ros2<span id="textcolor480"> </span>run<span id="textcolor481"> </span>tf2_ros<span id="textcolor482"> </span><span id="textcolor483">\</span> 
<a id="x3-19014r398"></a><span id="textcolor484">    </span>static_transform_publisher<span id="textcolor485"> </span><span id="textcolor486">\</span> 
<a id="x3-19016r399"></a><span id="textcolor487">    </span>--x<span id="textcolor488"> </span><span id="textcolor489">0</span><span id="textcolor490"> </span>--y<span id="textcolor491"> </span><span id="textcolor492">0</span><span id="textcolor493"> </span>--z<span id="textcolor494"> </span><span id="textcolor495">1</span><span id="textcolor496"> </span><span id="textcolor497">\</span> 
<a id="x3-19018r400"></a><span id="textcolor498">    </span>--qx<span id="textcolor499"> </span><span id="textcolor500">0</span><span id="textcolor501"> </span>--qy<span id="textcolor502"> </span><span id="textcolor503">0</span><span id="textcolor504"> </span>--qz<span id="textcolor505"> </span><span id="textcolor506">0</span><span id="textcolor507"> </span>--qw<span id="textcolor508"> </span><span id="textcolor509">1</span><span id="textcolor510"> </span><span id="textcolor511">\</span> 
<a id="x3-19020r401"></a><span id="textcolor512">    </span>--frame-id<span id="textcolor513"> </span>world<span id="textcolor514"> </span>--child-frame-id<span id="textcolor515"> </span>mystaticturtle</div></pre>
     </div>
     <p class="noindent"> <span id="textcolor516"><code class="verb">static_transform_publisher</code></span>
      is designed both as a command-line tool for manual use, as well as for use within launch files for
setting static transforms. For example:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb30" style="padding:20px;border-radius: 3px;"><a id="x3-19022r406"></a><span id="textcolor517">from</span><span id="textcolor518"> </span><span id="textcolor519">launch</span><span id="textcolor520"> </span><span id="textcolor521">import</span> <span id="textcolor522">LaunchDescription</span> 
<a id="x3-19024r407"></a><span id="textcolor523">from</span><span id="textcolor524"> </span><span id="textcolor525">launch_ros</span><span id="textcolor526">.</span><span id="textcolor527">actions</span><span id="textcolor528"> </span><span id="textcolor529">import</span> <span id="textcolor530">Node</span> 
<a id="x3-19026r408"></a> 
<a id="x3-19028r409"></a> 
<a id="x3-19030r410"></a><span id="textcolor531">def</span><span id="textcolor532"> </span><span id="textcolor533">generate_launch_description</span><span id="textcolor534">(</span><span id="textcolor535">)</span><span id="textcolor536">:</span> 
<a id="x3-19032r411"></a>   <span id="textcolor537">return</span> <span id="textcolor538">LaunchDescription</span><span id="textcolor539">(</span><span id="textcolor540">[</span> 
<a id="x3-19034r412"></a>      <span id="textcolor541">Node</span><span id="textcolor542">(</span> 
<a id="x3-19036r413"></a>         <span id="textcolor543">package</span><span id="textcolor544">=</span><span id="textcolor545">'</span><span id="textcolor546">tf2_ros</span><span id="textcolor547">'</span><span id="textcolor548">,</span> 
<a id="x3-19038r414"></a>         <span id="textcolor549">executable</span><span id="textcolor550">=</span><span id="textcolor551">'</span><span id="textcolor552">static_transform_publisher</span><span id="textcolor553">'</span><span id="textcolor554">,</span> 
<a id="x3-19040r415"></a>         <span id="textcolor555">arguments</span><span id="textcolor556">=</span><span id="textcolor557">[</span> 
<a id="x3-19042r416"></a>            <span id="textcolor558">'</span><span id="textcolor559">--x</span><span id="textcolor560">'</span><span id="textcolor561">,</span> <span id="textcolor562">'</span><span id="textcolor563">0</span><span id="textcolor564">'</span><span id="textcolor565">,</span> <span id="textcolor566">'</span><span id="textcolor567">--y</span><span id="textcolor568">'</span><span id="textcolor569">,</span> <span id="textcolor570">'</span><span id="textcolor571">0</span><span id="textcolor572">'</span><span id="textcolor573">,</span> <span id="textcolor574">'</span><span id="textcolor575">--z</span><span id="textcolor576">'</span><span id="textcolor577">,</span> <span id="textcolor578">'</span><span id="textcolor579">1</span><span id="textcolor580">'</span><span id="textcolor581">,</span> 
<a id="x3-19044r417"></a>            <span id="textcolor582">'</span><span id="textcolor583">--yaw</span><span id="textcolor584">'</span><span id="textcolor585">,</span> <span id="textcolor586">'</span><span id="textcolor587">0</span><span id="textcolor588">'</span><span id="textcolor589">,</span> <span id="textcolor590">'</span><span id="textcolor591">--pitch</span><span id="textcolor592">'</span><span id="textcolor593">,</span> <span id="textcolor594">'</span><span id="textcolor595">0</span><span id="textcolor596">'</span><span id="textcolor597">,</span> <span id="textcolor598">'</span><span id="textcolor599">--roll</span><span id="textcolor600">'</span><span id="textcolor601">,</span> 
<a id="x3-19046r418"></a>            <span id="textcolor602">'</span><span id="textcolor603">0</span><span id="textcolor604">'</span><span id="textcolor605">,</span> <span id="textcolor606">'</span><span id="textcolor607">--frame-id</span><span id="textcolor608">'</span><span id="textcolor609">,</span> <span id="textcolor610">'</span><span id="textcolor611">world</span><span id="textcolor612">'</span><span id="textcolor613">,</span> <span id="textcolor614">'</span><span id="textcolor615">--child-frame-id</span><span id="textcolor616">'</span><span id="textcolor617">,</span> <span id="textcolor618">'</span><span id="textcolor619">mystaticturtle</span><span id="textcolor620">'</span><span id="textcolor621">]</span> 
<a id="x3-19048r419"></a>      <span id="textcolor622">)</span><span id="textcolor623">,</span> 
<a id="x3-19050r420"></a>   <span id="textcolor624">]</span><span id="textcolor625">)</span></div></pre>
     </div>
     <p class="noindent">
      Note that all arguments except for –frame-id and –child-frame-id are optional; if a particular option isnt specified, then the
identity will be assumed.
     </p>
     <p class="noindent">
     </p>
    </div>
    <div class="section-head" id="section-3" sec="section-3">
     <h2 class="sectionHead">
      <a aria-label="Link to this section in PDF version" class="pdf-link" href="MobileRoboticsLectureBook.pdf#section.1.3" style="color: red;  position: absolute;  left: -30px;" target="_blank">
       <svg class="bi bi-file-pdf" fill="currentColor" height="20" viewbox="0 0 16 16" width="20" xmlns="http://www.w3.org/2000/svg">
        <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z">
        </path>
        <path d="M4.603 12.087a.81.81 0 0 1-.438-.42c-.195-.388-.13-.776.08-1.102.198-.307.526-.568.897-.787a7.68 7.68 0 0 1 1.482-.645 19.701 19.701 0 0 0 1.062-2.227 7.269 7.269 0 0 1-.43-1.295c-.086-.4-.119-.796-.046-1.136.075-.354.274-.672.65-.823.192-.077.4-.12.602-.077a.7.7 0 0 1 .477.365c.088.164.12.356.127.538.007.187-.012.395-.047.614-.084.51-.27 1.134-.52 1.794a10.954 10.954 0 0 0 .98 1.686 5.753 5.753 0 0 1 1.334.05c.364.065.734.195.96.465.12.144.193.32.2.518.007.192-.047.382-.138.563a1.04 1.04 0 0 1-.354.416.856.856 0 0 1-.51.138c-.331-.014-.654-.196-.933-.417a5.716 5.716 0 0 1-.911-.95 11.642 11.642 0 0 0-1.997.406 11.311 11.311 0 0 1-1.021 1.51c-.29.35-.608.655-.926.787a.793.793 0 0 1-.58.029zm1.379-1.901c-.166.076-.32.156-.459.238-.328.194-.541.383-.647.547-.094.145-.096.25-.04.361.01.022.02.036.026.044a.27.27 0 0 0 .035-.012c.137-.056.355-.235.635-.572a8.18 8.18 0 0 0 .45-.606zm1.64-1.33a12.647 12.647 0 0 1 1.01-.193 11.666 11.666 0 0 1-.51-.858 20.741 20.741 0 0 1-.5 1.05zm2.446.45c.15.162.296.3.435.41.24.19.407.253.498.256a.107.107 0 0 0 .07-.015.307.307 0 0 0 .094-.125.436.436 0 0 0 .059-.2.095.095 0 0 0-.026-.063c-.052-.062-.2-.152-.518-.209a3.881 3.881 0 0 0-.612-.053zM8.078 5.8a6.7 6.7 0 0 0 .2-.828c.031-.188.043-.343.038-.465a.613.613 0 0 0-.032-.198.517.517 0 0 0-.145.04c-.087.035-.158.106-.196.283-.04.192-.03.469.046.822.024.111.054.227.09.346z">
        </path>
       </svg>
      </a>
      <small class="titlemark">
       1.3
      </small>
      <a id="x3-200001.3">
      </a>
      Writing a Listener
     </h2>
     <a id="paragraph*.14">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-21000">
       </a>
       Writing the Listener Node
      </span>
      Lets first create the source files. Go to the <span id="textcolor626"><code class="verb">learning_tf2_py</code></span>
      package we created in the previous tutorial. Inside the <span id="textcolor627"><code class="verb">src/learning\_tf2\_py/learning\_tf2\_py</code></span>
      directory download the example listener code by entering the following
command:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb31" style="padding:20px;border-radius: 3px;"><a id="x3-21002r727"></a>wget<span id="textcolor628"> </span>https://raw.githubusercontent.com/ros/geometry_tutorials/humble/turtle_tf2_py/turtle_tf2_py/turtle_tf2_listener.py</div></pre>
     </div>
     <p class="noindent">
      Now open the file called <span id="textcolor629"><code class="verb">turtle_tf2_listener.py</code></span>
      using your preferred text editor.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb32" style="padding:20px;border-radius: 3px;"><a id="x3-21004r732"></a><span id="textcolor630">import</span><span id="textcolor631"> </span><span id="textcolor632">math</span> 
<a id="x3-21006r733"></a> 
<a id="x3-21008r734"></a><span id="textcolor633">from</span><span id="textcolor634"> </span><span id="textcolor635">geometry_msgs</span><span id="textcolor636">.</span><span id="textcolor637">msg</span><span id="textcolor638"> </span><span id="textcolor639">import</span> <span id="textcolor640">Twist</span> 
<a id="x3-21010r735"></a> 
<a id="x3-21012r736"></a><span id="textcolor641">import</span><span id="textcolor642"> </span><span id="textcolor643">rclpy</span> 
<a id="x3-21014r737"></a><span id="textcolor644">from</span><span id="textcolor645"> </span><span id="textcolor646">rclpy</span><span id="textcolor647">.</span><span id="textcolor648">node</span><span id="textcolor649"> </span><span id="textcolor650">import</span> <span id="textcolor651">Node</span> 
<a id="x3-21016r738"></a> 
<a id="x3-21018r739"></a><span id="textcolor652">from</span><span id="textcolor653"> </span><span id="textcolor654">tf2_ros</span><span id="textcolor655"> </span><span id="textcolor656">import</span> <span id="textcolor657">TransformException</span> 
<a id="x3-21020r740"></a><span id="textcolor658">from</span><span id="textcolor659"> </span><span id="textcolor660">tf2_ros</span><span id="textcolor661">.</span><span id="textcolor662">buffer</span><span id="textcolor663"> </span><span id="textcolor664">import</span> <span id="textcolor665">Buffer</span> 
<a id="x3-21022r741"></a><span id="textcolor666">from</span><span id="textcolor667"> </span><span id="textcolor668">tf2_ros</span><span id="textcolor669">.</span><span id="textcolor670">transform_listener</span><span id="textcolor671"> </span><span id="textcolor672">import</span> <span id="textcolor673">TransformListener</span> 
<a id="x3-21024r742"></a> 
<a id="x3-21026r743"></a><span id="textcolor674">from</span><span id="textcolor675"> </span><span id="textcolor676">turtlesim</span><span id="textcolor677">.</span><span id="textcolor678">srv</span><span id="textcolor679"> </span><span id="textcolor680">import</span> <span id="textcolor681">Spawn</span> 
<a id="x3-21028r744"></a> 
<a id="x3-21030r745"></a> 
<a id="x3-21032r746"></a><span id="textcolor682">class</span><span id="textcolor683"> </span><span id="textcolor684">FrameListener</span><span id="textcolor685">(</span><span id="textcolor686">Node</span><span id="textcolor687">)</span><span id="textcolor688">:</span> 
<a id="x3-21034r747"></a> 
<a id="x3-21036r748"></a>   <span id="textcolor689">def</span><span id="textcolor690"> </span><span id="textcolor691">__init__</span><span id="textcolor692">(</span><span id="textcolor693">self</span><span id="textcolor694">)</span><span id="textcolor695">:</span> 
<a id="x3-21038r749"></a>      <span id="textcolor696">super</span><span id="textcolor697">(</span><span id="textcolor698">)</span><span id="textcolor699">.</span><span id="textcolor700">__init__</span><span id="textcolor701">(</span><span id="textcolor702">'</span><span id="textcolor703">turtle_tf2_frame_listener</span><span id="textcolor704">'</span><span id="textcolor705">)</span> 
<a id="x3-21040r750"></a> 
<a id="x3-21042r751"></a>      <span id="textcolor706"># Declare and acquire `target_frame` parameter</span> 
<a id="x3-21044r752"></a>      <span id="textcolor707">self</span><span id="textcolor708">.</span><span id="textcolor709">target_frame</span> <span id="textcolor710">=</span> <span id="textcolor711">self</span><span id="textcolor712">.</span><span id="textcolor713">declare_parameter</span><span id="textcolor714">(</span> 
<a id="x3-21046r753"></a>       <span id="textcolor715">'</span><span id="textcolor716">target_frame</span><span id="textcolor717">'</span><span id="textcolor718">,</span> <span id="textcolor719">'</span><span id="textcolor720">turtle1</span><span id="textcolor721">'</span><span id="textcolor722">)</span><span id="textcolor723">.</span><span id="textcolor724">get_parameter_value</span><span id="textcolor725">(</span><span id="textcolor726">)</span><span id="textcolor727">.</span><span id="textcolor728">string_value</span> 
<a id="x3-21048r754"></a> 
<a id="x3-21050r755"></a>      <span id="textcolor729">self</span><span id="textcolor730">.</span><span id="textcolor731">tf_buffer</span> <span id="textcolor732">=</span> <span id="textcolor733">Buffer</span><span id="textcolor734">(</span><span id="textcolor735">)</span> 
<a id="x3-21052r756"></a>      <span id="textcolor736">self</span><span id="textcolor737">.</span><span id="textcolor738">tf_listener</span> <span id="textcolor739">=</span> <span id="textcolor740">TransformListener</span><span id="textcolor741">(</span><span id="textcolor742">self</span><span id="textcolor743">.</span><span id="textcolor744">tf_buffer</span><span id="textcolor745">,</span> <span id="textcolor746">self</span><span id="textcolor747">)</span> 
<a id="x3-21054r757"></a> 
<a id="x3-21056r758"></a>      <span id="textcolor748"># Create a client to spawn a turtle</span> 
<a id="x3-21058r759"></a>      <span id="textcolor749">self</span><span id="textcolor750">.</span><span id="textcolor751">spawner</span> <span id="textcolor752">=</span> <span id="textcolor753">self</span><span id="textcolor754">.</span><span id="textcolor755">create_client</span><span id="textcolor756">(</span><span id="textcolor757">Spawn</span><span id="textcolor758">,</span> <span id="textcolor759">'</span><span id="textcolor760">spawn</span><span id="textcolor761">'</span><span id="textcolor762">)</span> 
<a id="x3-21060r760"></a>      <span id="textcolor763"># Boolean values to store the information</span> 
<a id="x3-21062r761"></a>      <span id="textcolor764"># if the service for spawning turtle is available</span> 
<a id="x3-21064r762"></a>      <span id="textcolor765">self</span><span id="textcolor766">.</span><span id="textcolor767">turtle_spawning_service_ready</span> <span id="textcolor768">=</span> <span id="textcolor769">False</span> 
<a id="x3-21066r763"></a>      <span id="textcolor770"># if the turtle was successfully spawned</span> 
<a id="x3-21068r764"></a>      <span id="textcolor771">self</span><span id="textcolor772">.</span><span id="textcolor773">turtle_spawned</span> <span id="textcolor774">=</span> <span id="textcolor775">False</span> 
<a id="x3-21070r765"></a> 
<a id="x3-21072r766"></a>      <span id="textcolor776"># Create turtle2 velocity publisher</span> 
<a id="x3-21074r767"></a>      <span id="textcolor777">self</span><span id="textcolor778">.</span><span id="textcolor779">publisher</span> <span id="textcolor780">=</span> <span id="textcolor781">self</span><span id="textcolor782">.</span><span id="textcolor783">create_publisher</span><span id="textcolor784">(</span><span id="textcolor785">Twist</span><span id="textcolor786">,</span> <span id="textcolor787">'</span><span id="textcolor788">turtle2/cmd_vel</span><span id="textcolor789">'</span><span id="textcolor790">,</span> <span id="textcolor791">1</span><span id="textcolor792">)</span> 
<a id="x3-21076r768"></a> 
<a id="x3-21078r769"></a>      <span id="textcolor793"># Call on_timer function every second</span> 
<a id="x3-21080r770"></a>      <span id="textcolor794">self</span><span id="textcolor795">.</span><span id="textcolor796">timer</span> <span id="textcolor797">=</span> <span id="textcolor798">self</span><span id="textcolor799">.</span><span id="textcolor800">create_timer</span><span id="textcolor801">(</span><span id="textcolor802">1.0</span><span id="textcolor803">,</span> <span id="textcolor804">self</span><span id="textcolor805">.</span><span id="textcolor806">on_timer</span><span id="textcolor807">)</span> 
<a id="x3-21082r771"></a> 
<a id="x3-21084r772"></a>   <span id="textcolor808">def</span><span id="textcolor809"> </span><span id="textcolor810">on_timer</span><span id="textcolor811">(</span><span id="textcolor812">self</span><span id="textcolor813">)</span><span id="textcolor814">:</span> 
<a id="x3-21086r773"></a>      <span id="textcolor815"># Store frame names in variables that will be used to</span> 
<a id="x3-21088r774"></a>      <span id="textcolor816"># compute transformations</span> 
<a id="x3-21090r775"></a>      <span id="textcolor817">from_frame_rel</span> <span id="textcolor818">=</span> <span id="textcolor819">self</span><span id="textcolor820">.</span><span id="textcolor821">target_frame</span> 
<a id="x3-21092r776"></a>      <span id="textcolor822">to_frame_rel</span> <span id="textcolor823">=</span> <span id="textcolor824">'</span><span id="textcolor825">turtle2</span><span id="textcolor826">'</span> 
<a id="x3-21094r777"></a> 
<a id="x3-21096r778"></a>      <span id="textcolor827">if</span> <span id="textcolor828">self</span><span id="textcolor829">.</span><span id="textcolor830">turtle_spawning_service_ready</span><span id="textcolor831">:</span> 
<a id="x3-21098r779"></a>         <span id="textcolor832">if</span> <span id="textcolor833">self</span><span id="textcolor834">.</span><span id="textcolor835">turtle_spawned</span><span id="textcolor836">:</span> 
<a id="x3-21100r780"></a>            <span id="textcolor837"># Look up for the transformation between target_frame and turtle2 frames</span> 
<a id="x3-21102r781"></a>            <span id="textcolor838"># and send velocity commands for turtle2 to reach target_frame</span> 
<a id="x3-21104r782"></a>            <span id="textcolor839">try</span><span id="textcolor840">:</span> 
<a id="x3-21106r783"></a>              <span id="textcolor841">t</span> <span id="textcolor842">=</span> <span id="textcolor843">self</span><span id="textcolor844">.</span><span id="textcolor845">tf_buffer</span><span id="textcolor846">.</span><span id="textcolor847">lookup_transform</span><span id="textcolor848">(</span> 
<a id="x3-21108r784"></a>                 <span id="textcolor849">to_frame_rel</span><span id="textcolor850">,</span> 
<a id="x3-21110r785"></a>                 <span id="textcolor851">from_frame_rel</span><span id="textcolor852">,</span> 
<a id="x3-21112r786"></a>                 <span id="textcolor853">rclpy</span><span id="textcolor854">.</span><span id="textcolor855">time</span><span id="textcolor856">.</span><span id="textcolor857">Time</span><span id="textcolor858">(</span><span id="textcolor859">)</span><span id="textcolor860">)</span> 
<a id="x3-21114r787"></a>            <span id="textcolor861">except</span> <span id="textcolor862">TransformException</span> <span id="textcolor863">as</span> <span id="textcolor864">ex</span><span id="textcolor865">:</span> 
<a id="x3-21116r788"></a>              <span id="textcolor866">self</span><span id="textcolor867">.</span><span id="textcolor868">get_logger</span><span id="textcolor869">(</span><span id="textcolor870">)</span><span id="textcolor871">.</span><span id="textcolor872">info</span><span id="textcolor873">(</span> 
<a id="x3-21118r789"></a>                 <span id="textcolor874">f</span><span id="textcolor875">'</span><span id="textcolor876">Could not transform </span><span id="textcolor877">{</span><span id="textcolor878">to_frame_rel</span><span id="textcolor879">}</span><span id="textcolor880"> to </span><span id="textcolor881">{</span><span id="textcolor882">from_frame_rel</span><span id="textcolor883">}</span><span id="textcolor884">: </span><span id="textcolor885">{</span><span id="textcolor886">ex</span><span id="textcolor887">}</span><span id="textcolor888">'</span><span id="textcolor889">)</span> 
<a id="x3-21120r790"></a>              <span id="textcolor890">return</span> 
<a id="x3-21122r791"></a> 
<a id="x3-21124r792"></a>            <span id="textcolor891">msg</span> <span id="textcolor892">=</span> <span id="textcolor893">Twist</span><span id="textcolor894">(</span><span id="textcolor895">)</span> 
<a id="x3-21126r793"></a>            <span id="textcolor896">scale_rotation_rate</span> <span id="textcolor897">=</span> <span id="textcolor898">1.0</span> 
<a id="x3-21128r794"></a>            <span id="textcolor899">msg</span><span id="textcolor900">.</span><span id="textcolor901">angular</span><span id="textcolor902">.</span><span id="textcolor903">z</span> <span id="textcolor904">=</span> <span id="textcolor905">scale_rotation_rate</span> <span id="textcolor906">*</span> <span id="textcolor907">math</span><span id="textcolor908">.</span><span id="textcolor909">atan2</span><span id="textcolor910">(</span> 
<a id="x3-21130r795"></a>              <span id="textcolor911">t</span><span id="textcolor912">.</span><span id="textcolor913">transform</span><span id="textcolor914">.</span><span id="textcolor915">translation</span><span id="textcolor916">.</span><span id="textcolor917">y</span><span id="textcolor918">,</span> 
<a id="x3-21132r796"></a>              <span id="textcolor919">t</span><span id="textcolor920">.</span><span id="textcolor921">transform</span><span id="textcolor922">.</span><span id="textcolor923">translation</span><span id="textcolor924">.</span><span id="textcolor925">x</span><span id="textcolor926">)</span> 
<a id="x3-21134r797"></a> 
<a id="x3-21136r798"></a>            <span id="textcolor927">scale_forward_speed</span> <span id="textcolor928">=</span> <span id="textcolor929">0.5</span> 
<a id="x3-21138r799"></a>            <span id="textcolor930">msg</span><span id="textcolor931">.</span><span id="textcolor932">linear</span><span id="textcolor933">.</span><span id="textcolor934">x</span> <span id="textcolor935">=</span> <span id="textcolor936">scale_forward_speed</span> <span id="textcolor937">*</span> <span id="textcolor938">math</span><span id="textcolor939">.</span><span id="textcolor940">sqrt</span><span id="textcolor941">(</span> 
<a id="x3-21140r800"></a>              <span id="textcolor942">t</span><span id="textcolor943">.</span><span id="textcolor944">transform</span><span id="textcolor945">.</span><span id="textcolor946">translation</span><span id="textcolor947">.</span><span id="textcolor948">x</span> <span id="textcolor949">*</span><span id="textcolor950">*</span> <span id="textcolor951">2</span> <span id="textcolor952">+</span> 
<a id="x3-21142r801"></a>              <span id="textcolor953">t</span><span id="textcolor954">.</span><span id="textcolor955">transform</span><span id="textcolor956">.</span><span id="textcolor957">translation</span><span id="textcolor958">.</span><span id="textcolor959">y</span> <span id="textcolor960">*</span><span id="textcolor961">*</span> <span id="textcolor962">2</span><span id="textcolor963">)</span> 
<a id="x3-21144r802"></a> 
<a id="x3-21146r803"></a>            <span id="textcolor964">self</span><span id="textcolor965">.</span><span id="textcolor966">publisher</span><span id="textcolor967">.</span><span id="textcolor968">publish</span><span id="textcolor969">(</span><span id="textcolor970">msg</span><span id="textcolor971">)</span> 
<a id="x3-21148r804"></a>         <span id="textcolor972">else</span><span id="textcolor973">:</span> 
<a id="x3-21150r805"></a>            <span id="textcolor974">if</span> <span id="textcolor975">self</span><span id="textcolor976">.</span><span id="textcolor977">result</span><span id="textcolor978">.</span><span id="textcolor979">done</span><span id="textcolor980">(</span><span id="textcolor981">)</span><span id="textcolor982">:</span> 
<a id="x3-21152r806"></a>              <span id="textcolor983">self</span><span id="textcolor984">.</span><span id="textcolor985">get_logger</span><span id="textcolor986">(</span><span id="textcolor987">)</span><span id="textcolor988">.</span><span id="textcolor989">info</span><span id="textcolor990">(</span> 
<a id="x3-21154r807"></a>                 <span id="textcolor991">f</span><span id="textcolor992">'</span><span id="textcolor993">Successfully spawned </span><span id="textcolor994">{</span><span id="textcolor995">self</span><span id="textcolor996">.</span><span id="textcolor997">result</span><span id="textcolor998">.</span><span id="textcolor999">result</span><span id="textcolor1000">(</span><span id="textcolor1001">)</span><span id="textcolor1002">.</span><span id="textcolor1003">name</span><span id="textcolor1004">}</span><span id="textcolor1005">'</span><span id="textcolor1006">)</span> 
<a id="x3-21156r808"></a>              <span id="textcolor1007">self</span><span id="textcolor1008">.</span><span id="textcolor1009">turtle_spawned</span> <span id="textcolor1010">=</span> <span id="textcolor1011">True</span> 
<a id="x3-21158r809"></a>            <span id="textcolor1012">else</span><span id="textcolor1013">:</span> 
<a id="x3-21160r810"></a>              <span id="textcolor1014">self</span><span id="textcolor1015">.</span><span id="textcolor1016">get_logger</span><span id="textcolor1017">(</span><span id="textcolor1018">)</span><span id="textcolor1019">.</span><span id="textcolor1020">info</span><span id="textcolor1021">(</span><span id="textcolor1022">'</span><span id="textcolor1023">Spawn is not finished</span><span id="textcolor1024">'</span><span id="textcolor1025">)</span> 
<a id="x3-21162r811"></a>      <span id="textcolor1026">else</span><span id="textcolor1027">:</span> 
<a id="x3-21164r812"></a>         <span id="textcolor1028">if</span> <span id="textcolor1029">self</span><span id="textcolor1030">.</span><span id="textcolor1031">spawner</span><span id="textcolor1032">.</span><span id="textcolor1033">service_is_ready</span><span id="textcolor1034">(</span><span id="textcolor1035">)</span><span id="textcolor1036">:</span> 
<a id="x3-21166r813"></a>            <span id="textcolor1037"># Initialize request with turtle name and coordinates</span> 
<a id="x3-21168r814"></a>            <span id="textcolor1038"># Note that x, y and theta are defined as floats in turtlesim/srv/Spawn</span> 
<a id="x3-21170r815"></a>            <span id="textcolor1039">request</span> <span id="textcolor1040">=</span> <span id="textcolor1041">Spawn</span><span id="textcolor1042">.</span><span id="textcolor1043">Request</span><span id="textcolor1044">(</span><span id="textcolor1045">)</span> 
<a id="x3-21172r816"></a>            <span id="textcolor1046">request</span><span id="textcolor1047">.</span><span id="textcolor1048">name</span> <span id="textcolor1049">=</span> <span id="textcolor1050">'</span><span id="textcolor1051">turtle2</span><span id="textcolor1052">'</span> 
<a id="x3-21174r817"></a>            <span id="textcolor1053">request</span><span id="textcolor1054">.</span><span id="textcolor1055">x</span> <span id="textcolor1056">=</span> <span id="textcolor1057">float</span><span id="textcolor1058">(</span><span id="textcolor1059">4</span><span id="textcolor1060">)</span> 
<a id="x3-21176r818"></a>            <span id="textcolor1061">request</span><span id="textcolor1062">.</span><span id="textcolor1063">y</span> <span id="textcolor1064">=</span> <span id="textcolor1065">float</span><span id="textcolor1066">(</span><span id="textcolor1067">2</span><span id="textcolor1068">)</span> 
<a id="x3-21178r819"></a>            <span id="textcolor1069">request</span><span id="textcolor1070">.</span><span id="textcolor1071">theta</span> <span id="textcolor1072">=</span> <span id="textcolor1073">float</span><span id="textcolor1074">(</span><span id="textcolor1075">0</span><span id="textcolor1076">)</span> 
<a id="x3-21180r820"></a>            <span id="textcolor1077"># Call request</span> 
<a id="x3-21182r821"></a>            <span id="textcolor1078">self</span><span id="textcolor1079">.</span><span id="textcolor1080">result</span> <span id="textcolor1081">=</span> <span id="textcolor1082">self</span><span id="textcolor1083">.</span><span id="textcolor1084">spawner</span><span id="textcolor1085">.</span><span id="textcolor1086">call_async</span><span id="textcolor1087">(</span><span id="textcolor1088">request</span><span id="textcolor1089">)</span> 
<a id="x3-21184r822"></a>            <span id="textcolor1090">self</span><span id="textcolor1091">.</span><span id="textcolor1092">turtle_spawning_service_ready</span> <span id="textcolor1093">=</span> <span id="textcolor1094">True</span> 
<a id="x3-21186r823"></a>         <span id="textcolor1095">else</span><span id="textcolor1096">:</span> 
<a id="x3-21188r824"></a>            <span id="textcolor1097"># Check if the service is ready</span> 
<a id="x3-21190r825"></a>            <span id="textcolor1098">self</span><span id="textcolor1099">.</span><span id="textcolor1100">get_logger</span><span id="textcolor1101">(</span><span id="textcolor1102">)</span><span id="textcolor1103">.</span><span id="textcolor1104">info</span><span id="textcolor1105">(</span><span id="textcolor1106">'</span><span id="textcolor1107">Service is not ready</span><span id="textcolor1108">'</span><span id="textcolor1109">)</span> 
<a id="x3-21192r826"></a> 
<a id="x3-21194r827"></a> 
<a id="x3-21196r828"></a><span id="textcolor1110">def</span><span id="textcolor1111"> </span><span id="textcolor1112">main</span><span id="textcolor1113">(</span><span id="textcolor1114">)</span><span id="textcolor1115">:</span> 
<a id="x3-21198r829"></a>   <span id="textcolor1116">rclpy</span><span id="textcolor1117">.</span><span id="textcolor1118">init</span><span id="textcolor1119">(</span><span id="textcolor1120">)</span> 
<a id="x3-21200r830"></a>   <span id="textcolor1121">node</span> <span id="textcolor1122">=</span> <span id="textcolor1123">FrameListener</span><span id="textcolor1124">(</span><span id="textcolor1125">)</span> 
<a id="x3-21202r831"></a>   <span id="textcolor1126">try</span><span id="textcolor1127">:</span> 
<a id="x3-21204r832"></a>      <span id="textcolor1128">rclpy</span><span id="textcolor1129">.</span><span id="textcolor1130">spin</span><span id="textcolor1131">(</span><span id="textcolor1132">node</span><span id="textcolor1133">)</span> 
<a id="x3-21206r833"></a>   <span id="textcolor1134">except</span> <span id="textcolor1135">KeyboardInterrupt</span><span id="textcolor1136">:</span> 
<a id="x3-21208r834"></a>      <span id="textcolor1137">pass</span> 
<a id="x3-21210r835"></a> 
<a id="x3-21212r836"></a>   <span id="textcolor1138">rclpy</span><span id="textcolor1139">.</span><span id="textcolor1140">shutdown</span><span id="textcolor1141">(</span><span id="textcolor1142">)</span></div></pre>
     </div>
     <a id="paragraph*.15">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-22000">
       </a>
       Examining the Code
      </span>
      Now, lets take a look at the code that is relevant to get access to frame transformations. The <span id="textcolor1143"><code class="verb">tf2_ros</code></span>
      package provides an
implementation of a TransformListener to help make the task of receiving transforms easier.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb33" style="padding:20px;border-radius: 3px;"><a id="x3-22002r843"></a><span id="textcolor1144">from</span><span id="textcolor1145"> </span><span id="textcolor1146">tf2_ros</span><span id="textcolor1147">.</span><span id="textcolor1148">transform_listener</span><span id="textcolor1149"> </span><span id="textcolor1150">import</span> <span id="textcolor1151">TransformListener</span></div></pre>
     </div>
     <p class="noindent">
      Here, we create a TransformListener object. Once the listener is created, it starts receiving tf2 transformations over the wire, and
buffers them for up to 10 seconds.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb34" style="padding:20px;border-radius: 3px;"><a id="x3-22004r848"></a><span id="textcolor1152">self</span><span id="textcolor1153">.</span><span id="textcolor1154">tf_listener</span> <span id="textcolor1155">=</span> <span id="textcolor1156">TransformListener</span><span id="textcolor1157">(</span><span id="textcolor1158">self</span><span id="textcolor1159">.</span><span id="textcolor1160">tf_buffer</span><span id="textcolor1161">,</span> <span id="textcolor1162">self</span><span id="textcolor1163">)</span></div></pre>
     </div>
     <p class="noindent">
      Finally, we query the listener for a specific transformation. We call <span id="textcolor1164"><code class="verb">lookup_transform</code></span>
      method with following arguments:
     </p>
     <ul class="itemize1">
      <li class="itemize">
       <p class="noindent">
        Target
frame
       </p>
      </li>
      <li class="itemize">
       <p class="noindent">
        Source
frame
       </p>
      </li>
      <li class="itemize">
       <p class="noindent">
        The
time
at
which
we
want
to
transform
       </p>
      </li>
     </ul>
     <p class="noindent">
      Providing <span id="textcolor1168"><code class="verb">rclpy.time.Time()</code></span>
      will just get us the latest available transform. All this is wrapped in a try-except block to handle
possible exceptions.
      <a id="paragraph*.16">
      </a>
     </p>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-23000">
       </a>
       Adding an Entry Point
      </span>
      To allow the ros2 run command to run your node, you must add the entry point to setup.py (located in the <span id="textcolor1169"><code class="verb">src/learning\_tf2\_py directory</code></span>
      ).
     </p>
     <p class="noindent">
      Add the following line between the <span id="textcolor1170"><code class="verb">'console_scripts':</code></span>
      brackets:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb35" style="padding:20px;border-radius: 3px;"><a id="x3-23002r863"></a><span id="textcolor1171">'</span><span id="textcolor1172">turtle_tf2_listener = learning_tf2_py.turtle_tf2_listener:main</span><span id="textcolor1173">'</span><span id="textcolor1174">,</span></div></pre>
     </div>
     <a id="paragraph*.17">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-24000">
       </a>
       Updating the Launch Files
      </span>
      Open the launch file called <span id="textcolor1175"><code class="verb">turtle_tf2_demo.launch.py</code></span>
      in the <span id="textcolor1176"><code class="verb">src/learning\_tf2\_py/launch</code></span>
      directory with your text editor, add
two new nodes to the launch description, add a launch argument, and add the imports. The resulting file should look
like:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb36" style="padding:20px;border-radius: 3px;"><a id="x3-24002r870"></a><span id="textcolor1177">from</span><span id="textcolor1178"> </span><span id="textcolor1179">launch</span><span id="textcolor1180"> </span><span id="textcolor1181">import</span> <span id="textcolor1182">LaunchDescription</span> 
<a id="x3-24004r871"></a><span id="textcolor1183">from</span><span id="textcolor1184"> </span><span id="textcolor1185">launch</span><span id="textcolor1186">.</span><span id="textcolor1187">actions</span><span id="textcolor1188"> </span><span id="textcolor1189">import</span> <span id="textcolor1190">DeclareLaunchArgument</span> 
<a id="x3-24006r872"></a><span id="textcolor1191">from</span><span id="textcolor1192"> </span><span id="textcolor1193">launch</span><span id="textcolor1194">.</span><span id="textcolor1195">substitutions</span><span id="textcolor1196"> </span><span id="textcolor1197">import</span> <span id="textcolor1198">LaunchConfiguration</span> 
<a id="x3-24008r873"></a> 
<a id="x3-24010r874"></a><span id="textcolor1199">from</span><span id="textcolor1200"> </span><span id="textcolor1201">launch_ros</span><span id="textcolor1202">.</span><span id="textcolor1203">actions</span><span id="textcolor1204"> </span><span id="textcolor1205">import</span> <span id="textcolor1206">Node</span> 
<a id="x3-24012r875"></a> 
<a id="x3-24014r876"></a> 
<a id="x3-24016r877"></a><span id="textcolor1207">def</span><span id="textcolor1208"> </span><span id="textcolor1209">generate_launch_description</span><span id="textcolor1210">(</span><span id="textcolor1211">)</span><span id="textcolor1212">:</span> 
<a id="x3-24018r878"></a>   <span id="textcolor1213">return</span> <span id="textcolor1214">LaunchDescription</span><span id="textcolor1215">(</span><span id="textcolor1216">[</span> 
<a id="x3-24020r879"></a>      <span id="textcolor1217">Node</span><span id="textcolor1218">(</span> 
<a id="x3-24022r880"></a>         <span id="textcolor1219">package</span><span id="textcolor1220">=</span><span id="textcolor1221">'</span><span id="textcolor1222">turtlesim</span><span id="textcolor1223">'</span><span id="textcolor1224">,</span> 
<a id="x3-24024r881"></a>         <span id="textcolor1225">executable</span><span id="textcolor1226">=</span><span id="textcolor1227">'</span><span id="textcolor1228">turtlesim_node</span><span id="textcolor1229">'</span><span id="textcolor1230">,</span> 
<a id="x3-24026r882"></a>         <span id="textcolor1231">name</span><span id="textcolor1232">=</span><span id="textcolor1233">'</span><span id="textcolor1234">sim</span><span id="textcolor1235">'</span> 
<a id="x3-24028r883"></a>      <span id="textcolor1236">)</span><span id="textcolor1237">,</span> 
<a id="x3-24030r884"></a>      <span id="textcolor1238">Node</span><span id="textcolor1239">(</span> 
<a id="x3-24032r885"></a>         <span id="textcolor1240">package</span><span id="textcolor1241">=</span><span id="textcolor1242">'</span><span id="textcolor1243">learning_tf2_py</span><span id="textcolor1244">'</span><span id="textcolor1245">,</span> 
<a id="x3-24034r886"></a>         <span id="textcolor1246">executable</span><span id="textcolor1247">=</span><span id="textcolor1248">'</span><span id="textcolor1249">turtle_tf2_broadcaster</span><span id="textcolor1250">'</span><span id="textcolor1251">,</span> 
<a id="x3-24036r887"></a>         <span id="textcolor1252">name</span><span id="textcolor1253">=</span><span id="textcolor1254">'</span><span id="textcolor1255">broadcaster1</span><span id="textcolor1256">'</span><span id="textcolor1257">,</span> 
<a id="x3-24038r888"></a>         <span id="textcolor1258">parameters</span><span id="textcolor1259">=</span><span id="textcolor1260">[</span> 
<a id="x3-24040r889"></a>            <span id="textcolor1261">{</span><span id="textcolor1262">'</span><span id="textcolor1263">turtlename</span><span id="textcolor1264">'</span><span id="textcolor1265">:</span> <span id="textcolor1266">'</span><span id="textcolor1267">turtle1</span><span id="textcolor1268">'</span><span id="textcolor1269">}</span> 
<a id="x3-24042r890"></a>         <span id="textcolor1270">]</span> 
<a id="x3-24044r891"></a>      <span id="textcolor1271">)</span><span id="textcolor1272">,</span> 
<a id="x3-24046r892"></a>      <span id="textcolor1273">DeclareLaunchArgument</span><span id="textcolor1274">(</span> 
<a id="x3-24048r893"></a>         <span id="textcolor1275">'</span><span id="textcolor1276">target_frame</span><span id="textcolor1277">'</span><span id="textcolor1278">,</span> <span id="textcolor1279">default_value</span><span id="textcolor1280">=</span><span id="textcolor1281">'</span><span id="textcolor1282">turtle1</span><span id="textcolor1283">'</span><span id="textcolor1284">,</span> 
<a id="x3-24050r894"></a>         <span id="textcolor1285">description</span><span id="textcolor1286">=</span><span id="textcolor1287">'</span><span id="textcolor1288">Target frame name.</span><span id="textcolor1289">'</span> 
<a id="x3-24052r895"></a>      <span id="textcolor1290">)</span><span id="textcolor1291">,</span> 
<a id="x3-24054r896"></a>      <span id="textcolor1292">Node</span><span id="textcolor1293">(</span> 
<a id="x3-24056r897"></a>         <span id="textcolor1294">package</span><span id="textcolor1295">=</span><span id="textcolor1296">'</span><span id="textcolor1297">learning_tf2_py</span><span id="textcolor1298">'</span><span id="textcolor1299">,</span> 
<a id="x3-24058r898"></a>         <span id="textcolor1300">executable</span><span id="textcolor1301">=</span><span id="textcolor1302">'</span><span id="textcolor1303">turtle_tf2_broadcaster</span><span id="textcolor1304">'</span><span id="textcolor1305">,</span> 
<a id="x3-24060r899"></a>         <span id="textcolor1306">name</span><span id="textcolor1307">=</span><span id="textcolor1308">'</span><span id="textcolor1309">broadcaster2</span><span id="textcolor1310">'</span><span id="textcolor1311">,</span> 
<a id="x3-24062r900"></a>         <span id="textcolor1312">parameters</span><span id="textcolor1313">=</span><span id="textcolor1314">[</span> 
<a id="x3-24064r901"></a>            <span id="textcolor1315">{</span><span id="textcolor1316">'</span><span id="textcolor1317">turtlename</span><span id="textcolor1318">'</span><span id="textcolor1319">:</span> <span id="textcolor1320">'</span><span id="textcolor1321">turtle2</span><span id="textcolor1322">'</span><span id="textcolor1323">}</span> 
<a id="x3-24066r902"></a>         <span id="textcolor1324">]</span> 
<a id="x3-24068r903"></a>      <span id="textcolor1325">)</span><span id="textcolor1326">,</span> 
<a id="x3-24070r904"></a>      <span id="textcolor1327">Node</span><span id="textcolor1328">(</span> 
<a id="x3-24072r905"></a>         <span id="textcolor1329">package</span><span id="textcolor1330">=</span><span id="textcolor1331">'</span><span id="textcolor1332">learning_tf2_py</span><span id="textcolor1333">'</span><span id="textcolor1334">,</span> 
<a id="x3-24074r906"></a>         <span id="textcolor1335">executable</span><span id="textcolor1336">=</span><span id="textcolor1337">'</span><span id="textcolor1338">turtle_tf2_listener</span><span id="textcolor1339">'</span><span id="textcolor1340">,</span> 
<a id="x3-24076r907"></a>         <span id="textcolor1341">name</span><span id="textcolor1342">=</span><span id="textcolor1343">'</span><span id="textcolor1344">listener</span><span id="textcolor1345">'</span><span id="textcolor1346">,</span> 
<a id="x3-24078r908"></a>         <span id="textcolor1347">parameters</span><span id="textcolor1348">=</span><span id="textcolor1349">[</span> 
<a id="x3-24080r909"></a>            <span id="textcolor1350">{</span><span id="textcolor1351">'</span><span id="textcolor1352">target_frame</span><span id="textcolor1353">'</span><span id="textcolor1354">:</span> <span id="textcolor1355">LaunchConfiguration</span><span id="textcolor1356">(</span><span id="textcolor1357">'</span><span id="textcolor1358">target_frame</span><span id="textcolor1359">'</span><span id="textcolor1360">)</span><span id="textcolor1361">}</span> 
<a id="x3-24082r910"></a>         <span id="textcolor1362">]</span> 
<a id="x3-24084r911"></a>      <span id="textcolor1363">)</span><span id="textcolor1364">,</span> 
<a id="x3-24086r912"></a>   <span id="textcolor1365">]</span><span id="textcolor1366">)</span></div></pre>
     </div>
     <p class="noindent">
      This will declare a <span id="textcolor1367"><code class="verb">target_frame</code></span>
      launch argument, start a broadcaster for second turtle that we will spawn and listener that will
subscribe to those transformations.
      <a id="paragraph*.18">
      </a>
     </p>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-25000">
       </a>
       Build
      </span>
      Run <span id="textcolor1368"><code class="verb">rosdep</code></span>
      in the root of your workspace to check for missing dependencies.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb37" style="padding:20px;border-radius: 3px;"><a id="x3-25002r919"></a>rosdep<span id="textcolor1369"> </span>install<span id="textcolor1370"> </span>-i<span id="textcolor1371"> </span>--from-path<span id="textcolor1372"> </span>src<span id="textcolor1373"> </span>--rosdistro<span id="textcolor1374"> </span>humble<span id="textcolor1375"> </span>-y</div></pre>
     </div>
     <p class="noindent">
      Still in the root of your workspace, build your package:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb38" style="padding:20px;border-radius: 3px;"><a id="x3-25004r924"></a>colcon<span id="textcolor1376"> </span>build<span id="textcolor1377"> </span>--packages-select<span id="textcolor1378"> </span>learning_tf2_py</div></pre>
     </div>
     <p class="noindent">
      Open a new terminal, navigate to the root of your workspace, and source the setup files:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb39" style="padding:20px;border-radius: 3px;"><a id="x3-25006r929"></a>.<span id="textcolor1379"> </span>install/setup.bash</div></pre>
     </div>
     <a id="paragraph*.19">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-26000">
       </a>
       Run
      </span>
      Now youre ready to start your full turtle demo:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb40" style="padding:20px;border-radius: 3px;"><a id="x3-26002r936"></a>ros2<span id="textcolor1380"> </span>launch<span id="textcolor1381"> </span>learning_tf2_py<span id="textcolor1382"> </span>turtle_tf2_demo.launch.py</div></pre>
     </div>
     <p class="noindent">
      You should see the turtle sim with two turtles. In the second terminal window type the following command:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb41" style="padding:20px;border-radius: 3px;"><a id="x3-26004r941"></a>ros2<span id="textcolor1383"> </span>run<span id="textcolor1384"> </span>turtlesim<span id="textcolor1385"> </span>turtle_teleop_key</div></pre>
     </div>
     <p class="noindent">
      To see if things work, simply drive around the first turtle using the arrow keys (make sure your terminal window is active, not
your simulator window), and youll see the second turtle following the first one!
     </p>
     <p class="noindent">
     </p>
    </div>
    <div class="section-head" id="section-4" sec="section-4">
     <h2 class="sectionHead">
      <a aria-label="Link to this section in PDF version" class="pdf-link" href="MobileRoboticsLectureBook.pdf#section.1.4" style="color: red;  position: absolute;  left: -30px;" target="_blank">
       <svg class="bi bi-file-pdf" fill="currentColor" height="20" viewbox="0 0 16 16" width="20" xmlns="http://www.w3.org/2000/svg">
        <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z">
        </path>
        <path d="M4.603 12.087a.81.81 0 0 1-.438-.42c-.195-.388-.13-.776.08-1.102.198-.307.526-.568.897-.787a7.68 7.68 0 0 1 1.482-.645 19.701 19.701 0 0 0 1.062-2.227 7.269 7.269 0 0 1-.43-1.295c-.086-.4-.119-.796-.046-1.136.075-.354.274-.672.65-.823.192-.077.4-.12.602-.077a.7.7 0 0 1 .477.365c.088.164.12.356.127.538.007.187-.012.395-.047.614-.084.51-.27 1.134-.52 1.794a10.954 10.954 0 0 0 .98 1.686 5.753 5.753 0 0 1 1.334.05c.364.065.734.195.96.465.12.144.193.32.2.518.007.192-.047.382-.138.563a1.04 1.04 0 0 1-.354.416.856.856 0 0 1-.51.138c-.331-.014-.654-.196-.933-.417a5.716 5.716 0 0 1-.911-.95 11.642 11.642 0 0 0-1.997.406 11.311 11.311 0 0 1-1.021 1.51c-.29.35-.608.655-.926.787a.793.793 0 0 1-.58.029zm1.379-1.901c-.166.076-.32.156-.459.238-.328.194-.541.383-.647.547-.094.145-.096.25-.04.361.01.022.02.036.026.044a.27.27 0 0 0 .035-.012c.137-.056.355-.235.635-.572a8.18 8.18 0 0 0 .45-.606zm1.64-1.33a12.647 12.647 0 0 1 1.01-.193 11.666 11.666 0 0 1-.51-.858 20.741 20.741 0 0 1-.5 1.05zm2.446.45c.15.162.296.3.435.41.24.19.407.253.498.256a.107.107 0 0 0 .07-.015.307.307 0 0 0 .094-.125.436.436 0 0 0 .059-.2.095.095 0 0 0-.026-.063c-.052-.062-.2-.152-.518-.209a3.881 3.881 0 0 0-.612-.053zM8.078 5.8a6.7 6.7 0 0 0 .2-.828c.031-.188.043-.343.038-.465a.613.613 0 0 0-.032-.198.517.517 0 0 0-.145.04c-.087.035-.158.106-.196.283-.04.192-.03.469.046.822.024.111.054.227.09.346z">
        </path>
       </svg>
      </a>
      <small class="titlemark">
       1.4
      </small>
      <a id="x3-270001.4">
      </a>
      Adding a Frame
     </h2>
     <p class="noindent">
      Previously, we’ve recreated the turtle demo by writing a tf2 broadcaster and a tf2 listener. This tutorial will teach you how to
add extra fixed and dynamic frames to the transformation tree. In fact, adding a frame in tf2 is very similar to creating the tf2
broadcaster, but this example will show you some additional features of tf2.
     </p>
     <p class="noindent">
      For many tasks related to transformations, it is easier to think inside a local frame. For example, it is easiest to reason about
laser scan measurements in a frame at the center of the laser scanner. tf2 allows you to define a local frame for each sensor, link,
or joint in your system. When transforming from one frame to another, tf2 will take care of all the hidden intermediate frame
transformations that are introduced.
      <a id="paragraph*.20">
      </a>
     </p>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-28000">
       </a>
       Viewing the Tree
      </span>
      tf2 builds up a tree structure of frames and, thus, does not allow a closed loop in the frame structure. This means
that a frame only has one single parent, but it can have multiple children. Currently, our tf2 tree contains three
frames: world, turtle1 and turtle2. The two turtle frames are children of the world frame. If we want to add a new
frame to tf2, one of the three existing frames needs to be the parent frame, and the new one will become its child
frame.
      <a id="paragraph*.21">
      </a>
     </p>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-29000">
       </a>
       Writing the Fixed Frame Broadcaster
      </span>
      In our turtle example, well add a new frame carrot1, which will be the child of the turtle1. This frame will serve as the goal for
the second turtle.
     </p>
     <p class="noindent">
      Lets first create the source files. Go to the <span id="textcolor1386"><code class="verb">learning_tf2_py</code></span>
      package we created in the previous tutorials. Inside the <span id="textcolor1387"><code class="verb">src/learning_tf2_py/learning_tf2_py</code></span>
      directory download the fixed frame broadcaster code by entering the following
command:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb42" style="padding:20px;border-radius: 3px;"><a id="x3-29002r951"></a>wget<span id="textcolor1388"> </span>https://raw.githubusercontent.com/ros/geometry_tutorials/humble/turtle_tf2_py/turtle_tf2_py/fixed_frame_tf2_broadcaster.py</div></pre>
     </div>
     <p class="noindent">
      Now open the file called <span id="textcolor1389"><code class="verb">fixed_frame_tf2_broadcaster.py</code></span>.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb43" style="padding:20px;border-radius: 3px;"><a id="x3-29004r957"></a><span id="textcolor1390">from</span><span id="textcolor1391"> </span><span id="textcolor1392">geometry_msgs</span><span id="textcolor1393">.</span><span id="textcolor1394">msg</span><span id="textcolor1395"> </span><span id="textcolor1396">import</span> <span id="textcolor1397">TransformStamped</span> 
<a id="x3-29006r958"></a> 
<a id="x3-29008r959"></a><span id="textcolor1398">import</span><span id="textcolor1399"> </span><span id="textcolor1400">rclpy</span> 
<a id="x3-29010r960"></a><span id="textcolor1401">from</span><span id="textcolor1402"> </span><span id="textcolor1403">rclpy</span><span id="textcolor1404">.</span><span id="textcolor1405">node</span><span id="textcolor1406"> </span><span id="textcolor1407">import</span> <span id="textcolor1408">Node</span> 
<a id="x3-29012r961"></a> 
<a id="x3-29014r962"></a><span id="textcolor1409">from</span><span id="textcolor1410"> </span><span id="textcolor1411">tf2_ros</span><span id="textcolor1412"> </span><span id="textcolor1413">import</span> <span id="textcolor1414">TransformBroadcaster</span> 
<a id="x3-29016r963"></a> 
<a id="x3-29018r964"></a> 
<a id="x3-29020r965"></a><span id="textcolor1415">class</span><span id="textcolor1416"> </span><span id="textcolor1417">FixedFrameBroadcaster</span><span id="textcolor1418">(</span><span id="textcolor1419">Node</span><span id="textcolor1420">)</span><span id="textcolor1421">:</span> 
<a id="x3-29022r966"></a> 
<a id="x3-29024r967"></a>  <span id="textcolor1422">def</span><span id="textcolor1423"> </span><span id="textcolor1424">__init__</span><span id="textcolor1425">(</span><span id="textcolor1426">self</span><span id="textcolor1427">)</span><span id="textcolor1428">:</span> 
<a id="x3-29026r968"></a>     <span id="textcolor1429">super</span><span id="textcolor1430">(</span><span id="textcolor1431">)</span><span id="textcolor1432">.</span><span id="textcolor1433">__init__</span><span id="textcolor1434">(</span><span id="textcolor1435">'</span><span id="textcolor1436">fixed_frame_tf2_broadcaster</span><span id="textcolor1437">'</span><span id="textcolor1438">)</span> 
<a id="x3-29028r969"></a>     <span id="textcolor1439">self</span><span id="textcolor1440">.</span><span id="textcolor1441">tf_broadcaster</span> <span id="textcolor1442">=</span> <span id="textcolor1443">TransformBroadcaster</span><span id="textcolor1444">(</span><span id="textcolor1445">self</span><span id="textcolor1446">)</span> 
<a id="x3-29030r970"></a>     <span id="textcolor1447">self</span><span id="textcolor1448">.</span><span id="textcolor1449">timer</span> <span id="textcolor1450">=</span> <span id="textcolor1451">self</span><span id="textcolor1452">.</span><span id="textcolor1453">create_timer</span><span id="textcolor1454">(</span><span id="textcolor1455">0.1</span><span id="textcolor1456">,</span> <span id="textcolor1457">self</span><span id="textcolor1458">.</span><span id="textcolor1459">broadcast_timer_callback</span><span id="textcolor1460">)</span> 
<a id="x3-29032r971"></a> 
<a id="x3-29034r972"></a>  <span id="textcolor1461">def</span><span id="textcolor1462"> </span><span id="textcolor1463">broadcast_timer_callback</span><span id="textcolor1464">(</span><span id="textcolor1465">self</span><span id="textcolor1466">)</span><span id="textcolor1467">:</span> 
<a id="x3-29036r973"></a>     <span id="textcolor1468">t</span> <span id="textcolor1469">=</span> <span id="textcolor1470">TransformStamped</span><span id="textcolor1471">(</span><span id="textcolor1472">)</span> 
<a id="x3-29038r974"></a> 
<a id="x3-29040r975"></a>     <span id="textcolor1473">t</span><span id="textcolor1474">.</span><span id="textcolor1475">header</span><span id="textcolor1476">.</span><span id="textcolor1477">stamp</span> <span id="textcolor1478">=</span> <span id="textcolor1479">self</span><span id="textcolor1480">.</span><span id="textcolor1481">get_clock</span><span id="textcolor1482">(</span><span id="textcolor1483">)</span><span id="textcolor1484">.</span><span id="textcolor1485">now</span><span id="textcolor1486">(</span><span id="textcolor1487">)</span><span id="textcolor1488">.</span><span id="textcolor1489">to_msg</span><span id="textcolor1490">(</span><span id="textcolor1491">)</span> 
<a id="x3-29042r976"></a>     <span id="textcolor1492">t</span><span id="textcolor1493">.</span><span id="textcolor1494">header</span><span id="textcolor1495">.</span><span id="textcolor1496">frame_id</span> <span id="textcolor1497">=</span> <span id="textcolor1498">'</span><span id="textcolor1499">turtle1</span><span id="textcolor1500">'</span> 
<a id="x3-29044r977"></a>     <span id="textcolor1501">t</span><span id="textcolor1502">.</span><span id="textcolor1503">child_frame_id</span> <span id="textcolor1504">=</span> <span id="textcolor1505">'</span><span id="textcolor1506">carrot1</span><span id="textcolor1507">'</span> 
<a id="x3-29046r978"></a>     <span id="textcolor1508">t</span><span id="textcolor1509">.</span><span id="textcolor1510">transform</span><span id="textcolor1511">.</span><span id="textcolor1512">translation</span><span id="textcolor1513">.</span><span id="textcolor1514">x</span> <span id="textcolor1515">=</span> <span id="textcolor1516">0.0</span> 
<a id="x3-29048r979"></a>     <span id="textcolor1517">t</span><span id="textcolor1518">.</span><span id="textcolor1519">transform</span><span id="textcolor1520">.</span><span id="textcolor1521">translation</span><span id="textcolor1522">.</span><span id="textcolor1523">y</span> <span id="textcolor1524">=</span> <span id="textcolor1525">2.0</span> 
<a id="x3-29050r980"></a>     <span id="textcolor1526">t</span><span id="textcolor1527">.</span><span id="textcolor1528">transform</span><span id="textcolor1529">.</span><span id="textcolor1530">translation</span><span id="textcolor1531">.</span><span id="textcolor1532">z</span> <span id="textcolor1533">=</span> <span id="textcolor1534">0.0</span> 
<a id="x3-29052r981"></a>     <span id="textcolor1535">t</span><span id="textcolor1536">.</span><span id="textcolor1537">transform</span><span id="textcolor1538">.</span><span id="textcolor1539">rotation</span><span id="textcolor1540">.</span><span id="textcolor1541">x</span> <span id="textcolor1542">=</span> <span id="textcolor1543">0.0</span> 
<a id="x3-29054r982"></a>     <span id="textcolor1544">t</span><span id="textcolor1545">.</span><span id="textcolor1546">transform</span><span id="textcolor1547">.</span><span id="textcolor1548">rotation</span><span id="textcolor1549">.</span><span id="textcolor1550">y</span> <span id="textcolor1551">=</span> <span id="textcolor1552">0.0</span> 
<a id="x3-29056r983"></a>     <span id="textcolor1553">t</span><span id="textcolor1554">.</span><span id="textcolor1555">transform</span><span id="textcolor1556">.</span><span id="textcolor1557">rotation</span><span id="textcolor1558">.</span><span id="textcolor1559">z</span> <span id="textcolor1560">=</span> <span id="textcolor1561">0.0</span> 
<a id="x3-29058r984"></a>     <span id="textcolor1562">t</span><span id="textcolor1563">.</span><span id="textcolor1564">transform</span><span id="textcolor1565">.</span><span id="textcolor1566">rotation</span><span id="textcolor1567">.</span><span id="textcolor1568">w</span> <span id="textcolor1569">=</span> <span id="textcolor1570">1.0</span> 
<a id="x3-29060r985"></a> 
<a id="x3-29062r986"></a>     <span id="textcolor1571">self</span><span id="textcolor1572">.</span><span id="textcolor1573">tf_broadcaster</span><span id="textcolor1574">.</span><span id="textcolor1575">sendTransform</span><span id="textcolor1576">(</span><span id="textcolor1577">t</span><span id="textcolor1578">)</span> 
<a id="x3-29064r987"></a> 
<a id="x3-29066r988"></a> 
<a id="x3-29068r989"></a><span id="textcolor1579">def</span><span id="textcolor1580"> </span><span id="textcolor1581">main</span><span id="textcolor1582">(</span><span id="textcolor1583">)</span><span id="textcolor1584">:</span> 
<a id="x3-29070r990"></a>   <span id="textcolor1585">rclpy</span><span id="textcolor1586">.</span><span id="textcolor1587">init</span><span id="textcolor1588">(</span><span id="textcolor1589">)</span> 
<a id="x3-29072r991"></a>   <span id="textcolor1590">node</span> <span id="textcolor1591">=</span> <span id="textcolor1592">FixedFrameBroadcaster</span><span id="textcolor1593">(</span><span id="textcolor1594">)</span> 
<a id="x3-29074r992"></a>   <span id="textcolor1595">try</span><span id="textcolor1596">:</span> 
<a id="x3-29076r993"></a>      <span id="textcolor1597">rclpy</span><span id="textcolor1598">.</span><span id="textcolor1599">spin</span><span id="textcolor1600">(</span><span id="textcolor1601">node</span><span id="textcolor1602">)</span> 
<a id="x3-29078r994"></a>   <span id="textcolor1603">except</span> <span id="textcolor1604">KeyboardInterrupt</span><span id="textcolor1605">:</span> 
<a id="x3-29080r995"></a>      <span id="textcolor1606">pass</span> 
<a id="x3-29082r996"></a> 
<a id="x3-29084r997"></a>   <span id="textcolor1607">rclpy</span><span id="textcolor1608">.</span><span id="textcolor1609">shutdown</span><span id="textcolor1610">(</span><span id="textcolor1611">)</span></div></pre>
     </div>
     <p class="noindent">
      The code is very similar to the tf2 broadcaster tutorial example and the only difference is that the transform here does not
change over time.
      <a id="paragraph*.22">
      </a>
     </p>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-30000">
       </a>
       Examining the Code
      </span>
      Lets take a look at the key lines in this piece of code. Here we create a new transform, from the parent turtle1 to the new child
carrot1. The carrot1 frame is 2 meters offset in y axis in terms of the turtle1 frame.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb44" style="padding:20px;border-radius: 3px;"><a id="x3-30002r1002"></a><span id="textcolor1612">t</span> <span id="textcolor1613">=</span> <span id="textcolor1614">TransformStamped</span><span id="textcolor1615">(</span><span id="textcolor1616">)</span> 
<a id="x3-30004r1003"></a> 
<a id="x3-30006r1004"></a><span id="textcolor1617">t</span><span id="textcolor1618">.</span><span id="textcolor1619">header</span><span id="textcolor1620">.</span><span id="textcolor1621">stamp</span> <span id="textcolor1622">=</span> <span id="textcolor1623">self</span><span id="textcolor1624">.</span><span id="textcolor1625">get_clock</span><span id="textcolor1626">(</span><span id="textcolor1627">)</span><span id="textcolor1628">.</span><span id="textcolor1629">now</span><span id="textcolor1630">(</span><span id="textcolor1631">)</span><span id="textcolor1632">.</span><span id="textcolor1633">to_msg</span><span id="textcolor1634">(</span><span id="textcolor1635">)</span> 
<a id="x3-30008r1005"></a><span id="textcolor1636">t</span><span id="textcolor1637">.</span><span id="textcolor1638">header</span><span id="textcolor1639">.</span><span id="textcolor1640">frame_id</span> <span id="textcolor1641">=</span> <span id="textcolor1642">'</span><span id="textcolor1643">turtle1</span><span id="textcolor1644">'</span> 
<a id="x3-30010r1006"></a><span id="textcolor1645">t</span><span id="textcolor1646">.</span><span id="textcolor1647">child_frame_id</span> <span id="textcolor1648">=</span> <span id="textcolor1649">'</span><span id="textcolor1650">carrot1</span><span id="textcolor1651">'</span> 
<a id="x3-30012r1007"></a><span id="textcolor1652">t</span><span id="textcolor1653">.</span><span id="textcolor1654">transform</span><span id="textcolor1655">.</span><span id="textcolor1656">translation</span><span id="textcolor1657">.</span><span id="textcolor1658">x</span> <span id="textcolor1659">=</span> <span id="textcolor1660">0.0</span> 
<a id="x3-30014r1008"></a><span id="textcolor1661">t</span><span id="textcolor1662">.</span><span id="textcolor1663">transform</span><span id="textcolor1664">.</span><span id="textcolor1665">translation</span><span id="textcolor1666">.</span><span id="textcolor1667">y</span> <span id="textcolor1668">=</span> <span id="textcolor1669">2.0</span> 
<a id="x3-30016r1009"></a><span id="textcolor1670">t</span><span id="textcolor1671">.</span><span id="textcolor1672">transform</span><span id="textcolor1673">.</span><span id="textcolor1674">translation</span><span id="textcolor1675">.</span><span id="textcolor1676">z</span> <span id="textcolor1677">=</span> <span id="textcolor1678">0.0</span></div></pre>
     </div>
     <a id="paragraph*.23">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-31000">
       </a>
       Adding an Entry Point
      </span>
      To allow the ros2 run command to run your node, you must add the entry point to setup.py (located in the <span id="textcolor1679"><code class="verb">src/learning_tf2_py directory</code></span>
      ).
     </p>
     <p class="noindent">
      Add the following line between the <span id="textcolor1680"><code class="verb">'console_scripts':</code></span>
      brackets:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb45" style="padding:20px;border-radius: 3px;"><a id="x3-31002r1014"></a><span id="textcolor1681">'</span><span id="textcolor1682">fixed_frame_tf2_broadcaster = learning_tf2_py.fixed_frame_tf2_broadcaster:main</span><span id="textcolor1683">'</span><span id="textcolor1684">,</span></div></pre>
     </div>
     <a id="paragraph*.24">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-32000">
       </a>
       Writing the Launch File
      </span>
      Now lets create a launch file for this example. With your text editor, create a new file called <span id="textcolor1685"><code class="verb">turtle_tf2_fixed_frame_demo.launch.py</code></span>
      in the <span id="textcolor1686"><code class="verb">src/learning\_tf2\_py/launch</code></span>
      directory, and add the following lines:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb46" style="padding:20px;border-radius: 3px;"><a id="x3-32002r1020"></a><span id="textcolor1687">from</span><span id="textcolor1688"> </span><span id="textcolor1689">launch</span><span id="textcolor1690"> </span><span id="textcolor1691">import</span> <span id="textcolor1692">LaunchDescription</span> 
<a id="x3-32004r1021"></a><span id="textcolor1693">from</span><span id="textcolor1694"> </span><span id="textcolor1695">launch</span><span id="textcolor1696">.</span><span id="textcolor1697">actions</span><span id="textcolor1698"> </span><span id="textcolor1699">import</span> <span id="textcolor1700">IncludeLaunchDescription</span> 
<a id="x3-32006r1022"></a><span id="textcolor1701">from</span><span id="textcolor1702"> </span><span id="textcolor1703">launch</span><span id="textcolor1704">.</span><span id="textcolor1705">substitutions</span><span id="textcolor1706"> </span><span id="textcolor1707">import</span> <span id="textcolor1708">PathJoinSubstitution</span> 
<a id="x3-32008r1023"></a><span id="textcolor1709">from</span><span id="textcolor1710"> </span><span id="textcolor1711">launch_ros</span><span id="textcolor1712">.</span><span id="textcolor1713">actions</span><span id="textcolor1714"> </span><span id="textcolor1715">import</span> <span id="textcolor1716">Node</span> 
<a id="x3-32010r1024"></a><span id="textcolor1717">from</span><span id="textcolor1718"> </span><span id="textcolor1719">launch_ros</span><span id="textcolor1720">.</span><span id="textcolor1721">substitutions</span><span id="textcolor1722"> </span><span id="textcolor1723">import</span> <span id="textcolor1724">FindPackageShare</span> 
<a id="x3-32012r1025"></a> 
<a id="x3-32014r1026"></a> 
<a id="x3-32016r1027"></a><span id="textcolor1725">def</span><span id="textcolor1726"> </span><span id="textcolor1727">generate_launch_description</span><span id="textcolor1728">(</span><span id="textcolor1729">)</span><span id="textcolor1730">:</span> 
<a id="x3-32018r1028"></a>   <span id="textcolor1731">return</span> <span id="textcolor1732">LaunchDescription</span><span id="textcolor1733">(</span><span id="textcolor1734">[</span> 
<a id="x3-32020r1029"></a>      <span id="textcolor1735">IncludeLaunchDescription</span><span id="textcolor1736">(</span> 
<a id="x3-32022r1030"></a>         <span id="textcolor1737">PathJoinSubstitution</span><span id="textcolor1738">(</span><span id="textcolor1739">[</span> 
<a id="x3-32024r1031"></a>            <span id="textcolor1740">FindPackageShare</span><span id="textcolor1741">(</span><span id="textcolor1742">'</span><span id="textcolor1743">learning_tf2_py</span><span id="textcolor1744">'</span><span id="textcolor1745">)</span><span id="textcolor1746">,</span> <span id="textcolor1747">'</span><span id="textcolor1748">launch</span><span id="textcolor1749">'</span><span id="textcolor1750">,</span> <span id="textcolor1751">'</span><span id="textcolor1752">turtle_tf2_demo.launch.py</span><span id="textcolor1753">'</span><span id="textcolor1754">]</span><span id="textcolor1755">)</span> 
<a id="x3-32026r1032"></a>      <span id="textcolor1756">)</span><span id="textcolor1757">,</span> 
<a id="x3-32028r1033"></a>      <span id="textcolor1758">Node</span><span id="textcolor1759">(</span> 
<a id="x3-32030r1034"></a>         <span id="textcolor1760">package</span><span id="textcolor1761">=</span><span id="textcolor1762">'</span><span id="textcolor1763">learning_tf2_py</span><span id="textcolor1764">'</span><span id="textcolor1765">,</span> 
<a id="x3-32032r1035"></a>         <span id="textcolor1766">executable</span><span id="textcolor1767">=</span><span id="textcolor1768">'</span><span id="textcolor1769">fixed_frame_tf2_broadcaster</span><span id="textcolor1770">'</span><span id="textcolor1771">,</span> 
<a id="x3-32034r1036"></a>         <span id="textcolor1772">name</span><span id="textcolor1773">=</span><span id="textcolor1774">'</span><span id="textcolor1775">fixed_broadcaster</span><span id="textcolor1776">'</span><span id="textcolor1777">,</span> 
<a id="x3-32036r1037"></a>      <span id="textcolor1778">)</span><span id="textcolor1779">,</span> 
<a id="x3-32038r1038"></a>   <span id="textcolor1780">]</span><span id="textcolor1781">)</span></div></pre>
     </div>
     <p class="noindent">
      This launch file imports the required packages and then creates a <span id="textcolor1782"><code class="verb">demo_nodes</code></span>
      variable that will store nodes that we created in the
previous tutorials launch file.
     </p>
     <p class="noindent">
      The last part of the code will add our fixed carrot1 frame to the turtlesim world using our <span id="textcolor1783"><code class="verb">fixed_frame_tf2_broadcaster</code></span>
      node.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb47" style="padding:20px;border-radius: 3px;"><a id="x3-32040r1043"></a>      <span id="textcolor1784">Node</span><span id="textcolor1785">(</span> 
<a id="x3-32042r1044"></a>         <span id="textcolor1786">package</span><span id="textcolor1787">=</span><span id="textcolor1788">'</span><span id="textcolor1789">learning_tf2_py</span><span id="textcolor1790">'</span><span id="textcolor1791">,</span> 
<a id="x3-32044r1045"></a>         <span id="textcolor1792">executable</span><span id="textcolor1793">=</span><span id="textcolor1794">'</span><span id="textcolor1795">fixed_frame_tf2_broadcaster</span><span id="textcolor1796">'</span><span id="textcolor1797">,</span> 
<a id="x3-32046r1046"></a>         <span id="textcolor1798">name</span><span id="textcolor1799">=</span><span id="textcolor1800">'</span><span id="textcolor1801">fixed_broadcaster</span><span id="textcolor1802">'</span><span id="textcolor1803">,</span> 
<a id="x3-32048r1047"></a>      <span id="textcolor1804">)</span><span id="textcolor1805">,</span></div></pre>
     </div>
     <a id="paragraph*.25">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-33000">
       </a>
       Build
      </span>
      Run rosdep in the root of your workspace to check for missing dependencies.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb48" style="padding:20px;border-radius: 3px;"><a id="x3-33002r1054"></a>rosdep<span id="textcolor1806"> </span>install<span id="textcolor1807"> </span>-i<span id="textcolor1808"> </span>--from-path<span id="textcolor1809"> </span>src<span id="textcolor1810"> </span>--rosdistro<span id="textcolor1811"> </span>humble<span id="textcolor1812"> </span>-y</div></pre>
     </div>
     <p class="noindent">
      Still in the root of your workspace, build your package:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb49" style="padding:20px;border-radius: 3px;"><a id="x3-33004r1059"></a>colcon<span id="textcolor1813"> </span>build<span id="textcolor1814"> </span>--packages-select<span id="textcolor1815"> </span>learning_tf2_py</div></pre>
     </div>
     <p class="noindent">
      Open a new terminal, navigate to the root of your workspace, and source the setup files:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb50" style="padding:20px;border-radius: 3px;"><a id="x3-33006r1064"></a>.<span id="textcolor1816"> </span>install/setup.bash</div></pre>
     </div>
     <a id="paragraph*.26">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-34000">
       </a>
       Run
      </span>
      Now you can start the turtle broadcaster demo:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb51" style="padding:20px;border-radius: 3px;"><a id="x3-34002r1071"></a>ros2<span id="textcolor1817"> </span>launch<span id="textcolor1818"> </span>learning_tf2_py<span id="textcolor1819"> </span>turtle_tf2_fixed_frame_demo.launch.py</div></pre>
     </div>
     <p class="noindent">
      You should notice that the new carrot1 frame appeared in the transformation tree.
     </p>
     <p class="noindent">
      If you drive the first turtle around, you should notice that the behavior didnt change from the previous tutorial, even though we
added a new frame. Thats because adding an extra frame does not affect the other frames and our listener is still using the
previously defined frames.
     </p>
     <p class="noindent">
      Therefore if we want our second turtle to follow the carrot instead of the first turtle, we need to change value of the <span id="textcolor1820"><code class="verb">target_frame</code></span>.
This can be done two ways. One way is to pass the <span id="textcolor1821"><code class="verb">target_frame</code></span>
      argument to the launch file directly from the
console:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb52" style="padding:20px;border-radius: 3px;"><a id="x3-34004r1076"></a>ros2<span id="textcolor1822"> </span>launch<span id="textcolor1823"> </span>learning_tf2_py<span id="textcolor1824"> </span><span id="textcolor1825">\</span> 
<a id="x3-34006r1077"></a><span id="textcolor1826">    </span>turtle_tf2_fixed_frame_demo.launch.py<span id="textcolor1827"> </span><span id="textcolor1828">\</span> 
<a id="x3-34008r1078"></a><span id="textcolor1829">    </span>target_frame:<span id="textcolor1830">=</span>carrot1</div></pre>
     </div>
     <p class="noindent">
      The second way is to update the launch file. To do so, open the <span id="textcolor1831"><code class="verb">turtle_tf2_fixed_frame_demo.launch.py</code></span>
      file, and add the <span id="textcolor1832"><code class="verb">'target_frame': 'carrot1'</code></span>
      parameter via <span id="textcolor1833"><code class="verb">launch_arguments</code></span>
      argument.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb53" style="padding:20px;border-radius: 3px;"><a id="x3-34010r1083"></a><span id="textcolor1834">def</span><span id="textcolor1835"> </span><span id="textcolor1836">generate_launch_description</span><span id="textcolor1837">(</span><span id="textcolor1838">)</span><span id="textcolor1839">:</span> 
<a id="x3-34012r1084"></a>   <span id="textcolor1840">demo_nodes</span> <span id="textcolor1841">=</span> <span id="textcolor1842">IncludeLaunchDescription</span><span id="textcolor1843">(</span> 
<a id="x3-34014r1085"></a>      <span id="textcolor1844">.</span><span id="textcolor1845">.</span><span id="textcolor1846">.</span><span id="textcolor1847">,</span> 
<a id="x3-34016r1086"></a>      <span id="textcolor1848">launch_arguments</span><span id="textcolor1849">=</span><span id="textcolor1850">{</span><span id="textcolor1851">'</span><span id="textcolor1852">target_frame</span><span id="textcolor1853">'</span><span id="textcolor1854">:</span> <span id="textcolor1855">'</span><span id="textcolor1856">carrot1</span><span id="textcolor1857">'</span><span id="textcolor1858">}</span><span id="textcolor1859">.</span><span id="textcolor1860">items</span><span id="textcolor1861">(</span><span id="textcolor1862">)</span><span id="textcolor1863">,</span> 
<a id="x3-34018r1087"></a>      <span id="textcolor1864">)</span></div></pre>
     </div>
     <p class="noindent">
      Now rebuild the package, restart the <span id="textcolor1865"><code class="verb">turtle_tf2_fixed_frame_demo.launch.py</code></span>, and youll see the second turtle following the carrot
instead of the first turtle!
     </p>
     <h5 class="likesubsubsectionHead">
      <a id="x3-35000">
      </a>
      Writing the Dynamic Frame Broadcaster
     </h5>
     <p class="noindent">
      The extra frame we published in this tutorial is a fixed frame that doesnt change over time in relation to the parent frame.
However, if you want to publish a moving frame you can code the broadcaster to change the frame over time. Lets change our
carrot1 frame so that it changes relative to turtle1 frame over time. Go to the <span id="textcolor1866"><code class="verb">learning_tf2_py</code></span>
      package we created in the
previous tutorial. Inside the <span id="textcolor1867"><code class="verb">src/learning\_tf2\_py/learning\_tf2\_py</code></span>
      directory download the dynamic frame broadcaster code
by entering the following command:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb54" style="padding:20px;border-radius: 3px;"><a id="x3-35002r1094"></a>wget<span id="textcolor1868"> </span>https://raw.githubusercontent.com/ros/geometry_tutorials/humble/turtle_tf2_py/turtle_tf2_py/dynamic_frame_tf2_broadcaster.py</div></pre>
     </div>
     <p class="noindent">
      Now open the file called <span id="textcolor1869"><code class="verb">dynamic_frame_tf2_broadcaster.py</code></span>
      :
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb55" style="padding:20px;border-radius: 3px;"><a id="x3-35004r1099"></a><span id="textcolor1870">import</span><span id="textcolor1871"> </span><span id="textcolor1872">math</span> 
<a id="x3-35006r1100"></a> 
<a id="x3-35008r1101"></a><span id="textcolor1873">from</span><span id="textcolor1874"> </span><span id="textcolor1875">geometry_msgs</span><span id="textcolor1876">.</span><span id="textcolor1877">msg</span><span id="textcolor1878"> </span><span id="textcolor1879">import</span> <span id="textcolor1880">TransformStamped</span> 
<a id="x3-35010r1102"></a> 
<a id="x3-35012r1103"></a><span id="textcolor1881">import</span><span id="textcolor1882"> </span><span id="textcolor1883">rclpy</span> 
<a id="x3-35014r1104"></a><span id="textcolor1884">from</span><span id="textcolor1885"> </span><span id="textcolor1886">rclpy</span><span id="textcolor1887">.</span><span id="textcolor1888">node</span><span id="textcolor1889"> </span><span id="textcolor1890">import</span> <span id="textcolor1891">Node</span> 
<a id="x3-35016r1105"></a> 
<a id="x3-35018r1106"></a><span id="textcolor1892">from</span><span id="textcolor1893"> </span><span id="textcolor1894">tf2_ros</span><span id="textcolor1895"> </span><span id="textcolor1896">import</span> <span id="textcolor1897">TransformBroadcaster</span> 
<a id="x3-35020r1107"></a> 
<a id="x3-35022r1108"></a> 
<a id="x3-35024r1109"></a><span id="textcolor1898">class</span><span id="textcolor1899"> </span><span id="textcolor1900">DynamicFrameBroadcaster</span><span id="textcolor1901">(</span><span id="textcolor1902">Node</span><span id="textcolor1903">)</span><span id="textcolor1904">:</span> 
<a id="x3-35026r1110"></a> 
<a id="x3-35028r1111"></a>   <span id="textcolor1905">def</span><span id="textcolor1906"> </span><span id="textcolor1907">__init__</span><span id="textcolor1908">(</span><span id="textcolor1909">self</span><span id="textcolor1910">)</span><span id="textcolor1911">:</span> 
<a id="x3-35030r1112"></a>      <span id="textcolor1912">super</span><span id="textcolor1913">(</span><span id="textcolor1914">)</span><span id="textcolor1915">.</span><span id="textcolor1916">__init__</span><span id="textcolor1917">(</span><span id="textcolor1918">'</span><span id="textcolor1919">dynamic_frame_tf2_broadcaster</span><span id="textcolor1920">'</span><span id="textcolor1921">)</span> 
<a id="x3-35032r1113"></a>      <span id="textcolor1922">self</span><span id="textcolor1923">.</span><span id="textcolor1924">tf_broadcaster</span> <span id="textcolor1925">=</span> <span id="textcolor1926">TransformBroadcaster</span><span id="textcolor1927">(</span><span id="textcolor1928">self</span><span id="textcolor1929">)</span> 
<a id="x3-35034r1114"></a>      <span id="textcolor1930">self</span><span id="textcolor1931">.</span><span id="textcolor1932">timer</span> <span id="textcolor1933">=</span> <span id="textcolor1934">self</span><span id="textcolor1935">.</span><span id="textcolor1936">create_timer</span><span id="textcolor1937">(</span><span id="textcolor1938">0.1</span><span id="textcolor1939">,</span> <span id="textcolor1940">self</span><span id="textcolor1941">.</span><span id="textcolor1942">broadcast_timer_callback</span><span id="textcolor1943">)</span> 
<a id="x3-35036r1115"></a> 
<a id="x3-35038r1116"></a>   <span id="textcolor1944">def</span><span id="textcolor1945"> </span><span id="textcolor1946">broadcast_timer_callback</span><span id="textcolor1947">(</span><span id="textcolor1948">self</span><span id="textcolor1949">)</span><span id="textcolor1950">:</span> 
<a id="x3-35040r1117"></a>      <span id="textcolor1951">seconds</span><span id="textcolor1952">,</span> <span id="textcolor1953">_</span> <span id="textcolor1954">=</span> <span id="textcolor1955">self</span><span id="textcolor1956">.</span><span id="textcolor1957">get_clock</span><span id="textcolor1958">(</span><span id="textcolor1959">)</span><span id="textcolor1960">.</span><span id="textcolor1961">now</span><span id="textcolor1962">(</span><span id="textcolor1963">)</span><span id="textcolor1964">.</span><span id="textcolor1965">seconds_nanoseconds</span><span id="textcolor1966">(</span><span id="textcolor1967">)</span> 
<a id="x3-35042r1118"></a>      <span id="textcolor1968">x</span> <span id="textcolor1969">=</span> <span id="textcolor1970">seconds</span> <span id="textcolor1971">*</span> <span id="textcolor1972">math</span><span id="textcolor1973">.</span><span id="textcolor1974">pi</span> 
<a id="x3-35044r1119"></a> 
<a id="x3-35046r1120"></a>      <span id="textcolor1975">t</span> <span id="textcolor1976">=</span> <span id="textcolor1977">TransformStamped</span><span id="textcolor1978">(</span><span id="textcolor1979">)</span> 
<a id="x3-35048r1121"></a>      <span id="textcolor1980">t</span><span id="textcolor1981">.</span><span id="textcolor1982">header</span><span id="textcolor1983">.</span><span id="textcolor1984">stamp</span> <span id="textcolor1985">=</span> <span id="textcolor1986">self</span><span id="textcolor1987">.</span><span id="textcolor1988">get_clock</span><span id="textcolor1989">(</span><span id="textcolor1990">)</span><span id="textcolor1991">.</span><span id="textcolor1992">now</span><span id="textcolor1993">(</span><span id="textcolor1994">)</span><span id="textcolor1995">.</span><span id="textcolor1996">to_msg</span><span id="textcolor1997">(</span><span id="textcolor1998">)</span> 
<a id="x3-35050r1122"></a>      <span id="textcolor1999">t</span><span id="textcolor2000">.</span><span id="textcolor2001">header</span><span id="textcolor2002">.</span><span id="textcolor2003">frame_id</span> <span id="textcolor2004">=</span> <span id="textcolor2005">'</span><span id="textcolor2006">turtle1</span><span id="textcolor2007">'</span> 
<a id="x3-35052r1123"></a>      <span id="textcolor2008">t</span><span id="textcolor2009">.</span><span id="textcolor2010">child_frame_id</span> <span id="textcolor2011">=</span> <span id="textcolor2012">'</span><span id="textcolor2013">carrot1</span><span id="textcolor2014">'</span> 
<a id="x3-35054r1124"></a>      <span id="textcolor2015">t</span><span id="textcolor2016">.</span><span id="textcolor2017">transform</span><span id="textcolor2018">.</span><span id="textcolor2019">translation</span><span id="textcolor2020">.</span><span id="textcolor2021">x</span> <span id="textcolor2022">=</span> <span id="textcolor2023">10</span> <span id="textcolor2024">*</span> <span id="textcolor2025">math</span><span id="textcolor2026">.</span><span id="textcolor2027">sin</span><span id="textcolor2028">(</span><span id="textcolor2029">x</span><span id="textcolor2030">)</span> 
<a id="x3-35056r1125"></a>      <span id="textcolor2031">t</span><span id="textcolor2032">.</span><span id="textcolor2033">transform</span><span id="textcolor2034">.</span><span id="textcolor2035">translation</span><span id="textcolor2036">.</span><span id="textcolor2037">y</span> <span id="textcolor2038">=</span> <span id="textcolor2039">10</span> <span id="textcolor2040">*</span> <span id="textcolor2041">math</span><span id="textcolor2042">.</span><span id="textcolor2043">cos</span><span id="textcolor2044">(</span><span id="textcolor2045">x</span><span id="textcolor2046">)</span> 
<a id="x3-35058r1126"></a>      <span id="textcolor2047">t</span><span id="textcolor2048">.</span><span id="textcolor2049">transform</span><span id="textcolor2050">.</span><span id="textcolor2051">translation</span><span id="textcolor2052">.</span><span id="textcolor2053">z</span> <span id="textcolor2054">=</span> <span id="textcolor2055">0.0</span> 
<a id="x3-35060r1127"></a>      <span id="textcolor2056">t</span><span id="textcolor2057">.</span><span id="textcolor2058">transform</span><span id="textcolor2059">.</span><span id="textcolor2060">rotation</span><span id="textcolor2061">.</span><span id="textcolor2062">x</span> <span id="textcolor2063">=</span> <span id="textcolor2064">0.0</span> 
<a id="x3-35062r1128"></a>      <span id="textcolor2065">t</span><span id="textcolor2066">.</span><span id="textcolor2067">transform</span><span id="textcolor2068">.</span><span id="textcolor2069">rotation</span><span id="textcolor2070">.</span><span id="textcolor2071">y</span> <span id="textcolor2072">=</span> <span id="textcolor2073">0.0</span> 
<a id="x3-35064r1129"></a>      <span id="textcolor2074">t</span><span id="textcolor2075">.</span><span id="textcolor2076">transform</span><span id="textcolor2077">.</span><span id="textcolor2078">rotation</span><span id="textcolor2079">.</span><span id="textcolor2080">z</span> <span id="textcolor2081">=</span> <span id="textcolor2082">0.0</span> 
<a id="x3-35066r1130"></a>      <span id="textcolor2083">t</span><span id="textcolor2084">.</span><span id="textcolor2085">transform</span><span id="textcolor2086">.</span><span id="textcolor2087">rotation</span><span id="textcolor2088">.</span><span id="textcolor2089">w</span> <span id="textcolor2090">=</span> <span id="textcolor2091">1.0</span> 
<a id="x3-35068r1131"></a> 
<a id="x3-35070r1132"></a>      <span id="textcolor2092">self</span><span id="textcolor2093">.</span><span id="textcolor2094">tf_broadcaster</span><span id="textcolor2095">.</span><span id="textcolor2096">sendTransform</span><span id="textcolor2097">(</span><span id="textcolor2098">t</span><span id="textcolor2099">)</span> 
<a id="x3-35072r1133"></a> 
<a id="x3-35074r1134"></a> 
<a id="x3-35076r1135"></a><span id="textcolor2100">def</span><span id="textcolor2101"> </span><span id="textcolor2102">main</span><span id="textcolor2103">(</span><span id="textcolor2104">)</span><span id="textcolor2105">:</span> 
<a id="x3-35078r1136"></a>   <span id="textcolor2106">rclpy</span><span id="textcolor2107">.</span><span id="textcolor2108">init</span><span id="textcolor2109">(</span><span id="textcolor2110">)</span> 
<a id="x3-35080r1137"></a>   <span id="textcolor2111">node</span> <span id="textcolor2112">=</span> <span id="textcolor2113">DynamicFrameBroadcaster</span><span id="textcolor2114">(</span><span id="textcolor2115">)</span> 
<a id="x3-35082r1138"></a>   <span id="textcolor2116">try</span><span id="textcolor2117">:</span> 
<a id="x3-35084r1139"></a>      <span id="textcolor2118">rclpy</span><span id="textcolor2119">.</span><span id="textcolor2120">spin</span><span id="textcolor2121">(</span><span id="textcolor2122">node</span><span id="textcolor2123">)</span> 
<a id="x3-35086r1140"></a>   <span id="textcolor2124">except</span> <span id="textcolor2125">KeyboardInterrupt</span><span id="textcolor2126">:</span> 
<a id="x3-35088r1141"></a>      <span id="textcolor2127">pass</span> 
<a id="x3-35090r1142"></a> 
<a id="x3-35092r1143"></a>   <span id="textcolor2128">rclpy</span><span id="textcolor2129">.</span><span id="textcolor2130">shutdown</span><span id="textcolor2131">(</span><span id="textcolor2132">)</span></div></pre>
     </div>
     <a id="paragraph*.27">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-36000">
       </a>
       Examining the Code
      </span>
      Instead of a fixed definition of our x and y offsets, we are using the sin() and cos() functions on the current time so that the offset
of carrot1 is constantly changing.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb56" style="padding:20px;border-radius: 3px;"><a id="x3-36002r1150"></a>seconds,<span id="textcolor2133"> </span><span id="textcolor2134">_</span><span id="textcolor2135"> </span><span id="textcolor2136">=</span><span id="textcolor2137"> </span>self.get_clock<span id="textcolor2138">(</span><span id="textcolor2139">)</span>.now<span id="textcolor2140">(</span><span id="textcolor2141">)</span>.seconds_nanoseconds<span id="textcolor2142">(</span><span id="textcolor2143">)</span> 
<a id="x3-36004r1151"></a><span id="textcolor2144">x</span><span id="textcolor2145"> </span><span id="textcolor2146">=</span><span id="textcolor2147"> </span>seconds<span id="textcolor2148"> </span>*<span id="textcolor2149"> </span>math.pi 
<a id="x3-36006r1152"></a>... 
<a id="x3-36008r1153"></a>t.transform.translation.x<span id="textcolor2150"> </span><span id="textcolor2151">=</span><span id="textcolor2152"> </span><span id="textcolor2153">10</span><span id="textcolor2154"> </span>*<span id="textcolor2155"> </span>math.sin<span id="textcolor2156">(</span>x<span id="textcolor2157">)</span> 
<a id="x3-36010r1154"></a>t.transform.translation.y<span id="textcolor2158"> </span><span id="textcolor2159">=</span><span id="textcolor2160"> </span><span id="textcolor2161">10</span><span id="textcolor2162"> </span>*<span id="textcolor2163"> </span>math.cos<span id="textcolor2164">(</span>x<span id="textcolor2165">)</span></div></pre>
     </div>
     <a id="paragraph*.28">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-37000">
       </a>
       Adding an Entry Point
      </span>
      To allow the ros2 run command to run your node, you must add the entry point to setup.py (located in the <span id="textcolor2166"><code class="verb">src/learning\_tf2\_py</code></span>
      directory).
     </p>
     <p class="noindent">
      Add the following line between the <span id="textcolor2167"><code class="verb">'console_scripts':</code></span>
      brackets:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb57" style="padding:20px;border-radius: 3px;"><a id="x3-37002r1161"></a><span id="textcolor2168">'</span><span id="textcolor2169">dynamic_frame_tf2_broadcaster = learning_tf2_py.dynamic_frame_tf2_broadcaster:main</span><span id="textcolor2170">'</span><span id="textcolor2171">,</span></div></pre>
     </div>
     <a id="paragraph*.29">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-38000">
       </a>
       Writing the Launch File
      </span>
      To test this code, create a new launch file <span id="textcolor2172"><code class="verb">turtle_tf2_dynamic_frame_demo.launch.py</code></span>
      in the <span id="textcolor2173"><code class="verb">src/learning\_tf2\_py/launch</code></span>
      directory and paste the following code:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb58" style="padding:20px;border-radius: 3px;"><a id="x3-38002r1168"></a><span id="textcolor2174">from</span><span id="textcolor2175"> </span><span id="textcolor2176">launch</span><span id="textcolor2177"> </span><span id="textcolor2178">import</span> <span id="textcolor2179">LaunchDescription</span> 
<a id="x3-38004r1169"></a><span id="textcolor2180">from</span><span id="textcolor2181"> </span><span id="textcolor2182">launch</span><span id="textcolor2183">.</span><span id="textcolor2184">actions</span><span id="textcolor2185"> </span><span id="textcolor2186">import</span> <span id="textcolor2187">IncludeLaunchDescription</span> 
<a id="x3-38006r1170"></a><span id="textcolor2188">from</span><span id="textcolor2189"> </span><span id="textcolor2190">launch</span><span id="textcolor2191">.</span><span id="textcolor2192">substitutions</span><span id="textcolor2193"> </span><span id="textcolor2194">import</span> <span id="textcolor2195">PathJoinSubstitution</span> 
<a id="x3-38008r1171"></a><span id="textcolor2196">from</span><span id="textcolor2197"> </span><span id="textcolor2198">launch_ros</span><span id="textcolor2199">.</span><span id="textcolor2200">actions</span><span id="textcolor2201"> </span><span id="textcolor2202">import</span> <span id="textcolor2203">Node</span> 
<a id="x3-38010r1172"></a><span id="textcolor2204">from</span><span id="textcolor2205"> </span><span id="textcolor2206">launch_ros</span><span id="textcolor2207">.</span><span id="textcolor2208">substitutions</span><span id="textcolor2209"> </span><span id="textcolor2210">import</span> <span id="textcolor2211">FindPackageShare</span> 
<a id="x3-38012r1173"></a> 
<a id="x3-38014r1174"></a> 
<a id="x3-38016r1175"></a><span id="textcolor2212">def</span><span id="textcolor2213"> </span><span id="textcolor2214">generate_launch_description</span><span id="textcolor2215">(</span><span id="textcolor2216">)</span><span id="textcolor2217">:</span> 
<a id="x3-38018r1176"></a>   <span id="textcolor2218">return</span> <span id="textcolor2219">LaunchDescription</span><span id="textcolor2220">(</span><span id="textcolor2221">[</span> 
<a id="x3-38020r1177"></a>      <span id="textcolor2222">IncludeLaunchDescription</span><span id="textcolor2223">(</span> 
<a id="x3-38022r1178"></a>         <span id="textcolor2224">PathJoinSubstitution</span><span id="textcolor2225">(</span><span id="textcolor2226">[</span> 
<a id="x3-38024r1179"></a>            <span id="textcolor2227">FindPackageShare</span><span id="textcolor2228">(</span><span id="textcolor2229">'</span><span id="textcolor2230">learning_tf2_py</span><span id="textcolor2231">'</span><span id="textcolor2232">)</span><span id="textcolor2233">,</span> <span id="textcolor2234">'</span><span id="textcolor2235">launch</span><span id="textcolor2236">'</span><span id="textcolor2237">,</span> <span id="textcolor2238">'</span><span id="textcolor2239">turtle_tf2_demo.launch.py</span><span id="textcolor2240">'</span><span id="textcolor2241">]</span><span id="textcolor2242">)</span><span id="textcolor2243">,</span> 
<a id="x3-38026r1180"></a>         <span id="textcolor2244">launch_arguments</span><span id="textcolor2245">=</span><span id="textcolor2246">{</span><span id="textcolor2247">'</span><span id="textcolor2248">target_frame</span><span id="textcolor2249">'</span><span id="textcolor2250">:</span> <span id="textcolor2251">'</span><span id="textcolor2252">carrot1</span><span id="textcolor2253">'</span><span id="textcolor2254">}</span><span id="textcolor2255">.</span><span id="textcolor2256">items</span><span id="textcolor2257">(</span><span id="textcolor2258">)</span><span id="textcolor2259">,</span> 
<a id="x3-38028r1181"></a>      <span id="textcolor2260">)</span><span id="textcolor2261">,</span> 
<a id="x3-38030r1182"></a>      <span id="textcolor2262">Node</span><span id="textcolor2263">(</span> 
<a id="x3-38032r1183"></a>         <span id="textcolor2264">package</span><span id="textcolor2265">=</span><span id="textcolor2266">'</span><span id="textcolor2267">learning_tf2_py</span><span id="textcolor2268">'</span><span id="textcolor2269">,</span> 
<a id="x3-38034r1184"></a>         <span id="textcolor2270">executable</span><span id="textcolor2271">=</span><span id="textcolor2272">'</span><span id="textcolor2273">dynamic_frame_tf2_broadcaster</span><span id="textcolor2274">'</span><span id="textcolor2275">,</span> 
<a id="x3-38036r1185"></a>         <span id="textcolor2276">name</span><span id="textcolor2277">=</span><span id="textcolor2278">'</span><span id="textcolor2279">dynamic_broadcaster</span><span id="textcolor2280">'</span><span id="textcolor2281">,</span> 
<a id="x3-38038r1186"></a>      <span id="textcolor2282">)</span><span id="textcolor2283">,</span> 
<a id="x3-38040r1187"></a>   <span id="textcolor2284">]</span><span id="textcolor2285">)</span></div></pre>
     </div>
     <a id="paragraph*.30">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-39000">
       </a>
       Buld
      </span>
      Run rosdep in the root of your workspace to check for missing dependencies.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb59" style="padding:20px;border-radius: 3px;"><a id="x3-39002r1194"></a>rosdep<span id="textcolor2286"> </span>install<span id="textcolor2287"> </span>-i<span id="textcolor2288"> </span>--from-path<span id="textcolor2289"> </span>src<span id="textcolor2290"> </span>--rosdistro<span id="textcolor2291"> </span>humble<span id="textcolor2292"> </span>-y</div></pre>
     </div>
     <p class="noindent">
      Still in the root of your workspace, build your package:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb60" style="padding:20px;border-radius: 3px;"><a id="x3-39004r1199"></a>colcon<span id="textcolor2293"> </span>build<span id="textcolor2294"> </span>--packages-select<span id="textcolor2295"> </span>learning_tf2_py</div></pre>
     </div>
     <p class="noindent">
      Open a new terminal, navigate to the root of your workspace, and source the setup files:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb61" style="padding:20px;border-radius: 3px;"><a id="x3-39006r1204"></a>.<span id="textcolor2296"> </span>install/setup.bash</div></pre>
     </div>
     <a id="paragraph*.31">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-40000">
       </a>
       Run
      </span>
      Now you can start the dynamic frame demo:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb62" style="padding:20px;border-radius: 3px;"><a id="x3-40002r1211"></a>ros2<span id="textcolor2297"> </span>launch<span id="textcolor2298"> </span>learning_tf2_py<span id="textcolor2299"> </span>turtle_tf2_dynamic_frame_demo.launch.py</div></pre>
     </div>
     <p class="noindent">
      You should see that the second turtle is following the carrots position that is constantly changing.
     </p>
     <p class="noindent">
     </p>
    </div>
    <div class="section-head" id="section-5" sec="section-5">
     <h2 class="sectionHead">
      <a aria-label="Link to this section in PDF version" class="pdf-link" href="MobileRoboticsLectureBook.pdf#section.1.5" style="color: red;  position: absolute;  left: -30px;" target="_blank">
       <svg class="bi bi-file-pdf" fill="currentColor" height="20" viewbox="0 0 16 16" width="20" xmlns="http://www.w3.org/2000/svg">
        <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z">
        </path>
        <path d="M4.603 12.087a.81.81 0 0 1-.438-.42c-.195-.388-.13-.776.08-1.102.198-.307.526-.568.897-.787a7.68 7.68 0 0 1 1.482-.645 19.701 19.701 0 0 0 1.062-2.227 7.269 7.269 0 0 1-.43-1.295c-.086-.4-.119-.796-.046-1.136.075-.354.274-.672.65-.823.192-.077.4-.12.602-.077a.7.7 0 0 1 .477.365c.088.164.12.356.127.538.007.187-.012.395-.047.614-.084.51-.27 1.134-.52 1.794a10.954 10.954 0 0 0 .98 1.686 5.753 5.753 0 0 1 1.334.05c.364.065.734.195.96.465.12.144.193.32.2.518.007.192-.047.382-.138.563a1.04 1.04 0 0 1-.354.416.856.856 0 0 1-.51.138c-.331-.014-.654-.196-.933-.417a5.716 5.716 0 0 1-.911-.95 11.642 11.642 0 0 0-1.997.406 11.311 11.311 0 0 1-1.021 1.51c-.29.35-.608.655-.926.787a.793.793 0 0 1-.58.029zm1.379-1.901c-.166.076-.32.156-.459.238-.328.194-.541.383-.647.547-.094.145-.096.25-.04.361.01.022.02.036.026.044a.27.27 0 0 0 .035-.012c.137-.056.355-.235.635-.572a8.18 8.18 0 0 0 .45-.606zm1.64-1.33a12.647 12.647 0 0 1 1.01-.193 11.666 11.666 0 0 1-.51-.858 20.741 20.741 0 0 1-.5 1.05zm2.446.45c.15.162.296.3.435.41.24.19.407.253.498.256a.107.107 0 0 0 .07-.015.307.307 0 0 0 .094-.125.436.436 0 0 0 .059-.2.095.095 0 0 0-.026-.063c-.052-.062-.2-.152-.518-.209a3.881 3.881 0 0 0-.612-.053zM8.078 5.8a6.7 6.7 0 0 0 .2-.828c.031-.188.043-.343.038-.465a.613.613 0 0 0-.032-.198.517.517 0 0 0-.145.04c-.087.035-.158.106-.196.283-.04.192-.03.469.046.822.024.111.054.227.09.346z">
        </path>
       </svg>
      </a>
      <small class="titlemark">
       1.5
      </small>
      <a id="x3-410001.5">
      </a>
      Writing a Broadcaster
     </h2>
     <a id="paragraph*.32">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-42000">
       </a>
       Writing the Broadaster Node
      </span>
      Lets first create the source files. Go to the <span id="textcolor2300"><code class="verb">learning_tf2_py</code></span>
      package we created in the previous tutorial. Inside the <span id="textcolor2301"><code class="verb">[</code></span>
      /]src/learning_tf2_py/learning_tf2_py directory download the example broadcaster code by entering the following
command:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb63" style="padding:20px;border-radius: 3px;"><a id="x3-42002r432"></a>wget<span id="textcolor2302"> </span>https://raw.githubusercontent.com/ros/geometry_tutorials/humble/turtle_tf2_py/turtle_tf2_py/turtle_tf2_broadcaster.py</div></pre>
     </div>
     <p class="noindent">
      Now open the file called <span id="textcolor2303"><code class="verb">turtle_tf2_broadcaster.py</code></span>
      using your preferred text editor.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb64" style="padding:20px;border-radius: 3px;"><a id="x3-42004r437"></a><span id="textcolor2304">import</span><span id="textcolor2305"> </span><span id="textcolor2306">math</span> 
<a id="x3-42006r438"></a> 
<a id="x3-42008r439"></a><span id="textcolor2307">from</span><span id="textcolor2308"> </span><span id="textcolor2309">geometry_msgs</span><span id="textcolor2310">.</span><span id="textcolor2311">msg</span><span id="textcolor2312"> </span><span id="textcolor2313">import</span> <span id="textcolor2314">TransformStamped</span> 
<a id="x3-42010r440"></a> 
<a id="x3-42012r441"></a><span id="textcolor2315">import</span><span id="textcolor2316"> </span><span id="textcolor2317">numpy</span><span id="textcolor2318"> </span><span id="textcolor2319">as</span><span id="textcolor2320"> </span><span id="textcolor2321">np</span> 
<a id="x3-42014r442"></a> 
<a id="x3-42016r443"></a><span id="textcolor2322">import</span><span id="textcolor2323"> </span><span id="textcolor2324">rclpy</span> 
<a id="x3-42018r444"></a><span id="textcolor2325">from</span><span id="textcolor2326"> </span><span id="textcolor2327">rclpy</span><span id="textcolor2328">.</span><span id="textcolor2329">node</span><span id="textcolor2330"> </span><span id="textcolor2331">import</span> <span id="textcolor2332">Node</span> 
<a id="x3-42020r445"></a> 
<a id="x3-42022r446"></a><span id="textcolor2333">from</span><span id="textcolor2334"> </span><span id="textcolor2335">tf2_ros</span><span id="textcolor2336"> </span><span id="textcolor2337">import</span> <span id="textcolor2338">TransformBroadcaster</span> 
<a id="x3-42024r447"></a> 
<a id="x3-42026r448"></a><span id="textcolor2339">from</span><span id="textcolor2340"> </span><span id="textcolor2341">turtlesim</span><span id="textcolor2342">.</span><span id="textcolor2343">msg</span><span id="textcolor2344"> </span><span id="textcolor2345">import</span> <span id="textcolor2346">Pose</span> 
<a id="x3-42028r449"></a> 
<a id="x3-42030r450"></a> 
<a id="x3-42032r451"></a><span id="textcolor2347">def</span><span id="textcolor2348"> </span><span id="textcolor2349">quaternion_from_euler</span><span id="textcolor2350">(</span><span id="textcolor2351">ai</span><span id="textcolor2352">,</span> <span id="textcolor2353">aj</span><span id="textcolor2354">,</span> <span id="textcolor2355">ak</span><span id="textcolor2356">)</span><span id="textcolor2357">:</span> 
<a id="x3-42034r452"></a>   <span id="textcolor2358">ai</span> <span id="textcolor2359">/</span><span id="textcolor2360">=</span> <span id="textcolor2361">2.0</span> 
<a id="x3-42036r453"></a>   <span id="textcolor2362">aj</span> <span id="textcolor2363">/</span><span id="textcolor2364">=</span> <span id="textcolor2365">2.0</span> 
<a id="x3-42038r454"></a>   <span id="textcolor2366">ak</span> <span id="textcolor2367">/</span><span id="textcolor2368">=</span> <span id="textcolor2369">2.0</span> 
<a id="x3-42040r455"></a>   <span id="textcolor2370">ci</span> <span id="textcolor2371">=</span> <span id="textcolor2372">math</span><span id="textcolor2373">.</span><span id="textcolor2374">cos</span><span id="textcolor2375">(</span><span id="textcolor2376">ai</span><span id="textcolor2377">)</span> 
<a id="x3-42042r456"></a>   <span id="textcolor2378">si</span> <span id="textcolor2379">=</span> <span id="textcolor2380">math</span><span id="textcolor2381">.</span><span id="textcolor2382">sin</span><span id="textcolor2383">(</span><span id="textcolor2384">ai</span><span id="textcolor2385">)</span> 
<a id="x3-42044r457"></a>   <span id="textcolor2386">cj</span> <span id="textcolor2387">=</span> <span id="textcolor2388">math</span><span id="textcolor2389">.</span><span id="textcolor2390">cos</span><span id="textcolor2391">(</span><span id="textcolor2392">aj</span><span id="textcolor2393">)</span> 
<a id="x3-42046r458"></a>   <span id="textcolor2394">sj</span> <span id="textcolor2395">=</span> <span id="textcolor2396">math</span><span id="textcolor2397">.</span><span id="textcolor2398">sin</span><span id="textcolor2399">(</span><span id="textcolor2400">aj</span><span id="textcolor2401">)</span> 
<a id="x3-42048r459"></a>   <span id="textcolor2402">ck</span> <span id="textcolor2403">=</span> <span id="textcolor2404">math</span><span id="textcolor2405">.</span><span id="textcolor2406">cos</span><span id="textcolor2407">(</span><span id="textcolor2408">ak</span><span id="textcolor2409">)</span> 
<a id="x3-42050r460"></a>   <span id="textcolor2410">sk</span> <span id="textcolor2411">=</span> <span id="textcolor2412">math</span><span id="textcolor2413">.</span><span id="textcolor2414">sin</span><span id="textcolor2415">(</span><span id="textcolor2416">ak</span><span id="textcolor2417">)</span> 
<a id="x3-42052r461"></a>   <span id="textcolor2418">cc</span> <span id="textcolor2419">=</span> <span id="textcolor2420">ci</span><span id="textcolor2421">*</span><span id="textcolor2422">ck</span> 
<a id="x3-42054r462"></a>   <span id="textcolor2423">cs</span> <span id="textcolor2424">=</span> <span id="textcolor2425">ci</span><span id="textcolor2426">*</span><span id="textcolor2427">sk</span> 
<a id="x3-42056r463"></a>   <span id="textcolor2428">sc</span> <span id="textcolor2429">=</span> <span id="textcolor2430">si</span><span id="textcolor2431">*</span><span id="textcolor2432">ck</span> 
<a id="x3-42058r464"></a>   <span id="textcolor2433">ss</span> <span id="textcolor2434">=</span> <span id="textcolor2435">si</span><span id="textcolor2436">*</span><span id="textcolor2437">sk</span> 
<a id="x3-42060r465"></a> 
<a id="x3-42062r466"></a>   <span id="textcolor2438">q</span> <span id="textcolor2439">=</span> <span id="textcolor2440">np</span><span id="textcolor2441">.</span><span id="textcolor2442">empty</span><span id="textcolor2443">(</span><span id="textcolor2444">(</span><span id="textcolor2445">4</span><span id="textcolor2446">,</span> <span id="textcolor2447">)</span><span id="textcolor2448">)</span> 
<a id="x3-42064r467"></a>   <span id="textcolor2449">q</span><span id="textcolor2450">[</span><span id="textcolor2451">0</span><span id="textcolor2452">]</span> <span id="textcolor2453">=</span> <span id="textcolor2454">cj</span><span id="textcolor2455">*</span><span id="textcolor2456">sc</span> <span id="textcolor2457">-</span> <span id="textcolor2458">sj</span><span id="textcolor2459">*</span><span id="textcolor2460">cs</span> 
<a id="x3-42066r468"></a>   <span id="textcolor2461">q</span><span id="textcolor2462">[</span><span id="textcolor2463">1</span><span id="textcolor2464">]</span> <span id="textcolor2465">=</span> <span id="textcolor2466">cj</span><span id="textcolor2467">*</span><span id="textcolor2468">ss</span> <span id="textcolor2469">+</span> <span id="textcolor2470">sj</span><span id="textcolor2471">*</span><span id="textcolor2472">cc</span> 
<a id="x3-42068r469"></a>   <span id="textcolor2473">q</span><span id="textcolor2474">[</span><span id="textcolor2475">2</span><span id="textcolor2476">]</span> <span id="textcolor2477">=</span> <span id="textcolor2478">cj</span><span id="textcolor2479">*</span><span id="textcolor2480">cs</span> <span id="textcolor2481">-</span> <span id="textcolor2482">sj</span><span id="textcolor2483">*</span><span id="textcolor2484">sc</span> 
<a id="x3-42070r470"></a>   <span id="textcolor2485">q</span><span id="textcolor2486">[</span><span id="textcolor2487">3</span><span id="textcolor2488">]</span> <span id="textcolor2489">=</span> <span id="textcolor2490">cj</span><span id="textcolor2491">*</span><span id="textcolor2492">cc</span> <span id="textcolor2493">+</span> <span id="textcolor2494">sj</span><span id="textcolor2495">*</span><span id="textcolor2496">ss</span> 
<a id="x3-42072r471"></a> 
<a id="x3-42074r472"></a>   <span id="textcolor2497">return</span> <span id="textcolor2498">q</span> 
<a id="x3-42076r473"></a> 
<a id="x3-42078r474"></a> 
<a id="x3-42080r475"></a><span id="textcolor2499">class</span><span id="textcolor2500"> </span><span id="textcolor2501">FramePublisher</span><span id="textcolor2502">(</span><span id="textcolor2503">Node</span><span id="textcolor2504">)</span><span id="textcolor2505">:</span> 
<a id="x3-42082r476"></a> 
<a id="x3-42084r477"></a>   <span id="textcolor2506">def</span><span id="textcolor2507"> </span><span id="textcolor2508">__init__</span><span id="textcolor2509">(</span><span id="textcolor2510">self</span><span id="textcolor2511">)</span><span id="textcolor2512">:</span> 
<a id="x3-42086r478"></a>      <span id="textcolor2513">super</span><span id="textcolor2514">(</span><span id="textcolor2515">)</span><span id="textcolor2516">.</span><span id="textcolor2517">__init__</span><span id="textcolor2518">(</span><span id="textcolor2519">'</span><span id="textcolor2520">turtle_tf2_frame_publisher</span><span id="textcolor2521">'</span><span id="textcolor2522">)</span> 
<a id="x3-42088r479"></a> 
<a id="x3-42090r480"></a>      <span id="textcolor2523"># Declare and acquire `turtlename` parameter</span> 
<a id="x3-42092r481"></a>      <span id="textcolor2524">self</span><span id="textcolor2525">.</span><span id="textcolor2526">turtlename</span> <span id="textcolor2527">=</span> <span id="textcolor2528">self</span><span id="textcolor2529">.</span><span id="textcolor2530">declare_parameter</span><span id="textcolor2531">(</span> 
<a id="x3-42094r482"></a>       <span id="textcolor2532">'</span><span id="textcolor2533">turtlename</span><span id="textcolor2534">'</span><span id="textcolor2535">,</span> <span id="textcolor2536">'</span><span id="textcolor2537">turtle</span><span id="textcolor2538">'</span><span id="textcolor2539">)</span><span id="textcolor2540">.</span><span id="textcolor2541">get_parameter_value</span><span id="textcolor2542">(</span><span id="textcolor2543">)</span><span id="textcolor2544">.</span><span id="textcolor2545">string_value</span> 
<a id="x3-42096r483"></a> 
<a id="x3-42098r484"></a>      <span id="textcolor2546"># Initialize the transform broadcaster</span> 
<a id="x3-42100r485"></a>      <span id="textcolor2547">self</span><span id="textcolor2548">.</span><span id="textcolor2549">tf_broadcaster</span> <span id="textcolor2550">=</span> <span id="textcolor2551">TransformBroadcaster</span><span id="textcolor2552">(</span><span id="textcolor2553">self</span><span id="textcolor2554">)</span> 
<a id="x3-42102r486"></a> 
<a id="x3-42104r487"></a>      <span id="textcolor2555"># Subscribe to a turtle{1}{2}/pose topic and call handle_turtle_pose</span> 
<a id="x3-42106r488"></a>      <span id="textcolor2556"># callback function on each message</span> 
<a id="x3-42108r489"></a>      <span id="textcolor2557">self</span><span id="textcolor2558">.</span><span id="textcolor2559">subscription</span> <span id="textcolor2560">=</span> <span id="textcolor2561">self</span><span id="textcolor2562">.</span><span id="textcolor2563">create_subscription</span><span id="textcolor2564">(</span> 
<a id="x3-42110r490"></a>         <span id="textcolor2565">Pose</span><span id="textcolor2566">,</span> 
<a id="x3-42112r491"></a>         <span id="textcolor2567">f</span><span id="textcolor2568">'</span><span id="textcolor2569">/</span><span id="textcolor2570">{</span><span id="textcolor2571">self</span><span id="textcolor2572">.</span><span id="textcolor2573">turtlename</span><span id="textcolor2574">}</span><span id="textcolor2575">/pose</span><span id="textcolor2576">'</span><span id="textcolor2577">,</span> 
<a id="x3-42114r492"></a>         <span id="textcolor2578">self</span><span id="textcolor2579">.</span><span id="textcolor2580">handle_turtle_pose</span><span id="textcolor2581">,</span> 
<a id="x3-42116r493"></a>         <span id="textcolor2582">1</span><span id="textcolor2583">)</span> 
<a id="x3-42118r494"></a>      <span id="textcolor2584">self</span><span id="textcolor2585">.</span><span id="textcolor2586">subscription</span>  <span id="textcolor2587"># prevent unused variable warning</span> 
<a id="x3-42120r495"></a> 
<a id="x3-42122r496"></a>   <span id="textcolor2588">def</span><span id="textcolor2589"> </span><span id="textcolor2590">handle_turtle_pose</span><span id="textcolor2591">(</span><span id="textcolor2592">self</span><span id="textcolor2593">,</span> <span id="textcolor2594">msg</span><span id="textcolor2595">)</span><span id="textcolor2596">:</span> 
<a id="x3-42124r497"></a>      <span id="textcolor2597">t</span> <span id="textcolor2598">=</span> <span id="textcolor2599">TransformStamped</span><span id="textcolor2600">(</span><span id="textcolor2601">)</span> 
<a id="x3-42126r498"></a> 
<a id="x3-42128r499"></a>      <span id="textcolor2602"># Read message content and assign it to</span> 
<a id="x3-42130r500"></a>      <span id="textcolor2603"># corresponding tf variables</span> 
<a id="x3-42132r501"></a>      <span id="textcolor2604">t</span><span id="textcolor2605">.</span><span id="textcolor2606">header</span><span id="textcolor2607">.</span><span id="textcolor2608">stamp</span> <span id="textcolor2609">=</span> <span id="textcolor2610">self</span><span id="textcolor2611">.</span><span id="textcolor2612">get_clock</span><span id="textcolor2613">(</span><span id="textcolor2614">)</span><span id="textcolor2615">.</span><span id="textcolor2616">now</span><span id="textcolor2617">(</span><span id="textcolor2618">)</span><span id="textcolor2619">.</span><span id="textcolor2620">to_msg</span><span id="textcolor2621">(</span><span id="textcolor2622">)</span> 
<a id="x3-42134r502"></a>      <span id="textcolor2623">t</span><span id="textcolor2624">.</span><span id="textcolor2625">header</span><span id="textcolor2626">.</span><span id="textcolor2627">frame_id</span> <span id="textcolor2628">=</span> <span id="textcolor2629">'</span><span id="textcolor2630">world</span><span id="textcolor2631">'</span> 
<a id="x3-42136r503"></a>      <span id="textcolor2632">t</span><span id="textcolor2633">.</span><span id="textcolor2634">child_frame_id</span> <span id="textcolor2635">=</span> <span id="textcolor2636">self</span><span id="textcolor2637">.</span><span id="textcolor2638">turtlename</span> 
<a id="x3-42138r504"></a> 
<a id="x3-42140r505"></a>      <span id="textcolor2639"># Turtle only exists in 2D, thus we get x and y translation</span> 
<a id="x3-42142r506"></a>      <span id="textcolor2640"># coordinates from the message and set the z coordinate to 0</span> 
<a id="x3-42144r507"></a>      <span id="textcolor2641">t</span><span id="textcolor2642">.</span><span id="textcolor2643">transform</span><span id="textcolor2644">.</span><span id="textcolor2645">translation</span><span id="textcolor2646">.</span><span id="textcolor2647">x</span> <span id="textcolor2648">=</span> <span id="textcolor2649">msg</span><span id="textcolor2650">.</span><span id="textcolor2651">x</span> 
<a id="x3-42146r508"></a>      <span id="textcolor2652">t</span><span id="textcolor2653">.</span><span id="textcolor2654">transform</span><span id="textcolor2655">.</span><span id="textcolor2656">translation</span><span id="textcolor2657">.</span><span id="textcolor2658">y</span> <span id="textcolor2659">=</span> <span id="textcolor2660">msg</span><span id="textcolor2661">.</span><span id="textcolor2662">y</span> 
<a id="x3-42148r509"></a>      <span id="textcolor2663">t</span><span id="textcolor2664">.</span><span id="textcolor2665">transform</span><span id="textcolor2666">.</span><span id="textcolor2667">translation</span><span id="textcolor2668">.</span><span id="textcolor2669">z</span> <span id="textcolor2670">=</span> <span id="textcolor2671">0.0</span> 
<a id="x3-42150r510"></a> 
<a id="x3-42152r511"></a>      <span id="textcolor2672"># For the same reason, turtle can only rotate around one axis</span> 
<a id="x3-42154r512"></a>      <span id="textcolor2673"># and this why we set rotation in x and y to 0 and obtain</span> 
<a id="x3-42156r513"></a>      <span id="textcolor2674"># rotation in z axis from the message</span> 
<a id="x3-42158r514"></a>      <span id="textcolor2675">q</span> <span id="textcolor2676">=</span> <span id="textcolor2677">quaternion_from_euler</span><span id="textcolor2678">(</span><span id="textcolor2679">0</span><span id="textcolor2680">,</span> <span id="textcolor2681">0</span><span id="textcolor2682">,</span> <span id="textcolor2683">msg</span><span id="textcolor2684">.</span><span id="textcolor2685">theta</span><span id="textcolor2686">)</span> 
<a id="x3-42160r515"></a>      <span id="textcolor2687">t</span><span id="textcolor2688">.</span><span id="textcolor2689">transform</span><span id="textcolor2690">.</span><span id="textcolor2691">rotation</span><span id="textcolor2692">.</span><span id="textcolor2693">x</span> <span id="textcolor2694">=</span> <span id="textcolor2695">q</span><span id="textcolor2696">[</span><span id="textcolor2697">0</span><span id="textcolor2698">]</span> 
<a id="x3-42162r516"></a>      <span id="textcolor2699">t</span><span id="textcolor2700">.</span><span id="textcolor2701">transform</span><span id="textcolor2702">.</span><span id="textcolor2703">rotation</span><span id="textcolor2704">.</span><span id="textcolor2705">y</span> <span id="textcolor2706">=</span> <span id="textcolor2707">q</span><span id="textcolor2708">[</span><span id="textcolor2709">1</span><span id="textcolor2710">]</span> 
<a id="x3-42164r517"></a>      <span id="textcolor2711">t</span><span id="textcolor2712">.</span><span id="textcolor2713">transform</span><span id="textcolor2714">.</span><span id="textcolor2715">rotation</span><span id="textcolor2716">.</span><span id="textcolor2717">z</span> <span id="textcolor2718">=</span> <span id="textcolor2719">q</span><span id="textcolor2720">[</span><span id="textcolor2721">2</span><span id="textcolor2722">]</span> 
<a id="x3-42166r518"></a>      <span id="textcolor2723">t</span><span id="textcolor2724">.</span><span id="textcolor2725">transform</span><span id="textcolor2726">.</span><span id="textcolor2727">rotation</span><span id="textcolor2728">.</span><span id="textcolor2729">w</span> <span id="textcolor2730">=</span> <span id="textcolor2731">q</span><span id="textcolor2732">[</span><span id="textcolor2733">3</span><span id="textcolor2734">]</span> 
<a id="x3-42168r519"></a> 
<a id="x3-42170r520"></a>      <span id="textcolor2735"># Send the transformation</span> 
<a id="x3-42172r521"></a>      <span id="textcolor2736">self</span><span id="textcolor2737">.</span><span id="textcolor2738">tf_broadcaster</span><span id="textcolor2739">.</span><span id="textcolor2740">sendTransform</span><span id="textcolor2741">(</span><span id="textcolor2742">t</span><span id="textcolor2743">)</span> 
<a id="x3-42174r522"></a> 
<a id="x3-42176r523"></a> 
<a id="x3-42178r524"></a><span id="textcolor2744">def</span><span id="textcolor2745"> </span><span id="textcolor2746">main</span><span id="textcolor2747">(</span><span id="textcolor2748">)</span><span id="textcolor2749">:</span> 
<a id="x3-42180r525"></a>   <span id="textcolor2750">rclpy</span><span id="textcolor2751">.</span><span id="textcolor2752">init</span><span id="textcolor2753">(</span><span id="textcolor2754">)</span> 
<a id="x3-42182r526"></a>   <span id="textcolor2755">node</span> <span id="textcolor2756">=</span> <span id="textcolor2757">FramePublisher</span><span id="textcolor2758">(</span><span id="textcolor2759">)</span> 
<a id="x3-42184r527"></a>   <span id="textcolor2760">try</span><span id="textcolor2761">:</span> 
<a id="x3-42186r528"></a>      <span id="textcolor2762">rclpy</span><span id="textcolor2763">.</span><span id="textcolor2764">spin</span><span id="textcolor2765">(</span><span id="textcolor2766">node</span><span id="textcolor2767">)</span> 
<a id="x3-42188r529"></a>   <span id="textcolor2768">except</span> <span id="textcolor2769">KeyboardInterrupt</span><span id="textcolor2770">:</span> 
<a id="x3-42190r530"></a>      <span id="textcolor2771">pass</span> 
<a id="x3-42192r531"></a> 
<a id="x3-42194r532"></a>   <span id="textcolor2772">rclpy</span><span id="textcolor2773">.</span><span id="textcolor2774">shutdown</span><span id="textcolor2775">(</span><span id="textcolor2776">)</span></div></pre>
     </div>
     <a id="paragraph*.33">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-43000">
       </a>
       Examining the Code
      </span>
      Now, lets take a look at the code that is relevant to publishing the turtle pose to tf2. Firstly, we define and acquire a single
parameter <span id="textcolor2777"><code class="verb">turtlename</code></span>, which specifies a turtle name, e.g. <span id="textcolor2778"><code class="verb">turtle1</code></span>
      or <span id="textcolor2779"><code class="verb">turtle2</code></span>.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb65" style="padding:20px;border-radius: 3px;"><a id="x3-43002r539"></a><span id="textcolor2780">self</span><span id="textcolor2781">.</span><span id="textcolor2782">turtlename</span> <span id="textcolor2783">=</span> <span id="textcolor2784">self</span><span id="textcolor2785">.</span><span id="textcolor2786">declare_parameter</span><span id="textcolor2787">(</span> 
<a id="x3-43004r540"></a> <span id="textcolor2788">'</span><span id="textcolor2789">turtlename</span><span id="textcolor2790">'</span><span id="textcolor2791">,</span> <span id="textcolor2792">'</span><span id="textcolor2793">turtle</span><span id="textcolor2794">'</span><span id="textcolor2795">)</span><span id="textcolor2796">.</span><span id="textcolor2797">get_parameter_value</span><span id="textcolor2798">(</span><span id="textcolor2799">)</span><span id="textcolor2800">.</span><span id="textcolor2801">string_value</span></div></pre>
     </div>
     <p class="noindent">
      Afterward, the node subscribes to topic <span id="textcolor2802"><code class="verb">{self.turtlename}/pose</code></span>
      and runs function <span id="textcolor2803"><code class="verb">handle_turtle_pose</code></span>
      on every incoming
message.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb66" style="padding:20px;border-radius: 3px;"><a id="x3-43006r545"></a><span id="textcolor2804">self</span> <span id="textcolor2805">.</span><span id="textcolor2806">subscription</span> <span id="textcolor2807">=</span> <span id="textcolor2808">self</span><span id="textcolor2809">.</span><span id="textcolor2810">create_subscription</span><span id="textcolor2811">(</span> 
<a id="x3-43008r546"></a>   <span id="textcolor2812">Pose</span><span id="textcolor2813">,</span> 
<a id="x3-43010r547"></a>   <span id="textcolor2814">f</span><span id="textcolor2815">'</span><span id="textcolor2816">/</span><span id="textcolor2817">{</span><span id="textcolor2818">self</span><span id="textcolor2819">.</span><span id="textcolor2820">turtlename</span><span id="textcolor2821">}</span><span id="textcolor2822">/pose</span><span id="textcolor2823">'</span><span id="textcolor2824">,</span> 
<a id="x3-43012r548"></a>   <span id="textcolor2825">self</span><span id="textcolor2826">.</span><span id="textcolor2827">handle_turtle_pose</span><span id="textcolor2828">,</span> 
<a id="x3-43014r549"></a>   <span id="textcolor2829">1</span><span id="textcolor2830">)</span></div></pre>
     </div>
     <p class="noindent">
      Now, we create a TransformStamped object and give it the appropriate metadata.
     </p>
     <ul class="itemize1">
      <li class="itemize">
       <p class="noindent">
        We
need
to
give
the
transform
being
published
a
timestamp,
and
well
just
stamp
it
with
the
current
time
                                                                                
                                                                                
     
by
calling <span id="textcolor2832"><code class="verb">self.get_clock().now()</code></span>.
This
will
return
the
current
time
used
by
the
Node.
       </p>
      </li>
      <li class="itemize">
       <p class="noindent">
        Then
we
need
to
set
the
name
of
the
parent
frame
of
the
link
were
creating,
in
this
case
world.
       </p>
      </li>
      <li class="itemize">
       <p class="noindent">
        Finally,
we
need
to
set
the
name
of
the
child
node
of
the
link
were
creating,
in
this
case
this
is
the
name
of
the
turtle
                                                                                
                                                                                
     
itself.
       </p>
      </li>
     </ul>
     <p class="noindent">
      The handler function for the turtle pose message broadcasts this turtles translation and rotation, and publishes it as a transform
from frame world to frame <span id="textcolor2835"><code class="verb">turtleX</code></span>.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb67" style="padding:20px;border-radius: 3px;"><a id="x3-43016r554"></a><span id="textcolor2836">t</span> <span id="textcolor2837">=</span> <span id="textcolor2838">TransformStamped</span><span id="textcolor2839">(</span><span id="textcolor2840">)</span> 
<a id="x3-43018r555"></a> 
<a id="x3-43020r556"></a><span id="textcolor2841"># Read message content and assign it to</span> 
<a id="x3-43022r557"></a><span id="textcolor2842"># corresponding tf variables</span> 
<a id="x3-43024r558"></a><span id="textcolor2843">t</span><span id="textcolor2844">.</span><span id="textcolor2845">header</span><span id="textcolor2846">.</span><span id="textcolor2847">stamp</span> <span id="textcolor2848">=</span> <span id="textcolor2849">self</span><span id="textcolor2850">.</span><span id="textcolor2851">get_clock</span><span id="textcolor2852">(</span><span id="textcolor2853">)</span><span id="textcolor2854">.</span><span id="textcolor2855">now</span><span id="textcolor2856">(</span><span id="textcolor2857">)</span><span id="textcolor2858">.</span><span id="textcolor2859">to_msg</span><span id="textcolor2860">(</span><span id="textcolor2861">)</span> 
<a id="x3-43026r559"></a><span id="textcolor2862">t</span><span id="textcolor2863">.</span><span id="textcolor2864">header</span><span id="textcolor2865">.</span><span id="textcolor2866">frame_id</span> <span id="textcolor2867">=</span> <span id="textcolor2868">'</span><span id="textcolor2869">world</span><span id="textcolor2870">'</span> 
<a id="x3-43028r560"></a><span id="textcolor2871">t</span><span id="textcolor2872">.</span><span id="textcolor2873">child_frame_id</span> <span id="textcolor2874">=</span> <span id="textcolor2875">self</span><span id="textcolor2876">.</span><span id="textcolor2877">turtlename</span></div></pre>
     </div>
     <p class="noindent">
      Here we copy the information from the 3D turtle pose into the 3D transform.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb68" style="padding:20px;border-radius: 3px;"><a id="x3-43030r565"></a><span id="textcolor2878"># Turtle only exists in 2D, thus we get x and y translation</span> 
<a id="x3-43032r566"></a><span id="textcolor2879"># coordinates from the message and set the z coordinate to 0</span> 
<a id="x3-43034r567"></a><span id="textcolor2880">t</span><span id="textcolor2881">.</span><span id="textcolor2882">transform</span><span id="textcolor2883">.</span><span id="textcolor2884">translation</span><span id="textcolor2885">.</span><span id="textcolor2886">x</span> <span id="textcolor2887">=</span> <span id="textcolor2888">msg</span><span id="textcolor2889">.</span><span id="textcolor2890">x</span> 
<a id="x3-43036r568"></a><span id="textcolor2891">t</span><span id="textcolor2892">.</span><span id="textcolor2893">transform</span><span id="textcolor2894">.</span><span id="textcolor2895">translation</span><span id="textcolor2896">.</span><span id="textcolor2897">y</span> <span id="textcolor2898">=</span> <span id="textcolor2899">msg</span><span id="textcolor2900">.</span><span id="textcolor2901">y</span> 
<a id="x3-43038r569"></a><span id="textcolor2902">t</span><span id="textcolor2903">.</span><span id="textcolor2904">transform</span><span id="textcolor2905">.</span><span id="textcolor2906">translation</span><span id="textcolor2907">.</span><span id="textcolor2908">z</span> <span id="textcolor2909">=</span> <span id="textcolor2910">0.0</span> 
<a id="x3-43040r570"></a> 
<a id="x3-43042r571"></a><span id="textcolor2911"># For the same reason, turtle can only rotate around one axis</span> 
<a id="x3-43044r572"></a><span id="textcolor2912"># and this why we set rotation in x and y to 0 and obtain</span> 
<a id="x3-43046r573"></a><span id="textcolor2913"># rotation in z axis from the message</span> 
<a id="x3-43048r574"></a><span id="textcolor2914">q</span> <span id="textcolor2915">=</span> <span id="textcolor2916">quaternion_from_euler</span><span id="textcolor2917">(</span><span id="textcolor2918">0</span><span id="textcolor2919">,</span> <span id="textcolor2920">0</span><span id="textcolor2921">,</span> <span id="textcolor2922">msg</span><span id="textcolor2923">.</span><span id="textcolor2924">theta</span><span id="textcolor2925">)</span> 
<a id="x3-43050r575"></a><span id="textcolor2926">t</span><span id="textcolor2927">.</span><span id="textcolor2928">transform</span><span id="textcolor2929">.</span><span id="textcolor2930">rotation</span><span id="textcolor2931">.</span><span id="textcolor2932">x</span> <span id="textcolor2933">=</span> <span id="textcolor2934">q</span><span id="textcolor2935">[</span><span id="textcolor2936">0</span><span id="textcolor2937">]</span> 
<a id="x3-43052r576"></a><span id="textcolor2938">t</span><span id="textcolor2939">.</span><span id="textcolor2940">transform</span><span id="textcolor2941">.</span><span id="textcolor2942">rotation</span><span id="textcolor2943">.</span><span id="textcolor2944">y</span> <span id="textcolor2945">=</span> <span id="textcolor2946">q</span><span id="textcolor2947">[</span><span id="textcolor2948">1</span><span id="textcolor2949">]</span> 
<a id="x3-43054r577"></a><span id="textcolor2950">t</span><span id="textcolor2951">.</span><span id="textcolor2952">transform</span><span id="textcolor2953">.</span><span id="textcolor2954">rotation</span><span id="textcolor2955">.</span><span id="textcolor2956">z</span> <span id="textcolor2957">=</span> <span id="textcolor2958">q</span><span id="textcolor2959">[</span><span id="textcolor2960">2</span><span id="textcolor2961">]</span> 
<a id="x3-43056r578"></a><span id="textcolor2962">t</span><span id="textcolor2963">.</span><span id="textcolor2964">transform</span><span id="textcolor2965">.</span><span id="textcolor2966">rotation</span><span id="textcolor2967">.</span><span id="textcolor2968">w</span> <span id="textcolor2969">=</span> <span id="textcolor2970">q</span><span id="textcolor2971">[</span><span id="textcolor2972">3</span><span id="textcolor2973">]</span></div></pre>
     </div>
     <p class="noindent">
      Finally we take the transform that we constructed and pass it to the sendTransform method of the TransformBroadcaster that
will take care of broadcasting.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb69" style="padding:20px;border-radius: 3px;"><a id="x3-43058r583"></a><span id="textcolor2974"># Send the transformation</span> 
<a id="x3-43060r584"></a><span id="textcolor2975">self</span><span id="textcolor2976">.</span><span id="textcolor2977">tf_broadcaster</span><span id="textcolor2978">.</span><span id="textcolor2979">sendTransform</span><span id="textcolor2980">(</span><span id="textcolor2981">t</span><span id="textcolor2982">)</span></div></pre>
     </div>
     <a id="paragraph*.34">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-44000">
       </a>
       Adding an Entry Point
      </span>
      To allow the ros2 run command to run your node, you must add the entry point to setup.py
     </p>
     <p class="noindent">
      Add the following line between the <span id="textcolor2983"><code class="verb">'console_scripts':</code></span>
      brackets:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb70" style="padding:20px;border-radius: 3px;"><a id="x3-44002r591"></a><span id="textcolor2984"># Send the transformation</span> 
<a id="x3-44004r592"></a><span id="textcolor2985">self</span><span id="textcolor2986">.</span><span id="textcolor2987">tf_broadcaster</span><span id="textcolor2988">.</span><span id="textcolor2989">sendTransform</span><span id="textcolor2990">(</span><span id="textcolor2991">t</span><span id="textcolor2992">)</span></div></pre>
     </div>
     <a id="paragraph*.35">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-45000">
       </a>
       Writing the Launch File
      </span>
      Now create a launch file for this demo. Create a launch folder in the <span id="textcolor2993"><code class="verb">src/learning\_tf2\_py</code></span>
      directory. With your
text editor, create a new file called <span id="textcolor2994"><code class="verb">turtle\_tf2\_demo.launch.py</code></span>
      in the launch folder, and add the following
lines:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb71" style="padding:20px;border-radius: 3px;"><a id="x3-45002r599"></a><span id="textcolor2995">from</span><span id="textcolor2996"> </span><span id="textcolor2997">launch</span><span id="textcolor2998"> </span><span id="textcolor2999">import</span> <span id="textcolor3000">LaunchDescription</span> 
<a id="x3-45004r600"></a><span id="textcolor3001">from</span><span id="textcolor3002"> </span><span id="textcolor3003">launch_ros</span><span id="textcolor3004">.</span><span id="textcolor3005">actions</span><span id="textcolor3006"> </span><span id="textcolor3007">import</span> <span id="textcolor3008">Node</span> 
<a id="x3-45006r601"></a> 
<a id="x3-45008r602"></a> 
<a id="x3-45010r603"></a><span id="textcolor3009">def</span><span id="textcolor3010"> </span><span id="textcolor3011">generate_launch_description</span><span id="textcolor3012">(</span><span id="textcolor3013">)</span><span id="textcolor3014">:</span> 
<a id="x3-45012r604"></a>   <span id="textcolor3015">return</span> <span id="textcolor3016">LaunchDescription</span><span id="textcolor3017">(</span><span id="textcolor3018">[</span> 
<a id="x3-45014r605"></a>      <span id="textcolor3019">Node</span><span id="textcolor3020">(</span> 
<a id="x3-45016r606"></a>         <span id="textcolor3021">package</span><span id="textcolor3022">=</span><span id="textcolor3023">'</span><span id="textcolor3024">turtlesim</span><span id="textcolor3025">'</span><span id="textcolor3026">,</span> 
<a id="x3-45018r607"></a>         <span id="textcolor3027">executable</span><span id="textcolor3028">=</span><span id="textcolor3029">'</span><span id="textcolor3030">turtlesim_node</span><span id="textcolor3031">'</span><span id="textcolor3032">,</span> 
<a id="x3-45020r608"></a>         <span id="textcolor3033">name</span><span id="textcolor3034">=</span><span id="textcolor3035">'</span><span id="textcolor3036">sim</span><span id="textcolor3037">'</span> 
<a id="x3-45022r609"></a>      <span id="textcolor3038">)</span><span id="textcolor3039">,</span> 
<a id="x3-45024r610"></a>      <span id="textcolor3040">Node</span><span id="textcolor3041">(</span> 
<a id="x3-45026r611"></a>         <span id="textcolor3042">package</span><span id="textcolor3043">=</span><span id="textcolor3044">'</span><span id="textcolor3045">learning_tf2_py</span><span id="textcolor3046">'</span><span id="textcolor3047">,</span> 
<a id="x3-45028r612"></a>         <span id="textcolor3048">executable</span><span id="textcolor3049">=</span><span id="textcolor3050">'</span><span id="textcolor3051">turtle_tf2_broadcaster</span><span id="textcolor3052">'</span><span id="textcolor3053">,</span> 
<a id="x3-45030r613"></a>         <span id="textcolor3054">name</span><span id="textcolor3055">=</span><span id="textcolor3056">'</span><span id="textcolor3057">broadcaster1</span><span id="textcolor3058">'</span><span id="textcolor3059">,</span> 
<a id="x3-45032r614"></a>         <span id="textcolor3060">parameters</span><span id="textcolor3061">=</span><span id="textcolor3062">[</span> 
<a id="x3-45034r615"></a>            <span id="textcolor3063">{</span><span id="textcolor3064">'</span><span id="textcolor3065">turtlename</span><span id="textcolor3066">'</span><span id="textcolor3067">:</span> <span id="textcolor3068">'</span><span id="textcolor3069">turtle1</span><span id="textcolor3070">'</span><span id="textcolor3071">}</span> 
<a id="x3-45036r616"></a>         <span id="textcolor3072">]</span> 
<a id="x3-45038r617"></a>      <span id="textcolor3073">)</span><span id="textcolor3074">,</span> 
<a id="x3-45040r618"></a>   <span id="textcolor3075">]</span><span id="textcolor3076">)</span></div></pre>
     </div>
     <a id="paragraph*.36">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-46000">
       </a>
       Examining the Code
      </span>
      First we import required modules from the launch and <span id="textcolor3077"><code class="verb">launch_ros</code></span>
      packages. It should be noted that launch is a generic
launching framework (not ROS 2 specific) and <span id="textcolor3078"><code class="verb">launch_ros</code></span>
      has ROS 2 specific things, like nodes that we import
here.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb72" style="padding:20px;border-radius: 3px;"><a id="x3-46002r625"></a><span id="textcolor3079">from</span><span id="textcolor3080"> </span><span id="textcolor3081">launch</span><span id="textcolor3082"> </span><span id="textcolor3083">import</span> <span id="textcolor3084">LaunchDescription</span> 
<a id="x3-46004r626"></a><span id="textcolor3085">from</span><span id="textcolor3086"> </span><span id="textcolor3087">launch_ros</span><span id="textcolor3088">.</span><span id="textcolor3089">actions</span><span id="textcolor3090"> </span><span id="textcolor3091">import</span> <span id="textcolor3092">Node</span></div></pre>
     </div>
     <p class="noindent">
      Now we run our nodes that start the turtlesim simulation and broadcast turtle1 state to the tf2 using our <span id="textcolor3093"><code class="verb">turtle_tf2_broadcaster</code></span>
      node.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb73" style="padding:20px;border-radius: 3px;"><a id="x3-46006r631"></a>      <span id="textcolor3094">Node</span><span id="textcolor3095">(</span> 
<a id="x3-46008r632"></a>         <span id="textcolor3096">package</span><span id="textcolor3097">=</span><span id="textcolor3098">'</span><span id="textcolor3099">turtlesim</span><span id="textcolor3100">'</span><span id="textcolor3101">,</span> 
<a id="x3-46010r633"></a>         <span id="textcolor3102">executable</span><span id="textcolor3103">=</span><span id="textcolor3104">'</span><span id="textcolor3105">turtlesim_node</span><span id="textcolor3106">'</span><span id="textcolor3107">,</span> 
<a id="x3-46012r634"></a>         <span id="textcolor3108">name</span><span id="textcolor3109">=</span><span id="textcolor3110">'</span><span id="textcolor3111">sim</span><span id="textcolor3112">'</span> 
<a id="x3-46014r635"></a>      <span id="textcolor3113">)</span><span id="textcolor3114">,</span> 
<a id="x3-46016r636"></a>      <span id="textcolor3115">Node</span><span id="textcolor3116">(</span> 
<a id="x3-46018r637"></a>         <span id="textcolor3117">package</span><span id="textcolor3118">=</span><span id="textcolor3119">'</span><span id="textcolor3120">learning_tf2_py</span><span id="textcolor3121">'</span><span id="textcolor3122">,</span> 
<a id="x3-46020r638"></a>         <span id="textcolor3123">executable</span><span id="textcolor3124">=</span><span id="textcolor3125">'</span><span id="textcolor3126">turtle_tf2_broadcaster</span><span id="textcolor3127">'</span><span id="textcolor3128">,</span> 
<a id="x3-46022r639"></a>         <span id="textcolor3129">name</span><span id="textcolor3130">=</span><span id="textcolor3131">'</span><span id="textcolor3132">broadcaster1</span><span id="textcolor3133">'</span><span id="textcolor3134">,</span> 
<a id="x3-46024r640"></a>         <span id="textcolor3135">parameters</span><span id="textcolor3136">=</span><span id="textcolor3137">[</span> 
<a id="x3-46026r641"></a>            <span id="textcolor3138">{</span><span id="textcolor3139">'</span><span id="textcolor3140">turtlename</span><span id="textcolor3141">'</span><span id="textcolor3142">:</span> <span id="textcolor3143">'</span><span id="textcolor3144">turtle1</span><span id="textcolor3145">'</span><span id="textcolor3146">}</span> 
<a id="x3-46028r642"></a>         <span id="textcolor3147">]</span> 
<a id="x3-46030r643"></a>      <span id="textcolor3148">)</span><span id="textcolor3149">,</span></div></pre>
     </div>
     <a id="paragraph*.37">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-47000">
       </a>
       Adding Dependencies
      </span>
      Navigate one level back to the <span id="textcolor3150"><code class="verb">learning_tf2_py</code></span>
      directory, where the setup.py, setup.cfg, and package.xml files are
located.
     </p>
     <p class="noindent">
      Open package.xml with your text editor. Add the following dependencies corresponding to your launch files import
statements:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       xml
      </div>
      <pre><div class="language-xml" id="fancyvrb74" style="padding:20px;border-radius: 3px;"><a id="x3-47002r650"></a><span id="textcolor3151">&lt;exec_depend</span><span id="textcolor3152">&gt;</span>launch<span id="textcolor3153">&lt;/exec_depend&gt;</span> 
<a id="x3-47004r651"></a><span id="textcolor3154">&lt;exec_depend</span><span id="textcolor3155">&gt;</span>launch_ros<span id="textcolor3156">&lt;/exec_depend&gt;</span></div></pre>
     </div>
     <p class="noindent">
      This declares the additional required launch and <span id="textcolor3157"><code class="verb">launch_ros</code></span>
      dependencies when its code is executed.
     </p>
     <p class="noindent">
      Make sure to save the file.
      <a id="paragraph*.38">
      </a>
     </p>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-48000">
       </a>
       Updating Setup File
      </span>
      Reopen setup.py and add the line so that the launch files from the <span id="textcolor3158"><code class="verb">launch/</code></span>
      folder will be installed. The <span id="textcolor3159"><code class="verb">data_files</code></span>
      field should
now look like this:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb75" style="padding:20px;border-radius: 3px;"><a id="x3-48002r658"></a><span id="textcolor3160">data_files</span><span id="textcolor3161">=</span><span id="textcolor3162">[</span> 
<a id="x3-48004r659"></a>   <span id="textcolor3163">.</span><span id="textcolor3164">.</span><span id="textcolor3165">.</span> 
<a id="x3-48006r660"></a>   <span id="textcolor3166">(</span><span id="textcolor3167">os</span><span id="textcolor3168">.</span><span id="textcolor3169">path</span><span id="textcolor3170">.</span><span id="textcolor3171">join</span><span id="textcolor3172">(</span><span id="textcolor3173">'</span><span id="textcolor3174">share</span><span id="textcolor3175">'</span><span id="textcolor3176">,</span> <span id="textcolor3177">package_name</span><span id="textcolor3178">,</span> <span id="textcolor3179">'</span><span id="textcolor3180">launch</span><span id="textcolor3181">'</span><span id="textcolor3182">)</span><span id="textcolor3183">,</span> <span id="textcolor3184">glob</span><span id="textcolor3185">(</span><span id="textcolor3186">'</span><span id="textcolor3187">launch/*</span><span id="textcolor3188">'</span><span id="textcolor3189">)</span><span id="textcolor3190">)</span><span id="textcolor3191">,</span> 
<a id="x3-48008r661"></a><span id="textcolor3192">]</span><span id="textcolor3193">,</span></div></pre>
     </div>
     <p class="noindent">
      Also add the appropriate imports at the top of the file:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       python
      </div>
      <pre><div class="language-python" id="fancyvrb76" style="padding:20px;border-radius: 3px;"><a id="x3-48010r666"></a><span id="textcolor3194">import</span><span id="textcolor3195"> </span><span id="textcolor3196">os</span> 
<a id="x3-48012r667"></a><span id="textcolor3197">from</span><span id="textcolor3198"> </span><span id="textcolor3199">glob</span><span id="textcolor3200"> </span><span id="textcolor3201">import</span> <span id="textcolor3202">glob</span></div></pre>
     </div>
     <a id="paragraph*.39">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-49000">
       </a>
       Build
      </span>
      Run rosdep in the root of your workspace to check for missing dependencies.
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb77" style="padding:20px;border-radius: 3px;"><a id="x3-49002r674"></a>rosdep<span id="textcolor3203"> </span>install<span id="textcolor3204"> </span>-i<span id="textcolor3205"> </span>--from-path<span id="textcolor3206"> </span>src<span id="textcolor3207"> </span>--rosdistro<span id="textcolor3208"> </span>humble<span id="textcolor3209"> </span>-y</div></pre>
     </div>
     <p class="noindent">
      Still in the root of your workspace, build your package:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb78" style="padding:20px;border-radius: 3px;"><a id="x3-49004r679"></a>colcon<span id="textcolor3210"> </span>build<span id="textcolor3211"> </span>--packages-select<span id="textcolor3212"> </span>learning_tf2_py</div></pre>
     </div>
     <p class="noindent">
      Open a new terminal, navigate to the root of your workspace, and source the setup files:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb79" style="padding:20px;border-radius: 3px;"><a id="x3-49006r684"></a>.<span id="textcolor3213"> </span>install/setup.bash</div></pre>
     </div>
     <a id="paragraph*.40">
     </a>
     <p class="noindent">
      <span class="paragraphHead">
       <a id="x3-50000">
       </a>
       Run
      </span>
      Now run the launch file that will start the turtlesim simulation node and <span id="textcolor3214"><code class="verb">turtle_tf2_broadcaster</code></span>
      node:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb80" style="padding:20px;border-radius: 3px;"><a id="x3-50002r691"></a>ros2<span id="textcolor3215"> </span>launch<span id="textcolor3216"> </span>learning_tf2_py<span id="textcolor3217"> </span>turtle_tf2_demo.launch.py</div></pre>
     </div>
     <p class="noindent">
      In the second terminal window type the following command:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb81" style="padding:20px;border-radius: 3px;"><a id="x3-50004r696"></a>ros2<span id="textcolor3218"> </span>run<span id="textcolor3219"> </span>turtlesim<span id="textcolor3220"> </span>turtle_teleop_key</div></pre>
     </div>
     <p class="noindent">
      You will now see that the turtlesim simulation has started with one turtle that you can control. Now, use the <span id="textcolor3221"><code class="verb">tf2_echo</code></span>
      tool to
check if the turtle pose is actually getting broadcast to tf2:
     </p>
     <p class="noindent">
     </p>
     <div class="code-block">
      <div class="code-lang">
       bash
      </div>
      <pre><div class="language-bash" id="fancyvrb82" style="padding:20px;border-radius: 3px;"><a id="x3-50006r701"></a>ros2<span id="textcolor3222"> </span>run<span id="textcolor3223"> </span>tf2_ros<span id="textcolor3224"> </span>tf2_echo<span id="textcolor3225"> </span>world<span id="textcolor3226"> </span>turtle1</div></pre>
     </div>
     <p class="noindent">
      This should show you the pose of the first turtle. Drive around the turtle using the arrow keys (make sure your <span id="textcolor3227"><code class="verb">turtle_teleop_key</code></span>
      terminal window is active, not your simulator window). In your console output you will see something similar
to this:
     </p>
     <div class="tcolorbox tcolorbox" id="tcolobox-4">
      <div class="tcolorbox-content">
       <div class="code-block">
        <div class="code-lang">
         text
        </div>
        <pre><div class="language-text" id="fancyvrb83" style="padding:20px;border-radius: 3px;"><a id="x3-50008r1"></a>At time 1714913843.708748879 
<a id="x3-50010r2"></a>- Translation: [4.541, 3.889, 0.000] 
<a id="x3-50012r3"></a>- Rotation: in Quaternion [0.000, 0.000, 0.999, -0.035] 
<a id="x3-50014r4"></a>- Rotation: in RPY (radian) [0.000, -0.000, -3.072] 
<a id="x3-50016r5"></a>- Rotation: in RPY (degree) [0.000, -0.000, -176.013] 
<a id="x3-50018r6"></a>- Matrix: 
<a id="x3-50020r7"></a> -0.998  0.070  0.000  4.541 
<a id="x3-50022r8"></a> -0.070 -0.998  0.000  3.889 
<a id="x3-50024r9"></a>  0.000  0.000  1.000  0.000 
<a id="x3-50026r10"></a>  0.000  0.000  0.000  1.000</div></pre>
       </div>
      </div>
     </div>
     <p class="noindent">
      If you run <span id="textcolor3228"><code class="verb">tf2_echo</code></span>
      for the transform between the world and turtle2, you should not see a transform, because the second turtle is
not there yet. However, as soon as we add the second turtle in the next tutorial, the pose of turtle2 will be broadcast to tf2.
     </p>
    </div>
   </article>
   <footer>
    <div class="next">
     <p class="noindent">
      <a href="MobileRoboticsLectureBookli2.html" style="float: right;">
       Next Chapter →
      </a>
      <a href="index.html" style="float: left;">
       ← Previous Chapter
      </a>
      <a href="index.html">
       TOP
      </a>
     </p>
    </div>
   </footer>
  </div>
  <p class="noindent">
  </p>
  <p class="noindent">
   <a id="likesection.41">
   </a>
   <a id="x3-50027x">
   </a>
  </p>
  <p class="noindent">
   <a id="tailMobileRoboticsLectureBookch1.html">
   </a>
  </p>
 </body>
</html>
