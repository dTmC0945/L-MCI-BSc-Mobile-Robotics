<!DOCTYPE html> 
<html lang="en-US" xml:lang="en-US" > 
<head><title>10 Client Libraries</title> 
<meta  charset="utf-8" /> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<meta name="viewport" content="width=device-width,initial-scale=1" /> 
<link rel="stylesheet" type="text/css" href="MobileRoboticsLectureBook.css" /> 
<meta name="src" content="MobileRoboticsLectureBook.tex" /> 
 <script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/mml-chtml.js"></script>  
 <link rel="stylesheet" type="text/css" href="flatweb.css"> 
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script> 
 <script src="flatjs.js"></script> <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>  
<link href="https://unpkg.com/nord-highlightjs@0.1.0/dist/nord.css" rel="stylesheet" type="text/css" /> 
 <script src="https://unpkg.com/@highlightjs/cdn-assets@11.3.1/highlight.min.js"></script> 
 <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/dockerfile.min.js"> </script>  
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/cmake.min.js"> </script>  
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/cpp.min.js"> </script>  
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/makefile.min.js"> </script>  
<script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"> </script>  
<link rel="stylesheet" href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css"/>  
<script src="flatjs.js"> </script>  <header>  
</header> 
</head><body 
>
<!--l. 2--><div class="crosslinks"><p class="noindent"><a 
href="MobileRoboticsLectureBookch11.html" >NEXT</a><a 
href="MobileRoboticsLectureBookch9.html" >PREV</a><a 
href="index.html" >TOP</a></p></div>
<h2 class="chapterHead"><span class="titlemark">10</span>  <a 
 id="x12-23000010"></a>Client Libraries</h2>
<div class="chapterTOCS">
<span class="sectionToc" >10.1  <a 
href="#x12-23100010.1">Getting Started with Colcon</a></span>
<br /><span class="sectionToc" >10.2  <a 
href="#x12-23600010.2">Creating a Workspace</a></span>
<br /><span class="sectionToc" >10.3  <a 
href="#x12-24400010.3">Creating a Package</a></span>
<br /><span class="sectionToc" >10.4  <a 
href="#x12-24600010.4">Writing a Simple Publisher &#x0026; Subscriber</a></span>
<br /><span class="subsectionToc" >10.4.1  <a 
href="#x12-24800010.4.1">Writing the Publisher Node</a></span>
<br /><span class="subsectionToc" >10.4.2  <a 
href="#x12-25300010.4.2">Writing the Subscriber Node</a></span>
<br /><span class="subsectionToc" >10.4.3  <a 
href="#x12-25600010.4.3">Building and Running</a></span>
<br /><span class="sectionToc" >10.5  <a 
href="#x12-25700010.5">Writing a Simple Service and Client</a></span>
<br /><span class="subsectionToc" >10.5.1  <a 
href="#x12-26100010.5.1">Writing the Service Node</a></span>
<br /><span class="subsectionToc" >10.5.2  <a 
href="#x12-26400010.5.2">Writing the Client Node</a></span>
<br /><span class="sectionToc" >10.6  <a 
href="#x12-26700010.6">Creating Custom msg and srv Files</a></span>
<br /><span class="subsectionToc" >10.6.1  <a 
href="#x12-26900010.6.1">Creating Custom Definitions</a></span>
<br /><span class="subsectionToc" >10.6.2  <a 
href="#x12-27600010.6.2">Testing the Newly Built Interfaces</a></span>
<br /><span class="sectionToc" >10.7  <a 
href="#x12-28200010.7">Using Parameters in a Class</a></span>
<br /><span class="sectionToc" >10.8  <a 
href="#x12-29200010.8">Managing Dependencies</a></span>
<br /><span class="subsectionToc" >10.8.1  <a 
href="#x12-29300010.8.1">Explaining Rosdep</a></span>
<br /><span class="subsectionToc" >10.8.2  <a 
href="#x12-29400010.8.2">Explaining Pacakge Manifesto</a></span>
<br /><span class="sectionToc" >10.9  <a 
href="#x12-29500010.9">Creating an Action</a></span>
<br /><span class="sectionToc" >10.10  <a 
href="#x12-29800010.10">Writing an Action Server and Client</a></span>
<br /><span class="sectionToc" >10.11  <a 
href="#x12-30000010.11">Writing a Launch File</a></span>
</div>
<div class="page"><article class="chapter">

<h3 class="sectionHead"><span class="titlemark">10.1</span>  <a 
 id="x12-23100010.1"></a>Getting Started with Colcon</h3>
<!--l. 10--><p class="noindent" >Now we have learned previously all the essential concepts required for us to get a good introduction to
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a> and now we can begin to go deeper into understanding how packages are written and how all
previously defined concepts and ideas can be implemented in code. In this light, let us start with
looking at the compiler for <a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>: <span id="textcolor3018"><code class="verb">colcon</code></span>
</p><!--l. 15--><p class="noindent" >     
</p>
<blockquote class="quote">     
<!--l. 16--><p class="noindent" >a meta build tool to improve the workflow of building, testing and using multiple
software packages [<a 
 id="x12-231001"></a><a 
href="MobileRoboticsLectureBookad1.html#Debianpackageros2025">90</a>].</p></blockquote>
<!--l. 20--><p class="noindent" >The first thing to define is <span id="textcolor3019"><code class="verb">colcon</code></span> is an iteration on the <a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a> build tools:
</p>     
<blockquote class="quote">
                                                                                
                                                                                
     
<!--l. 23--><p class="noindent" ><span id="textcolor3020"><code class="verb">catkin_make</code></span>, <span id="textcolor3021"><code class="verb">catkin_make_isolated</code></span>, <span id="textcolor3022"><code class="verb">catkin_tools</code></span> and <span id="textcolor3023"><code class="verb">ament_tools</code></span>.</p></blockquote>         
<!--l. 27--><p class="noindent" >We
begin
by
installing
colcon:<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">1 </sup></span></alert>
<span class="marginnote">                                                                             
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">1</sup></span></alert><span id="textcolor3024">Of
course,
if
we
have
installed
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
with
a
Dockerfile
and
followed
the
lecture
material,
we
don’t
have
to
do
this
step.
However,
this
step
is
nevertheless
here
in
case
the
document
is
followed
non-linearly.</span></span>
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                            
<pre><div id="fancyvrb232" style='padding:20px;border-radius: 3px;'><a 
 id="x12-231003r67"></a>sudo<span id="textcolor3025"> </span>apt<span id="textcolor3026"> </span>install<span id="textcolor3027"> </span>python3-colcon-common-extensions</div></pre>
<div class="tcolorbox tcolorbox" id="tcolobox-96">                                                                                

                                                                                

 
<div class="tcolorbox-content"><pre><div id="fancyvrb233" style='padding:20px;border-radius: 3px;'><a 
 id="x12-231005r1"></a>Reading package lists... 0% 
<a 
 id="x12-231007r2"></a>Reading package lists... 0% 
<a 
 id="x12-231009r3"></a>Reading package lists... 7% 
<a 
 id="x12-231011r4"></a>Reading package lists... Done 
<a 
 id="x12-231013r5"></a>Building dependency tree... 0% 
<a 
 id="x12-231015r6"></a>Building dependency tree... 0% 
<a 
 id="x12-231017r7"></a>Building dependency tree... 50% 
<a 
 id="x12-231019r8"></a>Building dependency tree... 50% 
<a 
 id="x12-231021r9"></a>Building dependency tree... Done 
<a 
 id="x12-231023r10"></a>Reading state information... 0% 
<a 
 id="x12-231025r11"></a>Reading state information... 0% 
<a 
 id="x12-231027r12"></a>Reading state information... Done 
<a 
 id="x12-231029r13"></a>python3-colcon-common-extensions is already the newest version (0.3.0-100). 
<a 
 id="x12-231031r14"></a>0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.</div></pre>
 
</div> 
</div>                                                                          

<a 
 id="paragraph*.91"></a>                                                                             
<!--l. 35--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-232000"></a>The
Structure
of
a
Package</span>
A
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
workspace
is
                                                                                
                                                                                
a
directory
with
a
<alert style="color: #821131;">particular
structure</alert>.
Commonly
there
is
a
<span id="textcolor3028"><code class="verb">src</code></span>
subdirectory.<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">2 </sup></span></alert>
<span class="marginnote">
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">2</sup></span></alert><span id="textcolor3029">This
kind
of
directory
usually
exists
for
development
of
applications
such
as
C
or
C++.</span></span>
Within
this
subdirectory
is
where
the
source
code
(<span id="textcolor3030"><code class="verb">src</code></span>
)
of
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
packages
will
be
located.
</p>
<div class="knowledge">
<!--l. 44--><p class="noindent" >When  this  directory  is  created,  it  will  be  empty.  </p></div>
<!--l. 46--><p class="noindent" >The primary job of <span id="textcolor3031"><code class="verb">colcon</code></span> is to create the structure for, compile and build these source files.
By default it will create the following directories as same hierarchy of the <span id="textcolor3032"><code class="verb">src</code></span>  directory:
</p>     
<dl class="description"><dt class="description">
build 
</dt><dd 
class="description">                                                                            
<!--l. 51--><p class="noindent" >
Where
intermediate
files
are
stored.
For
each
package
a
subfolder
will
be
created
                                                                                
                                                                                
                                                                              
in
which
e.g.,
CMake<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">3 </sup></span></alert>
<span class="marginnote">                                                                              
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">3</sup></span></alert><span id="textcolor3033">a
free,
cross-platform,
software
development
tool
for
building
applications
via
compiler-independent
instructions
and
allows
automate
testing,
packaging
and
installation.
It
runs
on
a
variety
of
platforms
and
supports
many
programming
languages.</span></span>
is
being
invoked.
</p>                                                                                
</dd>
<dt class="description">
install 
</dt><dd 
class="description">
<!--l. 56--><p class="noindent" >                                                                           
Where
each
package
will
be
installed
to.
By
default
each
package
will
be
installed
into
a
separate
subdirectory.
</p>                                                                                
</dd>
<dt class="description">
log 
</dt><dd 
class="description">
<!--l. 58--><p class="noindent" >
                                                                                
                                                                                
                                                                          
Contains
various
logging
information
about
each
<span id="textcolor3034"><code class="verb">colcon</code></span>
invocation,
for
use
in
error-checking
and
debugging
purposes.</p></dd></dl>
<div class="warning">
<!--l. 65--><p class="noindent" >For any student who worked with ROS 1 and <span id="textcolor3035"><code class="verb">catkin</code></span>, there is no <span id="textcolor3036"><code class="verb">devel</code></span>  directory. </p></div>
<!--l. 67--><p class="noindent" >To
get
started
we
first
create
a
directory
(<span id="textcolor3037"><code class="verb">ros2\_ws</code></span>
)
to
contain
our
workspace:<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">4 </sup></span></alert>
<span class="marginnote">
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">4</sup></span></alert><span id="textcolor3038">The
name
of
the
directory
is
up
to
the
user.</span></span>
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb234" style='padding:20px;border-radius: 3px;'><a 
 id="x12-232002r90"></a>mkdir<span id="textcolor3039"> </span>-p<span id="textcolor3040"> </span>~/ros2_ws/src 
<a 
 id="x12-232004r91"></a><span id="textcolor3041">cd</span><span id="textcolor3042"> </span>~/ros2_ws</div></pre>
<!--l. 72--><p class="noindent" >At
this
moment
if
we
were
to
<span id="textcolor3043"><code class="verb">ls</code></span>
into
our
directory
we
will
only
see
one
(<alert style="color: #821131;">1</alert>) folder
which
is
<span id="textcolor3044"><code class="verb">src</code></span>,
which
is
to
be
expected
as
it
is
created
just
a
second
ago.
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb235" style='padding:20px;border-radius: 3px;'><a 
 id="x12-232006r97"></a>ls</div></pre>
<div class="tcolorbox tcolorbox" id="tcolobox-97">



 
<div class="tcolorbox-content"><pre><div id="fancyvrb236" style='padding:20px;border-radius: 3px;'><a 
 id="x12-232008r1"></a>src</div></pre>
 
</div> 
</div>
<!--l. 79--><p class="noindent" >Now
let’s
populate
our
newly
created
environment
with
some
tutorial
files
from
the
official
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
repo:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb237" style='padding:20px;border-radius: 3px;'><a 
 id="x12-232010r107"></a>git<span id="textcolor3045"> </span>clone<span id="textcolor3046"> </span>https://github.com/ros2/examples<span id="textcolor3047"> </span>src/examples<span id="textcolor3048"> </span>-b<span id="textcolor3049"> </span>humble</div></pre>
<div class="tcolorbox tcolorbox" id="tcolobox-98">



 
<div class="tcolorbox-content"><pre><div id="fancyvrb238" style='padding:20px;border-radius: 3px;'><a 
 id="x12-232012r1"></a>Cloning into &#x0027;src/examples&#x0027;... 
<a 
 id="x12-232014r2"></a>remote: Enumerating objects: 9987, done. 
<a 
 id="x12-232016r3"></a>remote: Counting objects: 100% (2546/2546), done. 
<a 
 id="x12-232018r4"></a>remote: Compressing objects: 100% (358/358), done. 
<a 
 id="x12-232020r5"></a>remote: Total 9987 (delta 2376), reused 2195 (delta 2188), pack-reused 7441 (from 3) 
<a 
 id="x12-232022r6"></a>Receiving objects: 100% (9987/9987), 1.56 MiB | 4.28 MiB/s, done. 
<a 
 id="x12-232024r7"></a>Resolving deltas: 100% (7250/7250), done.</div></pre>
 
</div> 
</div>

<a 
 id="paragraph*.92"></a>
<!--l. 86--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-233000"></a>Sourcing  an  Underlay</span>                                                               
It
is
important
that
we’ve
sourced
the
environment
for
an
existing
                                                                                
                                                                                
                                                                             
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
installation
which
will
provide
our
workspace
with
the
necessary
build
dependencies
for
the
example
packages.
This
is
achieved
by
sourcing
the
setup
script
provided
by
a
binary
installation
or
a
source
installation.<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">5 </sup></span></alert>
<span class="marginnote">                                                                             
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">5</sup></span></alert><span id="textcolor3050">i.e.
another,
colcon
workspace.</span></span>
</p>     
<blockquote class="quote">
<!--l. 94--><p class="noindent" >We
call
this
environment
an
<span id="bold" style="font-weight:bold;">underlay</span>.</p></blockquote>                                                                 
<!--l. 97--><p class="noindent" >Our
workspace,
<span id="textcolor3051"><code class="verb">ros2\_ws</code></span>
,
will
be
an
<span id="bold" style="font-weight:bold;">overlay</span>
on
top
of
the
existing
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
installation.
</p>                                                                                
<div class="knowledge">
                                                                                
                                                                                
                                                                              
<!--l. 103--><p class="noindent" >In
general,
it
is
recommended
to
use
an
overlay
when
we
plan
to
iterate
on
a
small
number
of
packages,
rather
than
putting
all
of
our
packages
into
the
same
workspace.
</p>                                                                                
</div>
                                                                                
<a 
 id="paragraph*.93"></a>
<!--l. 105--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-234000"></a>Building
the
Workspace</span>
In
the
root
of
the
workspace,
run
<span id="textcolor3052"><code class="verb">colcon build</code></span>.
Since
build
types
such
as
<span id="textcolor3053"><code class="verb">ament_cmake</code></span>
do
<span id="bold" style="font-weight:bold;">NOT</span>
 support
the
concept
of
the
devel
space
and
require
the
package
                                                                                
                                                                                
                                                                              
to
be
installed,
colcon
supports
the
option
<span id="textcolor3054"><code class="verb">--symlink-install</code></span>.
This
allows
the
installed
files
to
be
changed
by
changing
the
files
in
the
source
space<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">6 </sup></span></alert>
<span class="marginnote">                                                                            
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">6</sup></span></alert><span id="textcolor3055">e.g.,
Python
files
or
other
non-compiled
resources</span></span>
for
faster
iteration.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                          
<pre><div id="fancyvrb239" style='padding:20px;border-radius: 3px;'><a 
 id="x12-234002r123"></a>colcon<span id="textcolor3056"> </span>build<span id="textcolor3057"> </span>--symlink-install<span id="textcolor3058"> </span>--executor<span id="textcolor3059"> </span>sequential</div></pre>
<div class="warning">                                                                             
<!--l. 121--><p class="noindent" >The
way
we
are
currently
building
is
<span id="bold" style="font-weight:bold;">NOT</span>
 the
official
way
as
we
had
to
add
<span id="textcolor3060"><code class="verb">--executor sequential</code></span>
option.
We
are
adding
this
as
by
default,
the
                                                                                
                                                                                
                                                                            
colcon
processes/compiles
packages
parallel
to
speed
up
the
compilation
time.
If
we
were
to
have
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
installed
on
native
hardware
rather
than
a
docker
container
we
may
not
have
needed
this
additional
option.
</p>                                                                                
</div>
<!--l. 123--><p class="noindent" >After
the
build
is
finished,
we
should
see
the
<span id="textcolor3061"><code class="verb">build</code></span>
,
<span id="textcolor3062"><code class="verb">install</code></span>
,
and
<span id="textcolor3063"><code class="verb">log</code></span>
directories:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                                            
<pre><div id="fancyvrb240" style='padding:20px;border-radius: 3px;'><a 
 id="x12-234004r128"></a>ls<span id="textcolor3064"> </span>-l</div></pre>
<div class="tcolorbox tcolorbox" id="tcolobox-99">                                                                                

                                                                                

 
<div class="tcolorbox-content"><pre><div id="fancyvrb241" style='padding:20px;border-radius: 3px;'><a 
 id="x12-234006r1"></a>drwxr-xr-x 24 ubuntu ubuntu 4096 Jun  6 13:58 build 
<a 
 id="x12-234008r2"></a>drwxr-xr-x 24 ubuntu ubuntu 4096 Jun  6 13:58 install 
<a 
 id="x12-234010r3"></a>drwxr-xr-x  4 ubuntu ubuntu 4096 Jun  6 13:57 log 
<a 
 id="x12-234012r4"></a>drwxr-xr-x  3 ubuntu ubuntu 4096 Jun  6 13:54 src</div></pre>
 
</div> 
</div>                                                                          
<div class="knowledge">
<!--l. 131--><p class="noindent" >To
run
test
on
                                                                                
                                                                                
                                                                             
built
packages
we
can
run
<span id="textcolor3065"><code class="verb">colcon test</code></span>
</p>                                                                                
</div>
                                                                                
<a 
 id="paragraph*.94"></a>
<!--l. 133--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-235000"></a>Sourcing
the
New
Package</span>
When
<span id="textcolor3066"><code class="verb">colcon</code></span>
has
completed
building
successfully,
the
output
will
be
in
the
install
directory.
Before
we
can
use
any
of
the
installed
executables
or
libraries,
we
will
have
to
add
them
to
our
path
and
library
paths.
<span id="textcolor3067"><code class="verb">colcon</code></span>
will
have
generated
bash
files
in
the
install
directory
to
help
set
up
the
                                                                                
                                                                                
                                                                       
environment.
These
files
will
add
all
of
the
required
elements
to
our
path
and
library
paths
as
well
as
provide
any
bash
or
shell
commands
exported
by
packages.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                              
<pre><div id="fancyvrb242" style='padding:20px;border-radius: 3px;'><a 
 id="x12-235002r141"></a><span id="textcolor3068">source</span><span id="textcolor3069"> </span>install/setup.bash</div></pre>
<!--l. 144--><p class="noindent" >It
is
time
to
test
out
what
we
have
built.
Let’s
open
up
a
new
terminal
window
side
by
side
and
run
the
following
two
(<alert style="color: #821131;">2</alert>) commands:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                             
<pre><div id="fancyvrb243" style='padding:20px;border-radius: 3px;'><a 
 id="x12-235004r146"></a>ros2<span id="textcolor3070"> </span>run<span id="textcolor3071"> </span>examples_rclcpp_minimal_subscriber<span id="textcolor3072"> </span>subscriber_member_function</div></pre>
<!--l. 1--><p class="noindent" >

</p>                               
<pre><div id="fancyvrb244" style='padding:20px;border-radius: 3px;'><a 
 id="x12-235006r151"></a>ros2<span id="textcolor3073"> </span>run<span id="textcolor3074"> </span>examples_rclcpp_minimal_publisher<span id="textcolor3075"> </span>publisher_member_function</div></pre>
                                                                                
                                                                                
                                                                               
<!--l. 150--><p class="noindent" >If
everything
has
worked
well,
we
should
see
messages
from
the
publisher
and
subscriber
with
numbers
incrementing.
</p>                                                                                
<div class="tcolorbox tcolorbox" id="tcolobox-100">
                                                                                

                                                                                
 
<div class="tcolorbox-title">
<!--l. 164--><p class="noindent" ><span id="bold" style="font-weight:bold;">Information</span>:
Overlay
v.
Underlay</p></div> 
<div class="tcolorbox-content"><!--l. 164--><p class="noindent" >As a final clarification on these two (<alert style="color: #821131;">2</alert>) concepts, let’s look at them in a bit more detail: </p> 
<ul class="itemize1">
<li class="itemize">
<!--l. 164--><p class="noindent" >An <span id="bold" style="font-weight:bold;">underlay</span> is the core <a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a> installation that provides the foundational packages and environment for 
your <a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a> development. In our case it is Humble. 
</p>
</li>
<li class="itemize">
<!--l. 164--><p class="noindent" >An <span id="bold" style="font-weight:bold;">overlay</span> is the secondary workspace where we can add new packages without interfering with the 
existing ROS 2 workspace that we’re extending.</p></li></ul>
 
</div> 
</div>
                                                                                
                                                                                
                                                                                
<!--l. 166--><p class="noindent" >
</p>                                                                      
<h3 class="sectionHead"><span class="titlemark">10.2</span>  <a 
 id="x12-23600010.2"></a>Creating
a
Workspace</h3>
<!--l. 168--><p class="noindent" >A
workspace
is
a
directory
containing
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
packages.
Before
using
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>,
it’s
necessary
to
source
our
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
installation
workspace
in
the
terminal
we
plan
to
work
in.
This
makes
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>’s
packages
available
for
you
to
use
in
that
terminal.
</p>                                                                              
<!--l. 172--><p class="noindent" >We
also
have
the
option
of
sourcing
an
“overlay”,
which
is
a
secondary
workspace
where
we
can
add
                                                                                
                                                                                
                                                                             
new
packages
without
interfering
with
the
existing
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
workspace
that
we’re
extending,
or
“underlay”.
</p>                                                                                
<div class="warning">
<!--l. 178--><p class="noindent" >Our
underlay
must
contain
the
dependencies
of
all
the
packages
in
our
overlay.
</p>                                                                                
</div>
<!--l. 180--><p class="noindent" >Packages
in
our
overlay
will
override
packages
in
the
underlay.
</p>                                                                                
<div class="knowledge">
<!--l. 185--><p class="noindent" >It’s
also
possible
to
have
several
layers
of
underlays
and
overlays,
with
each
successive
overlay
using
the
packages
of
its
parent
underlays.
</p>                                                                                
</div>
                                                                                
                                                                                
                                                                                

<a 
 id="paragraph*.95"></a>                                                                          
<!--l. 187--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-237000"></a>Sourcing
the
Environment</span>
Our
main
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
installation
will
be
our
underlay
for
this
section.<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">7 </sup></span></alert>
<span class="marginnote">
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">7</sup></span></alert><span id="textcolor3078">Keep
in
mind
that
an
underlay
does
<span id="bold" style="font-weight:bold;">NOT</span>
 necessarily
have
to
be
the
main
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
installation.</span></span>
</p><!--l. 192--><p class="noindent" >Depending
on
how
we
installed
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>,
either
from
source
or
binaries,
and
which
platform
we’re
on,
our
exact
source
command
will
vary:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb245" style='padding:20px;border-radius: 3px;'><a 
 id="x12-237002r1486"></a><span id="textcolor3079">source</span><span id="textcolor3080"> </span>/opt/ros/humble/setup.bash</div></pre>

<a 
 id="paragraph*.96"></a>
<!--l. 197--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-238000"></a>Creating  a  New  Directory</span>
Best practice is to create a <alert style="color: #821131;">new directory for every new workspace</alert>. The name doesn’t matter, but it is helpful to have it
indicate the purpose of the workspace. Let’s choose the directory name <span id="textcolor3081"><code class="verb">ros2\_ws</code></span> , for “development workspace”:
                                                                                
                                                                                
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb246" style='padding:20px;border-radius: 3px;'><a 
 id="x12-238002r1491"></a>mkdir<span id="textcolor3082"> </span>-p<span id="textcolor3083"> </span>~/ros2_ws/src 
<a 
 id="x12-238004r1492"></a><span id="textcolor3084">cd</span><span id="textcolor3085"> </span>~/ros2_ws/src</div></pre>
<!--l. 205--><p class="noindent" >Another best practice is to put any packages in our workspace into the <span id="textcolor3086"><code class="verb">src</code></span>  directory.
The above code creates a <span id="textcolor3087"><code class="verb">src</code></span>  directory inside <span id="textcolor3088"><code class="verb">ros2\_ws</code></span>  and then navigates into it.

<a 
 id="paragraph*.97"></a></p>
<!--l. 209--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-239000"></a>Cloning  a  Sample  Repo</span>
Ensure we’re still in the <span id="textcolor3089"><code class="verb">ros2_ws/src</code></span> directory before we clone.
</p><!--l. 213--><p class="noindent" >In the following sections, we will create our own packages, but for now we will practice putting a workspace
together using existing packages. A repo can have multiple branches. We need to check out the one that
targets our installed <a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a> distro. When we clone this repo, add the <span id="textcolor3090"><code class="verb">-b</code></span> argument followed by that branch.
</p><!--l. 218--><p class="noindent" >In the <span id="textcolor3091"><code class="verb">ros2\_ws/src</code></span>  directory, run the following command:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb247" style='padding:20px;border-radius: 3px;'><a 
 id="x12-239002r1497"></a>git<span id="textcolor3092"> </span>clone<span id="textcolor3093"> </span>https://github.com/ros/ros_tutorials.git<span id="textcolor3094"> </span>-b<span id="textcolor3095"> </span>humble</div></pre>
<!--l. 222--><p class="noindent" >Now <span id="textcolor3096"><code class="verb">ros_tutorials</code></span> is cloned in our workspace. The <span id="textcolor3097"><code class="verb">ros_tutorials</code></span> repository contains the turtlesim package, which we’ll use
in this section. The other packages in this repository are not built because they contain a <span id="textcolor3098"><code class="verb">COLCON_IGNORE</code></span> file.
</p><!--l. 226--><p class="noindent" >So far we have populated our workspace with a sample package, but it isn’t a fully-functional
workspace yet as we need to resolve the dependencies first and then build the workspace.

<a 
 id="paragraph*.98"></a></p>
<!--l. 229--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-240000"></a>Resolving  Dependencies</span>
Before building the workspace, we need to resolve the package dependencies. It is possible we may
have all the dependencies already, but best practice is to check for dependencies every time we clone.
We wouldn’t want a build to fail after a long wait only to realize that we have missing dependencies.
</p><!--l. 236--><p class="noindent" >From the root of our workspace (<span id="textcolor3099"><code class="verb">ros2\_ws</code></span> ), run the following command:
</p>
<div class="warning">
<!--l. 241--><p class="noindent" >If we’re still in the <span id="textcolor3100"><code class="verb">src</code></span> directory with the <span id="textcolor3101"><code class="verb">ros_tutorials</code></span> clone, make sure to run <span id="textcolor3102"><code class="verb">cd ..</code></span> to move back up to the workspace (<span id="textcolor3103"><code class="verb">ros2\_ws</code></span> ). </p></div>
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb248" style='padding:20px;border-radius: 3px;'><a 
 id="x12-240002r1502"></a><span id="textcolor3104">cd</span><span id="textcolor3105"> </span>.. 
<a 
 id="x12-240004r1503"></a>rosdep<span id="textcolor3106"> </span>install<span id="textcolor3107"> </span>-i<span id="textcolor3108"> </span>--from-path<span id="textcolor3109"> </span>src<span id="textcolor3110"> </span>--rosdistro<span id="textcolor3111"> </span>humble<span id="textcolor3112"> </span>-y</div></pre>
<!--l. 245--><p class="noindent" >If we already have all our dependencies, the console will return:
</p>
<div class="tcolorbox tcolorbox" id="tcolobox-101">     
<div class="tcolorbox-content">
<pre><div id="fancyvrb249" style='padding:20px;border-radius: 3px;'><a 
 id="x12-240006r1"></a>#All required rosdeps installed successfully</div></pre>
 
</div> 
</div>                                                                        
<!--l. 249--><p class="noindent" >Packages
declare
their
dependencies
in
the
<span id="textcolor3113"><code class="verb">package.xml</code></span>
file.<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">8 </sup></span></alert>
<span class="marginnote">                                                                             
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">8</sup></span></alert><span id="textcolor3114">We
will
learn
more
about
packages
in
the
following
section.</span></span>
This
command
walks
                                                                                
                                                                                
                                                                          
through
those
declarations
and
installs
the
ones
that
are
missing.
                                                                                
<a 
 id="paragraph*.99"></a></p>
<!--l. 253--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-241000"></a>Building
the
Workspace</span>
From
the
root
of
our
workspace
(<span id="textcolor3115"><code class="verb">ros2\_ws</code></span>
),
we
can
now
build
our
packages
using
the
command:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                                       
<pre><div id="fancyvrb250" style='padding:20px;border-radius: 3px;'><a 
 id="x12-241002r1513"></a>colcon<span id="textcolor3116"> </span>build</div></pre>
<div class="tcolorbox tcolorbox" id="tcolobox-102">                                                                                

                                                                                

 
<div class="tcolorbox-content"><pre><div id="fancyvrb251" style='padding:20px;border-radius: 3px;'><a 
 id="x12-241004r1"></a>Starting »&gt; turtlesim 
<a 
 id="x12-241006r2"></a>Finished «&lt; turtlesim [5.49s] 
<a 
 id="x12-241008r3"></a> 
<a 
 id="x12-241010r4"></a>Summary: 1 package finished [5.58s]</div></pre>
 
</div> 
</div>                                                                      
<!--l. 262--><p class="noindent" >There
are
some
useful
arguments
for
<span id="textcolor3117"><code class="verb">colcon build</code></span>
which
are
as
follows:
</p>     
<dl class="description"><dt class="description">
<span id="textcolor3118"><code class="verb">--packages-up-to</code></span> 
</dt><dd 
class="description">
<!--l. 265--><p class="noindent" >     
builds
the
package
we
want,
plus
                                                                                
                                                                                
     
all
its
dependencies,
but
not
the
whole
workspace
(saves
time)
</p>     
</dd>
<dt class="description">
<span id="textcolor3119"><code class="verb">--symlink-install</code></span> 
</dt><dd 
class="description">
<!--l. 267--><p class="noindent" >     
saves
us
from
having
to
rebuild
every
time
we
tweak
python
scripts
</p>     
</dd>
<dt class="description">
<span id="textcolor3120"><code class="verb">--event-handlers console_direct+</code></span> 
</dt><dd 
class="description">
<!--l. 269--><p class="noindent" >     
shows
console
output
while
building
(can
otherwise
be
found
in
the
log
directory)
</p>     
</dd>
<dt class="description">
<span id="textcolor3121"><code class="verb">--executor sequential</code></span> 
</dt><dd 
class="description">
<!--l. 271--><p class="noindent" >     
processes
the
packages
one
by
one
instead
of
using
parallelism</p></dd></dl>                                                                
<!--l. 275--><p class="noindent" >Once
the
build
is
finished,
enter
                                                                                
                                                                                
                                                                              
the
command
in
the
workspace
root
(<span id="textcolor3122"><code class="verb">~/ros2_ws</code></span>).
We
will
see
that
colcon
has
created
new
directories:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                                              
<pre><div id="fancyvrb252" style='padding:20px;border-radius: 3px;'><a 
 id="x12-241012r1526"></a>ls</div></pre>
<div class="tcolorbox tcolorbox" id="tcolobox-103">                                                                                

                                                                                

 
<div class="tcolorbox-content"><pre><div id="fancyvrb253" style='padding:20px;border-radius: 3px;'><a 
 id="x12-241014r1"></a>build  install  log  src</div></pre>
 
</div> 
</div>                                                                        
<!--l. 281--><p class="noindent" >The
install
directory
is
where
our
workspace’s
setup
files
are,
which
we
can
use
to
source
our
overlay.
                                                                                
<a 
 id="paragraph*.100"></a></p>
<!--l. 284--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-242000"></a>Sourcing
our
Overlay</span>
Before
sourcing
the
overlay,
it
is
very
important
that
we
open
a
new
terminal,
separate
                                                                                
                                                                                
                                                                             
from
the
one
where
we
built
the
workspace.
Sourcing
an
overlay
in
the
same
terminal
where
we
built,
or
likewise
building
where
an
overlay
is
sourced,
may
create
complex
issues.
</p>                                                                              
<!--l. 290--><p class="noindent" >In
the
new
terminal,
source
our
main
ROS
2
environment
as
the
“underlay”,
so
we
can
build
the
overlay
“on
top
of”
it:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                        
<pre><div id="fancyvrb254" style='padding:20px;border-radius: 3px;'><a 
 id="x12-242002r1536"></a><span id="textcolor3123">source</span><span id="textcolor3124"> </span>/opt/ros/humble/setup.bash</div></pre>
<!--l. 295--><p class="noindent" >Time
to
go
into
the
root
of
our
workspace:
</p>                                                                                
<!--l. 1--><p class="noindent" >
                                                                                
                                                                                

</p>                                                                       
<pre><div id="fancyvrb255" style='padding:20px;border-radius: 3px;'><a 
 id="x12-242004r1541"></a><span id="textcolor3125">cd</span><span id="textcolor3126"> </span>~/ros2_ws</div></pre>
<!--l. 299--><p class="noindent" >In
the
root,
source
our
overlay:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                         
<pre><div id="fancyvrb256" style='padding:20px;border-radius: 3px;'><a 
 id="x12-242006r1546"></a><span id="textcolor3127">source</span><span id="textcolor3128"> </span>install/local_setup.bash</div></pre>
<div class="warning">                                                                          
<!--l. 310--><p class="noindent" >Sourcing
the
<span id="textcolor3129"><code class="verb">local_setup</code></span>
of
the
overlay
will
only
add
the
packages
available
in
the
overlay
to
our
environment.
<span id="textcolor3130"><code class="verb">setup</code></span>
sources
the
overlay
as
well
as
the
underlay
it
was
created
in,
allowing
us
to
utilise
both
workspaces.
So,
sourcing
our
main
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
installation’s
setup
and
then
the
<span id="textcolor3131"><code class="verb">ros2\_ws</code></span>
overlay’s
<span id="textcolor3132"><code class="verb">local_setup</code></span>,
like
we
                                                                                
                                                                                
                                                                             
just
did,
is
the
same
as
just
sourcing
<span id="textcolor3133"><code class="verb">ros2\_ws</code></span>
’s
setup,
because
that
includes
the
environment
of
its
underlay.
</p>                                                                                
</div>
<!--l. 312--><p class="noindent" >Now
we
can
run
the
<span id="textcolor3134"><code class="verb">turtlesim</code></span>
package
from
the
overlay:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                        
<pre><div id="fancyvrb257" style='padding:20px;border-radius: 3px;'><a 
 id="x12-242008r1551"></a>ros2<span id="textcolor3135"> </span>run<span id="textcolor3136"> </span>turtlesim<span id="textcolor3137"> </span>turtlesim_node</div></pre>
<!--l. 316--><p class="noindent" >     
</p>
<blockquote class="quote">     
<!--l. 317--><p class="noindent" >But
how
can
you
tell
that
this
is
the
overlay
turtlesim
running,
and
not
your
main
installation’s
turtlesim?</p></blockquote>                                                                 
<!--l. 321--><p class="noindent" >Let’s
modify
turtlesim
in
the
overlay
so
you
                                                                                
                                                                                
                                                                             
can
see
the
effects:
</p>     
<ul class="itemize1">
<li class="itemize">     
<!--l. 324--><p class="noindent" >We
can
modify
and
rebuild
packages
in
the
overlay
separately
from
the
underlay.
</p>     
</li>
<li class="itemize">     
<!--l. 325--><p class="noindent" >The
overlay
takes
precedence
over
the
underlay.</p></li></ul>                                                                     

<a 
 id="paragraph*.101"></a>                                                                         
<!--l. 328--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-243000"></a>Modifying
the
Overlay</span>
You
can
modify
turtlesim
in
your
overlay
by
editing
the
<alert style="color: #821131;">title
bar</alert>
on
the
turtlesim
window.
To
do
this,
locate
the
<span id="textcolor3140"><code class="verb">turtle\_frame.cpp</code></span>
file
in
<span id="textcolor3141"><code class="verb">[</code></span>
                                                                                
                                                                                
                                                 
/] /ros2_ws/src/ros_tutorials/turtlesim/src.
Open
<span id="textcolor3142"><code class="verb">turtle\_frame.cpp</code></span>
with
your
preferred
text
editor.
</p>                                                                             
<!--l. 335--><p class="noindent" >Find
the
function
<span id="textcolor3143"><code class="verb">setWindowTitle("TurtleSim");</code></span>,
change
the
value
&#x0022;<span id="textcolor3144"><code class="verb">TurtleSim</code></span>&#x0022;
to
&#x0022;<span id="textcolor3145"><code class="verb">MyTurtleSim</code></span>&#x0022;,
and
save
the
file.
</p>                                                                           
<!--l. 338--><p class="noindent" >Return
to
the
first
terminal
where
you
ran
colcon
build
earlier
and
run
it
again.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                        
<pre><div id="fancyvrb258" style='padding:20px;border-radius: 3px;'><a 
 id="x12-243002r1551"></a>ros2<span id="textcolor3146"> </span>run<span id="textcolor3147"> </span>turtlesim<span id="textcolor3148"> </span>turtlesim_node</div></pre>
<!--l. 342--><p class="noindent" >Return
to
the
second
terminal
(where
the
overlay
is
sourced)
and
run
turtlesim
again:
</p>                                                                            
<!--l. 344--><p class="noindent" >Even
though
your
main
ROS
2
environment
was
sourced
in
this
terminal
                                                                                
                                                                                
                                                                           
earlier,
the
overlay
of
your
<span id="textcolor3149"><code class="verb">ros2\_ws</code></span>
environment
takes
precedence
over
the
contents
of
the
underlay.
</p>                                                                              
<!--l. 347--><p class="noindent" >To
see
that
your
underlay
is
still
intact,
open
a
brand
new
terminal
and
source
only
your
ROS
2
installation.
Run
turtlesim
again:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                        
<pre><div id="fancyvrb259" style='padding:20px;border-radius: 3px;'><a 
 id="x12-243004r1551"></a>ros2<span id="textcolor3150"> </span>run<span id="textcolor3151"> </span>turtlesim<span id="textcolor3152"> </span>turtlesim_node</div></pre>
<!--l. 352--><p class="noindent" >You
can
see
that
modifications
in
the
overlay
did
not
actually
affect
anything
in
the
underlay.
                                                                                
                                                                                
                                                                                
</p>
<!--l. 354--><p class="noindent" >
</p>                                                                      
<h3 class="sectionHead"><span class="titlemark">10.3</span>  <a 
 id="x12-24400010.3"></a>Creating
a
Package</h3>
<!--l. 356--><p class="noindent" >A
package
is
an
organizational
unit
for
our
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
code.
If
we
want
to
be
able
to
install
our
code
or
share
it
with
others,
then
we’ll
need
it
organized
in
a
package.
With
packages,
we
can
release
our
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
work
and
allow
others
to
build
and
use
it
easily.
</p>                                                                          
<!--l. 360--><p class="noindent" >Package
creation
in
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
uses
ament
as
                                                                                
                                                                                
                                                                              
its
build
system
and
colcon
as
its
build
tool.
We
can
create
a
package
using
either
CMake
or
Python,
which
are
officially
supported,
though
other
build
types
do
exist.
                                                                                
<a 
 id="paragraph*.102"></a></p>
<!--l. 364--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-245000"></a>The
Anatomy
of
a
Package</span>
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
Python
and
CMake
packages
each
have
their
own
minimum
required
contents:
</p>     
<dl class="description"><dt class="description">
<span id="textcolor3153"><code class="verb">package.xml</code></span> 
</dt><dd 
class="description">
<!--l. 369--><p class="noindent" >     
file
containing
meta
information
about
the
package
</p>     
</dd>
<dt class="description">
<span id="textcolor3154"><code class="verb">resource/<package_name></code></span> 
</dt><dd 
class="description">
                                                                                
                                                                                
     
<!--l. 370--><p class="noindent" >
marker
file
for
the
package
</p>     
</dd>
<dt class="description">
<span id="textcolor3155"><code class="verb">setup.cfg</code></span> 
</dt><dd 
class="description">
<!--l. 371--><p class="noindent" >     
is
required
when
a
package
has
executables,
so
ros2
run
can
find
them
</p>     
</dd>
<dt class="description">
<span id="textcolor3156"><code class="verb">setup.py</code></span> 
</dt><dd 
class="description">
<!--l. 372--><p class="noindent" >     
containing
instructions
for
how
to
install
the
package
</p>     
</dd>
<dt class="description">
<span id="textcolor3157"><code class="verb"><package_name></code></span> 
</dt><dd 
class="description">
<!--l. 373--><p class="noindent" >     
a
directory
with
the
same
name
as
our
package,
used
by
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
tools
to
find
our
package,
contains
<span id="textcolor3158"><code class="verb">__init__.py</code></span></p></dd></dl>                                                                
<!--l. 377--><p class="noindent" >The
simplest
possible
package
may
                                                                                
                                                                                
                                                                             
have
a
file
structure
that
looks
like:
                                                                                
                                                                                
                                                                                
</p>
<!--l. 380--><p class="noindent" >
</p>                                                                      
<h3 class="sectionHead"><span class="titlemark">10.4</span>  <a 
 id="x12-24600010.4"></a>Writing
a
Simple
Publisher
&#x0026;
Subscriber</h3>
<!--l. 382--><p class="noindent" >In
this
exercise,
we
will
create
<alert style="color: #821131;">nodes</alert>
which
passes
information
in
the
form
of
string
messages
to
each
other
over
a
<alert style="color: #821131;">topic</alert>.
The
example
we
will
use
here
is
a
simple
“talker”
and
“listener”
system
where
</p>     
<blockquote class="quote">
<!--l. 387--><p class="noindent" >one
publishes
data
and
the
other
subscribes
to
the
topic
so
it
can
                                                                                
                                                                                
     
receive
that
data.</p></blockquote>                                                                        

<a 
 id="paragraph*.103"></a>                                                                          
<!--l. 390--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-247000"></a>Creating
a
ROS
Packages</span>
To
begin,
we
open
a
new
terminal
window
and
navigate
to
our
previously
created
<span id="textcolor3159"><code class="verb">ros2\_ws</code></span>
.
</p>                                                                                
<div class="warning">
<!--l. 397--><p class="noindent" >Recall
that
packages
should
be
created
in
the
<span id="textcolor3160"><code class="verb">src</code></span>
directory,
not
the
root
<span id="textcolor3161"><code class="verb">/</code></span>
of
the
workspace.
</p>                                                                                
</div>
<!--l. 399--><p class="noindent" >So
naturally,
navigate
into
the
<span id="textcolor3162"><code class="verb">ros2_ws/src</code></span>
directory,
and
run
the
package
creation
command:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                            
<pre><div id="fancyvrb260" style='padding:20px;border-radius: 3px;'><a 
 id="x12-247002r211"></a>ros2<span id="textcolor3163"> </span>pkg<span id="textcolor3164"> </span>create<span id="textcolor3165"> </span>--build-type<span id="textcolor3166"> </span>ament_python<span id="textcolor3167"> </span>--license<span id="textcolor3168"> </span>Apache-2.0<span id="textcolor3169"> </span>py_pubsub</div></pre>
                                                                                
                                                                                
                                                                               
<!--l. 404--><p class="noindent" >If
everything
works
well,
our
terminal
will
return
a
message
verifying
the
creation
of
our
package
<span id="textcolor3170"><code class="verb">py_pubsub</code></span>
and
all
its
necessary
files
and
folders.

</p>                                                                     
<h4 class="subsectionHead"><span class="titlemark">10.4.1</span>  <a 
 id="x12-24800010.4.1"></a>Writing
the
Publisher
Node</h4>
<!--l. 409--><p class="noindent" >Now
that
we
have
a
package
template,
please
navigate
into
<span id="textcolor3171"><code class="verb">ros2_ws/src/py_pubsub/py_pubsub</code></span>.
To
get
started,
download
the
example
<alert style="color: #821131;">talker
code</alert>
by
entering
the
following
command:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb261" style='padding:20px;border-radius: 3px;'><a 
 id="x12-248002r216"></a>wget<span id="textcolor3172"> </span>https://raw.githubusercontent.com/ros2/examples/humble/rclpy/topics/minimal_publisher/examples_rclpy_minimal_publisher/publisher_member_function.py</div></pre>
<!--l. 415--><p class="noindent" >Here
the
<span id="textcolor3173"><code class="verb">wget</code></span>
command
basically
                                                                                
                                                                                
                                                                            
access
the
file
in
a
web-server
and
then
downloads
it
to
the
current
working
directory.
If
the
code
works
successfully,
there
will
be
a
new
file
named
<span id="textcolor3174"><code class="verb">publisher_member_function.py</code></span>
adjacent
to
<span id="textcolor3175"><code class="verb">__init__.py</code></span>.
</p>                                                                             
<!--l. 419--><p class="noindent" >Now
let’s
open
the
code
and
see
what
is
going
on
under
the
hood.
The
following
is
the
code
in
full
with
snippets
and
detailed
explanation
to
follow:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb262" style='padding:20px;border-radius: 3px;'><a 
 id="x12-248004r222"></a><span id="textcolor3176">import</span><span id="textcolor3177"> </span><span id="textcolor3178">rclpy</span> 
<a 
 id="x12-248006r223"></a><span id="textcolor3179">from</span><span id="textcolor3180"> </span><span id="textcolor3181">rclpy</span><span id="textcolor3182">.</span><span id="textcolor3183">node</span><span id="textcolor3184"> </span><span id="textcolor3185">import</span> <span id="textcolor3186">Node</span> 
<a 
 id="x12-248008r224"></a> 
<a 
 id="x12-248010r225"></a><span id="textcolor3187">from</span><span id="textcolor3188"> </span><span id="textcolor3189">std_msgs</span><span id="textcolor3190">.</span><span id="textcolor3191">msg</span><span id="textcolor3192"> </span><span id="textcolor3193">import</span> <span id="textcolor3194">String</span> 
<a 
 id="x12-248012r226"></a> 
<a 
 id="x12-248014r227"></a> 
<a 
 id="x12-248016r228"></a><span id="textcolor3195">class</span><span id="textcolor3196"> </span><span id="textcolor3197">MinimalPublisher</span><span id="textcolor3198">(</span><span id="textcolor3199">Node</span><span id="textcolor3200">)</span><span id="textcolor3201">:</span> 
<a 
 id="x12-248018r229"></a> 
<a 
 id="x12-248020r230"></a>   <span id="textcolor3202">def</span><span id="textcolor3203"> </span><span id="textcolor3204">__init__</span><span id="textcolor3205">(</span><span id="textcolor3206">self</span><span id="textcolor3207">)</span><span id="textcolor3208">:</span> 
<a 
 id="x12-248022r231"></a>      <span id="textcolor3209">super</span><span id="textcolor3210">(</span><span id="textcolor3211">)</span><span id="textcolor3212">.</span><span id="textcolor3213">__init__</span><span id="textcolor3214">(</span><span id="textcolor3215">&#x0027;</span><span id="textcolor3216">minimal_publisher</span><span id="textcolor3217">&#x0027;</span><span id="textcolor3218">)</span> 
<a 
 id="x12-248024r232"></a>      <span id="textcolor3219">self</span><span id="textcolor3220">.</span><span id="textcolor3221">publisher_</span> <span id="textcolor3222">=</span> <span id="textcolor3223">self</span><span id="textcolor3224">.</span><span id="textcolor3225">create_publisher</span><span id="textcolor3226">(</span><span id="textcolor3227">String</span><span id="textcolor3228">,</span> <span id="textcolor3229">&#x0027;</span><span id="textcolor3230">topic</span><span id="textcolor3231">&#x0027;</span><span id="textcolor3232">,</span> <span id="textcolor3233">10</span><span id="textcolor3234">)</span> 
<a 
 id="x12-248026r233"></a>      <span id="textcolor3235">timer_period</span> <span id="textcolor3236">=</span> <span id="textcolor3237">0.5</span>  <span id="textcolor3238"># seconds</span> 
<a 
 id="x12-248028r234"></a>      <span id="textcolor3239">self</span><span id="textcolor3240">.</span><span id="textcolor3241">timer</span> <span id="textcolor3242">=</span> <span id="textcolor3243">self</span><span id="textcolor3244">.</span><span id="textcolor3245">create_timer</span><span id="textcolor3246">(</span><span id="textcolor3247">timer_period</span><span id="textcolor3248">,</span> <span id="textcolor3249">self</span><span id="textcolor3250">.</span><span id="textcolor3251">timer_callback</span><span id="textcolor3252">)</span> 
<a 
 id="x12-248030r235"></a>      <span id="textcolor3253">self</span><span id="textcolor3254">.</span><span id="textcolor3255">i</span> <span id="textcolor3256">=</span> <span id="textcolor3257">0</span> 
<a 
 id="x12-248032r236"></a> 
<a 
 id="x12-248034r237"></a>   <span id="textcolor3258">def</span><span id="textcolor3259"> </span><span id="textcolor3260">timer_callback</span><span id="textcolor3261">(</span><span id="textcolor3262">self</span><span id="textcolor3263">)</span><span id="textcolor3264">:</span> 
<a 
 id="x12-248036r238"></a>      <span id="textcolor3265">msg</span> <span id="textcolor3266">=</span> <span id="textcolor3267">String</span><span id="textcolor3268">(</span><span id="textcolor3269">)</span> 
<a 
 id="x12-248038r239"></a>      <span id="textcolor3270">msg</span><span id="textcolor3271">.</span><span id="textcolor3272">data</span> <span id="textcolor3273">=</span> <span id="textcolor3274">&#x0027;</span><span id="textcolor3275">Hello World: </span><span id="textcolor3276">%d</span><span id="textcolor3277">&#x0027;</span> <span id="textcolor3278">%</span> <span id="textcolor3279">self</span><span id="textcolor3280">.</span><span id="textcolor3281">i</span> 
<a 
 id="x12-248040r240"></a>      <span id="textcolor3282">self</span><span id="textcolor3283">.</span><span id="textcolor3284">publisher_</span><span id="textcolor3285">.</span><span id="textcolor3286">publish</span><span id="textcolor3287">(</span><span id="textcolor3288">msg</span><span id="textcolor3289">)</span> 
<a 
 id="x12-248042r241"></a>      <span id="textcolor3290">self</span><span id="textcolor3291">.</span><span id="textcolor3292">get_logger</span><span id="textcolor3293">(</span><span id="textcolor3294">)</span><span id="textcolor3295">.</span><span id="textcolor3296">info</span><span id="textcolor3297">(</span><span id="textcolor3298">&#x0027;</span><span id="textcolor3299">Publishing: </span><span id="textcolor3300">"</span><span id="textcolor3301">%s</span><span id="textcolor3302">"</span><span id="textcolor3303">&#x0027;</span> <span id="textcolor3304">%</span> <span id="textcolor3305">msg</span><span id="textcolor3306">.</span><span id="textcolor3307">data</span><span id="textcolor3308">)</span> 
<a 
 id="x12-248044r242"></a>      <span id="textcolor3309">self</span><span id="textcolor3310">.</span><span id="textcolor3311">i</span> <span id="textcolor3312">+</span><span id="textcolor3313">=</span> <span id="textcolor3314">1</span> 
<a 
 id="x12-248046r243"></a> 
<a 
 id="x12-248048r244"></a> 
<a 
 id="x12-248050r245"></a><span id="textcolor3315">def</span><span id="textcolor3316"> </span><span id="textcolor3317">main</span><span id="textcolor3318">(</span><span id="textcolor3319">args</span><span id="textcolor3320">=</span><span id="textcolor3321">None</span><span id="textcolor3322">)</span><span id="textcolor3323">:</span> 
<a 
 id="x12-248052r246"></a>   <span id="textcolor3324">rclpy</span><span id="textcolor3325">.</span><span id="textcolor3326">init</span><span id="textcolor3327">(</span><span id="textcolor3328">args</span><span id="textcolor3329">=</span><span id="textcolor3330">args</span><span id="textcolor3331">)</span> 
<a 
 id="x12-248054r247"></a> 
<a 
 id="x12-248056r248"></a>   <span id="textcolor3332">minimal_publisher</span> <span id="textcolor3333">=</span> <span id="textcolor3334">MinimalPublisher</span><span id="textcolor3335">(</span><span id="textcolor3336">)</span> 
<a 
 id="x12-248058r249"></a> 
<a 
 id="x12-248060r250"></a>   <span id="textcolor3337">rclpy</span><span id="textcolor3338">.</span><span id="textcolor3339">spin</span><span id="textcolor3340">(</span><span id="textcolor3341">minimal_publisher</span><span id="textcolor3342">)</span> 
<a 
 id="x12-248062r251"></a> 
<a 
 id="x12-248064r252"></a>   <span id="textcolor3343"># Destroy the node explicitly</span> 
<a 
 id="x12-248066r253"></a>   <span id="textcolor3344"># (optional - otherwise it will be done automatically</span> 
<a 
 id="x12-248068r254"></a>   <span id="textcolor3345"># when the garbage collector destroys the node object)</span> 
<a 
 id="x12-248070r255"></a>   <span id="textcolor3346">minimal_publisher</span><span id="textcolor3347">.</span><span id="textcolor3348">destroy_node</span><span id="textcolor3349">(</span><span id="textcolor3350">)</span> 
<a 
 id="x12-248072r256"></a>   <span id="textcolor3351">rclpy</span><span id="textcolor3352">.</span><span id="textcolor3353">shutdown</span><span id="textcolor3354">(</span><span id="textcolor3355">)</span> 
<a 
 id="x12-248074r257"></a> 
<a 
 id="x12-248076r258"></a> 
<a 
 id="x12-248078r259"></a><span id="textcolor3356">if</span> <span id="textcolor3357">__name__</span> <span id="textcolor3358">==</span> <span id="textcolor3359">&#x0027;</span><span id="textcolor3360">__main__</span><span id="textcolor3361">&#x0027;</span><span id="textcolor3362">:</span> 
<a 
 id="x12-248080r260"></a>   <span id="textcolor3363">main</span><span id="textcolor3364">(</span><span id="textcolor3365">)</span></div></pre>
                                                                                
<a 
 id="paragraph*.104"></a>
                                                                                
                                                                                
                                                                      
<!--l. 424--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-249000"></a>Deconstructing
the
Code</span>
The
first
lines
of
code
after
the
comments
import
<span id="textcolor3366"><code class="verb">rclpy</code></span>
so
its
<alert style="color: #821131;">Node
class</alert>
can
be
used.<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">9 </sup></span></alert>
<span class="marginnote">                                                                             
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">9</sup></span></alert><span id="textcolor3367">As
a
reminder,
the
<span id="textcolor3368"><code class="verb">rclpy</code></span>
is
the
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
library
written
for
Python.</span></span>
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                   
<pre><div id="fancyvrb263" style='padding:20px;border-radius: 3px;'><a 
 id="x12-249002r270"></a><span id="textcolor3369">import</span><span id="textcolor3370"> </span><span id="textcolor3371">rclpy</span> 
<a 
 id="x12-249004r271"></a><span id="textcolor3372">from</span><span id="textcolor3373"> </span><span id="textcolor3374">rclpy</span><span id="textcolor3375">.</span><span id="textcolor3376">node</span><span id="textcolor3377"> </span><span id="textcolor3378">import</span> <span id="textcolor3379">Node</span></div></pre>
<!--l. 432--><p class="noindent" >The
next
statement
imports
the
built-in
string
message
type
which
the
node
uses
to
structure
the
data
it
passes
on
the
topic.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                         
<pre><div id="fancyvrb264" style='padding:20px;border-radius: 3px;'><a 
 id="x12-249006r276"></a><span id="textcolor3380">from</span><span id="textcolor3381"> </span><span id="textcolor3382">std_msgs</span><span id="textcolor3383">.</span><span id="textcolor3384">msg</span><span id="textcolor3385"> </span><span id="textcolor3386">import</span> <span id="textcolor3387">String</span></div></pre>
<!--l. 437--><p class="noindent" >These
aforementioned
                                                                                
                                                                                
lines
represent
the
node’s
<alert style="color: #821131;">dependencies</alert>.
Recall
that
dependencies
have
to
be
added
to
<span id="textcolor3388"><code class="verb">package.xml</code></span>,
which
we
will
have
a
look
at
in
just
a
little
bit.
Next,
the
<span id="textcolor3389"><code class="verb">MinimalPublisher</code></span>
class
is
created,
which
inherits<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">10 </sup></span></alert>
<span class="marginnote">
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">10</sup></span></alert><span id="textcolor3390">or
is
a
subclass
of</span></span>
from
Node.
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb265" style='padding:20px;border-radius: 3px;'><a 
 id="x12-249008r281"></a><span id="textcolor3391">class</span><span id="textcolor3392"> </span><span id="textcolor3393">MinimalPublisher</span><span id="textcolor3394">(</span><span id="textcolor3395">Node</span><span id="textcolor3396">)</span><span id="textcolor3397">:</span></div></pre>
<!--l. 444--><p class="noindent" >Following
is
the
definition
of
the
class’s
constructor. <span id="textcolor3398"><code class="verb">super().__init__</code></span>
calls
the
Node
class’s
constructor
and
gives
it
our
node
name,
in
this
                                                                                
                                                                                
case
<span id="textcolor3399"><code class="verb">minimal_publisher</code></span>.                                                       
</p>
<!--l. 447--><p class="noindent" ><span id="textcolor3400"><code class="verb">create_publisher</code></span>
declares
the
node
publishes
messages
of
type
String,<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">11 </sup></span></alert>
<span class="marginnote">                                                                          
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">11</sup></span></alert><span id="textcolor3401">which
is
imported
from
the
<span id="textcolor3402"><code class="verb">std_msgs.msg</code></span>
module</span></span>
over
a
topic
named
topic,
and
that
the
“queue
size”
is
<span id="textcolor3403"><code class="verb">10</code></span>.
</p>                                                                                
<div class="knowledge">
<!--l. 454--><p class="noindent" >Queue
size
is
a
required
QoS
(quality
of
service)
setting
which
limits
the
amount
of
queued
messages
if
a
subscriber
is
<span id="bold" style="font-weight:bold;">NOT</span>
 receiving
them
fast
enough.
</p>                                                                                
</div>
<!--l. 456--><p class="noindent" >Next,
a
timer
is
created
with
                                                                                
                                                                                
                                                                               
a
callback
to
execute
every
<span id="textcolor3404"><code class="verb">0.5</code></span>
seconds. <span id="textcolor3405"><code class="verb">self.i</code></span>
is
a
counter
used
in
the
callback.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb266" style='padding:20px;border-radius: 3px;'><a 
 id="x12-249010r286"></a><span id="textcolor3406">def</span><span id="textcolor3407"> </span><span id="textcolor3408">__init__</span><span id="textcolor3409">(</span><span id="textcolor3410">self</span><span id="textcolor3411">)</span><span id="textcolor3412">:</span> 
<a 
 id="x12-249012r287"></a>   <span id="textcolor3413">super</span><span id="textcolor3414">(</span><span id="textcolor3415">)</span><span id="textcolor3416">.</span><span id="textcolor3417">__init__</span><span id="textcolor3418">(</span><span id="textcolor3419">&#x0027;</span><span id="textcolor3420">minimal_publisher</span><span id="textcolor3421">&#x0027;</span><span id="textcolor3422">)</span> 
<a 
 id="x12-249014r288"></a>   <span id="textcolor3423">self</span><span id="textcolor3424">.</span><span id="textcolor3425">publisher_</span> <span id="textcolor3426">=</span> <span id="textcolor3427">self</span><span id="textcolor3428">.</span><span id="textcolor3429">create_publisher</span><span id="textcolor3430">(</span><span id="textcolor3431">String</span><span id="textcolor3432">,</span> <span id="textcolor3433">&#x0027;</span><span id="textcolor3434">topic</span><span id="textcolor3435">&#x0027;</span><span id="textcolor3436">,</span> <span id="textcolor3437">10</span><span id="textcolor3438">)</span> 
<a 
 id="x12-249016r289"></a>   <span id="textcolor3439">timer_period</span> <span id="textcolor3440">=</span> <span id="textcolor3441">0.5</span>  <span id="textcolor3442"># seconds</span> 
<a 
 id="x12-249018r290"></a>   <span id="textcolor3443">self</span><span id="textcolor3444">.</span><span id="textcolor3445">timer</span> <span id="textcolor3446">=</span> <span id="textcolor3447">self</span><span id="textcolor3448">.</span><span id="textcolor3449">create_timer</span><span id="textcolor3450">(</span><span id="textcolor3451">timer_period</span><span id="textcolor3452">,</span> <span id="textcolor3453">self</span><span id="textcolor3454">.</span><span id="textcolor3455">timer_callback</span><span id="textcolor3456">)</span> 
<a 
 id="x12-249020r291"></a>   <span id="textcolor3457">self</span><span id="textcolor3458">.</span><span id="textcolor3459">i</span> <span id="textcolor3460">=</span> <span id="textcolor3461">0</span></div></pre>
<!--l. 461--><p class="noindent" ><span id="textcolor3462"><code class="verb">timer_callback</code></span>
creates
a
message
with
the
counter
value
appended,
and
publishes
it
to
the
console
with
<span id="textcolor3463"><code class="verb">get_logger().info</code></span>.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb267" style='padding:20px;border-radius: 3px;'><a 
 id="x12-249022r296"></a><span id="textcolor3464">def</span><span id="textcolor3465"> </span><span id="textcolor3466">timer_callback</span><span id="textcolor3467">(</span><span id="textcolor3468">self</span><span id="textcolor3469">)</span><span id="textcolor3470">:</span> 
<a 
 id="x12-249024r297"></a>   <span id="textcolor3471">msg</span> <span id="textcolor3472">=</span> <span id="textcolor3473">String</span><span id="textcolor3474">(</span><span id="textcolor3475">)</span> 
<a 
 id="x12-249026r298"></a>   <span id="textcolor3476">msg</span><span id="textcolor3477">.</span><span id="textcolor3478">data</span> <span id="textcolor3479">=</span> <span id="textcolor3480">&#x0027;</span><span id="textcolor3481">Hello World: </span><span id="textcolor3482">%d</span><span id="textcolor3483">&#x0027;</span> <span id="textcolor3484">%</span> <span id="textcolor3485">self</span><span id="textcolor3486">.</span><span id="textcolor3487">i</span> 
<a 
 id="x12-249028r299"></a>   <span id="textcolor3488">self</span><span id="textcolor3489">.</span><span id="textcolor3490">publisher_</span><span id="textcolor3491">.</span><span id="textcolor3492">publish</span><span id="textcolor3493">(</span><span id="textcolor3494">msg</span><span id="textcolor3495">)</span> 
<a 
 id="x12-249030r300"></a>   <span id="textcolor3496">self</span><span id="textcolor3497">.</span><span id="textcolor3498">get_logger</span><span id="textcolor3499">(</span><span id="textcolor3500">)</span><span id="textcolor3501">.</span><span id="textcolor3502">info</span><span id="textcolor3503">(</span><span id="textcolor3504">&#x0027;</span><span id="textcolor3505">Publishing: </span><span id="textcolor3506">"</span><span id="textcolor3507">%s</span><span id="textcolor3508">"</span><span id="textcolor3509">&#x0027;</span> <span id="textcolor3510">%</span> <span id="textcolor3511">msg</span><span id="textcolor3512">.</span><span id="textcolor3513">data</span><span id="textcolor3514">)</span> 
<a 
 id="x12-249032r301"></a>   <span id="textcolor3515">self</span><span id="textcolor3516">.</span><span id="textcolor3517">i</span> <span id="textcolor3518">+</span><span id="textcolor3519">=</span> <span id="textcolor3520">1</span></div></pre>
<!--l. 466--><p class="noindent" >Lastly,
the
main
function
is
defined.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb268" style='padding:20px;border-radius: 3px;'><a 
 id="x12-249034r306"></a><span id="textcolor3521">def</span><span id="textcolor3522"> </span><span id="textcolor3523">main</span><span id="textcolor3524">(</span><span id="textcolor3525">args</span><span id="textcolor3526">=</span><span id="textcolor3527">None</span><span id="textcolor3528">)</span><span id="textcolor3529">:</span> 
<a 
 id="x12-249036r307"></a>   <span id="textcolor3530">rclpy</span><span id="textcolor3531">.</span><span id="textcolor3532">init</span><span id="textcolor3533">(</span><span id="textcolor3534">args</span><span id="textcolor3535">=</span><span id="textcolor3536">args</span><span id="textcolor3537">)</span> 
<a 
 id="x12-249038r308"></a> 
<a 
 id="x12-249040r309"></a>   <span id="textcolor3538">minimal_publisher</span> <span id="textcolor3539">=</span> <span id="textcolor3540">MinimalPublisher</span><span id="textcolor3541">(</span><span id="textcolor3542">)</span> 
<a 
 id="x12-249042r310"></a> 
<a 
 id="x12-249044r311"></a>   <span id="textcolor3543">rclpy</span><span id="textcolor3544">.</span><span id="textcolor3545">spin</span><span id="textcolor3546">(</span><span id="textcolor3547">minimal_publisher</span><span id="textcolor3548">)</span> 
<a 
 id="x12-249046r312"></a> 
<a 
 id="x12-249048r313"></a>   <span id="textcolor3549"># Destroy the node explicitly</span> 
<a 
 id="x12-249050r314"></a>   <span id="textcolor3550"># (optional - otherwise it will be done automatically</span> 
<a 
 id="x12-249052r315"></a>   <span id="textcolor3551"># when the garbage collector destroys the node object)</span> 
<a 
 id="x12-249054r316"></a>   <span id="textcolor3552">minimal_publisher</span><span id="textcolor3553">.</span><span id="textcolor3554">destroy_node</span><span id="textcolor3555">(</span><span id="textcolor3556">)</span> 
<a 
 id="x12-249056r317"></a>   <span id="textcolor3557">rclpy</span><span id="textcolor3558">.</span><span id="textcolor3559">shutdown</span><span id="textcolor3560">(</span><span id="textcolor3561">)</span></div></pre>
<!--l. 470--><p class="noindent" >First
the
rclpy
library
is
initialized,
then
the
node
is
created,
and
then
it
“spins”
the
                                                                                
                                                                                
                                                                             
node
so
its
callbacks
are
called.
                                                                                
<a 
 id="paragraph*.105"></a></p>
<!--l. 473--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-250000"></a>Adding
Dependencies</span>
Navigate
one
level
back
to
the
<span id="textcolor3562"><code class="verb">ros2_ws/src/py_pubsub</code></span>
directory,
where
the
<span id="textcolor3563"><code class="verb">setup.py</code></span>,
<span id="textcolor3564"><code class="verb">setup.cfg,</code></span>
and
<span id="textcolor3565"><code class="verb">package.xml</code></span>
files
have
been
created
for
us.
Open
<span id="textcolor3566"><code class="verb">package.xml</code></span>
with
our
favourite
text
editor.<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">12 </sup></span></alert>
<span class="marginnote">
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">12</sup></span></alert><span id="textcolor3567">This
could
of
course
be
emacs,
or
something
which
is
not
emacs
so
we
can
see
why
emacs
is
better.</span></span>
</p><!--l. 480--><p class="noindent" >As
mentioned
previously,
make
sure
to
fill
                                                                                
                                                                                
in
the
<span id="textcolor3568"><code class="verb">&lt;description&gt;</code></span>,
<span id="textcolor3569"><code class="verb">&lt;maintainer&gt;</code></span>
and
<span id="textcolor3570"><code class="verb">&lt;license&gt;</code></span>
tags:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb269" style='padding:20px;border-radius: 3px;'><a 
 id="x12-250002r158"></a><span id="textcolor3571">&lt;description</span><span id="textcolor3572">&gt;</span>Examples<span id="textcolor3573"> </span>of<span id="textcolor3574"> </span>minimal<span id="textcolor3575"> </span>publisher/subscriber<span id="textcolor3576"> </span>using<span id="textcolor3577"> </span>rclpy<span id="textcolor3578">&lt;/description&gt;</span> 
<a 
 id="x12-250004r159"></a><span id="textcolor3579">&lt;maintainer</span><span id="textcolor3580"> </span><span id="textcolor3581">email=</span><span id="textcolor3582">"you@email.com"</span><span id="textcolor3583">&gt;</span>Your<span id="textcolor3584"> </span>Name<span id="textcolor3585">&lt;/maintainer&gt;</span> 
<a 
 id="x12-250006r160"></a><span id="textcolor3586">&lt;license</span><span id="textcolor3587">&gt;</span>Apache<span id="textcolor3588"> </span>License<span id="textcolor3589"> </span>2.0<span id="textcolor3590">&lt;/license&gt;</span></div></pre>
<!--l. 485--><p class="noindent" >After
the
lines
above,
add
the
following
dependencies
corresponding
to
our
node’s
import
statements:<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">13 </sup></span></alert>
<span class="marginnote">                                                                      
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">13</sup></span></alert><span id="textcolor3591">Remember,
we
need
to
let
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
know
the
dependencies
required
by
the
python
script.</span></span>
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                               
<pre><div id="fancyvrb270" style='padding:20px;border-radius: 3px;'><a 
 id="x12-250008r165"></a><span id="textcolor3592">&lt;exec_depend</span><span id="textcolor3593">&gt;</span>rclpy<span id="textcolor3594">&lt;/exec_depend&gt;</span> 
<a 
 id="x12-250010r166"></a><span id="textcolor3595">&lt;exec_depend</span><span id="textcolor3596">&gt;</span>std_msgs<span id="textcolor3597">&lt;/exec_depend&gt;</span></div></pre>
<!--l. 491--><p class="noindent" >This
declares
the
package
needs
<span id="textcolor3598"><code class="verb">rclpy</code></span>
and
<span id="textcolor3599"><code class="verb">std_msgs</code></span>
when
its
code
is
executed.
                                                                                
<a 
 id="paragraph*.106"></a></p>
<!--l. 493--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-251000"></a>Adding
An
Entry
Point</span>
                                                                                
                                                                                
                                                                            
Given
we
have
sorted
our
package
manifesto,
we
need
to
configure
our
python
code.
Open
the
<span id="textcolor3600"><code class="verb">setup.py</code></span>
file.
Again,
match
the
<span id="textcolor3601"><code class="verb">maintainer</code></span>,
<span id="textcolor3602"><code class="verb">maintainer_email</code></span>,
<span id="textcolor3603"><code class="verb">description</code></span>
and
<span id="textcolor3604"><code class="verb">license</code></span>
fields
to
our
<span id="textcolor3605"><code class="verb">package.xml</code></span>:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb271" style='padding:20px;border-radius: 3px;'><a 
 id="x12-251002r173"></a><span id="textcolor3606">maintainer</span><span id="textcolor3607">=</span><span id="textcolor3608">&#x0027;</span><span id="textcolor3609">YourName</span><span id="textcolor3610">&#x0027;</span><span id="textcolor3611">,</span> 
<a 
 id="x12-251004r174"></a><span id="textcolor3612">maintainer_email</span><span id="textcolor3613">=</span><span id="textcolor3614">&#x0027;</span><span id="textcolor3615">you@email.com</span><span id="textcolor3616">&#x0027;</span><span id="textcolor3617">,</span> 
<a 
 id="x12-251006r175"></a><span id="textcolor3618">description</span><span id="textcolor3619">=</span><span id="textcolor3620">&#x0027;</span><span id="textcolor3621">Examples of minimal publisher/subscriber using rclpy</span><span id="textcolor3622">&#x0027;</span><span id="textcolor3623">,</span> 
<a 
 id="x12-251008r176"></a><span id="textcolor3624">license</span><span id="textcolor3625">=</span><span id="textcolor3626">&#x0027;</span><span id="textcolor3627">Apache License 2.0</span><span id="textcolor3628">&#x0027;</span><span id="textcolor3629">,</span></div></pre>
<!--l. 501--><p class="noindent" >Add
the
following
line
within
the
<span id="textcolor3630"><code class="verb">console_scripts</code></span>
brackets
of
the
<span id="textcolor3631"><code class="verb">entry_points</code></span>
field:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb272" style='padding:20px;border-radius: 3px;'><a 
 id="x12-251010r181"></a><span id="textcolor3632">entry_points</span><span id="textcolor3633">=</span><span id="textcolor3634">{</span> 
<a 
 id="x12-251012r182"></a>      <span id="textcolor3635">&#x0027;</span><span id="textcolor3636">console_scripts</span><span id="textcolor3637">&#x0027;</span><span id="textcolor3638">:</span> <span id="textcolor3639">[</span> 
<a 
 id="x12-251014r183"></a>            <span id="textcolor3640">&#x0027;</span><span id="textcolor3641">talker = py_pubsub.publisher_member_function:main</span><span id="textcolor3642">&#x0027;</span><span id="textcolor3643">,</span> 
<a 
 id="x12-251016r184"></a>      <span id="textcolor3644">]</span><span id="textcolor3645">,</span> 
<a 
 id="x12-251018r185"></a><span id="textcolor3646">}</span><span id="textcolor3647">,</span></div></pre>
                                                                                
<a 
 id="paragraph*.107"></a>
<!--l. 505--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-252000"></a>Checking
the
Configuration
File</span>
The
contents
of
the
<span id="textcolor3648"><code class="verb">setup.cfg</code></span>
file
should
be
                                                                                
                                                                                
                                                                          
correctly
populated
automatically,
like
so:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                    
<pre><div id="fancyvrb273" style='padding:20px;border-radius: 3px;'><a 
 id="x12-252002r192"></a><span id="textcolor3649">[develop]</span> 
<a 
 id="x12-252004r193"></a><span id="textcolor3650">script_dir</span><span id="textcolor3651">=</span><span id="textcolor3652">$base/lib/py_pubsub</span> 
<a 
 id="x12-252006r194"></a><span id="textcolor3653">[install]</span> 
<a 
 id="x12-252008r195"></a><span id="textcolor3654">install_scripts</span><span id="textcolor3655">=</span><span id="textcolor3656">$base/lib/py_pubsub</span></div></pre>
<!--l. 512--><p class="noindent" >This
code
is
simply
telling
setuptools
to
put
our
executables
in
lib,
because
ros2
run
will
look
for
them
there.
We
could
build
our
package
now,
source
the
local
setup
files,
and
run
it,
but
let’s
create
the
subscriber
node
first
so
we
can
see
the
full
system
at
work.

</p>                                                                     
<h4 class="subsectionHead"><span class="titlemark">10.4.2</span>  <a 
 id="x12-25300010.4.2"></a>Writing
the
Subscriber
                                                                                
                                                                                
                                                                            
Node</h4>
<!--l. 518--><p class="noindent" >Return
to
<span id="textcolor3657"><code class="verb">ros2_ws/src/py_pubsub/py_pubsub</code></span>
to
create
the
next
node.
Enter
the
following
code
in
our
terminal:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb274" style='padding:20px;border-radius: 3px;'><a 
 id="x12-253002r327"></a>wget<span id="textcolor3658"> </span>https://raw.githubusercontent.com/ros2/examples/humble/rclpy/topics/minimal_subscriber/examples_rclpy_minimal_subscriber/subscriber_member_function.py</div></pre>
<!--l. 523--><p class="noindent" >Now
the
directory
should
have
these
files:
</p>                                                                                
<!--l. 525--><p class="noindent" >
</p>     
<blockquote class="quote">
<!--l. 526--><p class="noindent" ><span id="textcolor3659"><code class="verb">__init__.py</code></span>,
<span id="textcolor3660"><code class="verb">publisher_member_function.py</code></span>
and
<span id="textcolor3661"><code class="verb">subscriber_member_function.py</code></span></p></blockquote>                                                      

<a 
 id="paragraph*.108"></a>                                                                         
<!--l. 530--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-254000"></a>Examining
the
Code</span>
Open
the
<span id="textcolor3662"><code class="verb">subscriber_member_function.py</code></span>
with
our
preferred
text
editor.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb275" style='padding:20px;border-radius: 3px;'><a 
 id="x12-254002r334"></a><span id="textcolor3663">import</span><span id="textcolor3664"> </span><span id="textcolor3665">rclpy</span> 
<a 
 id="x12-254004r335"></a><span id="textcolor3666">from</span><span id="textcolor3667"> </span><span id="textcolor3668">rclpy</span><span id="textcolor3669">.</span><span id="textcolor3670">node</span><span id="textcolor3671"> </span><span id="textcolor3672">import</span> <span id="textcolor3673">Node</span> 
<a 
 id="x12-254006r336"></a> 
<a 
 id="x12-254008r337"></a><span id="textcolor3674">from</span><span id="textcolor3675"> </span><span id="textcolor3676">std_msgs</span><span id="textcolor3677">.</span><span id="textcolor3678">msg</span><span id="textcolor3679"> </span><span id="textcolor3680">import</span> <span id="textcolor3681">String</span> 
<a 
 id="x12-254010r338"></a> 
<a 
 id="x12-254012r339"></a> 
<a 
 id="x12-254014r340"></a><span id="textcolor3682">class</span><span id="textcolor3683"> </span><span id="textcolor3684">MinimalSubscriber</span><span id="textcolor3685">(</span><span id="textcolor3686">Node</span><span id="textcolor3687">)</span><span id="textcolor3688">:</span> 
<a 
 id="x12-254016r341"></a> 
<a 
 id="x12-254018r342"></a>   <span id="textcolor3689">def</span><span id="textcolor3690"> </span><span id="textcolor3691">__init__</span><span id="textcolor3692">(</span><span id="textcolor3693">self</span><span id="textcolor3694">)</span><span id="textcolor3695">:</span> 
<a 
 id="x12-254020r343"></a>      <span id="textcolor3696">super</span><span id="textcolor3697">(</span><span id="textcolor3698">)</span><span id="textcolor3699">.</span><span id="textcolor3700">__init__</span><span id="textcolor3701">(</span><span id="textcolor3702">&#x0027;</span><span id="textcolor3703">minimal_subscriber</span><span id="textcolor3704">&#x0027;</span><span id="textcolor3705">)</span> 
<a 
 id="x12-254022r344"></a>      <span id="textcolor3706">self</span><span id="textcolor3707">.</span><span id="textcolor3708">subscription</span> <span id="textcolor3709">=</span> <span id="textcolor3710">self</span><span id="textcolor3711">.</span><span id="textcolor3712">create_subscription</span><span id="textcolor3713">(</span> 
<a 
 id="x12-254024r345"></a>         <span id="textcolor3714">String</span><span id="textcolor3715">,</span> 
<a 
 id="x12-254026r346"></a>         <span id="textcolor3716">&#x0027;</span><span id="textcolor3717">topic</span><span id="textcolor3718">&#x0027;</span><span id="textcolor3719">,</span> 
<a 
 id="x12-254028r347"></a>         <span id="textcolor3720">self</span><span id="textcolor3721">.</span><span id="textcolor3722">listener_callback</span><span id="textcolor3723">,</span> 
<a 
 id="x12-254030r348"></a>         <span id="textcolor3724">10</span><span id="textcolor3725">)</span> 
<a 
 id="x12-254032r349"></a>      <span id="textcolor3726">self</span><span id="textcolor3727">.</span><span id="textcolor3728">subscription</span>  <span id="textcolor3729"># prevent unused variable warning</span> 
<a 
 id="x12-254034r350"></a> 
<a 
 id="x12-254036r351"></a>   <span id="textcolor3730">def</span><span id="textcolor3731"> </span><span id="textcolor3732">listener_callback</span><span id="textcolor3733">(</span><span id="textcolor3734">self</span><span id="textcolor3735">,</span> <span id="textcolor3736">msg</span><span id="textcolor3737">)</span><span id="textcolor3738">:</span> 
<a 
 id="x12-254038r352"></a>      <span id="textcolor3739">self</span><span id="textcolor3740">.</span><span id="textcolor3741">get_logger</span><span id="textcolor3742">(</span><span id="textcolor3743">)</span><span id="textcolor3744">.</span><span id="textcolor3745">info</span><span id="textcolor3746">(</span><span id="textcolor3747">&#x0027;</span><span id="textcolor3748">I heard: </span><span id="textcolor3749">"</span><span id="textcolor3750">%s</span><span id="textcolor3751">"</span><span id="textcolor3752">&#x0027;</span> <span id="textcolor3753">%</span> <span id="textcolor3754">msg</span><span id="textcolor3755">.</span><span id="textcolor3756">data</span><span id="textcolor3757">)</span> 
<a 
 id="x12-254040r353"></a> 
<a 
 id="x12-254042r354"></a> 
<a 
 id="x12-254044r355"></a><span id="textcolor3758">def</span><span id="textcolor3759"> </span><span id="textcolor3760">main</span><span id="textcolor3761">(</span><span id="textcolor3762">args</span><span id="textcolor3763">=</span><span id="textcolor3764">None</span><span id="textcolor3765">)</span><span id="textcolor3766">:</span> 
<a 
 id="x12-254046r356"></a>   <span id="textcolor3767">rclpy</span><span id="textcolor3768">.</span><span id="textcolor3769">init</span><span id="textcolor3770">(</span><span id="textcolor3771">args</span><span id="textcolor3772">=</span><span id="textcolor3773">args</span><span id="textcolor3774">)</span> 
<a 
 id="x12-254048r357"></a> 
<a 
 id="x12-254050r358"></a>   <span id="textcolor3775">minimal_subscriber</span> <span id="textcolor3776">=</span> <span id="textcolor3777">MinimalSubscriber</span><span id="textcolor3778">(</span><span id="textcolor3779">)</span> 
<a 
 id="x12-254052r359"></a> 
<a 
 id="x12-254054r360"></a>   <span id="textcolor3780">rclpy</span><span id="textcolor3781">.</span><span id="textcolor3782">spin</span><span id="textcolor3783">(</span><span id="textcolor3784">minimal_subscriber</span><span id="textcolor3785">)</span> 
<a 
 id="x12-254056r361"></a> 
<a 
 id="x12-254058r362"></a>   <span id="textcolor3786"># Destroy the node explicitly</span> 
<a 
 id="x12-254060r363"></a>   <span id="textcolor3787"># (optional - otherwise it will be done automatically</span> 
<a 
 id="x12-254062r364"></a>   <span id="textcolor3788"># when the garbage collector destroys the node object)</span> 
<a 
 id="x12-254064r365"></a>   <span id="textcolor3789">minimal_subscriber</span><span id="textcolor3790">.</span><span id="textcolor3791">destroy_node</span><span id="textcolor3792">(</span><span id="textcolor3793">)</span> 
<a 
 id="x12-254066r366"></a>   <span id="textcolor3794">rclpy</span><span id="textcolor3795">.</span><span id="textcolor3796">shutdown</span><span id="textcolor3797">(</span><span id="textcolor3798">)</span> 
<a 
 id="x12-254068r367"></a> 
<a 
 id="x12-254070r368"></a> 
<a 
 id="x12-254072r369"></a><span id="textcolor3799">if</span> <span id="textcolor3800">__name__</span> <span id="textcolor3801">==</span> <span id="textcolor3802">&#x0027;</span><span id="textcolor3803">__main__</span><span id="textcolor3804">&#x0027;</span><span id="textcolor3805">:</span> 
<a 
 id="x12-254074r370"></a>   <span id="textcolor3806">main</span><span id="textcolor3807">(</span><span id="textcolor3808">)</span></div></pre>
<!--l. 536--><p class="noindent" >The
subscriber
node’s
code
is
nearly
identical
to
                                                                                
                                                                                
                                                                              
the
publisher’s.
The
constructor
creates
a
subscriber
with
the
same
arguments
as
the
publisher.
</p>                                                                                
<div class="warning">
<!--l. 542--><p class="noindent" >the
topic
name
and
message
type
used
by
the
publisher
and
subscriber
must
match
to
allow
them
to
communicate.
</p>                                                                                
</div>
<!--l. 1--><p class="noindent" >

</p>      
<pre><div id="fancyvrb276" style='padding:20px;border-radius: 3px;'><a 
 id="x12-254076r375"></a><span id="textcolor3809">self</span><span id="textcolor3810">.</span><span id="textcolor3811">subscription</span> <span id="textcolor3812">=</span> <span id="textcolor3813">self</span><span id="textcolor3814">.</span><span id="textcolor3815">create_subscription</span><span id="textcolor3816">(</span> 
<a 
 id="x12-254078r376"></a>    <span id="textcolor3817">String</span><span id="textcolor3818">,</span> 
<a 
 id="x12-254080r377"></a>    <span id="textcolor3819">&#x0027;</span><span id="textcolor3820">topic</span><span id="textcolor3821">&#x0027;</span><span id="textcolor3822">,</span> 
<a 
 id="x12-254082r378"></a>    <span id="textcolor3823">self</span><span id="textcolor3824">.</span><span id="textcolor3825">listener_callback</span><span id="textcolor3826">,</span> 
<a 
 id="x12-254084r379"></a>    <span id="textcolor3827">10</span><span id="textcolor3828">)</span></div></pre>
<!--l. 546--><p class="noindent" >The
subscriber’s
constructor
and
callback
don’t
include
any
timer
definition,
because
it
doesn’t
need
one.
Its
callback
gets
called
as
soon
as
it
receives
a
message.
                                                                                
                                                                                
                                                                             
</p>
<!--l. 548--><p class="noindent" >The
callback
definition
simply
prints
an
info
message
to
the
console,
along
with
the
data
it
received.
Recall
that
the
publisher
defines
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                 
<pre><div id="fancyvrb277" style='padding:20px;border-radius: 3px;'><a 
 id="x12-254086r384"></a><span id="textcolor3829">def</span><span id="textcolor3830"> </span><span id="textcolor3831">listener_callback</span><span id="textcolor3832">(</span><span id="textcolor3833">self</span><span id="textcolor3834">,</span> <span id="textcolor3835">msg</span><span id="textcolor3836">)</span><span id="textcolor3837">:</span> 
<a 
 id="x12-254088r385"></a>    <span id="textcolor3838">self</span><span id="textcolor3839">.</span><span id="textcolor3840">get_logger</span><span id="textcolor3841">(</span><span id="textcolor3842">)</span><span id="textcolor3843">.</span><span id="textcolor3844">info</span><span id="textcolor3845">(</span><span id="textcolor3846">&#x0027;</span><span id="textcolor3847">I heard: </span><span id="textcolor3848">"</span><span id="textcolor3849">%s</span><span id="textcolor3850">"</span><span id="textcolor3851">&#x0027;</span> <span id="textcolor3852">%</span> <span id="textcolor3853">msg</span><span id="textcolor3854">.</span><span id="textcolor3855">data</span><span id="textcolor3856">)</span></div></pre>
<!--l. 553--><p class="noindent" >The
main
definition
is
almost
exactly
the
same,
replacing
the
creation
and
spinning
of
the
publisher
with
the
subscriber.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                             
<pre><div id="fancyvrb278" style='padding:20px;border-radius: 3px;'><a 
 id="x12-254090r390"></a><span id="textcolor3857">minimal_subscriber</span> <span id="textcolor3858">=</span> <span id="textcolor3859">MinimalSubscriber</span><span id="textcolor3860">(</span><span id="textcolor3861">)</span> 
<a 
 id="x12-254092r391"></a> 
<a 
 id="x12-254094r392"></a><span id="textcolor3862">rclpy</span><span id="textcolor3863">.</span><span id="textcolor3864">spin</span><span id="textcolor3865">(</span><span id="textcolor3866">minimal_subscriber</span><span id="textcolor3867">)</span></div></pre>
<!--l. 558--><p class="noindent" >Since
this
node
has
the
same
dependencies
as
the
publisher,
there’s
nothing
new
to
add
to
package.xml.
                                                                                
                                                                                
                                                                             
The
setup.cfg
file
can
also
remain
untouched.
                                                                                
<a 
 id="paragraph*.109"></a></p>
<!--l. 561--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-255000"></a>Adding
an
Entry
Point</span>
Reopen
setup.py
and
add
the
entry
point
for
the
subscriber
node
below
the
publisher’s
entry
point.
The
<span id="textcolor3868"><code class="verb">entry_points</code></span>
field
should
now
look
like
this:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb279" style='padding:20px;border-radius: 3px;'><a 
 id="x12-255002r399"></a><span id="textcolor3869">entry_points</span><span id="textcolor3870">=</span><span id="textcolor3871">{</span> 
<a 
 id="x12-255004r400"></a>      <span id="textcolor3872">&#x0027;</span><span id="textcolor3873">console_scripts</span><span id="textcolor3874">&#x0027;</span><span id="textcolor3875">:</span> <span id="textcolor3876">[</span> 
<a 
 id="x12-255006r401"></a>            <span id="textcolor3877">&#x0027;</span><span id="textcolor3878">talker = py_pubsub.publisher_member_function:main</span><span id="textcolor3879">&#x0027;</span><span id="textcolor3880">,</span> 
<a 
 id="x12-255008r402"></a>            <span id="textcolor3881">&#x0027;</span><span id="textcolor3882">listener = py_pubsub.subscriber_member_function:main</span><span id="textcolor3883">&#x0027;</span><span id="textcolor3884">,</span> 
<a 
 id="x12-255010r403"></a>      <span id="textcolor3885">]</span><span id="textcolor3886">,</span> 
<a 
 id="x12-255012r404"></a><span id="textcolor3887">}</span><span id="textcolor3888">,</span></div></pre>

                                                                     
<h4 class="subsectionHead"><span class="titlemark">10.4.3</span>  <a 
 id="x12-25600010.4.3"></a>Building
and
Running</h4>
<!--l. 570--><p class="noindent" >We
likely
already
have
the
<span id="textcolor3889"><code class="verb">rclpy</code></span>
and
<span id="textcolor3890"><code class="verb">std_msgs</code></span>
packages
installed
as
part
of
our
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
system.
                                                                                
                                                                                
                                                                             
It’s
good
practice
to
run
rosdep
in
the
root
of
our
workspace
(<span id="textcolor3891"><code class="verb">ros2\_ws</code></span>
)
to
check
for
missing
dependencies
before
building:
                                                                                
                                                                                
                                                                                
</p>
<!--l. 574--><p class="noindent" >
</p>                                                                      
<h3 class="sectionHead"><span class="titlemark">10.5</span>  <a 
 id="x12-25700010.5"></a>Writing
a
Simple
Service
and
Client</h3>
<!--l. 576--><p class="noindent" >When
nodes
communicate
using
services,
the
node
which
sends
a
request
for
data
is
called
the
<alert style="color: #821131;">client</alert>
node,
and
the
one
that
responds
to
the
request
is
the
<alert style="color: #821131;">service</alert>
node.
The
structure
of
the
request
and
response
is
determined
by
a
<span id="textcolor3892"><code class="verb">.srv</code></span>
file.
</p>                                                                             
<!--l. 580--><p class="noindent" >The
example
used
here
is
a
simple
integer
addition
system;
</p>                                                                                
<!--l. 582--><p class="noindent" >
                                                                                
                                                                                
     
</p>
<blockquote class="quote">     
<!--l. 583--><p class="noindent" >one
node
requests
the
sum
of
two
(<alert style="color: #821131;">2</alert>) integers,
and
the
other
responds
with
the
result.</p></blockquote>                                                                    
<!--l. 586--><p class="noindent" >Now
let’s
write
our
implementation.
                                                                                
<a 
 id="paragraph*.110"></a></p>
<!--l. 588--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-258000"></a>Creating
a
New
Package</span>
Let’s
begin
by
opening
a
new
terminal
and
source
our
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
installation
so
<span id="textcolor3893"><code class="verb">ros2</code></span>
commands
will
work.
Once
done,
please
navigate
into
the
<span id="textcolor3894"><code class="verb">ros2\_ws</code></span>
directory
created
in
previously.
</p>                                                                         
<!--l. 594--><p class="noindent" >Remember
that,
packages
should
be
created
                                                                                
                                                                                
                                                                              
in
the
<span id="textcolor3895"><code class="verb">src</code></span>
directory
and
<span id="bold" style="font-weight:bold;">NOT</span>
 the
root
of
the
workspace.
Navigate
into
<span id="textcolor3896"><code class="verb">ros2_ws/src</code></span>
and
create
a
new
package:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb280" style='padding:20px;border-radius: 3px;'><a 
 id="x12-258002r759"></a>ros2<span id="textcolor3897"> </span>pkg<span id="textcolor3898"> </span>create<span id="textcolor3899"> </span><span id="textcolor3900">\</span> 
<a 
 id="x12-258004r760"></a><span id="textcolor3901">    </span>--build-type<span id="textcolor3902"> </span>ament_python<span id="textcolor3903"> </span><span id="textcolor3904">\</span> 
<a 
 id="x12-258006r761"></a><span id="textcolor3905">    </span>--license<span id="textcolor3906"> </span>Apache-2.0<span id="textcolor3907"> </span>py_srvcli<span id="textcolor3908"> </span><span id="textcolor3909">\</span> 
<a 
 id="x12-258008r762"></a><span id="textcolor3910">    </span>--dependencies<span id="textcolor3911"> </span>rclpy<span id="textcolor3912"> </span>example_interfaces</div></pre>
<!--l. 599--><p class="noindent" >Our
terminal
will
return
a
message
verifying
the
creation
of
our
package
<span id="textcolor3913"><code class="verb">py_srvcli</code></span>
and
all
its
necessary
files
and
folders.
</p>                                                                             
<!--l. 602--><p class="noindent" >The
<span id="textcolor3914"><code class="verb">--dependencies</code></span>
argument
will
automatically
add
the
necessary
dependency
lines
to
<span id="textcolor3915"><code class="verb">package.xml</code></span>
.
<span id="textcolor3916"><code class="verb">example_interfaces</code></span>
is
the
package
that
includes
the
<span id="textcolor3917"><code class="verb">.srv</code></span>
file
we
will
                                                                                
                                                                                
                                                                             
need
to
structure
our
requests
and
responses:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                             
<pre><div id="fancyvrb281" style='padding:20px;border-radius: 3px;'><a 
 id="x12-258010r767"></a>int64<span id="textcolor3918"> </span>a 
<a 
 id="x12-258012r768"></a>int64<span id="textcolor3919"> </span>b 
<a 
 id="x12-258014r769"></a>--- 
<a 
 id="x12-258016r770"></a>int64<span id="textcolor3920"> </span>sum</div></pre>
<!--l. 608--><p class="noindent" >The
first
two
lines
are
the
parameters
of
the
request,
and
below
the
dashes
is
the
response.
                                                                                
<a 
 id="paragraph*.111"></a></p>
<!--l. 610--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-259000"></a>Updating
Package
Manifesto</span>
Because
we
used
the
<span id="textcolor3921"><code class="verb">--dependencies</code></span>
option
during
package
creation,
we
don’t
have
to
manually
add
dependencies
to
<span id="textcolor3922"><code class="verb">package.xml</code></span>
.
</p>                                                                              
<!--l. 615--><p class="noindent" >As
always,
though,
make
sure
to
add
the
description,
maintainer
email
and
                                                                                
                                                                                
                                                                            
name,
and
license
information
to
<span id="textcolor3923"><code class="verb">package.xml</code></span>
as
a
good
open-source
developer.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb282" style='padding:20px;border-radius: 3px;'><a 
 id="x12-259002r777"></a><span id="textcolor3924">&lt;description</span><span id="textcolor3925">&gt;</span>Python<span id="textcolor3926"> </span>client<span id="textcolor3927"> </span>server<span id="textcolor3928"> </span>tutorial<span id="textcolor3929">&lt;/description&gt;</span> 
<a 
 id="x12-259004r778"></a><span id="textcolor3930">&lt;maintainer</span><span id="textcolor3931"> </span><span id="textcolor3932">email=</span><span id="textcolor3933">"you@email.com"</span><span id="textcolor3934">&gt;</span>Your<span id="textcolor3935"> </span>Name<span id="textcolor3936">&lt;/maintainer&gt;</span> 
<a 
 id="x12-259006r779"></a><span id="textcolor3937">&lt;license</span><span id="textcolor3938">&gt;</span>Apache<span id="textcolor3939"> </span>License<span id="textcolor3940"> </span>2.0<span id="textcolor3941">&lt;/license&gt;</span></div></pre>
                                                                                
<a 
 id="paragraph*.112"></a>
<!--l. 620--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-260000"></a>Updating
the
Configuration</span>
Add
the
same
information
to
the
<span id="textcolor3942"><code class="verb">setup.py</code></span>
file
for
the
<span id="textcolor3943"><code class="verb">maintainer</code></span>,
<span id="textcolor3944"><code class="verb">maintainer_email</code></span>,
<span id="textcolor3945"><code class="verb">description</code></span>
and
license
fields:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb283" style='padding:20px;border-radius: 3px;'><a 
 id="x12-260002r786"></a><span id="textcolor3946">maintainer</span><span id="textcolor3947">=</span><span id="textcolor3948">&#x0027;</span><span id="textcolor3949">Your Name</span><span id="textcolor3950">&#x0027;</span><span id="textcolor3951">,</span> 
<a 
 id="x12-260004r787"></a><span id="textcolor3952">maintainer_email</span><span id="textcolor3953">=</span><span id="textcolor3954">&#x0027;</span><span id="textcolor3955">you@email.com</span><span id="textcolor3956">&#x0027;</span><span id="textcolor3957">,</span> 
<a 
 id="x12-260006r788"></a><span id="textcolor3958">description</span><span id="textcolor3959">=</span><span id="textcolor3960">&#x0027;</span><span id="textcolor3961">Python client server tutorial</span><span id="textcolor3962">&#x0027;</span><span id="textcolor3963">,</span> 
<a 
 id="x12-260008r789"></a><span id="textcolor3964">license</span><span id="textcolor3965">=</span><span id="textcolor3966">&#x0027;</span><span id="textcolor3967">Apache License 2.0</span><span id="textcolor3968">&#x0027;</span><span id="textcolor3969">,</span></div></pre>

                                                                     
<h4 class="subsectionHead"><span class="titlemark">10.5.1</span>  <a 
 id="x12-26100010.5.1"></a>Writing
the
Service
Node</h4>
<!--l. 629--><p class="noindent" >Once
we
are
sure
we
are
inside
the
<span id="textcolor3970"><code class="verb">[</code></span>
/]ros2_ws/src/py_srvcli/py_srvcli
directory,
we
then
create
a
                                                                                
                                                                                
                                                                             
new
file
called
<span id="textcolor3971"><code class="verb">service\_member\_function.py</code></span>
and
paste
the
following
code
within:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb284" style='padding:20px;border-radius: 3px;'><a 
 id="x12-261002r796"></a><span id="textcolor3972">from</span><span id="textcolor3973"> </span><span id="textcolor3974">example_interfaces</span><span id="textcolor3975">.</span><span id="textcolor3976">srv</span><span id="textcolor3977"> </span><span id="textcolor3978">import</span> <span id="textcolor3979">AddTwoInts</span> 
<a 
 id="x12-261004r797"></a> 
<a 
 id="x12-261006r798"></a><span id="textcolor3980">import</span><span id="textcolor3981"> </span><span id="textcolor3982">rclpy</span> 
<a 
 id="x12-261008r799"></a><span id="textcolor3983">from</span><span id="textcolor3984"> </span><span id="textcolor3985">rclpy</span><span id="textcolor3986">.</span><span id="textcolor3987">node</span><span id="textcolor3988"> </span><span id="textcolor3989">import</span> <span id="textcolor3990">Node</span> 
<a 
 id="x12-261010r800"></a> 
<a 
 id="x12-261012r801"></a> 
<a 
 id="x12-261014r802"></a><span id="textcolor3991">class</span><span id="textcolor3992"> </span><span id="textcolor3993">MinimalService</span><span id="textcolor3994">(</span><span id="textcolor3995">Node</span><span id="textcolor3996">)</span><span id="textcolor3997">:</span> 
<a 
 id="x12-261016r803"></a> 
<a 
 id="x12-261018r804"></a>   <span id="textcolor3998">def</span><span id="textcolor3999"> </span><span id="textcolor4000">__init__</span><span id="textcolor4001">(</span><span id="textcolor4002">self</span><span id="textcolor4003">)</span><span id="textcolor4004">:</span> 
<a 
 id="x12-261020r805"></a>      <span id="textcolor4005">super</span><span id="textcolor4006">(</span><span id="textcolor4007">)</span><span id="textcolor4008">.</span><span id="textcolor4009">__init__</span><span id="textcolor4010">(</span><span id="textcolor4011">&#x0027;</span><span id="textcolor4012">minimal_service</span><span id="textcolor4013">&#x0027;</span><span id="textcolor4014">)</span> 
<a 
 id="x12-261022r806"></a>      <span id="textcolor4015">self</span><span id="textcolor4016">.</span><span id="textcolor4017">srv</span> <span id="textcolor4018">=</span> <span id="textcolor4019">self</span><span id="textcolor4020">.</span><span id="textcolor4021">create_service</span><span id="textcolor4022">(</span><span id="textcolor4023">AddTwoInts</span><span id="textcolor4024">,</span> <span id="textcolor4025">&#x0027;</span><span id="textcolor4026">add_two_ints</span><span id="textcolor4027">&#x0027;</span><span id="textcolor4028">,</span> <span id="textcolor4029">self</span><span id="textcolor4030">.</span><span id="textcolor4031">add_two_ints_callback</span><span id="textcolor4032">)</span> 
<a 
 id="x12-261024r807"></a> 
<a 
 id="x12-261026r808"></a>   <span id="textcolor4033">def</span><span id="textcolor4034"> </span><span id="textcolor4035">add_two_ints_callback</span><span id="textcolor4036">(</span><span id="textcolor4037">self</span><span id="textcolor4038">,</span> <span id="textcolor4039">request</span><span id="textcolor4040">,</span> <span id="textcolor4041">response</span><span id="textcolor4042">)</span><span id="textcolor4043">:</span> 
<a 
 id="x12-261028r809"></a>      <span id="textcolor4044">response</span><span id="textcolor4045">.</span><span id="textcolor4046">sum</span> <span id="textcolor4047">=</span> <span id="textcolor4048">request</span><span id="textcolor4049">.</span><span id="textcolor4050">a</span> <span id="textcolor4051">+</span> <span id="textcolor4052">request</span><span id="textcolor4053">.</span><span id="textcolor4054">b</span> 
<a 
 id="x12-261030r810"></a>      <span id="textcolor4055">self</span><span id="textcolor4056">.</span><span id="textcolor4057">get_logger</span><span id="textcolor4058">(</span><span id="textcolor4059">)</span><span id="textcolor4060">.</span><span id="textcolor4061">info</span><span id="textcolor4062">(</span><span id="textcolor4063">&#x0027;</span><span id="textcolor4064">Incoming request</span><span id="textcolor4065">\n</span><span id="textcolor4066">a: </span><span id="textcolor4067">%d</span><span id="textcolor4068"> b: </span><span id="textcolor4069">%d</span><span id="textcolor4070">&#x0027;</span> <span id="textcolor4071">%</span> <span id="textcolor4072">(</span><span id="textcolor4073">request</span><span id="textcolor4074">.</span><span id="textcolor4075">a</span><span id="textcolor4076">,</span> <span id="textcolor4077">request</span><span id="textcolor4078">.</span><span id="textcolor4079">b</span><span id="textcolor4080">)</span><span id="textcolor4081">)</span> 
<a 
 id="x12-261032r811"></a> 
<a 
 id="x12-261034r812"></a>      <span id="textcolor4082">return</span> <span id="textcolor4083">response</span> 
<a 
 id="x12-261036r813"></a> 
<a 
 id="x12-261038r814"></a> 
<a 
 id="x12-261040r815"></a><span id="textcolor4084">def</span><span id="textcolor4085"> </span><span id="textcolor4086">main</span><span id="textcolor4087">(</span><span id="textcolor4088">)</span><span id="textcolor4089">:</span> 
<a 
 id="x12-261042r816"></a>   <span id="textcolor4090">rclpy</span><span id="textcolor4091">.</span><span id="textcolor4092">init</span><span id="textcolor4093">(</span><span id="textcolor4094">)</span> 
<a 
 id="x12-261044r817"></a> 
<a 
 id="x12-261046r818"></a>   <span id="textcolor4095">minimal_service</span> <span id="textcolor4096">=</span> <span id="textcolor4097">MinimalService</span><span id="textcolor4098">(</span><span id="textcolor4099">)</span> 
<a 
 id="x12-261048r819"></a> 
<a 
 id="x12-261050r820"></a>   <span id="textcolor4100">rclpy</span><span id="textcolor4101">.</span><span id="textcolor4102">spin</span><span id="textcolor4103">(</span><span id="textcolor4104">minimal_service</span><span id="textcolor4105">)</span> 
<a 
 id="x12-261052r821"></a> 
<a 
 id="x12-261054r822"></a>   <span id="textcolor4106">rclpy</span><span id="textcolor4107">.</span><span id="textcolor4108">shutdown</span><span id="textcolor4109">(</span><span id="textcolor4110">)</span> 
<a 
 id="x12-261056r823"></a> 
<a 
 id="x12-261058r824"></a> 
<a 
 id="x12-261060r825"></a><span id="textcolor4111">if</span> <span id="textcolor4112">__name__</span> <span id="textcolor4113">==</span> <span id="textcolor4114">&#x0027;</span><span id="textcolor4115">__main__</span><span id="textcolor4116">&#x0027;</span><span id="textcolor4117">:</span> 
<a 
 id="x12-261062r826"></a>   <span id="textcolor4118">main</span><span id="textcolor4119">(</span><span id="textcolor4120">)</span></div></pre>
<!--l. 635--><p class="noindent" >Let’s
look
at
the
code
in
more
detail
and
what
what
is
going
on.
                                                                                
<a 
 id="paragraph*.113"></a></p>
<!--l. 637--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-262000"></a>Examining
the
Code</span>
The
first
<span id="textcolor4121"><code class="verb">import</code></span>
statement
imports
the
<span id="textcolor4122"><code class="verb">AddTwoInts</code></span>
service
type
from
the
<span id="textcolor4123"><code class="verb">example_interfaces</code></span>
package.
The
following
import
statement
imports
the
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
Python
client
library
(<span id="textcolor4124"><code class="verb">rclpy</code></span>),
and
specifically
the
<span id="textcolor4125"><code class="verb">Node</code></span>
class.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
                                                                                
                                                                                
                   
<pre><div id="fancyvrb285" style='padding:20px;border-radius: 3px;'><a 
 id="x12-262002r833"></a><span id="textcolor4126">from</span><span id="textcolor4127"> </span><span id="textcolor4128">example_interfaces</span><span id="textcolor4129">.</span><span id="textcolor4130">srv</span><span id="textcolor4131"> </span><span id="textcolor4132">import</span> <span id="textcolor4133">AddTwoInts</span> 
<a 
 id="x12-262004r834"></a> 
<a 
 id="x12-262006r835"></a><span id="textcolor4134">import</span><span id="textcolor4135"> </span><span id="textcolor4136">rclpy</span> 
<a 
 id="x12-262008r836"></a><span id="textcolor4137">from</span><span id="textcolor4138"> </span><span id="textcolor4139">rclpy</span><span id="textcolor4140">.</span><span id="textcolor4141">node</span><span id="textcolor4142"> </span><span id="textcolor4143">import</span> <span id="textcolor4144">Node</span></div></pre>
<!--l. 645--><p class="noindent" >The
<span id="textcolor4145"><code class="verb">MinimalService</code></span>
class
constructor
initializes
the
node
with
the
name
<span id="textcolor4146"><code class="verb">minimal_service</code></span>.
Then,
it
creates
a
service
and
defines
the
type,
name,
and
callback.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb286" style='padding:20px;border-radius: 3px;'><a 
 id="x12-262010r841"></a>   <span id="textcolor4147">def</span><span id="textcolor4148"> </span><span id="textcolor4149">__init__</span><span id="textcolor4150">(</span><span id="textcolor4151">self</span><span id="textcolor4152">)</span><span id="textcolor4153">:</span> 
<a 
 id="x12-262012r842"></a>      <span id="textcolor4154">super</span><span id="textcolor4155">(</span><span id="textcolor4156">)</span><span id="textcolor4157">.</span><span id="textcolor4158">__init__</span><span id="textcolor4159">(</span><span id="textcolor4160">&#x0027;</span><span id="textcolor4161">minimal_service</span><span id="textcolor4162">&#x0027;</span><span id="textcolor4163">)</span> 
<a 
 id="x12-262014r843"></a>      <span id="textcolor4164">self</span><span id="textcolor4165">.</span><span id="textcolor4166">srv</span> <span id="textcolor4167">=</span> <span id="textcolor4168">self</span><span id="textcolor4169">.</span><span id="textcolor4170">create_service</span><span id="textcolor4171">(</span><span id="textcolor4172">AddTwoInts</span><span id="textcolor4173">,</span> <span id="textcolor4174">&#x0027;</span><span id="textcolor4175">add_two_ints</span><span id="textcolor4176">&#x0027;</span><span id="textcolor4177">,</span> <span id="textcolor4178">self</span><span id="textcolor4179">.</span><span id="textcolor4180">add_two_ints_callback</span><span id="textcolor4181">)</span></div></pre>
<!--l. 650--><p class="noindent" >The
definition
of
the
service
callback
receives
the
request
data,
sums
it,
and
returns
the
sum
as
a
response.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb287" style='padding:20px;border-radius: 3px;'><a 
 id="x12-262016r848"></a>   <span id="textcolor4182">def</span><span id="textcolor4183"> </span><span id="textcolor4184">add_two_ints_callback</span><span id="textcolor4185">(</span><span id="textcolor4186">self</span><span id="textcolor4187">,</span> <span id="textcolor4188">request</span><span id="textcolor4189">,</span> <span id="textcolor4190">response</span><span id="textcolor4191">)</span><span id="textcolor4192">:</span> 
<a 
 id="x12-262018r849"></a>      <span id="textcolor4193">response</span><span id="textcolor4194">.</span><span id="textcolor4195">sum</span> <span id="textcolor4196">=</span> <span id="textcolor4197">request</span><span id="textcolor4198">.</span><span id="textcolor4199">a</span> <span id="textcolor4200">+</span> <span id="textcolor4201">request</span><span id="textcolor4202">.</span><span id="textcolor4203">b</span> 
<a 
 id="x12-262020r850"></a>      <span id="textcolor4204">self</span><span id="textcolor4205">.</span><span id="textcolor4206">get_logger</span><span id="textcolor4207">(</span><span id="textcolor4208">)</span><span id="textcolor4209">.</span><span id="textcolor4210">info</span><span id="textcolor4211">(</span><span id="textcolor4212">&#x0027;</span><span id="textcolor4213">Incoming request</span><span id="textcolor4214">\n</span><span id="textcolor4215">a: </span><span id="textcolor4216">%d</span><span id="textcolor4217"> b: </span><span id="textcolor4218">%d</span><span id="textcolor4219">&#x0027;</span> <span id="textcolor4220">%</span> <span id="textcolor4221">(</span><span id="textcolor4222">request</span><span id="textcolor4223">.</span><span id="textcolor4224">a</span><span id="textcolor4225">,</span> <span id="textcolor4226">request</span><span id="textcolor4227">.</span><span id="textcolor4228">b</span><span id="textcolor4229">)</span><span id="textcolor4230">)</span> 
<a 
 id="x12-262022r851"></a> 
<a 
 id="x12-262024r852"></a>      <span id="textcolor4231">return</span> <span id="textcolor4232">response</span></div></pre>
<!--l. 655--><p class="noindent" >Finally,
the
main
class
initializes
the
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
Python
client
library,
instantiates
the
<span id="textcolor4233"><code class="verb">MinimalService</code></span>
class
                                                                                
                                                                                
                                                                              
to
create
the
service
node
and
spins
the
node
to
handle
callbacks.
                                                                                
<a 
 id="paragraph*.114"></a></p>
<!--l. 658--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-263000"></a>Adding
an
Entry
Point</span>
To
allow
the
<span id="textcolor4234"><code class="verb">ros2 run</code></span>
command
to
run
our
node,
we
must
add
the
entry
point
to
<span id="textcolor4235"><code class="verb">setup.py</code></span>
.<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">14 </sup></span></alert>
<span class="marginnote">                                                                           
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">14</sup></span></alert><span id="textcolor4236">This
is
located
in
the
<span id="textcolor4237"><code class="verb">[</code></span>
/]ros2_ws/src/py_srvcli
directory.</span></span>
To
make
this
happen,
all
we
have
to
do
this
add
the
following
line
between
the
<span id="textcolor4238"><code class="verb">&#x0027;console_scripts&#x0027;:</code></span>
brackets:
</p>                                                                                
<!--l. 1--><p class="noindent" >

                                                                                
                                                                                
</p>                                           
<pre><div id="fancyvrb288" style='padding:20px;border-radius: 3px;'><a 
 id="x12-263002r859"></a><span id="textcolor4239">&#x0027;</span><span id="textcolor4240">service = py_srvcli.service_member_function:main</span><span id="textcolor4241">&#x0027;</span><span id="textcolor4242">,</span></div></pre>

                                                                     
<h4 class="subsectionHead"><span class="titlemark">10.5.2</span>  <a 
 id="x12-26400010.5.2"></a>Writing
the
Client
Node</h4>
<!--l. 669--><p class="noindent" >Once
we
are
inside
the
<span id="textcolor4243"><code class="verb">[</code></span>
/]ros2_ws/src/py_srvcli/py_srvcli
directory,
create
a
new
file
called
<span id="textcolor4244"><code class="verb">client\_member\_function.py</code></span>
and
paste
the
following
code
within:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb289" style='padding:20px;border-radius: 3px;'><a 
 id="x12-264002r866"></a><span id="textcolor4245">import</span><span id="textcolor4246"> </span><span id="textcolor4247">sys</span> 
<a 
 id="x12-264004r867"></a> 
<a 
 id="x12-264006r868"></a><span id="textcolor4248">from</span><span id="textcolor4249"> </span><span id="textcolor4250">example_interfaces</span><span id="textcolor4251">.</span><span id="textcolor4252">srv</span><span id="textcolor4253"> </span><span id="textcolor4254">import</span> <span id="textcolor4255">AddTwoInts</span> 
<a 
 id="x12-264008r869"></a><span id="textcolor4256">import</span><span id="textcolor4257"> </span><span id="textcolor4258">rclpy</span> 
<a 
 id="x12-264010r870"></a><span id="textcolor4259">from</span><span id="textcolor4260"> </span><span id="textcolor4261">rclpy</span><span id="textcolor4262">.</span><span id="textcolor4263">node</span><span id="textcolor4264"> </span><span id="textcolor4265">import</span> <span id="textcolor4266">Node</span> 
<a 
 id="x12-264012r871"></a> 
<a 
 id="x12-264014r872"></a> 
<a 
 id="x12-264016r873"></a><span id="textcolor4267">class</span><span id="textcolor4268"> </span><span id="textcolor4269">MinimalClientAsync</span><span id="textcolor4270">(</span><span id="textcolor4271">Node</span><span id="textcolor4272">)</span><span id="textcolor4273">:</span> 
<a 
 id="x12-264018r874"></a> 
<a 
 id="x12-264020r875"></a>   <span id="textcolor4274">def</span><span id="textcolor4275"> </span><span id="textcolor4276">__init__</span><span id="textcolor4277">(</span><span id="textcolor4278">self</span><span id="textcolor4279">)</span><span id="textcolor4280">:</span> 
<a 
 id="x12-264022r876"></a>      <span id="textcolor4281">super</span><span id="textcolor4282">(</span><span id="textcolor4283">)</span><span id="textcolor4284">.</span><span id="textcolor4285">__init__</span><span id="textcolor4286">(</span><span id="textcolor4287">&#x0027;</span><span id="textcolor4288">minimal_client_async</span><span id="textcolor4289">&#x0027;</span><span id="textcolor4290">)</span> 
<a 
 id="x12-264024r877"></a>      <span id="textcolor4291">self</span><span id="textcolor4292">.</span><span id="textcolor4293">cli</span> <span id="textcolor4294">=</span> <span id="textcolor4295">self</span><span id="textcolor4296">.</span><span id="textcolor4297">create_client</span><span id="textcolor4298">(</span><span id="textcolor4299">AddTwoInts</span><span id="textcolor4300">,</span> <span id="textcolor4301">&#x0027;</span><span id="textcolor4302">add_two_ints</span><span id="textcolor4303">&#x0027;</span><span id="textcolor4304">)</span> 
<a 
 id="x12-264026r878"></a>      <span id="textcolor4305">while</span> <span id="textcolor4306">not</span> <span id="textcolor4307">self</span><span id="textcolor4308">.</span><span id="textcolor4309">cli</span><span id="textcolor4310">.</span><span id="textcolor4311">wait_for_service</span><span id="textcolor4312">(</span><span id="textcolor4313">timeout_sec</span><span id="textcolor4314">=</span><span id="textcolor4315">1.0</span><span id="textcolor4316">)</span><span id="textcolor4317">:</span> 
<a 
 id="x12-264028r879"></a>         <span id="textcolor4318">self</span><span id="textcolor4319">.</span><span id="textcolor4320">get_logger</span><span id="textcolor4321">(</span><span id="textcolor4322">)</span><span id="textcolor4323">.</span><span id="textcolor4324">info</span><span id="textcolor4325">(</span><span id="textcolor4326">&#x0027;</span><span id="textcolor4327">service not available, waiting again...</span><span id="textcolor4328">&#x0027;</span><span id="textcolor4329">)</span> 
<a 
 id="x12-264030r880"></a>      <span id="textcolor4330">self</span><span id="textcolor4331">.</span><span id="textcolor4332">req</span> <span id="textcolor4333">=</span> <span id="textcolor4334">AddTwoInts</span><span id="textcolor4335">.</span><span id="textcolor4336">Request</span><span id="textcolor4337">(</span><span id="textcolor4338">)</span> 
<a 
 id="x12-264032r881"></a> 
<a 
 id="x12-264034r882"></a>   <span id="textcolor4339">def</span><span id="textcolor4340"> </span><span id="textcolor4341">send_request</span><span id="textcolor4342">(</span><span id="textcolor4343">self</span><span id="textcolor4344">,</span> <span id="textcolor4345">a</span><span id="textcolor4346">,</span> <span id="textcolor4347">b</span><span id="textcolor4348">)</span><span id="textcolor4349">:</span> 
<a 
 id="x12-264036r883"></a>      <span id="textcolor4350">self</span><span id="textcolor4351">.</span><span id="textcolor4352">req</span><span id="textcolor4353">.</span><span id="textcolor4354">a</span> <span id="textcolor4355">=</span> <span id="textcolor4356">a</span> 
<a 
 id="x12-264038r884"></a>      <span id="textcolor4357">self</span><span id="textcolor4358">.</span><span id="textcolor4359">req</span><span id="textcolor4360">.</span><span id="textcolor4361">b</span> <span id="textcolor4362">=</span> <span id="textcolor4363">b</span> 
<a 
 id="x12-264040r885"></a>      <span id="textcolor4364">return</span> <span id="textcolor4365">self</span><span id="textcolor4366">.</span><span id="textcolor4367">cli</span><span id="textcolor4368">.</span><span id="textcolor4369">call_async</span><span id="textcolor4370">(</span><span id="textcolor4371">self</span><span id="textcolor4372">.</span><span id="textcolor4373">req</span><span id="textcolor4374">)</span> 
<a 
 id="x12-264042r886"></a> 
<a 
 id="x12-264044r887"></a> 
<a 
 id="x12-264046r888"></a><span id="textcolor4375">def</span><span id="textcolor4376"> </span><span id="textcolor4377">main</span><span id="textcolor4378">(</span><span id="textcolor4379">)</span><span id="textcolor4380">:</span> 
<a 
 id="x12-264048r889"></a>   <span id="textcolor4381">rclpy</span><span id="textcolor4382">.</span><span id="textcolor4383">init</span><span id="textcolor4384">(</span><span id="textcolor4385">)</span> 
<a 
 id="x12-264050r890"></a> 
<a 
 id="x12-264052r891"></a>   <span id="textcolor4386">minimal_client</span> <span id="textcolor4387">=</span> <span id="textcolor4388">MinimalClientAsync</span><span id="textcolor4389">(</span><span id="textcolor4390">)</span> 
<a 
 id="x12-264054r892"></a>   <span id="textcolor4391">future</span> <span id="textcolor4392">=</span> <span id="textcolor4393">minimal_client</span><span id="textcolor4394">.</span><span id="textcolor4395">send_request</span><span id="textcolor4396">(</span><span id="textcolor4397">int</span><span id="textcolor4398">(</span><span id="textcolor4399">sys</span><span id="textcolor4400">.</span><span id="textcolor4401">argv</span><span id="textcolor4402">[</span><span id="textcolor4403">1</span><span id="textcolor4404">]</span><span id="textcolor4405">)</span><span id="textcolor4406">,</span> <span id="textcolor4407">int</span><span id="textcolor4408">(</span><span id="textcolor4409">sys</span><span id="textcolor4410">.</span><span id="textcolor4411">argv</span><span id="textcolor4412">[</span><span id="textcolor4413">2</span><span id="textcolor4414">]</span><span id="textcolor4415">)</span><span id="textcolor4416">)</span> 
<a 
 id="x12-264056r893"></a>   <span id="textcolor4417">rclpy</span><span id="textcolor4418">.</span><span id="textcolor4419">spin_until_future_complete</span><span id="textcolor4420">(</span><span id="textcolor4421">minimal_client</span><span id="textcolor4422">,</span> <span id="textcolor4423">future</span><span id="textcolor4424">)</span> 
<a 
 id="x12-264058r894"></a>   <span id="textcolor4425">response</span> <span id="textcolor4426">=</span> <span id="textcolor4427">future</span><span id="textcolor4428">.</span><span id="textcolor4429">result</span><span id="textcolor4430">(</span><span id="textcolor4431">)</span> 
<a 
 id="x12-264060r895"></a>   <span id="textcolor4432">minimal_client</span><span id="textcolor4433">.</span><span id="textcolor4434">get_logger</span><span id="textcolor4435">(</span><span id="textcolor4436">)</span><span id="textcolor4437">.</span><span id="textcolor4438">info</span><span id="textcolor4439">(</span> 
<a 
 id="x12-264062r896"></a>      <span id="textcolor4440">&#x0027;</span><span id="textcolor4441">Result of add_two_ints: for </span><span id="textcolor4442">%d</span><span id="textcolor4443"> + </span><span id="textcolor4444">%d</span><span id="textcolor4445"> = </span><span id="textcolor4446">%d</span><span id="textcolor4447">&#x0027;</span> <span id="textcolor4448">%</span> 
<a 
 id="x12-264064r897"></a>      <span id="textcolor4449">(</span><span id="textcolor4450">int</span><span id="textcolor4451">(</span><span id="textcolor4452">sys</span><span id="textcolor4453">.</span><span id="textcolor4454">argv</span><span id="textcolor4455">[</span><span id="textcolor4456">1</span><span id="textcolor4457">]</span><span id="textcolor4458">)</span><span id="textcolor4459">,</span> <span id="textcolor4460">int</span><span id="textcolor4461">(</span><span id="textcolor4462">sys</span><span id="textcolor4463">.</span><span id="textcolor4464">argv</span><span id="textcolor4465">[</span><span id="textcolor4466">2</span><span id="textcolor4467">]</span><span id="textcolor4468">)</span><span id="textcolor4469">,</span> <span id="textcolor4470">response</span><span id="textcolor4471">.</span><span id="textcolor4472">sum</span><span id="textcolor4473">)</span><span id="textcolor4474">)</span> 
<a 
 id="x12-264066r898"></a> 
<a 
 id="x12-264068r899"></a>   <span id="textcolor4475">minimal_client</span><span id="textcolor4476">.</span><span id="textcolor4477">destroy_node</span><span id="textcolor4478">(</span><span id="textcolor4479">)</span> 
<a 
 id="x12-264070r900"></a>   <span id="textcolor4480">rclpy</span><span id="textcolor4481">.</span><span id="textcolor4482">shutdown</span><span id="textcolor4483">(</span><span id="textcolor4484">)</span> 
<a 
 id="x12-264072r901"></a> 
<a 
 id="x12-264074r902"></a> 
<a 
 id="x12-264076r903"></a><span id="textcolor4485">if</span> <span id="textcolor4486">__name__</span> <span id="textcolor4487">==</span> <span id="textcolor4488">&#x0027;</span><span id="textcolor4489">__main__</span><span id="textcolor4490">&#x0027;</span><span id="textcolor4491">:</span> 
<a 
 id="x12-264078r904"></a>   <span id="textcolor4492">main</span><span id="textcolor4493">(</span><span id="textcolor4494">)</span></div></pre>
                                                                                
<a 
 id="paragraph*.115"></a>
<!--l. 674--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-265000"></a>Examining
the
Code</span>
As
with
the
service
code,
we
first
<span id="textcolor4495"><code class="verb">import</code></span>
the
necessary
libraries.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>            
<pre><div id="fancyvrb290" style='padding:20px;border-radius: 3px;'><a 
 id="x12-265002r911"></a><span id="textcolor4496">import</span><span id="textcolor4497"> </span><span id="textcolor4498">sys</span> 
<a 
 id="x12-265004r912"></a> 
<a 
 id="x12-265006r913"></a><span id="textcolor4499">from</span><span id="textcolor4500"> </span><span id="textcolor4501">example_interfaces</span><span id="textcolor4502">.</span><span id="textcolor4503">srv</span><span id="textcolor4504"> </span><span id="textcolor4505">import</span> <span id="textcolor4506">AddTwoInts</span> 
<a 
 id="x12-265008r914"></a><span id="textcolor4507">import</span><span id="textcolor4508"> </span><span id="textcolor4509">rclpy</span> 
<a 
 id="x12-265010r915"></a><span id="textcolor4510">from</span><span id="textcolor4511"> </span><span id="textcolor4512">rclpy</span><span id="textcolor4513">.</span><span id="textcolor4514">node</span><span id="textcolor4515"> </span><span id="textcolor4516">import</span> <span id="textcolor4517">Node</span></div></pre>
<!--l. 680--><p class="noindent" >The
<span id="textcolor4518"><code class="verb">MinimalClientAsync</code></span>
class
constructor
initializes
the
node
with
                                                                                
                                                                                
                                                                              
the
name
<span id="textcolor4519"><code class="verb">minimal_client_async</code></span>.
The
constructor
definition
creates
a
client
with
the
same
type
and
name
as
the
service
node.
The
type
and
name
must
match
for
the
client
and
service
to
be
able
to
communicate.
The
while
loop
in
the
constructor
checks
if
a
service
matching
the
type
and
name
of
the
client
is
available
once
a
second.
Finally
it
creates
a
new
<span id="textcolor4520"><code class="verb">AddTwoInts</code></span>
request
object.
</p>                                                                                
<!--l. 1--><p class="noindent" >
                                                                                
                                                                                

</p>
<pre><div id="fancyvrb291" style='padding:20px;border-radius: 3px;'><a 
 id="x12-265012r920"></a><span id="textcolor4521">def</span><span id="textcolor4522"> </span><span id="textcolor4523">__init__</span><span id="textcolor4524">(</span><span id="textcolor4525">self</span><span id="textcolor4526">)</span><span id="textcolor4527">:</span> 
<a 
 id="x12-265014r921"></a>   <span id="textcolor4528">super</span><span id="textcolor4529">(</span><span id="textcolor4530">)</span><span id="textcolor4531">.</span><span id="textcolor4532">__init__</span><span id="textcolor4533">(</span><span id="textcolor4534">&#x0027;</span><span id="textcolor4535">minimal_client_async</span><span id="textcolor4536">&#x0027;</span><span id="textcolor4537">)</span> 
<a 
 id="x12-265016r922"></a>   <span id="textcolor4538">self</span><span id="textcolor4539">.</span><span id="textcolor4540">cli</span> <span id="textcolor4541">=</span> <span id="textcolor4542">self</span><span id="textcolor4543">.</span><span id="textcolor4544">create_client</span><span id="textcolor4545">(</span><span id="textcolor4546">AddTwoInts</span><span id="textcolor4547">,</span> <span id="textcolor4548">&#x0027;</span><span id="textcolor4549">add_two_ints</span><span id="textcolor4550">&#x0027;</span><span id="textcolor4551">)</span> 
<a 
 id="x12-265018r923"></a>   <span id="textcolor4552">while</span> <span id="textcolor4553">not</span> <span id="textcolor4554">self</span><span id="textcolor4555">.</span><span id="textcolor4556">cli</span><span id="textcolor4557">.</span><span id="textcolor4558">wait_for_service</span><span id="textcolor4559">(</span><span id="textcolor4560">timeout_sec</span><span id="textcolor4561">=</span><span id="textcolor4562">1.0</span><span id="textcolor4563">)</span><span id="textcolor4564">:</span> 
<a 
 id="x12-265020r924"></a>      <span id="textcolor4565">self</span><span id="textcolor4566">.</span><span id="textcolor4567">get_logger</span><span id="textcolor4568">(</span><span id="textcolor4569">)</span><span id="textcolor4570">.</span><span id="textcolor4571">info</span><span id="textcolor4572">(</span><span id="textcolor4573">&#x0027;</span><span id="textcolor4574">service not available, waiting again...</span><span id="textcolor4575">&#x0027;</span><span id="textcolor4576">)</span> 
<a 
 id="x12-265022r925"></a>   <span id="textcolor4577">self</span><span id="textcolor4578">.</span><span id="textcolor4579">req</span> <span id="textcolor4580">=</span> <span id="textcolor4581">AddTwoInts</span><span id="textcolor4582">.</span><span id="textcolor4583">Request</span><span id="textcolor4584">(</span><span id="textcolor4585">)</span></div></pre>
<!--l. 689--><p class="noindent" >Below
the
constructor
is
the
<span id="textcolor4586"><code class="verb">send_request</code></span>
method,
which
will
send
the
request
and
spin
until
it
receives
the
response
or
fails.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>    
<pre><div id="fancyvrb292" style='padding:20px;border-radius: 3px;'><a 
 id="x12-265024r930"></a><span id="textcolor4587">def</span><span id="textcolor4588"> </span><span id="textcolor4589">send_request</span><span id="textcolor4590">(</span><span id="textcolor4591">self</span><span id="textcolor4592">,</span> <span id="textcolor4593">a</span><span id="textcolor4594">,</span> <span id="textcolor4595">b</span><span id="textcolor4596">)</span><span id="textcolor4597">:</span> 
<a 
 id="x12-265026r931"></a>    <span id="textcolor4598">self</span><span id="textcolor4599">.</span><span id="textcolor4600">req</span><span id="textcolor4601">.</span><span id="textcolor4602">a</span> <span id="textcolor4603">=</span> <span id="textcolor4604">a</span> 
<a 
 id="x12-265028r932"></a>    <span id="textcolor4605">self</span><span id="textcolor4606">.</span><span id="textcolor4607">req</span><span id="textcolor4608">.</span><span id="textcolor4609">b</span> <span id="textcolor4610">=</span> <span id="textcolor4611">b</span> 
<a 
 id="x12-265030r933"></a>    <span id="textcolor4612">return</span> <span id="textcolor4613">self</span><span id="textcolor4614">.</span><span id="textcolor4615">cli</span><span id="textcolor4616">.</span><span id="textcolor4617">call_async</span><span id="textcolor4618">(</span><span id="textcolor4619">self</span><span id="textcolor4620">.</span><span id="textcolor4621">req</span><span id="textcolor4622">)</span></div></pre>
<!--l. 694--><p class="noindent" >Finally
we
have
the
<span id="textcolor4623"><code class="verb">main</code></span>
method,
which
constructs
a
<span id="textcolor4624"><code class="verb">MinimalClientAsync</code></span>
object,
sends
the
request
using
the
passed-in
command-line
arguments,
calls
<span id="textcolor4625"><code class="verb">rclpy.spin_until_future_complete</code></span>
to
wait
for
the
result,
and
logs
the
results.
                                                                                
<a 
 id="paragraph*.116"></a></p>
<!--l. 698--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-266000"></a>Adding
an
Entry
Point</span>
                                                                                
                                                                                
                                                                           
Similar
to
the
service
node,
we
also
have
to
add
an
<alert style="color: #821131;">entry
point</alert>
to
be
able
to
run
the
client
node
from
the
command-line.
The
<span id="textcolor4626"><code class="verb">entry_points</code></span>
field
of
our
<span id="textcolor4627"><code class="verb">setup.py</code></span>
file
should
look
like
this:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb293" style='padding:20px;border-radius: 3px;'><a 
 id="x12-266002r957"></a><span id="textcolor4628">entry_points</span><span id="textcolor4629">=</span><span id="textcolor4630">{</span> 
<a 
 id="x12-266004r958"></a>   <span id="textcolor4631">&#x0027;</span><span id="textcolor4632">console_scripts</span><span id="textcolor4633">&#x0027;</span><span id="textcolor4634">:</span> <span id="textcolor4635">[</span> 
<a 
 id="x12-266006r959"></a>      <span id="textcolor4636">&#x0027;</span><span id="textcolor4637">service = py_srvcli.service_member_function:main</span><span id="textcolor4638">&#x0027;</span><span id="textcolor4639">,</span> 
<a 
 id="x12-266008r960"></a>      <span id="textcolor4640">&#x0027;</span><span id="textcolor4641">client = py_srvcli.client_member_function:main</span><span id="textcolor4642">&#x0027;</span><span id="textcolor4643">,</span> 
<a 
 id="x12-266010r961"></a>   <span id="textcolor4644">]</span><span id="textcolor4645">,</span> 
<a 
 id="x12-266012r962"></a><span id="textcolor4646">}</span><span id="textcolor4647">,</span></div></pre>
<div class="knowledge">                                                                             
<!--l. 709--><p class="noindent" >It’s
good
practice
to
run
<span id="textcolor4648"><code class="verb">rosdep</code></span>
in
the
root
of
our
workspace
(<span id="textcolor4649"><code class="verb">ros2\_ws</code></span>
)
to
check
for
missing
dependencies
before
building:
</p>                                                                                
</div>
<!--l. 1--><p class="noindent" >

</p>                                        
<pre><div id="fancyvrb294" style='padding:20px;border-radius: 3px;'><a 
 id="x12-266014r969"></a><span id="textcolor4650">rosdep</span> <span id="textcolor4651">install</span> <span id="textcolor4652">-</span><span id="textcolor4653">i</span> <span id="textcolor4654">-</span><span id="textcolor4655">-</span><span id="textcolor4656">from</span><span id="textcolor4657">-</span><span id="textcolor4658">path</span> <span id="textcolor4659">src</span> <span id="textcolor4660">-</span><span id="textcolor4661">-</span><span id="textcolor4662">rosdistro</span> <span id="textcolor4663">humble</span> <span id="textcolor4664">-</span><span id="textcolor4665">y</span></div></pre>
                                                                                
                                                                                
                                                                          
<!--l. 713--><p class="noindent" >Navigate
back
to
the
root
of
our
workspace,
<span id="textcolor4666"><code class="verb">ros2\_ws</code></span>
,
and
build
our
new
package:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                   
<pre><div id="fancyvrb295" style='padding:20px;border-radius: 3px;'><a 
 id="x12-266016r974"></a><span id="textcolor4667">colcon</span> <span id="textcolor4668">build</span> <span id="textcolor4669">-</span><span id="textcolor4670">-</span><span id="textcolor4671">packages</span><span id="textcolor4672">-</span><span id="textcolor4673">select</span> <span id="textcolor4674">py_srvcli</span></div></pre>
<!--l. 717--><p class="noindent" >Open
a
new
terminal,
navigate
to
<span id="textcolor4675"><code class="verb">ros2\_ws</code></span>
,
and
source
the
setup
files:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                              
<pre><div id="fancyvrb296" style='padding:20px;border-radius: 3px;'><a 
 id="x12-266018r979"></a><span id="textcolor4676">source</span> <span id="textcolor4677">install</span><span id="textcolor4678">/</span><span id="textcolor4679">setup</span><span id="textcolor4680">.</span><span id="textcolor4681">bash</span></div></pre>
<!--l. 721--><p class="noindent" >Now
run
the
service
node:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                             
<pre><div id="fancyvrb297" style='padding:20px;border-radius: 3px;'><a 
 id="x12-266020r984"></a><span id="textcolor4682">ros2</span> <span id="textcolor4683">run</span> <span id="textcolor4684">py_srvcli</span> <span id="textcolor4685">service</span></div></pre>
<!--l. 725--><p class="noindent" >The
node
will
wait
for
the
client’s
request.
</p>                                                                            
<!--l. 727--><p class="noindent" >Open
another
terminal
and
source
the
setup
files
from
inside
<span id="textcolor4686"><code class="verb">ros2\_ws</code></span>
again.
                                                                                
                                                                                
                                                                            
Start
the
client
node,
followed
by
any
two
integers
separated
by
a
space.
If
we
chose
2
and
3,
for
example,
the
client
would
receive
a
response
like
this:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                           
<pre><div id="fancyvrb298" style='padding:20px;border-radius: 3px;'><a 
 id="x12-266022r989"></a><span id="textcolor4687">ros2</span> <span id="textcolor4688">run</span> <span id="textcolor4689">py_srvcli</span> <span id="textcolor4690">client</span> <span id="textcolor4691">2</span> <span id="textcolor4692">3</span></div></pre>
<div class="tcolorbox tcolorbox" id="tcolobox-104">                                                                                

                                                                                

 
<div class="tcolorbox-content"><pre><div id="fancyvrb299" style='padding:20px;border-radius: 3px;'><a 
 id="x12-266024r1"></a>[INFO] [minimal_client_async]: Result of add_two_ints: for 2 + 3 = 5</div></pre>
 
</div> 
</div>                                                                      
<!--l. 734--><p class="noindent" >Return
to
the
terminal
where
our
service
node
is
running.
We
will
see
that
it
published
log
messages
when
it
received
the
request:
</p>                                                                                
<div class="tcolorbox tcolorbox" id="tcolobox-105">
                                                                                

                                                                                
                                                                                
                                                                                

 
<div class="tcolorbox-content">
<pre><div id="fancyvrb300" style='padding:20px;border-radius: 3px;'><a 
 id="x12-266026r1"></a>[INFO] [minimal_service]: Incoming request 
<a 
 id="x12-266028r2"></a>a: 2 b: 3</div></pre>
 
</div> 
</div>
                                                                                
                                                                                
                                                                                
<!--l. 739--><p class="noindent" >
</p>                                                                      
<h3 class="sectionHead"><span class="titlemark">10.6</span>  <a 
 id="x12-26700010.6"></a>Creating
Custom
msg
and
srv
Files</h3>
<!--l. 741--><p class="noindent" >Previously,
we
utilised
message
and
service
interfaces
to
learn
about:
</p>     
<ul class="itemize1">
<li class="itemize">     
<!--l. 744--><p class="noindent" >topics.
</p>     
</li>
<li class="itemize">     
<!--l. 745--><p class="noindent" >services,
</p>     
</li>
<li class="itemize">     
<!--l. 746--><p class="noindent" >simple
publisher/subscriber,
and
</p>     
</li>
<li class="itemize">     
<!--l. 747--><p class="noindent" >service/client
nodes.</p></li></ul>                                                                       
<div class="warning">
<!--l. 752--><p class="noindent" >It
is
worth
noting,
the
interfaces
we
used
previously
were
predefined
in
those
cases.
</p>                                                                                
</div>
                                                                                
                                                                                
                                                                            
<!--l. 754--><p class="noindent" >While
it’s
good
practice
to
use
predefined
interface
definitions,
time
will
eventually
come,
where
we
will
need
to
define
our
own
messages
and
services
sometimes
as
well.
Here,
we
will
have
a
look
at
the
simplest
method
of
creating
custom
interface
definitions.
                                                                                
<a 
 id="paragraph*.117"></a></p>
<!--l. 758--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-268000"></a>Creating
a
New
Package</span>
Here,
we
will
be
creating
our
custom
<span id="textcolor4697"><code class="verb">.msg</code></span>
and
<span id="textcolor4698"><code class="verb">.srv</code></span>
files
in
their
own
package,
and
then
                                                                                
                                                                                
                                                                          
utilising
them
in
a
separate
package.
</p>                                                                                
<div class="warning">
<!--l. 765--><p class="noindent" >It
is
worth
stressing,
that
both
packages
should
be
in
the
same
workspace.
</p>                                                                                
</div>
<!--l. 767--><p class="noindent" >As
we
will
use
the
pub/sub
and
service/client
packages
we
created
previously,
make
sure
we
are
in
the
same
workspace
as
those
packages
(<span id="textcolor4699"><code class="verb">ros2_ws/src</code></span>),
and
then
run
the
following
command
to
create
a
new
package:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                     
<pre><div id="fancyvrb301" style='padding:20px;border-radius: 3px;'><a 
 id="x12-268002r431"></a>ros2<span id="textcolor4700"> </span>pkg<span id="textcolor4701"> </span>create<span id="textcolor4702"> </span>--build-type<span id="textcolor4703"> </span>ament_cmake<span id="textcolor4704"> </span>--license<span id="textcolor4705"> </span>Apache-2.0<span id="textcolor4706"> </span>tutorial_interfaces</div></pre>
<!--l. 773--><p class="noindent" ><span id="textcolor4707"><code class="verb">tutorial_interfaces</code></span>
is
the
<alert style="color: #821131;">name
of
                                                                                
                                                                                
the
new
package</alert>.
Note
that
it
is,
and
can
only
be,
an
<span id="textcolor4708"><code class="verb">ament_cmake</code></span>
package,<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">15 </sup></span></alert>
<span class="marginnote">
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">15</sup></span></alert><span id="textcolor4709">It
is
basically
a
build
system
for
CMake
based
packages
in
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>.
It
is
a
set
of
scripts
enhancing
CMake
and
adding
convenience
functionality
for
package
authors.</span></span>
but
this
doesn’t
restrict
in
which
type
of
packages
we
can
use
our
messages
and
services.
We
can
create
our
own
custom
interfaces
in
an
                                                                                
                                                                                
<span id="textcolor4710"><code class="verb">ament_cmake</code></span>
package,
and
then
use
it
in
a
C++
or
Python
node,
which
will
be
covered
later.
</p><!--l. 781--><p class="noindent" >The
<span id="textcolor4711"><code class="verb">.msg</code></span>
and
<span id="textcolor4712"><code class="verb">.srv</code></span>
files
are
required
to
be
placed
in
directories
called
<span id="textcolor4713"><code class="verb">msg</code></span>
and
<span id="textcolor4714"><code class="verb">srv</code></span>
respectively.
</p><!--l. 784--><p class="noindent" >We
can
create
the
directories
in
<span id="textcolor4715"><code class="verb">[</code></span>
/]ros2_ws/src/tutorial_interfaces
using:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb302" style='padding:20px;border-radius: 3px;'><a 
 id="x12-268004r436"></a>mkdir<span id="textcolor4716"> </span>msg<span id="textcolor4717"> </span>srv</div></pre>

<h4 class="subsectionHead"><span class="titlemark">10.6.1</span>  <a 
 id="x12-26900010.6.1"></a>Creating  Custom  Definitions</h4>

<a 
 id="paragraph*.118"></a>
<!--l. 790--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-270000"></a>msg  Definition</span>
In the <span id="textcolor4718"><code class="verb">[</code></span> /]tutorial_interfaces/msg directory we just created, make a new file called <span id="textcolor4719"><code class="verb">Num.msg</code></span> with one line of code declaring its data structure:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb303" style='padding:20px;border-radius: 3px;'><a 
 id="x12-270002r441"></a>int64 num</div></pre>
<!--l. 797--><p class="noindent" >This is a <span id="bold" style="font-weight:bold;">custom message</span> which transfers a single 64-bit integer called <span id="textcolor4720"><code class="verb">num</code></span>.
</p><!--l. 799--><p class="noindent" >In addition, in the <span id="textcolor4721"><code class="verb">tutorial\_interfaces/msg</code></span> directory we’ve just created, make a new file called <span id="textcolor4722"><code class="verb">Sphere.msg</code></span> with the following content:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb304" style='padding:20px;border-radius: 3px;'><a 
 id="x12-270004r446"></a>geometry_msgs/Point<span id="textcolor4723"> </span>center 
<a 
 id="x12-270006r447"></a>float64<span id="textcolor4724"> </span>radius</div></pre>
                                                                                
                                                                                
<!--l. 804--><p class="noindent" >This custom message uses a message from another message package. As we can see from the first line in the message, it is <span id="textcolor4725"><code class="verb">geometry_msgs/Point</code></span>.

<a 
 id="paragraph*.119"></a></p>
<!--l. 807--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-271000"></a>srv  Definition</span>
Let’s go back in the <span id="textcolor4726"><code class="verb">tutorial_interfaces/srv</code></span> directory we’ve just created a few moment ago
and make a new file called <span id="textcolor4727"><code class="verb">AddThreeInts.srv</code></span> with the following request and response structure:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb305" style='padding:20px;border-radius: 3px;'><a 
 id="x12-271002r453"></a>int64<span id="textcolor4728"> </span>a 
<a 
 id="x12-271004r454"></a>int64<span id="textcolor4729"> </span>b 
<a 
 id="x12-271006r455"></a>int64<span id="textcolor4730"> </span>c 
<a 
 id="x12-271008r456"></a>--- 
<a 
 id="x12-271010r457"></a>int64<span id="textcolor4731"> </span>sum</div></pre>
<!--l. 815--><p class="noindent" >This is our custom service which requests three (<alert style="color: #821131;">3</alert>) integers aptly named <span id="textcolor4732"><code class="verb">a</code></span>, <span id="textcolor4733"><code class="verb">b</code></span>, and <span id="textcolor4734"><code class="verb">c</code></span>, and responds with an integer called <span id="textcolor4735"><code class="verb">sum</code></span>.

<a 
 id="paragraph*.120"></a></p>
<!--l. 818--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-272000"></a>CMakeLists</span>
To
convert
the
interfaces
we
defined
into
language-specific
code<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">16 </sup></span></alert>
<span class="marginnote">
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">16</sup></span></alert><span id="textcolor4736">This
can
be
either
C++
or
Python.</span></span>
so
that
they
can
be
used
in
those
languages,
let’s
add
the
following
lines
to
our
<span id="textcolor4737"><code class="verb">CMakeLists.txt</code></span>:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb306" style='padding:20px;border-radius: 3px;'><a 
 id="x12-272002r462"></a><span id="textcolor4738">find_package</span><span id="textcolor4739">(</span><span id="textcolor4740">geometry_msgs</span><span id="textcolor4741"> </span><span id="textcolor4742">REQUIRED</span><span id="textcolor4743">)</span> 
<a 
 id="x12-272004r463"></a><span id="textcolor4744">find_package</span><span id="textcolor4745">(</span><span id="textcolor4746">rosidl_default_generators</span><span id="textcolor4747"> </span><span id="textcolor4748">REQUIRED</span><span id="textcolor4749">)</span> 
<a 
 id="x12-272006r464"></a> 
<a 
 id="x12-272008r465"></a><span id="textcolor4750">rosidl_generate_interfaces</span><span id="textcolor4751">(</span><span id="textcolor4752">${</span><span id="textcolor4753">PROJECT_NAME</span><span id="textcolor4754">}</span> 
<a 
 id="x12-272010r466"></a><span id="textcolor4755"> </span><span id="textcolor4756">"msg/Num.msg"</span> 
<a 
 id="x12-272012r467"></a><span id="textcolor4757"> </span><span id="textcolor4758">"msg/Sphere.msg"</span> 
<a 
 id="x12-272014r468"></a><span id="textcolor4759"> </span><span id="textcolor4760">"srv/AddThreeInts.srv"</span> 
<a 
 id="x12-272016r469"></a><span id="textcolor4761"> </span><span id="textcolor4762">DEPENDENCIES</span><span id="textcolor4763"> </span><span id="textcolor4764">geometry_msgs</span><span id="textcolor4765"> </span><span id="textcolor4766"># Add packages that above messages</span> 
<a 
 id="x12-272018r470"></a><span id="textcolor4767"> </span><span id="textcolor4768">#depend on, in this case geometry_msgs for Sphere.msg</span> 
<a 
 id="x12-272020r471"></a><span id="textcolor4769">)</span></div></pre>
<div class="warning">
<!--l. 830--><p class="noindent" >The first argument (library name) in the <span id="textcolor4770"><code class="verb">rosidl_generate_interfaces</code></span> must start with
the name of the package, e.g., simply <span id="textcolor4771"><code class="verb">${PROJECT_NAME}</code></span> or <span id="textcolor4772"><code class="verb">${PROJECT_NAME}_suffix</code></span>. </p></div>

<a 
 id="paragraph*.121"></a>
<!--l. 832--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-273000"></a>Package.xml</span>
Because the interfaces rely on <span id="textcolor4773"><code class="verb">rosidl_default_generators</code></span> for generating language-specific code, we need to declare a build tool
dependency on it. <span id="textcolor4774"><code class="verb">rosidl_default_runtime</code></span> is a runtime or execution-stage dependency, needed to be able to use the interfaces later.
</p><!--l. 839--><p class="noindent" >The <span id="textcolor4775"><code class="verb">rosidl_interface_packages</code></span> is the name of the dependency group which our package,
<span id="textcolor4776"><code class="verb">tutorial_interfaces</code></span>, should be associated with, declared using the <span id="textcolor4777"><code class="verb">&lt;member_of_group&gt;</code></span> tag.
</p><!--l. 843--><p class="noindent" >Add the following lines within the <span id="textcolor4778"><code class="verb">&lt;package&gt;</code></span> element of <span id="textcolor4779"><code class="verb">package.xml</code></span>:
</p><!--l. 1--><p class="noindent" >
                                                                                
                                                                                

</p>
<pre><div id="fancyvrb307" style='padding:20px;border-radius: 3px;'><a 
 id="x12-273002r476"></a><span id="textcolor4780">&lt;depend</span><span id="textcolor4781">&gt;</span>geometry_msgs<span id="textcolor4782">&lt;/depend&gt;</span> 
<a 
 id="x12-273004r477"></a><span id="textcolor4783">&lt;buildtool_depend</span><span id="textcolor4784">&gt;</span>rosidl_default_generators<span id="textcolor4785">&lt;/buildtool_depend&gt;</span> 
<a 
 id="x12-273006r478"></a><span id="textcolor4786">&lt;exec_depend</span><span id="textcolor4787">&gt;</span>rosidl_default_runtime<span id="textcolor4788">&lt;/exec_depend&gt;</span> 
<a 
 id="x12-273008r479"></a><span id="textcolor4789">&lt;member_of_group</span><span id="textcolor4790">&gt;</span>rosidl_interface_packages<span id="textcolor4791">&lt;/member_of_group&gt;</span></div></pre>
<!--l. 847--><p class="noindent" >Please pay attention to the last line where we have added the new tag.

<a 
 id="paragraph*.122"></a></p>
<!--l. 849--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-274000"></a>Building  the  Package</span>
Now that all the parts of our custom interfaces package are in place, we can finally build
the package. In the root of our workspace (<span id="textcolor4792"><code class="verb">~/ros2_ws</code></span>), please run the following command:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb308" style='padding:20px;border-radius: 3px;'><a 
 id="x12-274002r484"></a>colcon<span id="textcolor4793"> </span>build<span id="textcolor4794"> </span>--packages-select<span id="textcolor4795"> </span>tutorial_interfaces</div></pre>
<!--l. 856--><p class="noindent" >Now the interfaces will be discoverable by other <a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a> packages.

<a 
 id="paragraph*.123"></a></p>
<!--l. 858--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-275000"></a>Confirming  the  Creation</span>
In a new terminal, let’s run the following command from within our workspace (<span id="textcolor4796"><code class="verb">ros2\_ws</code></span> ) to source it if it is required:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb309" style='padding:20px;border-radius: 3px;'><a 
 id="x12-275002r489"></a><span id="textcolor4797">source</span><span id="textcolor4798"> </span>install/setup.bash</div></pre>
<!--l. 865--><p class="noindent" >Now we can confirm our interface creation has worked by using the <span id="textcolor4799"><code class="verb">ros2 interface show</code></span>
command. The output we see in our terminal should look similar to the following:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb310" style='padding:20px;border-radius: 3px;'><a 
 id="x12-275004r494"></a>ros2<span id="textcolor4800"> </span>interface<span id="textcolor4801"> </span>show<span id="textcolor4802"> </span>tutorial_interfaces/msg/Num</div></pre>
<div class="tcolorbox tcolorbox" id="tcolobox-106">     
<div class="tcolorbox-content"><pre><div id="fancyvrb311" style='padding:20px;border-radius: 3px;'><a 
 id="x12-275006r1"></a>int64 num</div></pre>
 
</div> 
</div>
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb312" style='padding:20px;border-radius: 3px;'><a 
 id="x12-275008r504"></a>ros2<span id="textcolor4803"> </span>interface<span id="textcolor4804"> </span>show<span id="textcolor4805"> </span>tutorial_interfaces/msg/Sphere</div></pre>
<div class="tcolorbox tcolorbox" id="tcolobox-107">     
<div class="tcolorbox-content"><pre><div id="fancyvrb313" style='padding:20px;border-radius: 3px;'><a 
 id="x12-275010r1"></a>geometry_msgs/Point center 
<a 
 id="x12-275012r2"></a>        float64 x 
<a 
 id="x12-275014r3"></a>        float64 y 
<a 
 id="x12-275016r4"></a>        float64 z 
<a 
 id="x12-275018r5"></a>float64 radius</div></pre>
 
</div> 
</div>
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb314" style='padding:20px;border-radius: 3px;'><a 
 id="x12-275020r518"></a>ros2<span id="textcolor4806"> </span>interface<span id="textcolor4807"> </span>show<span id="textcolor4808"> </span>tutorial_interfaces/srv/AddThreeInts</div></pre>
<div class="tcolorbox tcolorbox" id="tcolobox-108">     
<div class="tcolorbox-content"><pre><div id="fancyvrb315" style='padding:20px;border-radius: 3px;'><a 
 id="x12-275022r1"></a>int64 a 
<a 
 id="x12-275024r2"></a>int64 b 
<a 
 id="x12-275026r3"></a>int64 c 
<a 
 id="x12-275028r4"></a>--- 
<a 
 id="x12-275030r5"></a>int64 sum</div></pre>
 
</div> 
</div>

<h4 class="subsectionHead"><span class="titlemark">10.6.2</span>  <a 
 id="x12-27600010.6.2"></a>Testing  the  Newly  Built  Interfaces</h4>
<!--l. 880--><p class="noindent" >Time to see our new interface in actiony. A few simple modifications to the nodes, <span id="textcolor4809"><code class="verb">CMakeLists.txt</code></span> and <span id="textcolor4810"><code class="verb">package.xml</code></span> files will allow we to use our new interfaces.

</p>
<h5 class="likesubsubsectionHead"><a 
 id="x12-277000"></a>Publisher  and  Subscriber  System:  Publisher  Code</h5>
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb316" style='padding:20px;border-radius: 3px;'><a 
 id="x12-277002r536"></a><span id="textcolor4811">import</span><span id="textcolor4812"> </span><span id="textcolor4813">rclpy</span> 
<a 
 id="x12-277004r537"></a><span id="textcolor4814">from</span><span id="textcolor4815"> </span><span id="textcolor4816">rclpy</span><span id="textcolor4817">.</span><span id="textcolor4818">node</span><span id="textcolor4819"> </span><span id="textcolor4820">import</span> <span id="textcolor4821">Node</span> 
<a 
 id="x12-277006r538"></a> 
<a 
 id="x12-277008r539"></a><span id="textcolor4822">from</span><span id="textcolor4823"> </span><span id="textcolor4824">tutorial_interfaces</span><span id="textcolor4825">.</span><span id="textcolor4826">msg</span><span id="textcolor4827"> </span><span id="textcolor4828">import</span> <span id="textcolor4829">Num</span>                            <span id="textcolor4830"># CHANGE</span> 
<a 
 id="x12-277010r540"></a> 
<a 
 id="x12-277012r541"></a> 
<a 
 id="x12-277014r542"></a><span id="textcolor4831">class</span><span id="textcolor4832"> </span><span id="textcolor4833">MinimalPublisher</span><span id="textcolor4834">(</span><span id="textcolor4835">Node</span><span id="textcolor4836">)</span><span id="textcolor4837">:</span> 
<a 
 id="x12-277016r543"></a> 
<a 
 id="x12-277018r544"></a>   <span id="textcolor4838">def</span><span id="textcolor4839"> </span><span id="textcolor4840">__init__</span><span id="textcolor4841">(</span><span id="textcolor4842">self</span><span id="textcolor4843">)</span><span id="textcolor4844">:</span> 
<a 
 id="x12-277020r545"></a>      <span id="textcolor4845">super</span><span id="textcolor4846">(</span><span id="textcolor4847">)</span><span id="textcolor4848">.</span><span id="textcolor4849">__init__</span><span id="textcolor4850">(</span><span id="textcolor4851">&#x0027;</span><span id="textcolor4852">minimal_publisher</span><span id="textcolor4853">&#x0027;</span><span id="textcolor4854">)</span> 
<a 
 id="x12-277022r546"></a>      <span id="textcolor4855">self</span><span id="textcolor4856">.</span><span id="textcolor4857">publisher_</span> <span id="textcolor4858">=</span> <span id="textcolor4859">self</span><span id="textcolor4860">.</span><span id="textcolor4861">create_publisher</span><span id="textcolor4862">(</span><span id="textcolor4863">Num</span><span id="textcolor4864">,</span> <span id="textcolor4865">&#x0027;</span><span id="textcolor4866">topic</span><span id="textcolor4867">&#x0027;</span><span id="textcolor4868">,</span> <span id="textcolor4869">10</span><span id="textcolor4870">)</span>  <span id="textcolor4871"># CHANGE</span> 
<a 
 id="x12-277024r547"></a>      <span id="textcolor4872">timer_period</span> <span id="textcolor4873">=</span> <span id="textcolor4874">0.5</span> 
<a 
 id="x12-277026r548"></a>      <span id="textcolor4875">self</span><span id="textcolor4876">.</span><span id="textcolor4877">timer</span> <span id="textcolor4878">=</span> <span id="textcolor4879">self</span><span id="textcolor4880">.</span><span id="textcolor4881">create_timer</span><span id="textcolor4882">(</span><span id="textcolor4883">timer_period</span><span id="textcolor4884">,</span> <span id="textcolor4885">self</span><span id="textcolor4886">.</span><span id="textcolor4887">timer_callback</span><span id="textcolor4888">)</span> 
<a 
 id="x12-277028r549"></a>      <span id="textcolor4889">self</span><span id="textcolor4890">.</span><span id="textcolor4891">i</span> <span id="textcolor4892">=</span> <span id="textcolor4893">0</span> 
<a 
 id="x12-277030r550"></a> 
<a 
 id="x12-277032r551"></a>   <span id="textcolor4894">def</span><span id="textcolor4895"> </span><span id="textcolor4896">timer_callback</span><span id="textcolor4897">(</span><span id="textcolor4898">self</span><span id="textcolor4899">)</span><span id="textcolor4900">:</span> 
<a 
 id="x12-277034r552"></a>      <span id="textcolor4901">msg</span> <span id="textcolor4902">=</span> <span id="textcolor4903">Num</span><span id="textcolor4904">(</span><span id="textcolor4905">)</span>                                                <span id="textcolor4906"># CHANGE</span> 
<a 
 id="x12-277036r553"></a>      <span id="textcolor4907">msg</span><span id="textcolor4908">.</span><span id="textcolor4909">num</span> <span id="textcolor4910">=</span> <span id="textcolor4911">self</span><span id="textcolor4912">.</span><span id="textcolor4913">i</span>                                           <span id="textcolor4914"># CHANGE</span> 
<a 
 id="x12-277038r554"></a>      <span id="textcolor4915">self</span><span id="textcolor4916">.</span><span id="textcolor4917">publisher_</span><span id="textcolor4918">.</span><span id="textcolor4919">publish</span><span id="textcolor4920">(</span><span id="textcolor4921">msg</span><span id="textcolor4922">)</span> 
<a 
 id="x12-277040r555"></a>      <span id="textcolor4923">self</span><span id="textcolor4924">.</span><span id="textcolor4925">get_logger</span><span id="textcolor4926">(</span><span id="textcolor4927">)</span><span id="textcolor4928">.</span><span id="textcolor4929">info</span><span id="textcolor4930">(</span><span id="textcolor4931">&#x0027;</span><span id="textcolor4932">Publishing: </span><span id="textcolor4933">"</span><span id="textcolor4934">%d</span><span id="textcolor4935">"</span><span id="textcolor4936">&#x0027;</span> <span id="textcolor4937">%</span> <span id="textcolor4938">msg</span><span id="textcolor4939">.</span><span id="textcolor4940">num</span><span id="textcolor4941">)</span>       <span id="textcolor4942"># CHANGE</span> 
<a 
 id="x12-277042r556"></a>      <span id="textcolor4943">self</span><span id="textcolor4944">.</span><span id="textcolor4945">i</span> <span id="textcolor4946">+</span><span id="textcolor4947">=</span> <span id="textcolor4948">1</span> 
<a 
 id="x12-277044r557"></a> 
<a 
 id="x12-277046r558"></a> 
<a 
 id="x12-277048r559"></a><span id="textcolor4949">def</span><span id="textcolor4950"> </span><span id="textcolor4951">main</span><span id="textcolor4952">(</span><span id="textcolor4953">args</span><span id="textcolor4954">=</span><span id="textcolor4955">None</span><span id="textcolor4956">)</span><span id="textcolor4957">:</span> 
<a 
 id="x12-277050r560"></a>   <span id="textcolor4958">rclpy</span><span id="textcolor4959">.</span><span id="textcolor4960">init</span><span id="textcolor4961">(</span><span id="textcolor4962">args</span><span id="textcolor4963">=</span><span id="textcolor4964">args</span><span id="textcolor4965">)</span> 
<a 
 id="x12-277052r561"></a> 
<a 
 id="x12-277054r562"></a>   <span id="textcolor4966">minimal_publisher</span> <span id="textcolor4967">=</span> <span id="textcolor4968">MinimalPublisher</span><span id="textcolor4969">(</span><span id="textcolor4970">)</span> 
<a 
 id="x12-277056r563"></a> 
<a 
 id="x12-277058r564"></a>   <span id="textcolor4971">rclpy</span><span id="textcolor4972">.</span><span id="textcolor4973">spin</span><span id="textcolor4974">(</span><span id="textcolor4975">minimal_publisher</span><span id="textcolor4976">)</span> 
<a 
 id="x12-277060r565"></a> 
<a 
 id="x12-277062r566"></a>   <span id="textcolor4977">minimal_publisher</span><span id="textcolor4978">.</span><span id="textcolor4979">destroy_node</span><span id="textcolor4980">(</span><span id="textcolor4981">)</span> 
<a 
 id="x12-277064r567"></a>   <span id="textcolor4982">rclpy</span><span id="textcolor4983">.</span><span id="textcolor4984">shutdown</span><span id="textcolor4985">(</span><span id="textcolor4986">)</span> 
<a 
 id="x12-277066r568"></a> 
<a 
 id="x12-277068r569"></a> 
<a 
 id="x12-277070r570"></a><span id="textcolor4987">if</span> <span id="textcolor4988">__name__</span> <span id="textcolor4989">==</span> <span id="textcolor4990">&#x0027;</span><span id="textcolor4991">__main__</span><span id="textcolor4992">&#x0027;</span><span id="textcolor4993">:</span> 
<a 
 id="x12-277072r571"></a>   <span id="textcolor4994">main</span><span id="textcolor4995">(</span><span id="textcolor4996">)</span></div></pre>

                                                                                
                                                                                
<h5 class="likesubsubsectionHead"><a 
 id="x12-278000"></a>Publisher  and  Subscriber  System:  Subscriber  Code</h5>
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb317" style='padding:20px;border-radius: 3px;'><a 
 id="x12-278002r576"></a><span id="textcolor4997">import</span><span id="textcolor4998"> </span><span id="textcolor4999">rclpy</span> 
<a 
 id="x12-278004r577"></a><span id="textcolor5000">from</span><span id="textcolor5001"> </span><span id="textcolor5002">rclpy</span><span id="textcolor5003">.</span><span id="textcolor5004">node</span><span id="textcolor5005"> </span><span id="textcolor5006">import</span> <span id="textcolor5007">Node</span> 
<a 
 id="x12-278006r578"></a> 
<a 
 id="x12-278008r579"></a><span id="textcolor5008">from</span><span id="textcolor5009"> </span><span id="textcolor5010">tutorial_interfaces</span><span id="textcolor5011">.</span><span id="textcolor5012">msg</span><span id="textcolor5013"> </span><span id="textcolor5014">import</span> <span id="textcolor5015">Num</span>                        <span id="textcolor5016"># CHANGE</span> 
<a 
 id="x12-278010r580"></a> 
<a 
 id="x12-278012r581"></a> 
<a 
 id="x12-278014r582"></a><span id="textcolor5017">class</span><span id="textcolor5018"> </span><span id="textcolor5019">MinimalSubscriber</span><span id="textcolor5020">(</span><span id="textcolor5021">Node</span><span id="textcolor5022">)</span><span id="textcolor5023">:</span> 
<a 
 id="x12-278016r583"></a> 
<a 
 id="x12-278018r584"></a>   <span id="textcolor5024">def</span><span id="textcolor5025"> </span><span id="textcolor5026">__init__</span><span id="textcolor5027">(</span><span id="textcolor5028">self</span><span id="textcolor5029">)</span><span id="textcolor5030">:</span> 
<a 
 id="x12-278020r585"></a>      <span id="textcolor5031">super</span><span id="textcolor5032">(</span><span id="textcolor5033">)</span><span id="textcolor5034">.</span><span id="textcolor5035">__init__</span><span id="textcolor5036">(</span><span id="textcolor5037">&#x0027;</span><span id="textcolor5038">minimal_subscriber</span><span id="textcolor5039">&#x0027;</span><span id="textcolor5040">)</span> 
<a 
 id="x12-278022r586"></a>      <span id="textcolor5041">self</span><span id="textcolor5042">.</span><span id="textcolor5043">subscription</span> <span id="textcolor5044">=</span> <span id="textcolor5045">self</span><span id="textcolor5046">.</span><span id="textcolor5047">create_subscription</span><span id="textcolor5048">(</span> 
<a 
 id="x12-278024r587"></a>         <span id="textcolor5049">Num</span><span id="textcolor5050">,</span>                                               <span id="textcolor5051"># CHANGE</span> 
<a 
 id="x12-278026r588"></a>         <span id="textcolor5052">&#x0027;</span><span id="textcolor5053">topic</span><span id="textcolor5054">&#x0027;</span><span id="textcolor5055">,</span> 
<a 
 id="x12-278028r589"></a>         <span id="textcolor5056">self</span><span id="textcolor5057">.</span><span id="textcolor5058">listener_callback</span><span id="textcolor5059">,</span> 
<a 
 id="x12-278030r590"></a>         <span id="textcolor5060">10</span><span id="textcolor5061">)</span> 
<a 
 id="x12-278032r591"></a>      <span id="textcolor5062">self</span><span id="textcolor5063">.</span><span id="textcolor5064">subscription</span> 
<a 
 id="x12-278034r592"></a> 
<a 
 id="x12-278036r593"></a>   <span id="textcolor5065">def</span><span id="textcolor5066"> </span><span id="textcolor5067">listener_callback</span><span id="textcolor5068">(</span><span id="textcolor5069">self</span><span id="textcolor5070">,</span> <span id="textcolor5071">msg</span><span id="textcolor5072">)</span><span id="textcolor5073">:</span> 
<a 
 id="x12-278038r594"></a>      <span id="textcolor5074">self</span><span id="textcolor5075">.</span><span id="textcolor5076">get_logger</span><span id="textcolor5077">(</span><span id="textcolor5078">)</span><span id="textcolor5079">.</span><span id="textcolor5080">info</span><span id="textcolor5081">(</span><span id="textcolor5082">&#x0027;</span><span id="textcolor5083">I heard: </span><span id="textcolor5084">"</span><span id="textcolor5085">%d</span><span id="textcolor5086">"</span><span id="textcolor5087">&#x0027;</span> <span id="textcolor5088">%</span> <span id="textcolor5089">msg</span><span id="textcolor5090">.</span><span id="textcolor5091">num</span><span id="textcolor5092">)</span>  <span id="textcolor5093"># CHANGE</span> 
<a 
 id="x12-278040r595"></a> 
<a 
 id="x12-278042r596"></a> 
<a 
 id="x12-278044r597"></a><span id="textcolor5094">def</span><span id="textcolor5095"> </span><span id="textcolor5096">main</span><span id="textcolor5097">(</span><span id="textcolor5098">args</span><span id="textcolor5099">=</span><span id="textcolor5100">None</span><span id="textcolor5101">)</span><span id="textcolor5102">:</span> 
<a 
 id="x12-278046r598"></a>   <span id="textcolor5103">rclpy</span><span id="textcolor5104">.</span><span id="textcolor5105">init</span><span id="textcolor5106">(</span><span id="textcolor5107">args</span><span id="textcolor5108">=</span><span id="textcolor5109">args</span><span id="textcolor5110">)</span> 
<a 
 id="x12-278048r599"></a> 
<a 
 id="x12-278050r600"></a>   <span id="textcolor5111">minimal_subscriber</span> <span id="textcolor5112">=</span> <span id="textcolor5113">MinimalSubscriber</span><span id="textcolor5114">(</span><span id="textcolor5115">)</span> 
<a 
 id="x12-278052r601"></a> 
<a 
 id="x12-278054r602"></a>   <span id="textcolor5116">rclpy</span><span id="textcolor5117">.</span><span id="textcolor5118">spin</span><span id="textcolor5119">(</span><span id="textcolor5120">minimal_subscriber</span><span id="textcolor5121">)</span> 
<a 
 id="x12-278056r603"></a> 
<a 
 id="x12-278058r604"></a>   <span id="textcolor5122">minimal_subscriber</span><span id="textcolor5123">.</span><span id="textcolor5124">destroy_node</span><span id="textcolor5125">(</span><span id="textcolor5126">)</span> 
<a 
 id="x12-278060r605"></a>   <span id="textcolor5127">rclpy</span><span id="textcolor5128">.</span><span id="textcolor5129">shutdown</span><span id="textcolor5130">(</span><span id="textcolor5131">)</span> 
<a 
 id="x12-278062r606"></a> 
<a 
 id="x12-278064r607"></a> 
<a 
 id="x12-278066r608"></a><span id="textcolor5132">if</span> <span id="textcolor5133">__name__</span> <span id="textcolor5134">==</span> <span id="textcolor5135">&#x0027;</span><span id="textcolor5136">__main__</span><span id="textcolor5137">&#x0027;</span><span id="textcolor5138">:</span> 
<a 
 id="x12-278068r609"></a>   <span id="textcolor5139">main</span><span id="textcolor5140">(</span><span id="textcolor5141">)</span></div></pre>
<!--l. 891--><p class="noindent" >We also need to edit our <span id="textcolor5142"><code class="verb">package.xml</code></span>  file to make all the previous python code to work.
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb318" style='padding:20px;border-radius: 3px;'><a 
 id="x12-278070r614"></a><span id="textcolor5143">&lt;exec_depend</span><span id="textcolor5144">&gt;</span>tutorial_interfaces<span id="textcolor5145">&lt;/exec_depend&gt;</span></div></pre>
<!--l. 895--><p class="noindent" >Once we have done the necessary changes let’s build our package and execute it.
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb319" style='padding:20px;border-radius: 3px;'><a 
 id="x12-278072r619"></a>colcon<span id="textcolor5146"> </span>build<span id="textcolor5147"> </span>--packages-select<span id="textcolor5148"> </span>py_pubsub</div></pre>
<!--l. 899--><p class="noindent" >Then open two new terminals, source <span id="textcolor5149"><code class="verb">ros2\_ws</code></span>  in each, and run:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb320" style='padding:20px;border-radius: 3px;'><a 
 id="x12-278074r624"></a>ros2<span id="textcolor5150"> </span>run<span id="textcolor5151"> </span>py_pubsub<span id="textcolor5152"> </span>talker</div></pre>
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb321" style='padding:20px;border-radius: 3px;'><a 
 id="x12-278076r624"></a>ros2<span id="textcolor5153"> </span>run<span id="textcolor5154"> </span>py_pubsub<span id="textcolor5155"> </span>talker</div></pre>
<!--l. 904--><p class="noindent" >Since <span id="textcolor5156"><code class="verb">Num.msg</code></span> relays only an integer, the talker should only be publishing integer values, as opposed to the string it published previously:
</p>
<div class="tcolorbox tcolorbox" id="tcolobox-109">     
<div class="tcolorbox-content">
<pre><div id="fancyvrb322" style='padding:20px;border-radius: 3px;'><a 
 id="x12-278078r1"></a>[INFO] [minimal_publisher]: Publishing: &#x0027;0&#x0027; 
<a 
 id="x12-278080r2"></a>[INFO] [minimal_publisher]: Publishing: &#x0027;1&#x0027; 
<a 
 id="x12-278082r3"></a>[INFO] [minimal_publisher]: Publishing: &#x0027;2&#x0027;</div></pre>
 
</div> 
</div>

<a 
 id="subsubsection*.124"></a>
<h5 class="subsubsectionHead"><a 
 id="x12-279000"></a>Service  Client  System</h5>
<!--l. 911--><p class="noindent" >With a few modifications to the service/client package created previously, we can see <span id="textcolor5157"><code class="verb">AddThreeInts.srv</code></span> in action. Since we’ll be
changing the original two (<alert style="color: #821131;">2</alert>) integer request srv to a three (<alert style="color: #821131;">3</alert>) integer request srv, the output will be slightly different.

</p>
<h5 class="likesubsubsectionHead"><a 
 id="x12-280000"></a>Service</h5>
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb323" style='padding:20px;border-radius: 3px;'><a 
 id="x12-280002r643"></a><span id="textcolor5158">from</span><span id="textcolor5159"> </span><span id="textcolor5160">tutorial_interfaces</span><span id="textcolor5161">.</span><span id="textcolor5162">srv</span><span id="textcolor5163"> </span><span id="textcolor5164">import</span> <span id="textcolor5165">AddThreeInts</span>  <span id="textcolor5166"># CHANGE</span> 
<a 
 id="x12-280004r644"></a> 
<a 
 id="x12-280006r645"></a><span id="textcolor5167">import</span><span id="textcolor5168"> </span><span id="textcolor5169">rclpy</span> 
<a 
 id="x12-280008r646"></a><span id="textcolor5170">from</span><span id="textcolor5171"> </span><span id="textcolor5172">rclpy</span><span id="textcolor5173">.</span><span id="textcolor5174">node</span><span id="textcolor5175"> </span><span id="textcolor5176">import</span> <span id="textcolor5177">Node</span> 
<a 
 id="x12-280010r647"></a> 
<a 
 id="x12-280012r648"></a> 
<a 
 id="x12-280014r649"></a><span id="textcolor5178">class</span><span id="textcolor5179"> </span><span id="textcolor5180">MinimalService</span><span id="textcolor5181">(</span><span id="textcolor5182">Node</span><span id="textcolor5183">)</span><span id="textcolor5184">:</span> 
<a 
 id="x12-280016r650"></a> 
<a 
 id="x12-280018r651"></a>   <span id="textcolor5185">def</span><span id="textcolor5186"> </span><span id="textcolor5187">__init__</span><span id="textcolor5188">(</span><span id="textcolor5189">self</span><span id="textcolor5190">)</span><span id="textcolor5191">:</span> 
<a 
 id="x12-280020r652"></a>      <span id="textcolor5192">super</span><span id="textcolor5193">(</span><span id="textcolor5194">)</span><span id="textcolor5195">.</span><span id="textcolor5196">__init__</span><span id="textcolor5197">(</span><span id="textcolor5198">&#x0027;</span><span id="textcolor5199">minimal_service</span><span id="textcolor5200">&#x0027;</span><span id="textcolor5201">)</span> 
<a 
 id="x12-280022r653"></a>      <span id="textcolor5202">self</span><span id="textcolor5203">.</span><span id="textcolor5204">srv</span> <span id="textcolor5205">=</span> <span id="textcolor5206">self</span><span id="textcolor5207">.</span><span id="textcolor5208">create_service</span><span id="textcolor5209">(</span><span id="textcolor5210">AddThreeInts</span><span id="textcolor5211">,</span> 
<a 
 id="x12-280024r654"></a>                            <span id="textcolor5212">&#x0027;</span><span id="textcolor5213">add_three_ints</span><span id="textcolor5214">&#x0027;</span><span id="textcolor5215">,</span> 
<a 
 id="x12-280026r655"></a>                            <span id="textcolor5216">self</span><span id="textcolor5217">.</span><span id="textcolor5218">add_three_ints_callback</span><span id="textcolor5219">)</span>  <span id="textcolor5220"># CHANGE</span> 
<a 
 id="x12-280028r656"></a> 
<a 
 id="x12-280030r657"></a>   <span id="textcolor5221">def</span><span id="textcolor5222"> </span><span id="textcolor5223">add_three_ints_callback</span><span id="textcolor5224">(</span><span id="textcolor5225">self</span><span id="textcolor5226">,</span> <span id="textcolor5227">request</span><span id="textcolor5228">,</span> <span id="textcolor5229">response</span><span id="textcolor5230">)</span><span id="textcolor5231">:</span> 
<a 
 id="x12-280032r658"></a>      <span id="textcolor5232">response</span><span id="textcolor5233">.</span><span id="textcolor5234">sum</span> <span id="textcolor5235">=</span> <span id="textcolor5236">request</span><span id="textcolor5237">.</span><span id="textcolor5238">a</span> <span id="textcolor5239">+</span> <span id="textcolor5240">request</span><span id="textcolor5241">.</span><span id="textcolor5242">b</span> <span id="textcolor5243">+</span> <span id="textcolor5244">request</span><span id="textcolor5245">.</span><span id="textcolor5246">c</span>  <span id="textcolor5247"># CHANGE</span> 
<a 
 id="x12-280034r659"></a>      <span id="textcolor5248">self</span><span id="textcolor5249">.</span><span id="textcolor5250">get_logger</span><span id="textcolor5251">(</span><span id="textcolor5252">)</span>\ 
<a 
 id="x12-280036r660"></a>         <span id="textcolor5253">.</span><span id="textcolor5254">info</span><span id="textcolor5255">(</span><span id="textcolor5256">&#x0027;</span><span id="textcolor5257">Incoming request</span><span id="textcolor5258">\n</span><span id="textcolor5259">a: </span><span id="textcolor5260">%d</span><span id="textcolor5261"> b: </span><span id="textcolor5262">%d</span><span id="textcolor5263"> c: </span><span id="textcolor5264">%d</span><span id="textcolor5265">&#x0027;</span> <span id="textcolor5266">%</span> <span id="textcolor5267">(</span><span id="textcolor5268">request</span><span id="textcolor5269">.</span><span id="textcolor5270">a</span><span id="textcolor5271">,</span> <span id="textcolor5272">request</span><span id="textcolor5273">.</span><span id="textcolor5274">b</span><span id="textcolor5275">,</span> <span id="textcolor5276">request</span><span id="textcolor5277">.</span><span id="textcolor5278">c</span><span id="textcolor5279">)</span><span id="textcolor5280">)</span>  <span id="textcolor5281"># CHANGE</span> 
<a 
 id="x12-280038r661"></a> 
<a 
 id="x12-280040r662"></a>      <span id="textcolor5282">return</span> <span id="textcolor5283">response</span> 
<a 
 id="x12-280042r663"></a> 
<a 
 id="x12-280044r664"></a><span id="textcolor5284">def</span><span id="textcolor5285"> </span><span id="textcolor5286">main</span><span id="textcolor5287">(</span><span id="textcolor5288">args</span><span id="textcolor5289">=</span><span id="textcolor5290">None</span><span id="textcolor5291">)</span><span id="textcolor5292">:</span> 
<a 
 id="x12-280046r665"></a>   <span id="textcolor5293">rclpy</span><span id="textcolor5294">.</span><span id="textcolor5295">init</span><span id="textcolor5296">(</span><span id="textcolor5297">args</span><span id="textcolor5298">=</span><span id="textcolor5299">args</span><span id="textcolor5300">)</span> 
<a 
 id="x12-280048r666"></a> 
<a 
 id="x12-280050r667"></a>   <span id="textcolor5301">minimal_service</span> <span id="textcolor5302">=</span> <span id="textcolor5303">MinimalService</span><span id="textcolor5304">(</span><span id="textcolor5305">)</span> 
<a 
 id="x12-280052r668"></a> 
<a 
 id="x12-280054r669"></a>   <span id="textcolor5306">rclpy</span><span id="textcolor5307">.</span><span id="textcolor5308">spin</span><span id="textcolor5309">(</span><span id="textcolor5310">minimal_service</span><span id="textcolor5311">)</span> 
<a 
 id="x12-280056r670"></a> 
<a 
 id="x12-280058r671"></a>   <span id="textcolor5312">rclpy</span><span id="textcolor5313">.</span><span id="textcolor5314">shutdown</span><span id="textcolor5315">(</span><span id="textcolor5316">)</span> 
<a 
 id="x12-280060r672"></a> 
<a 
 id="x12-280062r673"></a><span id="textcolor5317">if</span> <span id="textcolor5318">__name__</span> <span id="textcolor5319">==</span> <span id="textcolor5320">&#x0027;</span><span id="textcolor5321">__main__</span><span id="textcolor5322">&#x0027;</span><span id="textcolor5323">:</span> 
<a 
 id="x12-280064r674"></a>   <span id="textcolor5324">main</span><span id="textcolor5325">(</span><span id="textcolor5326">)</span></div></pre>

<h5 class="likesubsubsectionHead"><a 
 id="x12-281000"></a>Client</h5>
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb324" style='padding:20px;border-radius: 3px;'><a 
 id="x12-281002r679"></a><span id="textcolor5327">from</span><span id="textcolor5328"> </span><span id="textcolor5329">tutorial_interfaces</span><span id="textcolor5330">.</span><span id="textcolor5331">srv</span><span id="textcolor5332"> </span><span id="textcolor5333">import</span> <span id="textcolor5334">AddThreeInts</span>                            <span id="textcolor5335"># CHANGE</span> 
<a 
 id="x12-281004r680"></a><span id="textcolor5336">import</span><span id="textcolor5337"> </span><span id="textcolor5338">sys</span> 
<a 
 id="x12-281006r681"></a><span id="textcolor5339">import</span><span id="textcolor5340"> </span><span id="textcolor5341">rclpy</span> 
<a 
 id="x12-281008r682"></a><span id="textcolor5342">from</span><span id="textcolor5343"> </span><span id="textcolor5344">rclpy</span><span id="textcolor5345">.</span><span id="textcolor5346">node</span><span id="textcolor5347"> </span><span id="textcolor5348">import</span> <span id="textcolor5349">Node</span> 
<a 
 id="x12-281010r683"></a> 
<a 
 id="x12-281012r684"></a> 
<a 
 id="x12-281014r685"></a><span id="textcolor5350">class</span><span id="textcolor5351"> </span><span id="textcolor5352">MinimalClientAsync</span><span id="textcolor5353">(</span><span id="textcolor5354">Node</span><span id="textcolor5355">)</span><span id="textcolor5356">:</span> 
<a 
 id="x12-281016r686"></a> 
<a 
 id="x12-281018r687"></a>   <span id="textcolor5357">def</span><span id="textcolor5358"> </span><span id="textcolor5359">__init__</span><span id="textcolor5360">(</span><span id="textcolor5361">self</span><span id="textcolor5362">)</span><span id="textcolor5363">:</span> 
<a 
 id="x12-281020r688"></a>      <span id="textcolor5364">super</span><span id="textcolor5365">(</span><span id="textcolor5366">)</span><span id="textcolor5367">.</span><span id="textcolor5368">__init__</span><span id="textcolor5369">(</span><span id="textcolor5370">&#x0027;</span><span id="textcolor5371">minimal_client_async</span><span id="textcolor5372">&#x0027;</span><span id="textcolor5373">)</span> 
<a 
 id="x12-281022r689"></a>      <span id="textcolor5374">self</span><span id="textcolor5375">.</span><span id="textcolor5376">cli</span> <span id="textcolor5377">=</span> <span id="textcolor5378">self</span><span id="textcolor5379">.</span><span id="textcolor5380">create_client</span><span id="textcolor5381">(</span><span id="textcolor5382">AddThreeInts</span><span id="textcolor5383">,</span> <span id="textcolor5384">&#x0027;</span><span id="textcolor5385">add_three_ints</span><span id="textcolor5386">&#x0027;</span><span id="textcolor5387">)</span>       <span id="textcolor5388"># CHANGE</span> 
<a 
 id="x12-281024r690"></a>      <span id="textcolor5389">while</span> <span id="textcolor5390">not</span> <span id="textcolor5391">self</span><span id="textcolor5392">.</span><span id="textcolor5393">cli</span><span id="textcolor5394">.</span><span id="textcolor5395">wait_for_service</span><span id="textcolor5396">(</span><span id="textcolor5397">timeout_sec</span><span id="textcolor5398">=</span><span id="textcolor5399">1.0</span><span id="textcolor5400">)</span><span id="textcolor5401">:</span> 
<a 
 id="x12-281026r691"></a>         <span id="textcolor5402">self</span><span id="textcolor5403">.</span><span id="textcolor5404">get_logger</span><span id="textcolor5405">(</span><span id="textcolor5406">)</span><span id="textcolor5407">.</span><span id="textcolor5408">info</span><span id="textcolor5409">(</span><span id="textcolor5410">&#x0027;</span><span id="textcolor5411">service not available, waiting again...</span><span id="textcolor5412">&#x0027;</span><span id="textcolor5413">)</span> 
<a 
 id="x12-281028r692"></a>      <span id="textcolor5414">self</span><span id="textcolor5415">.</span><span id="textcolor5416">req</span> <span id="textcolor5417">=</span> <span id="textcolor5418">AddThreeInts</span><span id="textcolor5419">.</span><span id="textcolor5420">Request</span><span id="textcolor5421">(</span><span id="textcolor5422">)</span>                                   <span id="textcolor5423"># CHANGE</span> 
<a 
 id="x12-281030r693"></a> 
<a 
 id="x12-281032r694"></a>   <span id="textcolor5424">def</span><span id="textcolor5425"> </span><span id="textcolor5426">send_request</span><span id="textcolor5427">(</span><span id="textcolor5428">self</span><span id="textcolor5429">)</span><span id="textcolor5430">:</span> 
<a 
 id="x12-281034r695"></a>      <span id="textcolor5431">self</span><span id="textcolor5432">.</span><span id="textcolor5433">req</span><span id="textcolor5434">.</span><span id="textcolor5435">a</span> <span id="textcolor5436">=</span> <span id="textcolor5437">int</span><span id="textcolor5438">(</span><span id="textcolor5439">sys</span><span id="textcolor5440">.</span><span id="textcolor5441">argv</span><span id="textcolor5442">[</span><span id="textcolor5443">1</span><span id="textcolor5444">]</span><span id="textcolor5445">)</span> 
<a 
 id="x12-281036r696"></a>      <span id="textcolor5446">self</span><span id="textcolor5447">.</span><span id="textcolor5448">req</span><span id="textcolor5449">.</span><span id="textcolor5450">b</span> <span id="textcolor5451">=</span> <span id="textcolor5452">int</span><span id="textcolor5453">(</span><span id="textcolor5454">sys</span><span id="textcolor5455">.</span><span id="textcolor5456">argv</span><span id="textcolor5457">[</span><span id="textcolor5458">2</span><span id="textcolor5459">]</span><span id="textcolor5460">)</span> 
<a 
 id="x12-281038r697"></a>      <span id="textcolor5461">self</span><span id="textcolor5462">.</span><span id="textcolor5463">req</span><span id="textcolor5464">.</span><span id="textcolor5465">c</span> <span id="textcolor5466">=</span> <span id="textcolor5467">int</span><span id="textcolor5468">(</span><span id="textcolor5469">sys</span><span id="textcolor5470">.</span><span id="textcolor5471">argv</span><span id="textcolor5472">[</span><span id="textcolor5473">3</span><span id="textcolor5474">]</span><span id="textcolor5475">)</span>                                       <span id="textcolor5476"># CHANGE</span> 
<a 
 id="x12-281040r698"></a>      <span id="textcolor5477">self</span><span id="textcolor5478">.</span><span id="textcolor5479">future</span> <span id="textcolor5480">=</span> <span id="textcolor5481">self</span><span id="textcolor5482">.</span><span id="textcolor5483">cli</span><span id="textcolor5484">.</span><span id="textcolor5485">call_async</span><span id="textcolor5486">(</span><span id="textcolor5487">self</span><span id="textcolor5488">.</span><span id="textcolor5489">req</span><span id="textcolor5490">)</span> 
<a 
 id="x12-281042r699"></a> 
<a 
 id="x12-281044r700"></a> 
<a 
 id="x12-281046r701"></a><span id="textcolor5491">def</span><span id="textcolor5492"> </span><span id="textcolor5493">main</span><span id="textcolor5494">(</span><span id="textcolor5495">args</span><span id="textcolor5496">=</span><span id="textcolor5497">None</span><span id="textcolor5498">)</span><span id="textcolor5499">:</span> 
<a 
 id="x12-281048r702"></a>   <span id="textcolor5500">rclpy</span><span id="textcolor5501">.</span><span id="textcolor5502">init</span><span id="textcolor5503">(</span><span id="textcolor5504">args</span><span id="textcolor5505">=</span><span id="textcolor5506">args</span><span id="textcolor5507">)</span> 
<a 
 id="x12-281050r703"></a> 
<a 
 id="x12-281052r704"></a>   <span id="textcolor5508">minimal_client</span> <span id="textcolor5509">=</span> <span id="textcolor5510">MinimalClientAsync</span><span id="textcolor5511">(</span><span id="textcolor5512">)</span> 
<a 
 id="x12-281054r705"></a>   <span id="textcolor5513">minimal_client</span><span id="textcolor5514">.</span><span id="textcolor5515">send_request</span><span id="textcolor5516">(</span><span id="textcolor5517">)</span> 
<a 
 id="x12-281056r706"></a> 
<a 
 id="x12-281058r707"></a>   <span id="textcolor5518">while</span> <span id="textcolor5519">rclpy</span><span id="textcolor5520">.</span><span id="textcolor5521">ok</span><span id="textcolor5522">(</span><span id="textcolor5523">)</span><span id="textcolor5524">:</span> 
<a 
 id="x12-281060r708"></a>      <span id="textcolor5525">rclpy</span><span id="textcolor5526">.</span><span id="textcolor5527">spin_once</span><span id="textcolor5528">(</span><span id="textcolor5529">minimal_client</span><span id="textcolor5530">)</span> 
<a 
 id="x12-281062r709"></a>      <span id="textcolor5531">if</span> <span id="textcolor5532">minimal_client</span><span id="textcolor5533">.</span><span id="textcolor5534">future</span><span id="textcolor5535">.</span><span id="textcolor5536">done</span><span id="textcolor5537">(</span><span id="textcolor5538">)</span><span id="textcolor5539">:</span> 
<a 
 id="x12-281064r710"></a>         <span id="textcolor5540">try</span><span id="textcolor5541">:</span> 
<a 
 id="x12-281066r711"></a>            <span id="textcolor5542">response</span> <span id="textcolor5543">=</span> <span id="textcolor5544">minimal_client</span><span id="textcolor5545">.</span><span id="textcolor5546">future</span><span id="textcolor5547">.</span><span id="textcolor5548">result</span><span id="textcolor5549">(</span><span id="textcolor5550">)</span> 
<a 
 id="x12-281068r712"></a>         <span id="textcolor5551">except</span> <span id="textcolor5552">Exception</span> <span id="textcolor5553">as</span> <span id="textcolor5554">e</span><span id="textcolor5555">:</span> 
<a 
 id="x12-281070r713"></a>            <span id="textcolor5556">minimal_client</span><span id="textcolor5557">.</span><span id="textcolor5558">get_logger</span><span id="textcolor5559">(</span><span id="textcolor5560">)</span><span id="textcolor5561">.</span><span id="textcolor5562">info</span><span id="textcolor5563">(</span> 
<a 
 id="x12-281072r714"></a>              <span id="textcolor5564">&#x0027;</span><span id="textcolor5565">Service call failed </span><span id="textcolor5566">%r</span><span id="textcolor5567">&#x0027;</span> <span id="textcolor5568">%</span> <span id="textcolor5569">(</span><span id="textcolor5570">e</span><span id="textcolor5571">,</span><span id="textcolor5572">)</span><span id="textcolor5573">)</span> 
<a 
 id="x12-281074r715"></a>         <span id="textcolor5574">else</span><span id="textcolor5575">:</span> 
<a 
 id="x12-281076r716"></a>            <span id="textcolor5576">minimal_client</span><span id="textcolor5577">.</span><span id="textcolor5578">get_logger</span><span id="textcolor5579">(</span><span id="textcolor5580">)</span><span id="textcolor5581">.</span><span id="textcolor5582">info</span><span id="textcolor5583">(</span> 
<a 
 id="x12-281078r717"></a>              <span id="textcolor5584">&#x0027;</span><span id="textcolor5585">Result of add_three_ints: for </span><span id="textcolor5586">%d</span><span id="textcolor5587"> + </span><span id="textcolor5588">%d</span><span id="textcolor5589"> + </span><span id="textcolor5590">%d</span><span id="textcolor5591"> = </span><span id="textcolor5592">%d</span><span id="textcolor5593">&#x0027;</span> <span id="textcolor5594">%</span>                                <span id="textcolor5595"># CHANGE</span> 
<a 
 id="x12-281080r718"></a>              <span id="textcolor5596">(</span><span id="textcolor5597">minimal_client</span><span id="textcolor5598">.</span><span id="textcolor5599">req</span><span id="textcolor5600">.</span><span id="textcolor5601">a</span><span id="textcolor5602">,</span> <span id="textcolor5603">minimal_client</span><span id="textcolor5604">.</span><span id="textcolor5605">req</span><span id="textcolor5606">.</span><span id="textcolor5607">b</span><span id="textcolor5608">,</span> <span id="textcolor5609">minimal_client</span><span id="textcolor5610">.</span><span id="textcolor5611">req</span><span id="textcolor5612">.</span><span id="textcolor5613">c</span><span id="textcolor5614">,</span> <span id="textcolor5615">response</span><span id="textcolor5616">.</span><span id="textcolor5617">sum</span><span id="textcolor5618">)</span><span id="textcolor5619">)</span>  <span id="textcolor5620"># CHANGE</span> 
<a 
 id="x12-281082r719"></a>         <span id="textcolor5621">break</span> 
<a 
 id="x12-281084r720"></a> 
<a 
 id="x12-281086r721"></a>   <span id="textcolor5622">minimal_client</span><span id="textcolor5623">.</span><span id="textcolor5624">destroy_node</span><span id="textcolor5625">(</span><span id="textcolor5626">)</span> 
<a 
 id="x12-281088r722"></a>   <span id="textcolor5627">rclpy</span><span id="textcolor5628">.</span><span id="textcolor5629">shutdown</span><span id="textcolor5630">(</span><span id="textcolor5631">)</span> 
<a 
 id="x12-281090r723"></a> 
<a 
 id="x12-281092r724"></a> 
<a 
 id="x12-281094r725"></a><span id="textcolor5632">if</span> <span id="textcolor5633">__name__</span> <span id="textcolor5634">==</span> <span id="textcolor5635">&#x0027;</span><span id="textcolor5636">__main__</span><span id="textcolor5637">&#x0027;</span><span id="textcolor5638">:</span> 
<a 
 id="x12-281096r726"></a>   <span id="textcolor5639">main</span><span id="textcolor5640">(</span><span id="textcolor5641">)</span></div></pre>
<!--l. 923--><p class="noindent" >To add these features to our package we need to let <span id="textcolor5642"><code class="verb">package.xml</code></span> know, which for that we need to write:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb325" style='padding:20px;border-radius: 3px;'><a 
 id="x12-281098r732"></a><span id="textcolor5643">&lt;exec_depend</span><span id="textcolor5644">&gt;</span>tutorial_interfaces<span id="textcolor5645">&lt;/exec_depend&gt;</span></div></pre>
<!--l. 928--><p class="noindent" >After making the above edits and saving all the changes, build the package:
</p><!--l. 930--><p class="noindent" >Then open two new terminals, source <span id="textcolor5646"><code class="verb">ros2\_ws</code></span>  in each, and run:
</p><!--l. 1--><p class="noindent" >
                                                                                
                                                                                

</p>
<pre><div id="fancyvrb326" style='padding:20px;border-radius: 3px;'><a 
 id="x12-281100r742"></a>ros2<span id="textcolor5647"> </span>run<span id="textcolor5648"> </span>py_srvcli<span id="textcolor5649"> </span>service</div></pre>
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb327" style='padding:20px;border-radius: 3px;'><a 
 id="x12-281102r747"></a>ros2<span id="textcolor5650"> </span>run<span id="textcolor5651"> </span>py_srvcli<span id="textcolor5652"> </span>client<span id="textcolor5653"> </span><span id="textcolor5654">2</span><span id="textcolor5655"> </span><span id="textcolor5656">3</span><span id="textcolor5657"> </span><span id="textcolor5658">1</span></div></pre>
                                                                                
                                                                                
<!--l. 936--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">10.7</span>  <a 
 id="x12-28200010.7"></a>Using  Parameters  in  a  Class</h3>
<!--l. 938--><p class="noindent" >When making our own nodes we will sometimes need to add parameters that can be set from the launch file.
</p><!--l. 941--><p class="noindent" >This tutorial will show we how to create those parameters in a Python class, and how to set them in a launch file.

<a 
 id="paragraph*.125"></a></p>
<!--l. 944--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-283000"></a>Creating  a  Package</span>
Open a new terminal and source our <a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a> installation so that ros2 commands will work.
</p><!--l. 948--><p class="noindent" >Follow these instructions to create a new workspace named <span id="textcolor5659"><code class="verb">ros2\_ws</code></span> .
</p><!--l. 950--><p class="noindent" >Recall that packages should be created in the src directory, not the root of the workspace. Navigate into <span id="textcolor5660"><code class="verb">ros2_ws/src</code></span> and create a new package:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb328" style='padding:20px;border-radius: 3px;'><a 
 id="x12-283002r1014"></a>ros2<span id="textcolor5661"> </span>pkg<span id="textcolor5662"> </span>create<span id="textcolor5663"> </span>--build-type<span id="textcolor5664"> </span>ament_python<span id="textcolor5665"> </span><span id="textcolor5666">\</span> 
<a 
 id="x12-283004r1015"></a><span id="textcolor5667">    </span>--license<span id="textcolor5668"> </span>Apache-2.0<span id="textcolor5669"> </span>python_parameters<span id="textcolor5670"> </span><span id="textcolor5671">\</span> 
<a 
 id="x12-283006r1016"></a><span id="textcolor5672">    </span>--dependencies<span id="textcolor5673"> </span>rclpy</div></pre>
<!--l. 955--><p class="noindent" >Our terminal will return a message verifying the creation of our package <span id="textcolor5674"><code class="verb">python_parameters</code></span> and all its necessary files and folders.
</p><!--l. 958--><p class="noindent" >The <span id="textcolor5675"><code class="verb">--dependencies</code></span> argument will automatically add the necessary dependency lines to <span id="textcolor5676"><code class="verb">package.xml</code></span> and CMakeLists.txt.

<a 
 id="paragraph*.126"></a></p>
<!--l. 961--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-284000"></a>Updating  the  Package  Manifesto</span>
Because we used the <span id="textcolor5677"><code class="verb">--dependencies</code></span> option during package creation, we don’t have to manually add dependencies to package.xml or CMakeLists.txt.
</p><!--l. 966--><p class="noindent" >As always, though, make sure to add the description, maintainer email and name, and license information to package.xml.
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb329" style='padding:20px;border-radius: 3px;'><a 
 id="x12-284002r1022"></a><span id="textcolor5678">&lt;description</span><span id="textcolor5679">&gt;</span>Python<span id="textcolor5680"> </span>parameter<span id="textcolor5681"> </span>tutorial<span id="textcolor5682">&lt;/description&gt;</span> 
<a 
 id="x12-284004r1023"></a><span id="textcolor5683">&lt;maintainer</span><span id="textcolor5684"> </span><span id="textcolor5685">email=</span><span id="textcolor5686">"you@email.com"</span><span id="textcolor5687">&gt;</span>Your<span id="textcolor5688"> </span>Name<span id="textcolor5689">&lt;/maintainer&gt;</span> 
<a 
 id="x12-284006r1024"></a><span id="textcolor5690">&lt;license</span><span id="textcolor5691">&gt;</span>Apache<span id="textcolor5692"> </span>License<span id="textcolor5693"> </span>2.0<span id="textcolor5694">&lt;/license&gt;</span></div></pre>

<a 
 id="paragraph*.127"></a>
<!--l. 971--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-285000"></a>Writing  our  Python  Code</span>
Inside the <span id="textcolor5695"><code class="verb">ros2_ws/src/python_parameters/python_parameters</code></span> directory, create a new file called <span id="textcolor5696"><code class="verb">python_parameters_node.py</code></span> and paste the following code within:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb330" style='padding:20px;border-radius: 3px;'><a 
 id="x12-285002r1029"></a><span id="textcolor5697">import</span><span id="textcolor5698"> </span><span id="textcolor5699">rclpy</span> 
<a 
 id="x12-285004r1030"></a><span id="textcolor5700">import</span><span id="textcolor5701"> </span><span id="textcolor5702">rclpy</span><span id="textcolor5703">.</span><span id="textcolor5704">node</span> 
<a 
 id="x12-285006r1031"></a> 
<a 
 id="x12-285008r1032"></a><span id="textcolor5705">class</span><span id="textcolor5706"> </span><span id="textcolor5707">MinimalParam</span><span id="textcolor5708">(</span><span id="textcolor5709">rclpy</span><span id="textcolor5710">.</span><span id="textcolor5711">node</span><span id="textcolor5712">.</span><span id="textcolor5713">Node</span><span id="textcolor5714">)</span><span id="textcolor5715">:</span> 
<a 
 id="x12-285010r1033"></a>   <span id="textcolor5716">def</span><span id="textcolor5717"> </span><span id="textcolor5718">__init__</span><span id="textcolor5719">(</span><span id="textcolor5720">self</span><span id="textcolor5721">)</span><span id="textcolor5722">:</span> 
<a 
 id="x12-285012r1034"></a>      <span id="textcolor5723">super</span><span id="textcolor5724">(</span><span id="textcolor5725">)</span><span id="textcolor5726">.</span><span id="textcolor5727">__init__</span><span id="textcolor5728">(</span><span id="textcolor5729">&#x0027;</span><span id="textcolor5730">minimal_param_node</span><span id="textcolor5731">&#x0027;</span><span id="textcolor5732">)</span> 
<a 
 id="x12-285014r1035"></a> 
<a 
 id="x12-285016r1036"></a>      <span id="textcolor5733">self</span><span id="textcolor5734">.</span><span id="textcolor5735">declare_parameter</span><span id="textcolor5736">(</span><span id="textcolor5737">&#x0027;</span><span id="textcolor5738">my_parameter</span><span id="textcolor5739">&#x0027;</span><span id="textcolor5740">,</span> <span id="textcolor5741">&#x0027;</span><span id="textcolor5742">world</span><span id="textcolor5743">&#x0027;</span><span id="textcolor5744">)</span> 
<a 
 id="x12-285018r1037"></a> 
<a 
 id="x12-285020r1038"></a>      <span id="textcolor5745">self</span><span id="textcolor5746">.</span><span id="textcolor5747">timer</span> <span id="textcolor5748">=</span> <span id="textcolor5749">self</span><span id="textcolor5750">.</span><span id="textcolor5751">create_timer</span><span id="textcolor5752">(</span><span id="textcolor5753">1</span><span id="textcolor5754">,</span> <span id="textcolor5755">self</span><span id="textcolor5756">.</span><span id="textcolor5757">timer_callback</span><span id="textcolor5758">)</span> 
<a 
 id="x12-285022r1039"></a> 
<a 
 id="x12-285024r1040"></a>   <span id="textcolor5759">def</span><span id="textcolor5760"> </span><span id="textcolor5761">timer_callback</span><span id="textcolor5762">(</span><span id="textcolor5763">self</span><span id="textcolor5764">)</span><span id="textcolor5765">:</span> 
<a 
 id="x12-285026r1041"></a>      <span id="textcolor5766">my_param</span> <span id="textcolor5767">=</span> <span id="textcolor5768">self</span><span id="textcolor5769">.</span><span id="textcolor5770">get_parameter</span><span id="textcolor5771">(</span><span id="textcolor5772">&#x0027;</span><span id="textcolor5773">my_parameter</span><span id="textcolor5774">&#x0027;</span><span id="textcolor5775">)</span><span id="textcolor5776">.</span><span id="textcolor5777">get_parameter_value</span><span id="textcolor5778">(</span><span id="textcolor5779">)</span><span id="textcolor5780">.</span><span id="textcolor5781">string_value</span> 
<a 
 id="x12-285028r1042"></a> 
<a 
 id="x12-285030r1043"></a>      <span id="textcolor5782">self</span><span id="textcolor5783">.</span><span id="textcolor5784">get_logger</span><span id="textcolor5785">(</span><span id="textcolor5786">)</span><span id="textcolor5787">.</span><span id="textcolor5788">info</span><span id="textcolor5789">(</span><span id="textcolor5790">&#x0027;</span><span id="textcolor5791">Hello </span><span id="textcolor5792">%s</span><span id="textcolor5793">!</span><span id="textcolor5794">&#x0027;</span> <span id="textcolor5795">%</span> <span id="textcolor5796">my_param</span><span id="textcolor5797">)</span> 
<a 
 id="x12-285032r1044"></a> 
<a 
 id="x12-285034r1045"></a>      <span id="textcolor5798">my_new_param</span> <span id="textcolor5799">=</span> <span id="textcolor5800">rclpy</span><span id="textcolor5801">.</span><span id="textcolor5802">parameter</span><span id="textcolor5803">.</span><span id="textcolor5804">Parameter</span><span id="textcolor5805">(</span> 
<a 
 id="x12-285036r1046"></a>         <span id="textcolor5806">&#x0027;</span><span id="textcolor5807">my_parameter</span><span id="textcolor5808">&#x0027;</span><span id="textcolor5809">,</span> 
<a 
 id="x12-285038r1047"></a>         <span id="textcolor5810">rclpy</span><span id="textcolor5811">.</span><span id="textcolor5812">Parameter</span><span id="textcolor5813">.</span><span id="textcolor5814">Type</span><span id="textcolor5815">.</span><span id="textcolor5816">STRING</span><span id="textcolor5817">,</span> 
<a 
 id="x12-285040r1048"></a>         <span id="textcolor5818">&#x0027;</span><span id="textcolor5819">world</span><span id="textcolor5820">&#x0027;</span> 
<a 
 id="x12-285042r1049"></a>      <span id="textcolor5821">)</span> 
<a 
 id="x12-285044r1050"></a>      <span id="textcolor5822">all_new_parameters</span> <span id="textcolor5823">=</span> <span id="textcolor5824">[</span><span id="textcolor5825">my_new_param</span><span id="textcolor5826">]</span> 
<a 
 id="x12-285046r1051"></a>      <span id="textcolor5827">self</span><span id="textcolor5828">.</span><span id="textcolor5829">set_parameters</span><span id="textcolor5830">(</span><span id="textcolor5831">all_new_parameters</span><span id="textcolor5832">)</span> 
<a 
 id="x12-285048r1052"></a> 
<a 
 id="x12-285050r1053"></a><span id="textcolor5833">def</span><span id="textcolor5834"> </span><span id="textcolor5835">main</span><span id="textcolor5836">(</span><span id="textcolor5837">)</span><span id="textcolor5838">:</span> 
<a 
 id="x12-285052r1054"></a>   <span id="textcolor5839">rclpy</span><span id="textcolor5840">.</span><span id="textcolor5841">init</span><span id="textcolor5842">(</span><span id="textcolor5843">)</span> 
<a 
 id="x12-285054r1055"></a>   <span id="textcolor5844">node</span> <span id="textcolor5845">=</span> <span id="textcolor5846">MinimalParam</span><span id="textcolor5847">(</span><span id="textcolor5848">)</span> 
<a 
 id="x12-285056r1056"></a>   <span id="textcolor5849">rclpy</span><span id="textcolor5850">.</span><span id="textcolor5851">spin</span><span id="textcolor5852">(</span><span id="textcolor5853">node</span><span id="textcolor5854">)</span> 
<a 
 id="x12-285058r1057"></a> 
<a 
 id="x12-285060r1058"></a><span id="textcolor5855">if</span> <span id="textcolor5856">__name__</span> <span id="textcolor5857">==</span> <span id="textcolor5858">&#x0027;</span><span id="textcolor5859">__main__</span><span id="textcolor5860">&#x0027;</span><span id="textcolor5861">:</span> 
<a 
 id="x12-285062r1059"></a>   <span id="textcolor5862">main</span><span id="textcolor5863">(</span><span id="textcolor5864">)</span></div></pre>

<a 
 id="paragraph*.128"></a>
<!--l. 978--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-286000"></a>Code  Demystified</span>
The import statements at the top are used to import the package dependencies.
</p><!--l. 982--><p class="noindent" >The next piece of code creates the class and the constructor. The line;
</p><!--l. 984--><p class="noindent" >     
</p>
<blockquote class="quote">     
<!--l. 985--><p class="noindent" ><span id="textcolor5865"><code class="verb">self.declare_parameter(&#x0027;my_parameter&#x0027;, &#x0027;world&#x0027;)</code></span></p></blockquote>
<!--l. 988--><p class="noindent" >of the constructor creates a parameter with the name <span id="textcolor5866"><code class="verb">my_parameter</code></span> and a default value of world. The parameter
type is inferred from the default value, so in this case it would be set to a string type. Next the timer is
initialized with a period of 1, which causes the <span id="textcolor5867"><code class="verb">timer_callback</code></span> function to be executed once a second.
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb331" style='padding:20px;border-radius: 3px;'><a 
 id="x12-286002r1064"></a><span id="textcolor5868">class</span><span id="textcolor5869"> </span><span id="textcolor5870">MinimalParam</span><span id="textcolor5871">(</span><span id="textcolor5872">rclpy</span><span id="textcolor5873">.</span><span id="textcolor5874">node</span><span id="textcolor5875">.</span><span id="textcolor5876">Node</span><span id="textcolor5877">)</span><span id="textcolor5878">:</span> 
<a 
 id="x12-286004r1065"></a>   <span id="textcolor5879">def</span><span id="textcolor5880"> </span><span id="textcolor5881">__init__</span><span id="textcolor5882">(</span><span id="textcolor5883">self</span><span id="textcolor5884">)</span><span id="textcolor5885">:</span> 
<a 
 id="x12-286006r1066"></a>      <span id="textcolor5886">super</span><span id="textcolor5887">(</span><span id="textcolor5888">)</span><span id="textcolor5889">.</span><span id="textcolor5890">__init__</span><span id="textcolor5891">(</span><span id="textcolor5892">&#x0027;</span><span id="textcolor5893">minimal_param_node</span><span id="textcolor5894">&#x0027;</span><span id="textcolor5895">)</span> 
<a 
 id="x12-286008r1067"></a> 
<a 
 id="x12-286010r1068"></a>      <span id="textcolor5896">self</span><span id="textcolor5897">.</span><span id="textcolor5898">declare_parameter</span><span id="textcolor5899">(</span><span id="textcolor5900">&#x0027;</span><span id="textcolor5901">my_parameter</span><span id="textcolor5902">&#x0027;</span><span id="textcolor5903">,</span> <span id="textcolor5904">&#x0027;</span><span id="textcolor5905">world</span><span id="textcolor5906">&#x0027;</span><span id="textcolor5907">)</span> 
<a 
 id="x12-286012r1069"></a> 
<a 
 id="x12-286014r1070"></a>      <span id="textcolor5908">self</span><span id="textcolor5909">.</span><span id="textcolor5910">timer</span> <span id="textcolor5911">=</span> <span id="textcolor5912">self</span><span id="textcolor5913">.</span><span id="textcolor5914">create_timer</span><span id="textcolor5915">(</span><span id="textcolor5916">1</span><span id="textcolor5917">,</span> <span id="textcolor5918">self</span><span id="textcolor5919">.</span><span id="textcolor5920">timer_callback</span><span id="textcolor5921">)</span></div></pre>
<!--l. 995--><p class="noindent" >The first line of our <span id="textcolor5922"><code class="verb">timer_callback</code></span> function gets the parameter <span id="textcolor5923"><code class="verb">my_parameter</code></span> from the node, and stores it in <span id="textcolor5924"><code class="verb">my_param</code></span>. Next the
<span id="textcolor5925"><code class="verb">get_logger</code></span> function ensures the event is logged. The <span id="textcolor5926"><code class="verb">set_parameters</code></span> function then sets the parameter <span id="textcolor5927"><code class="verb">my_parameter</code></span> back to the default
string value world. In the case that the user changed the parameter externally, this ensures it is always reset back to the original.
</p><!--l. 1--><p class="noindent" >
                                                                                
                                                                                

</p>
<pre><div id="fancyvrb332" style='padding:20px;border-radius: 3px;'><a 
 id="x12-286016r1075"></a><span id="textcolor5928">def</span><span id="textcolor5929"> </span><span id="textcolor5930">timer_callback</span><span id="textcolor5931">(</span><span id="textcolor5932">self</span><span id="textcolor5933">)</span><span id="textcolor5934">:</span> 
<a 
 id="x12-286018r1076"></a>   <span id="textcolor5935">my_param</span> <span id="textcolor5936">=</span> <span id="textcolor5937">self</span><span id="textcolor5938">.</span><span id="textcolor5939">get_parameter</span><span id="textcolor5940">(</span><span id="textcolor5941">&#x0027;</span><span id="textcolor5942">my_parameter</span><span id="textcolor5943">&#x0027;</span><span id="textcolor5944">)</span><span id="textcolor5945">.</span><span id="textcolor5946">get_parameter_value</span><span id="textcolor5947">(</span><span id="textcolor5948">)</span><span id="textcolor5949">.</span><span id="textcolor5950">string_value</span> 
<a 
 id="x12-286020r1077"></a> 
<a 
 id="x12-286022r1078"></a>   <span id="textcolor5951">self</span><span id="textcolor5952">.</span><span id="textcolor5953">get_logger</span><span id="textcolor5954">(</span><span id="textcolor5955">)</span><span id="textcolor5956">.</span><span id="textcolor5957">info</span><span id="textcolor5958">(</span><span id="textcolor5959">&#x0027;</span><span id="textcolor5960">Hello </span><span id="textcolor5961">%s</span><span id="textcolor5962">!</span><span id="textcolor5963">&#x0027;</span> <span id="textcolor5964">%</span> <span id="textcolor5965">my_param</span><span id="textcolor5966">)</span> 
<a 
 id="x12-286024r1079"></a> 
<a 
 id="x12-286026r1080"></a>   <span id="textcolor5967">my_new_param</span> <span id="textcolor5968">=</span> <span id="textcolor5969">rclpy</span><span id="textcolor5970">.</span><span id="textcolor5971">parameter</span><span id="textcolor5972">.</span><span id="textcolor5973">Parameter</span><span id="textcolor5974">(</span> 
<a 
 id="x12-286028r1081"></a>      <span id="textcolor5975">&#x0027;</span><span id="textcolor5976">my_parameter</span><span id="textcolor5977">&#x0027;</span><span id="textcolor5978">,</span> 
<a 
 id="x12-286030r1082"></a>      <span id="textcolor5979">rclpy</span><span id="textcolor5980">.</span><span id="textcolor5981">Parameter</span><span id="textcolor5982">.</span><span id="textcolor5983">Type</span><span id="textcolor5984">.</span><span id="textcolor5985">STRING</span><span id="textcolor5986">,</span> 
<a 
 id="x12-286032r1083"></a>      <span id="textcolor5987">&#x0027;</span><span id="textcolor5988">world</span><span id="textcolor5989">&#x0027;</span> 
<a 
 id="x12-286034r1084"></a>   <span id="textcolor5990">)</span> 
<a 
 id="x12-286036r1085"></a>   <span id="textcolor5991">all_new_parameters</span> <span id="textcolor5992">=</span> <span id="textcolor5993">[</span><span id="textcolor5994">my_new_param</span><span id="textcolor5995">]</span> 
<a 
 id="x12-286038r1086"></a>   <span id="textcolor5996">self</span><span id="textcolor5997">.</span><span id="textcolor5998">set_parameters</span><span id="textcolor5999">(</span><span id="textcolor6000">all_new_parameters</span><span id="textcolor6001">)</span></div></pre>
<!--l. 1003--><p class="noindent" >Following the <span id="textcolor6002"><code class="verb">timer_callback</code></span> is our main. Here <a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a> is initialized, an instance of the
MinimalParam class is constructed, and rclpy.spin starts processing data from the node.
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb333" style='padding:20px;border-radius: 3px;'><a 
 id="x12-286040r1091"></a><span id="textcolor6003">def</span><span id="textcolor6004"> </span><span id="textcolor6005">main</span><span id="textcolor6006">(</span><span id="textcolor6007">)</span><span id="textcolor6008">:</span> 
<a 
 id="x12-286042r1092"></a>   <span id="textcolor6009">rclpy</span><span id="textcolor6010">.</span><span id="textcolor6011">init</span><span id="textcolor6012">(</span><span id="textcolor6013">)</span> 
<a 
 id="x12-286044r1093"></a>   <span id="textcolor6014">node</span> <span id="textcolor6015">=</span> <span id="textcolor6016">MinimalParam</span><span id="textcolor6017">(</span><span id="textcolor6018">)</span> 
<a 
 id="x12-286046r1094"></a>   <span id="textcolor6019">rclpy</span><span id="textcolor6020">.</span><span id="textcolor6021">spin</span><span id="textcolor6022">(</span><span id="textcolor6023">node</span><span id="textcolor6024">)</span> 
<a 
 id="x12-286048r1095"></a> 
<a 
 id="x12-286050r1096"></a><span id="textcolor6025">if</span> <span id="textcolor6026">__name__</span> <span id="textcolor6027">==</span> <span id="textcolor6028">&#x0027;</span><span id="textcolor6029">__main__</span><span id="textcolor6030">&#x0027;</span><span id="textcolor6031">:</span> 
<a 
 id="x12-286052r1097"></a>   <span id="textcolor6032">main</span><span id="textcolor6033">(</span><span id="textcolor6034">)</span></div></pre>

<a 
 id="paragraph*.129"></a>
<!--l. 1008--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-287000"></a>(Optional)  Adding  a  Parameter  Descriptor</span>
Optionally, we can set a descriptor for the parameter. Descriptors allow we to specify a text description of the parameter and its
constraints, like making it read-only, specifying a range, etc. For that to work, the <span id="textcolor6035"><code class="verb">__init__</code></span> code has to be changed to:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb334" style='padding:20px;border-radius: 3px;'><a 
 id="x12-287002r1104"></a><span id="textcolor6036"># ...</span> 
<a 
 id="x12-287004r1105"></a> 
<a 
 id="x12-287006r1106"></a><span id="textcolor6037">class</span><span id="textcolor6038"> </span><span id="textcolor6039">MinimalParam</span><span id="textcolor6040">(</span><span id="textcolor6041">rclpy</span><span id="textcolor6042">.</span><span id="textcolor6043">node</span><span id="textcolor6044">.</span><span id="textcolor6045">Node</span><span id="textcolor6046">)</span><span id="textcolor6047">:</span> 
<a 
 id="x12-287008r1107"></a>   <span id="textcolor6048">def</span><span id="textcolor6049"> </span><span id="textcolor6050">__init__</span><span id="textcolor6051">(</span><span id="textcolor6052">self</span><span id="textcolor6053">)</span><span id="textcolor6054">:</span> 
<a 
 id="x12-287010r1108"></a>      <span id="textcolor6055">super</span><span id="textcolor6056">(</span><span id="textcolor6057">)</span><span id="textcolor6058">.</span><span id="textcolor6059">__init__</span><span id="textcolor6060">(</span><span id="textcolor6061">&#x0027;</span><span id="textcolor6062">minimal_param_node</span><span id="textcolor6063">&#x0027;</span><span id="textcolor6064">)</span> 
<a 
 id="x12-287012r1109"></a> 
<a 
 id="x12-287014r1110"></a>      <span id="textcolor6065">from</span><span id="textcolor6066"> </span><span id="textcolor6067">rcl_interfaces</span><span id="textcolor6068">.</span><span id="textcolor6069">msg</span><span id="textcolor6070"> </span><span id="textcolor6071">import</span> <span id="textcolor6072">ParameterDescriptor</span> 
<a 
 id="x12-287016r1111"></a>      <span id="textcolor6073">my_parameter_descriptor</span> <span id="textcolor6074">=</span> <span id="textcolor6075">ParameterDescriptor</span><span id="textcolor6076">(</span><span id="textcolor6077">description</span><span id="textcolor6078">=</span><span id="textcolor6079">&#x0027;</span><span id="textcolor6080">This parameter is mine!</span><span id="textcolor6081">&#x0027;</span><span id="textcolor6082">)</span> 
<a 
 id="x12-287018r1112"></a> 
<a 
 id="x12-287020r1113"></a>      <span id="textcolor6083">self</span><span id="textcolor6084">.</span><span id="textcolor6085">declare_parameter</span><span id="textcolor6086">(</span><span id="textcolor6087">&#x0027;</span><span id="textcolor6088">my_parameter</span><span id="textcolor6089">&#x0027;</span><span id="textcolor6090">,</span> <span id="textcolor6091">&#x0027;</span><span id="textcolor6092">world</span><span id="textcolor6093">&#x0027;</span><span id="textcolor6094">,</span> <span id="textcolor6095">my_parameter_descriptor</span><span id="textcolor6096">)</span> 
<a 
 id="x12-287022r1114"></a> 
<a 
 id="x12-287024r1115"></a>      <span id="textcolor6097">self</span><span id="textcolor6098">.</span><span id="textcolor6099">timer</span> <span id="textcolor6100">=</span> <span id="textcolor6101">self</span><span id="textcolor6102">.</span><span id="textcolor6103">create_timer</span><span id="textcolor6104">(</span><span id="textcolor6105">1</span><span id="textcolor6106">,</span> <span id="textcolor6107">self</span><span id="textcolor6108">.</span><span id="textcolor6109">timer_callback</span><span id="textcolor6110">)</span></div></pre>
<!--l. 1016--><p class="noindent" >The rest of the code remains the same. Once we run the node, we can then run ros2
param describe <span id="textcolor6111"><code class="verb">/minimal_param_node my_parameter</code></span> to see the type and description.

<a 
 id="paragraph*.130"></a></p>
<!--l. 1019--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-288000"></a>Adding  an  Entry  Point</span>
Open the setup.py file. Again, match the maintainer, <span id="textcolor6112"><code class="verb">maintainer_email</code></span>, description and license fields to our package.xml:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb335" style='padding:20px;border-radius: 3px;'><a 
 id="x12-288002r1122"></a><span id="textcolor6113">maintainer</span><span id="textcolor6114">=</span><span id="textcolor6115">&#x0027;</span><span id="textcolor6116">YourName</span><span id="textcolor6117">&#x0027;</span><span id="textcolor6118">,</span> 
<a 
 id="x12-288004r1123"></a><span id="textcolor6119">maintainer_email</span><span id="textcolor6120">=</span><span id="textcolor6121">&#x0027;</span><span id="textcolor6122">you@email.com</span><span id="textcolor6123">&#x0027;</span><span id="textcolor6124">,</span> 
<a 
 id="x12-288006r1124"></a><span id="textcolor6125">description</span><span id="textcolor6126">=</span><span id="textcolor6127">&#x0027;</span><span id="textcolor6128">Python parameter tutorial</span><span id="textcolor6129">&#x0027;</span><span id="textcolor6130">,</span> 
<a 
 id="x12-288008r1125"></a><span id="textcolor6131">license</span><span id="textcolor6132">=</span><span id="textcolor6133">&#x0027;</span><span id="textcolor6134">Apache License 2.0</span><span id="textcolor6135">&#x0027;</span><span id="textcolor6136">,</span></div></pre>
<!--l. 1026--><p class="noindent" >Add the following line within the <span id="textcolor6137"><code class="verb">console_scripts</code></span> brackets of the <span id="textcolor6138"><code class="verb">entry_points</code></span> field:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb336" style='padding:20px;border-radius: 3px;'><a 
 id="x12-288010r1131"></a><span id="textcolor6139">entry_points</span><span id="textcolor6140">=</span><span id="textcolor6141">{</span> 
<a 
 id="x12-288012r1132"></a>   <span id="textcolor6142">&#x0027;</span><span id="textcolor6143">console_scripts</span><span id="textcolor6144">&#x0027;</span><span id="textcolor6145">:</span> <span id="textcolor6146">[</span> 
<a 
 id="x12-288014r1133"></a>      <span id="textcolor6147">&#x0027;</span><span id="textcolor6148">minimal_param_node = python_parameters.python_parameters_node:main</span><span id="textcolor6149">&#x0027;</span><span id="textcolor6150">,</span> 
<a 
 id="x12-288016r1134"></a>   <span id="textcolor6151">]</span><span id="textcolor6152">,</span> 
<a 
 id="x12-288018r1135"></a><span id="textcolor6153">}</span><span id="textcolor6154">,</span></div></pre>

<a 
 id="paragraph*.131"></a>
<!--l. 1030--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-289000"></a>Building  and  Running  the  Code</span>
It’s good practice to run rosdep in the root of our workspace (<span id="textcolor6155"><code class="verb">ros2\_ws</code></span> ) to check for missing dependencies before building:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb337" style='padding:20px;border-radius: 3px;'><a 
 id="x12-289002r1145"></a>rosdep<span id="textcolor6156"> </span>install<span id="textcolor6157"> </span>-i<span id="textcolor6158"> </span>--from-path<span id="textcolor6159"> </span>src<span id="textcolor6160"> </span>--rosdistro<span id="textcolor6161"> </span>humble<span id="textcolor6162"> </span>-y</div></pre>
<!--l. 1037--><p class="noindent" >Navigate back to the root of our workspace, <span id="textcolor6163"><code class="verb">ros2\_ws</code></span> , and build our new package:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb338" style='padding:20px;border-radius: 3px;'><a 
 id="x12-289004r1150"></a>colcon<span id="textcolor6164"> </span>build<span id="textcolor6165"> </span>--packages-select<span id="textcolor6166"> </span>python_parameters</div></pre>
<!--l. 1041--><p class="noindent" >Open a new terminal, navigate to <span id="textcolor6167"><code class="verb">ros2\_ws</code></span> , and source the setup files:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb339" style='padding:20px;border-radius: 3px;'><a 
 id="x12-289006r1155"></a><span id="textcolor6168">source</span><span id="textcolor6169"> </span>install/setup.bash</div></pre>
<!--l. 1045--><p class="noindent" >Now run the node. The terminal should return Hello world! every second:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb340" style='padding:20px;border-radius: 3px;'><a 
 id="x12-289008r1160"></a>ros2<span id="textcolor6170"> </span>run<span id="textcolor6171"> </span>python_parameters<span id="textcolor6172"> </span>minimal_param_node</div></pre>
<div class="tcolorbox tcolorbox" id="tcolobox-110">     
<div class="tcolorbox-content"><pre><div id="fancyvrb341" style='padding:20px;border-radius: 3px;'><a 
 id="x12-289010r1"></a>[INFO] [parameter_node]: Hello world!</div></pre>
 
</div> 
</div>
<!--l. 1050--><p class="noindent" >Now we can see the default value of our parameter, but we want to be able to set it ourself. There are two ways to accomplish this.

                                                                                
                                                                                
<a 
 id="paragraph*.132"></a></p>
<!--l. 1053--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-290000"></a>Changing  Output  using  the  Console</span>
Make  sure  the  node  is  running:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb342" style='padding:20px;border-radius: 3px;'><a 
 id="x12-290002r1173"></a>ros2<span id="textcolor6173"> </span>run<span id="textcolor6174"> </span>python_parameters<span id="textcolor6175"> </span>minimal_param_node</div></pre>
<!--l. 1059--><p class="noindent" >Open another terminal, source the setup files from inside <span id="textcolor6176"><code class="verb">ros2\_ws</code></span>  again, and enter the following line:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb343" style='padding:20px;border-radius: 3px;'><a 
 id="x12-290004r1178"></a>ros2<span id="textcolor6177"> </span>param<span id="textcolor6178"> </span>list</div></pre>
<!--l. 1064--><p class="noindent" >There we will see the custom parameter <span id="textcolor6179"><code class="verb">my_parameter</code></span>. To change it, simply run the following line in the console:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb344" style='padding:20px;border-radius: 3px;'><a 
 id="x12-290006r1183"></a>ros2<span id="textcolor6180"> </span>param<span id="textcolor6181"> </span><span id="textcolor6182">set</span><span id="textcolor6183"> </span>/minimal_param_node<span id="textcolor6184"> </span>my_parameter<span id="textcolor6185"> </span>earth</div></pre>
<!--l. 1069--><p class="noindent" >We know it went well if we get the output Set parameter successful. If we look at the other
terminal, we should see the output change to <span id="textcolor6186"><code class="verb">[INFO] [minimal_param_node]: Hello earth!</code></span>
</p><!--l. 1072--><p class="noindent" >Since the node afterwards set the parameter back to world, further outputs show:
</p><!--l. 1074--><p class="noindent" >     
</p>
<blockquote class="quote">     
<!--l. 1075--><p class="noindent" ><span id="textcolor6187"><code class="verb">[INFO] [minimal_param_node]: Hello world!</code></span></p></blockquote>

<a 
 id="paragraph*.133"></a>
<!--l. 1078--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-291000"></a>Changing  using  the  Launch  File</span>
We can also set parameters in a launch file, but first we will need to add a launch directory. Inside the <span id="textcolor6188"><code class="verb">ros2_ws/src/python_parameters/</code></span>
directory, create a new directory called launch. In there, create a new file called <span id="textcolor6189"><code class="verb">python_parameters_launch.py</code></span>
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb345" style='padding:20px;border-radius: 3px;'><a 
 id="x12-291002r1190"></a><span id="textcolor6190">from</span><span id="textcolor6191"> </span><span id="textcolor6192">launch</span><span id="textcolor6193"> </span><span id="textcolor6194">import</span> <span id="textcolor6195">LaunchDescription</span> 
<a 
 id="x12-291004r1191"></a><span id="textcolor6196">from</span><span id="textcolor6197"> </span><span id="textcolor6198">launch_ros</span><span id="textcolor6199">.</span><span id="textcolor6200">actions</span><span id="textcolor6201"> </span><span id="textcolor6202">import</span> <span id="textcolor6203">Node</span> 
<a 
 id="x12-291006r1192"></a> 
<a 
 id="x12-291008r1193"></a> 
<a 
 id="x12-291010r1194"></a><span id="textcolor6204">def</span><span id="textcolor6205"> </span><span id="textcolor6206">generate_launch_description</span><span id="textcolor6207">(</span><span id="textcolor6208">)</span><span id="textcolor6209">:</span> 
<a 
 id="x12-291012r1195"></a>   <span id="textcolor6210">return</span> <span id="textcolor6211">LaunchDescription</span><span id="textcolor6212">(</span><span id="textcolor6213">[</span> 
<a 
 id="x12-291014r1196"></a>      <span id="textcolor6214">Node</span><span id="textcolor6215">(</span> 
<a 
 id="x12-291016r1197"></a>         <span id="textcolor6216">package</span><span id="textcolor6217">=</span><span id="textcolor6218">&#x0027;</span><span id="textcolor6219">python_parameters</span><span id="textcolor6220">&#x0027;</span><span id="textcolor6221">,</span> 
<a 
 id="x12-291018r1198"></a>         <span id="textcolor6222">executable</span><span id="textcolor6223">=</span><span id="textcolor6224">&#x0027;</span><span id="textcolor6225">minimal_param_node</span><span id="textcolor6226">&#x0027;</span><span id="textcolor6227">,</span> 
<a 
 id="x12-291020r1199"></a>         <span id="textcolor6228">name</span><span id="textcolor6229">=</span><span id="textcolor6230">&#x0027;</span><span id="textcolor6231">custom_minimal_param_node</span><span id="textcolor6232">&#x0027;</span><span id="textcolor6233">,</span> 
<a 
 id="x12-291022r1200"></a>         <span id="textcolor6234">output</span><span id="textcolor6235">=</span><span id="textcolor6236">&#x0027;</span><span id="textcolor6237">screen</span><span id="textcolor6238">&#x0027;</span><span id="textcolor6239">,</span> 
<a 
 id="x12-291024r1201"></a>         <span id="textcolor6240">emulate_tty</span><span id="textcolor6241">=</span><span id="textcolor6242">True</span><span id="textcolor6243">,</span> 
<a 
 id="x12-291026r1202"></a>         <span id="textcolor6244">parameters</span><span id="textcolor6245">=</span><span id="textcolor6246">[</span> 
<a 
 id="x12-291028r1203"></a>            <span id="textcolor6247">{</span><span id="textcolor6248">&#x0027;</span><span id="textcolor6249">my_parameter</span><span id="textcolor6250">&#x0027;</span><span id="textcolor6251">:</span> <span id="textcolor6252">&#x0027;</span><span id="textcolor6253">earth</span><span id="textcolor6254">&#x0027;</span><span id="textcolor6255">}</span> 
<a 
 id="x12-291030r1204"></a>         <span id="textcolor6256">]</span> 
<a 
 id="x12-291032r1205"></a>      <span id="textcolor6257">)</span> 
<a 
 id="x12-291034r1206"></a>   <span id="textcolor6258">]</span><span id="textcolor6259">)</span></div></pre>
<!--l. 1086--><p class="noindent" >Here we can see that we set <span id="textcolor6260"><code class="verb">my_parameter</code></span> to earth when we launch our node <span id="textcolor6261"><code class="verb">parameter_node</code></span>.
By adding the two lines below, we ensure our output is printed in our console.
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb346" style='padding:20px;border-radius: 3px;'><a 
 id="x12-291036r1211"></a><span id="textcolor6262">output</span><span id="textcolor6263">=</span><span id="textcolor6264">"screen"</span>, 
<a 
 id="x12-291038r1212"></a><span id="textcolor6265">emulate_tty</span><span id="textcolor6266">=</span>True,</div></pre>
<!--l. 1092--><p class="noindent" >Now open the setup.py file. Add the import statements to the top of the file, and the other new statement to the <span id="textcolor6267"><code class="verb">data_files</code></span> parameter to include all launch files:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb347" style='padding:20px;border-radius: 3px;'><a 
 id="x12-291040r1217"></a>import<span id="textcolor6268"> </span>os 
<a 
 id="x12-291042r1218"></a>from<span id="textcolor6269"> </span>glob<span id="textcolor6270"> </span>import<span id="textcolor6271"> </span>glob 
<a 
 id="x12-291044r1219"></a><span id="textcolor6272"># ...</span> 
<a 
 id="x12-291046r1220"></a> 
<a 
 id="x12-291048r1221"></a>setup<span id="textcolor6273">(</span> 
<a 
 id="x12-291050r1222"></a><span id="textcolor6274"> </span><span id="textcolor6275"># ...</span> 
<a 
 id="x12-291052r1223"></a><span id="textcolor6276"> </span><span id="textcolor6277">data_files</span><span id="textcolor6278">=</span><span id="textcolor6279">[</span> 
<a 
 id="x12-291054r1224"></a><span id="textcolor6280">    </span><span id="textcolor6281"># ...</span> 
<a 
 id="x12-291056r1225"></a><span id="textcolor6282">    </span><span id="textcolor6283">(</span>os.path.join<span id="textcolor6284">(</span><span id="textcolor6285">&#x0027;share&#x0027;</span>,<span id="textcolor6286"> </span>package_name,<span id="textcolor6287"> </span><span id="textcolor6288">&#x0027;launch&#x0027;</span><span id="textcolor6289">)</span>,<span id="textcolor6290"> </span>glob<span id="textcolor6291">(</span><span id="textcolor6292">&#x0027;launch/*&#x0027;</span><span id="textcolor6293">)</span><span id="textcolor6294">)</span>, 
<a 
 id="x12-291058r1226"></a><span id="textcolor6295">   </span><span id="textcolor6296">]</span> 
<a 
 id="x12-291060r1227"></a><span id="textcolor6297"> </span><span id="textcolor6298">)</span></div></pre>
<!--l. 1097--><p class="noindent" >Open a console and navigate to the root of our workspace, <span id="textcolor6299"><code class="verb">ros2\_ws</code></span> , and build our new package:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb348" style='padding:20px;border-radius: 3px;'><a 
 id="x12-291062r1233"></a>colcon<span id="textcolor6300"> </span>build<span id="textcolor6301"> </span>--packages-select<span id="textcolor6302"> </span>python_parameters</div></pre>
<!--l. 1102--><p class="noindent" >Then  source  the  setup  files  in  a  new  terminal:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb349" style='padding:20px;border-radius: 3px;'><a 
 id="x12-291064r1238"></a><span id="textcolor6303">source</span><span id="textcolor6304"> </span>install/setup.bash</div></pre>
<!--l. 1106--><p class="noindent" >Now run the node using the launch file we have just created. The terminal should return the following message the first time:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb350" style='padding:20px;border-radius: 3px;'><a 
 id="x12-291066r1243"></a>ros2<span id="textcolor6305"> </span>launch<span id="textcolor6306"> </span>python_parameters<span id="textcolor6307"> </span>python_parameters_launch.py</div></pre>
<div class="tcolorbox tcolorbox" id="tcolobox-111">     
<div class="tcolorbox-content"><pre><div id="fancyvrb351" style='padding:20px;border-radius: 3px;'><a 
 id="x12-291068r1"></a>[INFO] [custom_minimal_param_node]: Hello earth!</div></pre>
 
</div> 
</div>
<!--l. 1111--><p class="noindent" >Further outputs should show <span id="textcolor6308"><code class="verb">[INFO] [minimal_param_node]: Hello world!</code></span> every second.
                                                                                
                                                                                
</p><!--l. 1113--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">10.8</span>  <a 
 id="x12-29200010.8"></a>Managing  Dependencies</h3>

<h4 class="subsectionHead"><span class="titlemark">10.8.1</span>  <a 
 id="x12-29300010.8.1"></a>Explaining  Rosdep</h4>
<!--l. 1117--><p class="noindent" >rosdep is a dependency management utility that can work with packages and external libraries. It is a
command-line utility for identifying and installing dependencies to build or install a package. rosdep is not a
package manager in its own right; it is a meta-package manager that uses its own knowledge of the system
and the dependencies to find the appropriate package to install on a particular platform. The actual
installation is done using the system package manager (e.g. apt on Debian/Ubuntu, dnf on Fedora/RHEL, etc).
</p><!--l. 1124--><p class="noindent" >It is most often invoked before building a workspace, where it is used to install the dependencies of the packages within that workspace.
</p><!--l. 1127--><p class="noindent" >It has the ability to work over a single package or over a directory of packages (e.g. workspace).
</p>
<div class="warning">
<!--l. 1135--><p class="noindent" >While the name suggests it is for ROS, rosdep is semi-agnostic to ROS. We can utilize this powerful tool in non-ROS
software projects by installing it as a standalone Python package. Successfully running rosdep relies on rosdep
keys to be available, which can be downloaded from a public git repository with a few simple commands. </p></div>

<h4 class="subsectionHead"><span class="titlemark">10.8.2</span>  <a 
 id="x12-29400010.8.2"></a>Explaining  Pacakge  Manifesto</h4>
<!--l. 1139--><p class="noindent" >The package.xml is the file in our software where rosdep finds the set of dependencies. It is important that the list
of dependencies in the package.xml is complete and correct, which allows all of the tooling to determine
the packages dependencies. Missing or incorrect dependencies can lead to users not being able to use our
package, to packages in a workspace being built out-of-order, and to packages not being able to be released.
</p><!--l. 1145--><p class="noindent" >The dependencies in the package.xml file are generally referred to as “rosdep keys”. These dependencies are manually populated in the
package.xml file by the package’s creators and should be an exhaustive list of any non-builtin libraries and packages it requires.
</p><!--l. 1149--><p class="noindent" >These are represented in the following tags (see REP-149 for the full specification):
</p>     
<dl class="description"><dt class="description">
<span id="textcolor6309"><code class="verb"><depend></code></span> 
</dt><dd 
class="description">
<!--l. 1152--><p class="noindent" >     
These
are
dependencies
that
should
be
provided
at
both
build
time
and
run
time
for
our
package.
For
C++
packages,
if
in
doubt,
use
this
tag.
                                                                                
                                                                                
     
Pure
Python
packages
generally
don’t
have
a
build
phase,
so
should
never
use
this
and
should
use
<span id="textcolor6310"><code class="verb">&lt;exec_depend&gt;</code></span>
instead.
</p>     
</dd>
<dt class="description">
<span id="textcolor6311"><code class="verb"><build_depend></code></span> 
</dt><dd 
class="description">
<!--l. 1156--><p class="noindent" >     
If
we
only
use
a
particular
dependency
for
building
our
package,
and
not
at
execution
time,
we
can
use
the
<span id="textcolor6312"><code class="verb">&lt;build_depend&gt;</code></span>
tag.
</p>     
<!--l. 1159--><p class="noindent" >With
this
type
of
dependency,
an
installed
binary
of
our
package
does
not
require
that
particular
package
to
be
installed.
                                                                                
                                                                                
     
</p>
<!--l. 1162--><p class="noindent" >However,
that
can
create
a
problem
if
our
package
exports
a
header
that
includes
a
header
from
this
dependency.
In
that
case
we
also
need
a
<span id="textcolor6313"><code class="verb">&lt;build_export_depend&gt;</code></span>.</p></dd></dl>
                                                                                
                                                                                
<!--l. 1166--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">10.9</span>  <a 
 id="x12-29500010.9"></a>Creating  an  Action</h3>
<!--l. 1168--><p class="noindent" >We learned about actions previously in the Understanding actions tutorial. Like the other communication types and their
respective interfaces (topics/msg and services/srv), we can also custom-define actions in our packages. This tutorial shows you
how to define and build an action that we can use with the action server and action client we will write in the next tutorial.
</p><!--l. 1174--><p class="noindent" >Before we start, let’s setup everything and make sure the requisites are in order:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb352" style='padding:20px;border-radius: 3px;'><a 
 id="x12-295002r1258"></a>mkdir<span id="textcolor6314"> </span>-p<span id="textcolor6315"> </span>ros2_ws/src<span id="textcolor6316"> </span><span id="textcolor6317"># you can reuse an existing workspace </span> 
<a 
 id="x12-295004r1259"></a><span id="textcolor6318">cd</span><span id="textcolor6319"> </span>ros2_ws/src 
<a 
 id="x12-295006r1260"></a>ros2<span id="textcolor6320"> </span>pkg<span id="textcolor6321"> </span>create<span id="textcolor6322"> </span>action_tutorials_interfaces</div></pre>

<a 
 id="paragraph*.134"></a>
<!--l. 1178--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-296000"></a>Defining  an  Action</span>
Actions  are  defined  in  <span id="textcolor6323"><code class="verb">.action</code></span> files  of  the  form:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb353" style='padding:20px;border-radius: 3px;'><a 
 id="x12-296002r1265"></a># Request 
<a 
 id="x12-296004r1266"></a>--- 
<a 
 id="x12-296006r1267"></a># Result 
<a 
 id="x12-296008r1268"></a>--- 
<a 
 id="x12-296010r1269"></a># Feedback</div></pre>
<!--l. 1184--><p class="noindent" >An action definition is made up of three message definitions separated by <span id="textcolor6324"><code class="verb">---</code></span>.
</p><!--l. 1186--><p class="noindent" >A request message is sent from an action client to an action server initiating a new goal.
</p><!--l. 1188--><p class="noindent" >A result message is sent from an action server to an action client when a goal is done.
</p><!--l. 1190--><p class="noindent" >Feedback messages are periodically sent from an action server to an action client with updates about a goal.
</p><!--l. 1193--><p class="noindent" >An instance of an action is typically referred to as a goal.
</p><!--l. 1195--><p class="noindent" >Say we want to define a new action “Fibonacci” for computing the Fibonacci sequence.
</p><!--l. 1197--><p class="noindent" >Create an action directory in our <a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a> package <span id="textcolor6325"><code class="verb">action_tutorials_interfaces</code></span>:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb354" style='padding:20px;border-radius: 3px;'><a 
 id="x12-296012r1274"></a><span id="textcolor6326">cd</span><span id="textcolor6327"> </span>action_tutorials_interfaces 
<a 
 id="x12-296014r1275"></a>mkdir<span id="textcolor6328"> </span>action</div></pre>
<!--l. 1201--><p class="noindent" >Within the action directory, create a file called Fibonacci.action with the following contents:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb355" style='padding:20px;border-radius: 3px;'><a 
 id="x12-296016r1280"></a>int32 order 
<a 
 id="x12-296018r1281"></a>--- 
<a 
 id="x12-296020r1282"></a>int32[] sequence 
<a 
 id="x12-296022r1283"></a>--- 
<a 
 id="x12-296024r1284"></a>int32[] partial_sequence</div></pre>
<!--l. 1205--><p class="noindent" >The goal request is the order of the Fibonacci sequence we want to compute, the
result is the final sequence, and the feedback is the <span id="textcolor6329"><code class="verb">partial_sequence</code></span> computed so far.

<a 
 id="paragraph*.135"></a></p>
<!--l. 1207--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-297000"></a>Building  an  Action</span>
Before we can use the new Fibonacci action type in our code, we must pass the definition to the rosidl code generation pipeline.
</p><!--l. 1212--><p class="noindent" >This is accomplished by adding the following lines to our CMakeLists.txt before the <span id="textcolor6330"><code class="verb">ament_package()</code></span> line, in the <span id="textcolor6331"><code class="verb">action_tutorials_interfaces</code></span>:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb356" style='padding:20px;border-radius: 3px;'><a 
 id="x12-297002r1291"></a><span id="textcolor6332">find_package</span><span id="textcolor6333">(</span><span id="textcolor6334">rosidl_default_generators</span><span id="textcolor6335"> </span><span id="textcolor6336">REQUIRED</span><span id="textcolor6337">)</span> 
<a 
 id="x12-297004r1292"></a> 
<a 
 id="x12-297006r1293"></a><span id="textcolor6338">rosidl_generate_interfaces</span><span id="textcolor6339">(</span><span id="textcolor6340">${</span><span id="textcolor6341">PROJECT_NAME</span><span id="textcolor6342">}</span> 
<a 
 id="x12-297008r1294"></a><span id="textcolor6343"> </span><span id="textcolor6344">"action/Fibonacci.action"</span> 
<a 
 id="x12-297010r1295"></a><span id="textcolor6345">)</span></div></pre>
<!--l. 1217--><p class="noindent" >We should also add the required dependencies to our package.xml:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb357" style='padding:20px;border-radius: 3px;'><a 
 id="x12-297012r1300"></a><span id="textcolor6346">&lt;buildtool_depend</span><span id="textcolor6347">&gt;</span>rosidl_default_generators<span id="textcolor6348">&lt;/buildtool_depend&gt;</span> 
<a 
 id="x12-297014r1301"></a><span id="textcolor6349">&lt;depend</span><span id="textcolor6350">&gt;</span>action_msgs<span id="textcolor6351">&lt;/depend&gt;</span> 
<a 
 id="x12-297016r1302"></a><span id="textcolor6352">&lt;member_of_group</span><span id="textcolor6353">&gt;</span>rosidl_interface_packages<span id="textcolor6354">&lt;/member_of_group&gt;</span></div></pre>
<!--l. 1221--><p class="noindent" >Note, we need to depend on <span id="textcolor6355"><code class="verb">action_msgs</code></span> since action definitions include additional metadata (e.g. goal IDs).
</p><!--l. 1224--><p class="noindent" >We should now be able to build the package containing the Fibonacci action definition:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb358" style='padding:20px;border-radius: 3px;'><a 
 id="x12-297018r1307"></a><span id="textcolor6356">cd</span><span id="textcolor6357"> </span>~/ros2_ws<span id="textcolor6358"> </span><span id="textcolor6359"># Change to the root of the workspace</span> 
<a 
 id="x12-297020r1308"></a>colcon<span id="textcolor6360"> </span>build<span id="textcolor6361"> </span><span id="textcolor6362"># Build</span></div></pre>
                                                                                
                                                                                
<!--l. 1228--><p class="noindent" >We’re  done!
</p><!--l. 1230--><p class="noindent" >By convention, action types will be prefixed by their package name and the word action. So when we want
to refer to our new action, it will have the full name <span id="textcolor6363"><code class="verb">action_tutorials_interfaces/action/Fibonacci</code></span>.
</p><!--l. 1232--><p class="noindent" >We can check that our action built successfully with the command line tool:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb359" style='padding:20px;border-radius: 3px;'><a 
 id="x12-297022r1313"></a>.<span id="textcolor6364"> </span>install/setup.bash<span id="textcolor6365">  </span><span id="textcolor6366"># Source our workspace.</span> 
<a 
 id="x12-297024r1314"></a><span id="textcolor6367"># Check that our action definition exists</span> 
<a 
 id="x12-297026r1315"></a>ros2<span id="textcolor6368"> </span>interface<span id="textcolor6369"> </span>show<span id="textcolor6370"> </span>action_tutorials_interfaces/action/Fibonacci<span id="textcolor6371">  </span></div></pre>
<!--l. 1236--><p class="noindent" >We should see the Fibonacci action definition printed to the screen.
                                                                                
                                                                                
</p><!--l. 1238--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">10.10</span>  <a 
 id="x12-29800010.10"></a>Writing  an  Action  Server  and  Client</h3>
<!--l. 1240--><p class="noindent" >Actions are a form of asynchronous communication in <a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>. Action clients send goal
requests to action servers. Action servers send goal feedback and results to action clients.

<a 
 id="paragraph*.136"></a></p>
<!--l. 1243--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-299000"></a>Writing  an  Action  Server</span>
Let’s focus on writing an action server that computes the Fibonacci sequence using the action we created in the Creating an action tutorial.
</p><!--l. 1248--><p class="noindent" >Until now, we’ve created packages and used ros2 run to run our nodes. To keep things simple in this tutorial, however, we’ll scope the
action server to a single file. If we’d like to see what a complete package for the actions tutorials looks like, check out <span id="textcolor6372"><code class="verb">action_tutorials</code></span>.
</p><!--l. 1253--><p class="noindent" >Open a new file in our home directory, let’s call it <span id="textcolor6373"><code class="verb">fibonacci_action_server.py</code></span>, and add the following code:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb360" style='padding:20px;border-radius: 3px;'><a 
 id="x12-299002r1326"></a><span id="textcolor6374">import</span><span id="textcolor6375"> </span><span id="textcolor6376">rclpy</span> 
<a 
 id="x12-299004r1327"></a><span id="textcolor6377">from</span><span id="textcolor6378"> </span><span id="textcolor6379">rclpy</span><span id="textcolor6380">.</span><span id="textcolor6381">action</span><span id="textcolor6382"> </span><span id="textcolor6383">import</span> <span id="textcolor6384">ActionServer</span> 
<a 
 id="x12-299006r1328"></a><span id="textcolor6385">from</span><span id="textcolor6386"> </span><span id="textcolor6387">rclpy</span><span id="textcolor6388">.</span><span id="textcolor6389">node</span><span id="textcolor6390"> </span><span id="textcolor6391">import</span> <span id="textcolor6392">Node</span> 
<a 
 id="x12-299008r1329"></a> 
<a 
 id="x12-299010r1330"></a><span id="textcolor6393">from</span><span id="textcolor6394"> </span><span id="textcolor6395">action_tutorials_interfaces</span><span id="textcolor6396">.</span><span id="textcolor6397">action</span><span id="textcolor6398"> </span><span id="textcolor6399">import</span> <span id="textcolor6400">Fibonacci</span> 
<a 
 id="x12-299012r1331"></a> 
<a 
 id="x12-299014r1332"></a> 
<a 
 id="x12-299016r1333"></a><span id="textcolor6401">class</span><span id="textcolor6402"> </span><span id="textcolor6403">FibonacciActionServer</span><span id="textcolor6404">(</span><span id="textcolor6405">Node</span><span id="textcolor6406">)</span><span id="textcolor6407">:</span> 
<a 
 id="x12-299018r1334"></a> 
<a 
 id="x12-299020r1335"></a>   <span id="textcolor6408">def</span><span id="textcolor6409"> </span><span id="textcolor6410">__init__</span><span id="textcolor6411">(</span><span id="textcolor6412">self</span><span id="textcolor6413">)</span><span id="textcolor6414">:</span> 
<a 
 id="x12-299022r1336"></a>      <span id="textcolor6415">super</span><span id="textcolor6416">(</span><span id="textcolor6417">)</span><span id="textcolor6418">.</span><span id="textcolor6419">__init__</span><span id="textcolor6420">(</span><span id="textcolor6421">&#x0027;</span><span id="textcolor6422">fibonacci_action_server</span><span id="textcolor6423">&#x0027;</span><span id="textcolor6424">)</span> 
<a 
 id="x12-299024r1337"></a>      <span id="textcolor6425">self</span><span id="textcolor6426">.</span><span id="textcolor6427">_action_server</span> <span id="textcolor6428">=</span> <span id="textcolor6429">ActionServer</span><span id="textcolor6430">(</span> 
<a 
 id="x12-299026r1338"></a>         <span id="textcolor6431">self</span><span id="textcolor6432">,</span> 
<a 
 id="x12-299028r1339"></a>         <span id="textcolor6433">Fibonacci</span><span id="textcolor6434">,</span> 
<a 
 id="x12-299030r1340"></a>         <span id="textcolor6435">&#x0027;</span><span id="textcolor6436">fibonacci</span><span id="textcolor6437">&#x0027;</span><span id="textcolor6438">,</span> 
<a 
 id="x12-299032r1341"></a>         <span id="textcolor6439">self</span><span id="textcolor6440">.</span><span id="textcolor6441">execute_callback</span><span id="textcolor6442">)</span> 
<a 
 id="x12-299034r1342"></a> 
<a 
 id="x12-299036r1343"></a>   <span id="textcolor6443">def</span><span id="textcolor6444"> </span><span id="textcolor6445">execute_callback</span><span id="textcolor6446">(</span><span id="textcolor6447">self</span><span id="textcolor6448">,</span> <span id="textcolor6449">goal_handle</span><span id="textcolor6450">)</span><span id="textcolor6451">:</span> 
<a 
 id="x12-299038r1344"></a>      <span id="textcolor6452">self</span><span id="textcolor6453">.</span><span id="textcolor6454">get_logger</span><span id="textcolor6455">(</span><span id="textcolor6456">)</span><span id="textcolor6457">.</span><span id="textcolor6458">info</span><span id="textcolor6459">(</span><span id="textcolor6460">&#x0027;</span><span id="textcolor6461">Executing goal...</span><span id="textcolor6462">&#x0027;</span><span id="textcolor6463">)</span> 
<a 
 id="x12-299040r1345"></a>      <span id="textcolor6464">result</span> <span id="textcolor6465">=</span> <span id="textcolor6466">Fibonacci</span><span id="textcolor6467">.</span><span id="textcolor6468">Result</span><span id="textcolor6469">(</span><span id="textcolor6470">)</span> 
<a 
 id="x12-299042r1346"></a>      <span id="textcolor6471">return</span> <span id="textcolor6472">result</span> 
<a 
 id="x12-299044r1347"></a> 
<a 
 id="x12-299046r1348"></a> 
<a 
 id="x12-299048r1349"></a><span id="textcolor6473">def</span><span id="textcolor6474"> </span><span id="textcolor6475">main</span><span id="textcolor6476">(</span><span id="textcolor6477">args</span><span id="textcolor6478">=</span><span id="textcolor6479">None</span><span id="textcolor6480">)</span><span id="textcolor6481">:</span> 
<a 
 id="x12-299050r1350"></a>   <span id="textcolor6482">rclpy</span><span id="textcolor6483">.</span><span id="textcolor6484">init</span><span id="textcolor6485">(</span><span id="textcolor6486">args</span><span id="textcolor6487">=</span><span id="textcolor6488">args</span><span id="textcolor6489">)</span> 
<a 
 id="x12-299052r1351"></a> 
<a 
 id="x12-299054r1352"></a>   <span id="textcolor6490">fibonacci_action_server</span> <span id="textcolor6491">=</span> <span id="textcolor6492">FibonacciActionServer</span><span id="textcolor6493">(</span><span id="textcolor6494">)</span> 
<a 
 id="x12-299056r1353"></a> 
<a 
 id="x12-299058r1354"></a>   <span id="textcolor6495">rclpy</span><span id="textcolor6496">.</span><span id="textcolor6497">spin</span><span id="textcolor6498">(</span><span id="textcolor6499">fibonacci_action_server</span><span id="textcolor6500">)</span> 
<a 
 id="x12-299060r1355"></a> 
<a 
 id="x12-299062r1356"></a> 
<a 
 id="x12-299064r1357"></a><span id="textcolor6501">if</span> <span id="textcolor6502">__name__</span> <span id="textcolor6503">==</span> <span id="textcolor6504">&#x0027;</span><span id="textcolor6505">__main__</span><span id="textcolor6506">&#x0027;</span><span id="textcolor6507">:</span> 
<a 
 id="x12-299066r1358"></a>   <span id="textcolor6508">main</span><span id="textcolor6509">(</span><span id="textcolor6510">)</span></div></pre>
                                                                                
                                                                                
<!--l. 1258--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">10.11</span>  <a 
 id="x12-30000010.11"></a>Writing  a  Launch  File</h3>
<!--l. 1260--><p class="noindent" >The launch system in <a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a> is responsible for helping the user describe the <alert style="color: #821131;">configuration of
their system and then execute it as described</alert>. The configuration of the system includes: </p>
<ul class="itemize1">     
<li class="itemize">
<!--l. 1265--><p class="noindent" >what
programs
to
run,
where
to
run
them,
</p>     
</li>
<li class="itemize">     
<!--l. 1266--><p class="noindent" >what
arguments
to
pass
them,
and
</p>     
</li>
<li class="itemize">     
<!--l. 1267--><p class="noindent" >ROS-specific
conventions
which
make
it
easy
to
reuse
components
throughout
the
system
by
giving
them
each
a
different
configuration</p></li></ul>
<!--l. 1271--><p class="noindent" >It is also responsible for monitoring the state of the processes launched, and reporting and/or reacting to changes in the state of those processes.
</p><!--l. 1274--><p class="noindent" >Launch files written in <alert style="color: #821131;">XML</alert>, <alert style="color: #821131;">YAML</alert>, or <alert style="color: #821131;">Python</alert> can start and stop different nodes as well as trigger and act on various events.
</p>
<div class="knowledge">
<!--l. 1280--><p class="noindent" >The package providing this framework is <span id="textcolor6514"><code class="verb">launch_ros</code></span>, which uses the non-ROS-specific launch framework underneath. </p></div>
<!--l. 1282--><p class="noindent" >So now we got the preliminary information out of the way, let us start with working on writing our own launch file.

<a 
 id="paragraph*.137"></a></p>
<!--l. 1285--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-301000"></a>Creating  a  Launch  Directory</span>
We start by creating a new directory to store our launch files:
</p><!--l. 1--><p class="noindent" >
                                                                                
                                                                                

</p>
<pre><div id="fancyvrb361" style='padding:20px;border-radius: 3px;'><a 
 id="x12-301002r1561"></a>mkdir<span id="textcolor6515"> </span>launch</div></pre>

<a 
 id="paragraph*.138"></a>
<!--l. 1291--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-302000"></a>Writing  our  Launch  File</span>
Let’s put together a <a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a> launch file using the <span id="textcolor6516"><code class="verb">turtlesim</code></span> package and its executables. As mentioned previously, this can either be
in XML, YAML, or Python. However for the sake of coherence, we shall only look at the Python version of it.
</p><!--l. 1297--><p class="noindent" >Please copy and paste the code into <span id="textcolor6517"><code class="verb">launch/turtlesim\_mimic\_launch.py</code></span>  file:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb362" style='padding:20px;border-radius: 3px;'><a 
 id="x12-302002r1566"></a><span id="textcolor6518">from</span><span id="textcolor6519"> </span><span id="textcolor6520">launch</span><span id="textcolor6521"> </span><span id="textcolor6522">import</span> <span id="textcolor6523">LaunchDescription</span> 
<a 
 id="x12-302004r1567"></a><span id="textcolor6524">from</span><span id="textcolor6525"> </span><span id="textcolor6526">launch_ros</span><span id="textcolor6527">.</span><span id="textcolor6528">actions</span><span id="textcolor6529"> </span><span id="textcolor6530">import</span> <span id="textcolor6531">Node</span> 
<a 
 id="x12-302006r1568"></a> 
<a 
 id="x12-302008r1569"></a> 
<a 
 id="x12-302010r1570"></a><span id="textcolor6532">def</span><span id="textcolor6533"> </span><span id="textcolor6534">generate_launch_description</span><span id="textcolor6535">(</span><span id="textcolor6536">)</span><span id="textcolor6537">:</span> 
<a 
 id="x12-302012r1571"></a>   <span id="textcolor6538">return</span> <span id="textcolor6539">LaunchDescription</span><span id="textcolor6540">(</span><span id="textcolor6541">[</span> 
<a 
 id="x12-302014r1572"></a>      <span id="textcolor6542">Node</span><span id="textcolor6543">(</span> 
<a 
 id="x12-302016r1573"></a>         <span id="textcolor6544">package</span><span id="textcolor6545">=</span><span id="textcolor6546">&#x0027;</span><span id="textcolor6547">turtlesim</span><span id="textcolor6548">&#x0027;</span><span id="textcolor6549">,</span> 
<a 
 id="x12-302018r1574"></a>         <span id="textcolor6550">namespace</span><span id="textcolor6551">=</span><span id="textcolor6552">&#x0027;</span><span id="textcolor6553">turtlesim1</span><span id="textcolor6554">&#x0027;</span><span id="textcolor6555">,</span> 
<a 
 id="x12-302020r1575"></a>         <span id="textcolor6556">executable</span><span id="textcolor6557">=</span><span id="textcolor6558">&#x0027;</span><span id="textcolor6559">turtlesim_node</span><span id="textcolor6560">&#x0027;</span><span id="textcolor6561">,</span> 
<a 
 id="x12-302022r1576"></a>         <span id="textcolor6562">name</span><span id="textcolor6563">=</span><span id="textcolor6564">&#x0027;</span><span id="textcolor6565">sim</span><span id="textcolor6566">&#x0027;</span> 
<a 
 id="x12-302024r1577"></a>      <span id="textcolor6567">)</span><span id="textcolor6568">,</span> 
<a 
 id="x12-302026r1578"></a>      <span id="textcolor6569">Node</span><span id="textcolor6570">(</span> 
<a 
 id="x12-302028r1579"></a>         <span id="textcolor6571">package</span><span id="textcolor6572">=</span><span id="textcolor6573">&#x0027;</span><span id="textcolor6574">turtlesim</span><span id="textcolor6575">&#x0027;</span><span id="textcolor6576">,</span> 
<a 
 id="x12-302030r1580"></a>         <span id="textcolor6577">namespace</span><span id="textcolor6578">=</span><span id="textcolor6579">&#x0027;</span><span id="textcolor6580">turtlesim2</span><span id="textcolor6581">&#x0027;</span><span id="textcolor6582">,</span> 
<a 
 id="x12-302032r1581"></a>         <span id="textcolor6583">executable</span><span id="textcolor6584">=</span><span id="textcolor6585">&#x0027;</span><span id="textcolor6586">turtlesim_node</span><span id="textcolor6587">&#x0027;</span><span id="textcolor6588">,</span> 
<a 
 id="x12-302034r1582"></a>         <span id="textcolor6589">name</span><span id="textcolor6590">=</span><span id="textcolor6591">&#x0027;</span><span id="textcolor6592">sim</span><span id="textcolor6593">&#x0027;</span> 
<a 
 id="x12-302036r1583"></a>      <span id="textcolor6594">)</span><span id="textcolor6595">,</span> 
<a 
 id="x12-302038r1584"></a>      <span id="textcolor6596">Node</span><span id="textcolor6597">(</span> 
<a 
 id="x12-302040r1585"></a>         <span id="textcolor6598">package</span><span id="textcolor6599">=</span><span id="textcolor6600">&#x0027;</span><span id="textcolor6601">turtlesim</span><span id="textcolor6602">&#x0027;</span><span id="textcolor6603">,</span> 
<a 
 id="x12-302042r1586"></a>         <span id="textcolor6604">executable</span><span id="textcolor6605">=</span><span id="textcolor6606">&#x0027;</span><span id="textcolor6607">mimic</span><span id="textcolor6608">&#x0027;</span><span id="textcolor6609">,</span> 
<a 
 id="x12-302044r1587"></a>         <span id="textcolor6610">name</span><span id="textcolor6611">=</span><span id="textcolor6612">&#x0027;</span><span id="textcolor6613">mimic</span><span id="textcolor6614">&#x0027;</span><span id="textcolor6615">,</span> 
<a 
 id="x12-302046r1588"></a>         <span id="textcolor6616">remappings</span><span id="textcolor6617">=</span><span id="textcolor6618">[</span> 
<a 
 id="x12-302048r1589"></a>            <span id="textcolor6619">(</span><span id="textcolor6620">&#x0027;</span><span id="textcolor6621">/input/pose</span><span id="textcolor6622">&#x0027;</span><span id="textcolor6623">,</span> <span id="textcolor6624">&#x0027;</span><span id="textcolor6625">/turtlesim1/turtle1/pose</span><span id="textcolor6626">&#x0027;</span><span id="textcolor6627">)</span><span id="textcolor6628">,</span> 
<a 
 id="x12-302050r1590"></a>            <span id="textcolor6629">(</span><span id="textcolor6630">&#x0027;</span><span id="textcolor6631">/output/cmd_vel</span><span id="textcolor6632">&#x0027;</span><span id="textcolor6633">,</span> <span id="textcolor6634">&#x0027;</span><span id="textcolor6635">/turtlesim2/turtle1/cmd_vel</span><span id="textcolor6636">&#x0027;</span><span id="textcolor6637">)</span><span id="textcolor6638">,</span> 
<a 
 id="x12-302052r1591"></a>         <span id="textcolor6639">]</span> 
<a 
 id="x12-302054r1592"></a>      <span id="textcolor6640">)</span> 
<a 
 id="x12-302056r1593"></a>   <span id="textcolor6641">]</span><span id="textcolor6642">)</span></div></pre>

<a 
 id="paragraph*.139"></a>
<!--l. 1301--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-303000"></a>Understanding  the  Launch  File</span>
All of the launch files above are launching a system of three (<alert style="color: #821131;">3</alert>) nodes, all from the turtlesim package. The goal
of the system is to launch two (<alert style="color: #821131;">2</alert>) turtlesim windows, and have one turtle mimic the movements of the other.
</p><!--l. 1307--><p class="noindent" >When launching the two (<alert style="color: #821131;">2</alert>) turtlesim nodes, the only difference between them is their <alert style="color: #821131;">namespace</alert> values.
Unique namespaces allow the system to start two (<alert style="color: #821131;">2</alert>) nodes without node name or topic name conflicts. Both
turtles in this system receive commands over the same topic and publish their pose over the same topic.
</p>
<div class="knowledge">
<!--l. 1314--><p class="noindent" >With unique namespaces, messages meant for different turtles can be distinguished. </p></div>
<!--l. 1316--><p class="noindent" >The final node is also from the turtlesim package, but a different executable:
</p><!--l. 1318--><p class="noindent" >     
</p>
<blockquote class="quote">     
<!--l. 1319--><p class="noindent" ><span id="textcolor6643"><code class="verb">mimic</code></span>.</p></blockquote>
<!--l. 1322--><p class="noindent" >This node has added configuration details in the form of remappings. mimic’s <span id="textcolor6644"><code class="verb">input/pose</code></span> topic is
remapped to <span id="textcolor6645"><code class="verb">turtlesim1/turtle1/pose</code></span> and it’s <span id="textcolor6646"><code class="verb">output/cmd\_vel</code></span> topic to <span id="textcolor6647"><code class="verb">turtlesim2/turtle1/cmd\_vel</code></span>.
</p><!--l. 1326--><p class="noindent" >This means mimic will subscribe to <span id="textcolor6648"><code class="verb">turtlesim1/sim</code></span> pose topic and republish it for <span id="textcolor6649"><code class="verb">turtlesim2/sim</code></span> velocity command topic to subscribe to.
</p>
<div class="warning">
<!--l. 1331--><p class="noindent" >In other words, turtlesim2 will mimic turtlesim1’s movements. </p></div>
<!--l. 1333--><p class="noindent" >Now to see what is going on with the launch file. These import statements pull in some Python launch modules.
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb363" style='padding:20px;border-radius: 3px;'><a 
 id="x12-303002r1598"></a><span id="textcolor6650">from</span><span id="textcolor6651"> </span><span id="textcolor6652">launch</span><span id="textcolor6653"> </span><span id="textcolor6654">import</span> <span id="textcolor6655">LaunchDescription</span> 
<a 
 id="x12-303004r1599"></a><span id="textcolor6656">from</span><span id="textcolor6657"> </span><span id="textcolor6658">launch_ros</span><span id="textcolor6659">.</span><span id="textcolor6660">actions</span><span id="textcolor6661"> </span><span id="textcolor6662">import</span> <span id="textcolor6663">Node</span></div></pre>
<!--l. 1338--><p class="noindent" >Next,  the  launch  description  itself  begins:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb364" style='padding:20px;border-radius: 3px;'><a 
 id="x12-303006r1604"></a><span id="textcolor6664">def</span><span id="textcolor6665"> </span><span id="textcolor6666">generate_launch_description</span><span id="textcolor6667">(</span><span id="textcolor6668">)</span><span id="textcolor6669">:</span> 
<a 
 id="x12-303008r1605"></a>   <span id="textcolor6670">return</span> <span id="textcolor6671">LaunchDescription</span><span id="textcolor6672">(</span><span id="textcolor6673">[</span> 
<a 
 id="x12-303010r1606"></a>      <span id="textcolor6674">Node</span><span id="textcolor6675">(</span> 
<a 
 id="x12-303012r1607"></a>   <span id="textcolor6676">]</span><span id="textcolor6677">)</span></div></pre>
<!--l. 1342--><p class="noindent" >The first two actions in the launch description launch the two turtlesim windows:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb365" style='padding:20px;border-radius: 3px;'><a 
 id="x12-303014r1612"></a>      <span id="textcolor6678">Node</span><span id="textcolor6679">(</span> 
<a 
 id="x12-303016r1613"></a>         <span id="textcolor6680">package</span><span id="textcolor6681">=</span><span id="textcolor6682">&#x0027;</span><span id="textcolor6683">turtlesim</span><span id="textcolor6684">&#x0027;</span><span id="textcolor6685">,</span> 
<a 
 id="x12-303018r1614"></a>         <span id="textcolor6686">namespace</span><span id="textcolor6687">=</span><span id="textcolor6688">&#x0027;</span><span id="textcolor6689">turtlesim1</span><span id="textcolor6690">&#x0027;</span><span id="textcolor6691">,</span> 
<a 
 id="x12-303020r1615"></a>         <span id="textcolor6692">executable</span><span id="textcolor6693">=</span><span id="textcolor6694">&#x0027;</span><span id="textcolor6695">turtlesim_node</span><span id="textcolor6696">&#x0027;</span><span id="textcolor6697">,</span> 
<a 
 id="x12-303022r1616"></a>         <span id="textcolor6698">name</span><span id="textcolor6699">=</span><span id="textcolor6700">&#x0027;</span><span id="textcolor6701">sim</span><span id="textcolor6702">&#x0027;</span> 
<a 
 id="x12-303024r1617"></a>      <span id="textcolor6703">)</span><span id="textcolor6704">,</span> 
<a 
 id="x12-303026r1618"></a>      <span id="textcolor6705">Node</span><span id="textcolor6706">(</span> 
<a 
 id="x12-303028r1619"></a>         <span id="textcolor6707">package</span><span id="textcolor6708">=</span><span id="textcolor6709">&#x0027;</span><span id="textcolor6710">turtlesim</span><span id="textcolor6711">&#x0027;</span><span id="textcolor6712">,</span> 
<a 
 id="x12-303030r1620"></a>         <span id="textcolor6713">namespace</span><span id="textcolor6714">=</span><span id="textcolor6715">&#x0027;</span><span id="textcolor6716">turtlesim2</span><span id="textcolor6717">&#x0027;</span><span id="textcolor6718">,</span> 
<a 
 id="x12-303032r1621"></a>         <span id="textcolor6719">executable</span><span id="textcolor6720">=</span><span id="textcolor6721">&#x0027;</span><span id="textcolor6722">turtlesim_node</span><span id="textcolor6723">&#x0027;</span><span id="textcolor6724">,</span> 
<a 
 id="x12-303034r1622"></a>         <span id="textcolor6725">name</span><span id="textcolor6726">=</span><span id="textcolor6727">&#x0027;</span><span id="textcolor6728">sim</span><span id="textcolor6729">&#x0027;</span> 
<a 
 id="x12-303036r1623"></a>      <span id="textcolor6730">)</span><span id="textcolor6731">,</span></div></pre>
<!--l. 1346--><p class="noindent" >The final action launches the mimic node with the remaps:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb366" style='padding:20px;border-radius: 3px;'><a 
 id="x12-303038r1628"></a>      <span id="textcolor6732">Node</span><span id="textcolor6733">(</span> 
<a 
 id="x12-303040r1629"></a>         <span id="textcolor6734">package</span><span id="textcolor6735">=</span><span id="textcolor6736">&#x0027;</span><span id="textcolor6737">turtlesim</span><span id="textcolor6738">&#x0027;</span><span id="textcolor6739">,</span> 
<a 
 id="x12-303042r1630"></a>         <span id="textcolor6740">executable</span><span id="textcolor6741">=</span><span id="textcolor6742">&#x0027;</span><span id="textcolor6743">mimic</span><span id="textcolor6744">&#x0027;</span><span id="textcolor6745">,</span> 
<a 
 id="x12-303044r1631"></a>         <span id="textcolor6746">name</span><span id="textcolor6747">=</span><span id="textcolor6748">&#x0027;</span><span id="textcolor6749">mimic</span><span id="textcolor6750">&#x0027;</span><span id="textcolor6751">,</span> 
<a 
 id="x12-303046r1632"></a>         <span id="textcolor6752">remappings</span><span id="textcolor6753">=</span><span id="textcolor6754">[</span> 
<a 
 id="x12-303048r1633"></a>            <span id="textcolor6755">(</span><span id="textcolor6756">&#x0027;</span><span id="textcolor6757">/input/pose</span><span id="textcolor6758">&#x0027;</span><span id="textcolor6759">,</span> <span id="textcolor6760">&#x0027;</span><span id="textcolor6761">/turtlesim1/turtle1/pose</span><span id="textcolor6762">&#x0027;</span><span id="textcolor6763">)</span><span id="textcolor6764">,</span> 
<a 
 id="x12-303050r1634"></a>            <span id="textcolor6765">(</span><span id="textcolor6766">&#x0027;</span><span id="textcolor6767">/output/cmd_vel</span><span id="textcolor6768">&#x0027;</span><span id="textcolor6769">,</span> <span id="textcolor6770">&#x0027;</span><span id="textcolor6771">/turtlesim2/turtle1/cmd_vel</span><span id="textcolor6772">&#x0027;</span><span id="textcolor6773">)</span><span id="textcolor6774">,</span> 
<a 
 id="x12-303052r1635"></a>         <span id="textcolor6775">]</span> 
<a 
 id="x12-303054r1636"></a>      <span id="textcolor6776">)</span></div></pre>

                                                                                
                                                                                
<a 
 id="paragraph*.140"></a>
<!--l. 1350--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-304000"></a>Launching  the  Package</span>
To run the launch file created above, enter into the directory we created earlier and run the following command:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb367" style='padding:20px;border-radius: 3px;'><a 
 id="x12-304002r1641"></a><span id="textcolor6777">cd</span><span id="textcolor6778"> </span>launch 
<a 
 id="x12-304004r1642"></a>ros2<span id="textcolor6779"> </span>launch<span id="textcolor6780"> </span>turtlesim_mimic_launch.py</div></pre>
<!--l. 1357--><p class="noindent" >Two turtlesim windows will open, and we will see the following [INFO] messages telling we which nodes our launch file has started:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb368" style='padding:20px;border-radius: 3px;'><a 
 id="x12-304006r1647"></a>[INFO] [launch]: Default logging verbosity is set to INFO 
<a 
 id="x12-304008r1648"></a>[INFO] [turtlesim_node-1]: process started with pid [11714] 
<a 
 id="x12-304010r1649"></a>[INFO] [turtlesim_node-2]: process started with pid [11715] 
<a 
 id="x12-304012r1650"></a>[INFO] [mimic-3]: process started with pid [11716]</div></pre>
<!--l. 1362--><p class="noindent" >To see the system in action, open a new terminal and run the ros2 topic pub command on the <span id="textcolor6781"><code class="verb">turtlesim1/turtle1/cmd\_vel</code></span> topic to get the first turtle moving:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb369" style='padding:20px;border-radius: 3px;'><a 
 id="x12-304014r1655"></a>ros2<span id="textcolor6782"> </span>topic<span id="textcolor6783"> </span>pub<span id="textcolor6784"> </span>-r<span id="textcolor6785"> </span><span id="textcolor6786">1</span><span id="textcolor6787"> </span><span id="textcolor6788">\</span> 
<a 
 id="x12-304016r1656"></a><span id="textcolor6789">    </span>/turtlesim1/turtle1/cmd_vel<span id="textcolor6790"> </span>geometry_msgs/msg/Twist<span id="textcolor6791"> </span><span id="textcolor6792">\</span> 
<a 
 id="x12-304018r1657"></a><span id="textcolor6793">    </span><span id="textcolor6794">"{linear: {x: 2.0, y: 0.0, z: 0.0}, angular: {x: 0.0, y: 0.0, z: -1.8}}"</span></div></pre>
<!--l. 1367--><p class="noindent" >We  will  see  both  turtles  following  the  same  path.

<a 
 id="paragraph*.141"></a></p>
<!--l. 1369--><p class="noindent" ><span class="paragraphHead"><a 
 id="x12-305000"></a>Checking  the  Graph</span>
While the system is still running, open a new terminal and run <span id="textcolor6795"><code class="verb">rqt_graph</code></span> to get a better idea of the relationship between the nodes in our launch file.
</p><!--l. 1374--><p class="noindent" >Run  the  command:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb370" style='padding:20px;border-radius: 3px;'><a 
 id="x12-305002r1662"></a>rqt_graph</div></pre>
<!--l. 1378--><p class="noindent" >A hidden node (the ros2 topic pub command we ran) is publishing data to the <span id="textcolor6796"><code class="verb">turtlesim1/turtle1/cmd\_vel</code></span> topic on the
left, which the <span id="textcolor6797"><code class="verb">turtlesim1/sim</code></span> node is subscribed to. The rest of the graph shows what was described earlier:
mimic is subscribed to <span id="textcolor6798"><code class="verb">turtlesim1/sim</code></span>’s pose topic, and publishes to <span id="textcolor6799"><code class="verb">turtlesim2/sim</code></span>’s velocity command topic.
</p>
</article></div>
</article></div>
<div class="page"><article class="chapter">
                                                                                
                                                                                
<!--l. 8--><div class="crosslinks"><p class="noindent"><a 
href="MobileRoboticsLectureBookch11.html" >NEXT</a><a 
href="MobileRoboticsLectureBookch9.html" >PREV</a><a 
href="index.html" >TOP</a></p></div>
<!--l. 8--><p class="noindent" ><a 
 id="tailMobileRoboticsLectureBookch10.html"></a></p> 
</body> 
</html>
