<!DOCTYPE html> 
<html lang="en-US" xml:lang="en-US" > 
<head><title>11 Transform Library</title> 
<meta  charset="utf-8" /> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<meta name="viewport" content="width=device-width,initial-scale=1" /> 
<link rel="stylesheet" type="text/css" href="MobileRoboticsLectureBook.css" /> 
<meta name="src" content="MobileRoboticsLectureBook.tex" /> 
 <script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/mml-chtml.js"></script>  
 <link rel="stylesheet" type="text/css" href="flatweb.css"> 
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script> 
 <script src="flatjs.js"></script> <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>  
<link href="https://unpkg.com/nord-highlightjs@0.1.0/dist/nord.css" rel="stylesheet" type="text/css" /> 
 <script src="https://unpkg.com/@highlightjs/cdn-assets@11.3.1/highlight.min.js"></script> 
 <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/dockerfile.min.js"> </script>  
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/cmake.min.js"> </script>  
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/cpp.min.js"> </script>  
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/makefile.min.js"> </script>  
<script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"> </script>  
<link rel="stylesheet" href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css"/>  
<script src="flatjs.js"> </script>  <header>  
</header> 
</head><body 
>
<!--l. 8--><div class="crosslinks"><p class="noindent"><a 
href="MobileRoboticsLectureBookli2.html" >NEXT</a><a 
href="MobileRoboticsLectureBookch10.html" >PREV</a><a 
href="index.html" >TOP</a></p></div>
<h2 class="chapterHead"><span class="titlemark">11</span>  <a 
 id="x13-30600011"></a>Transform Library</h2>
<div class="chapterTOCS">
<span class="sectionToc" >11.1  <a 
href="#x13-30700011.1">A Gentle Introduction</a></span>
<br /><span class="sectionToc" >11.2  <a 
href="#x13-31500011.2">Writing a Static Broadcaster</a></span>
<br /><span class="sectionToc" >11.3  <a 
href="#x13-32400011.3">Writing a Listener</a></span>
<br /><span class="sectionToc" >11.4  <a 
href="#x13-33100011.4">Adding a Frame</a></span>
<br /><span class="sectionToc" >11.5  <a 
href="#x13-34500011.5">Writing a Broadcaster</a></span>
</div>
<div class="page"><article class="chapter">

<h3 class="sectionHead"><span class="titlemark">11.1</span>  <a 
 id="x13-30700011.1"></a>A Gentle Introduction</h3>
<!--l. 16--><p class="noindent" ><span id="textcolor6800"><code class="verb">tf2</code></span> is the <alert style="color: #821131;">transform library</alert>, which lets the user keep track of multiple coordinate frames over
time. <span id="textcolor6801"><code class="verb">tf2</code></span> maintains the relationship between coordinate frames in a tree structure buffered in time and
lets the user transform points, vectors, etc., between any two (<alert style="color: #821131;">2</alert>) coordinate frames at any desired
point in time.
</p>
<div class="wrapfig-r"><img 
src="figures/Transform-Library/raster/tf2-sample.png" alt="PIC"  
width="146" height="146"  /> <a 
 id="x13-307001r1"></a>
<figcaption class="caption" ><span class="id">Figure 11.1: </span><span  
class="content">A  robot  is  comprised  of
numerous  coordinate  system  as  can  be
seen  from  this  robot  and  needs  to  be
constantly  be  kept  in  check  which  <span id="textcolor6803"><code class="verb">tf2</code></span>
allows [<a 
href="MobileRoboticsLectureBookad1.html#ros2iron2025">91</a>].                     </span></figcaption><!--tex4ht:label?: x13-307001r1 --></div>
<!--l. 28--><p class="noindent" >A robotic system typically various types of 3D coordinate frames which change over time.
</p>     
<blockquote class="quote">
<!--l. 31--><p class="noindent" >Examples include a world frame, base frame, gripper frame, head frame, etc.</p></blockquote>
<!--l. 34--><p class="noindent" >The key use-case for <span id="textcolor6804"><code class="verb">tf2</code></span> is to keep track of all these frames over time, and allows us to ask questions
like:
</p>     
<ul class="itemize1">
<li class="itemize">     
<!--l. 38--><p class="noindent" >Where was the head frame relative to the world frame 5 seconds ago?
</p>     
</li>
<li class="itemize">     
<!--l. 39--><p class="noindent" >What is the pose of the object in my gripper relative to my base?
                                                                                
                                                                                
     
</p>
</li>     
<li class="itemize">
<!--l. 40--><p class="noindent" >What is the current pose of the base frame in the map frame?</p></li></ul>
<!--l. 43--><p class="noindent" ><span id="textcolor6808"><code class="verb">tf2</code></span> can operate in a distributed system. This means all the information about the coordinate frames of
a robot is available to <alert style="color: #821131;">all</alert> <a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a> components on any computer in the system. In addition, <span id="textcolor6809"><code class="verb">tf2</code></span> can have
every component in your distributed system build its own transform information database or have a
central node that gathers and stores all transform information.

</p>
<h4 class="likesubsectionHead"><a 
 id="x13-308000"></a>A Simple Test</h4>
<!--l. 51--><p class="noindent" >To get started with the <span id="textcolor6810"><code class="verb">tf2</code></span> library, we are going to run a demo and see some of the power of <span id="textcolor6811"><code class="verb">tf2</code></span> in a
multi-robot example using turtlesim, which we should already be familiar with.

<a 
 id="paragraph*.142"></a></p>
<!--l. 55--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-309000"></a>Installing the Demo</span>
We will start by installing the demo package and its dependencies, like we did previously. This might
have been already installed depending on the way <a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a> was installed, but it doesn’t hurt to run the
command again:
</p><!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb371" style='padding:20px;border-radius: 3px;'><a 
 id="x13-309002r63"></a>sudo<span id="textcolor6812"> </span>apt-get<span id="textcolor6813"> </span>install<span id="textcolor6814"> </span><span id="textcolor6815">\</span> 
<a 
 id="x13-309004r64"></a><span id="textcolor6816">     </span>ros-humble-rviz2<span id="textcolor6817"> </span><span id="textcolor6818">\</span> 
<a 
 id="x13-309006r65"></a><span id="textcolor6819">     </span>ros-humble-turtle-tf2-py<span id="textcolor6820"> </span><span id="textcolor6821">\</span> 
<a 
 id="x13-309008r66"></a><span id="textcolor6822">     </span>ros-humble-tf2-ros<span id="textcolor6823"> </span><span id="textcolor6824">\</span> 
<a 
 id="x13-309010r67"></a><span id="textcolor6825">     </span>ros-humble-tf2-tools<span id="textcolor6826"> </span><span id="textcolor6827">\</span> 
<a 
 id="x13-309012r68"></a><span id="textcolor6828">     </span>ros-humble-turtlesim</div></pre>
<!--l. 63--><p class="noindent" >Now
that
we’ve
installed
the
<span id="textcolor6829"><code class="verb">turtle_tf2_py</code></span>
tutorial
package
let’s
run
the
demo.
First,
open
a
<alert style="color: #821131;">new
terminal</alert>
and
source
your
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
installation
so
that
<span id="textcolor6830"><code class="verb">ros2</code></span>
commands
will
work.<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">1 </sup></span></alert>
<span class="marginnote">
                                                                                
                                                                                
                                                                           
<alert style="color: #821131;"><span id="bold" style="font-weight:bold;"><sup class="textsuperscript">1</sup></span></alert><span id="textcolor6831">While
the
docker
container
setup
has
the
source
predefined,
it
is
nevertheless
a
good
practice
to
do
this
if
you
are
working
with
multiple
versions.</span></span>
Then
run
the
following
command:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                           
<pre><div id="fancyvrb372" style='padding:20px;border-radius: 3px;'><a 
 id="x13-309014r75"></a>ros2<span id="textcolor6832"> </span>launch<span id="textcolor6833"> </span>turtle_tf2_py<span id="textcolor6834"> </span>turtle_tf2_demo.launch.py</div></pre>
<!--l. 71--><p class="noindent" >You
will
see
the
turtlesim
start
with
two
(<alert style="color: #821131;">2</alert>) turtles.
In
the
<alert style="color: #821131;">second
terminal</alert>
window
type
the
following
command:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                      
<pre><div id="fancyvrb373" style='padding:20px;border-radius: 3px;'><a 
 id="x13-309016r80"></a>ros2<span id="textcolor6835"> </span>run<span id="textcolor6836"> </span>turtlesim<span id="textcolor6837"> </span>turtle_teleop_key</div></pre>
<!--l. 76--><p class="noindent" >Once
the
turtlesim
is
started
you
can
drive
the
central
                                                                                
                                                                                
                                                                            
turtle
around
in
the
turtlesim
using
the
keyboard
arrow
keys,
select
the
second
terminal
window
so
that
our
keystrokes
will
be
captured
to
drive
the
turtle.
</p>                                                                             
<!--l. 80--><p class="noindent" >You
can
see
that
one
turtle
continuously
moves
to
follow
the
turtle
you
are
driving
around.
                                                                                
<a 
 id="paragraph*.143"></a></p>
<!--l. 82--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-310000"></a>Looking
at
the
Behaviour</span>
This
demo
is
using
the
<span id="textcolor6838"><code class="verb">tf2</code></span>
library
to
create
three
(<alert style="color: #821131;">3</alert>) coordinate
frames:
</p>     
<dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
1. 
</dt><dd 
class="enumerate-enumitem">a world frame,
</dd>     
<dt class="enumerate-enumitem">
2. 
</dt><dd 
class="enumerate-enumitem">a <span id="textcolor6839"><code class="verb">turtle1</code></span> frame, and
                                                                                
                                                                                
     
</dd>
<dt class="enumerate-enumitem">   
3. 
</dt><dd 
class="enumerate-enumitem">a <span id="textcolor6840"><code class="verb">turtle2</code></span> frame.</dd></dl>                                                              
<!--l. 92--><p class="noindent" >In
this
tutorial,
we
use
a
<span id="textcolor6841"><code class="verb">tf2</code></span>
<span id="bold" style="font-weight:bold;">broadcaster</span>
to
publish
the
turtle
coordinate
frames
and
a
<span id="textcolor6842"><code class="verb">tf2</code></span>
<span id="bold" style="font-weight:bold;">listener</span>
to
calculate
the
difference
in
the
turtle
frames
and
move
one
turtle
to
follow
the
other.

</p>                                                                            
<h5 class="likesubsubsectionHead"><a 
 id="x13-311000"></a>Useful
Tools</h5>
<!--l. 98--><p class="noindent" >It
is
time
to
see
how
<span id="textcolor6843"><code class="verb">tf2</code></span>
is
being
used
to
create
this
simple
exercise.
We
can
use
<span id="textcolor6844"><code class="verb">tf2_tools</code></span>
to
look
at
what
                                                                                
                                                                                
                                                                              
<span id="textcolor6845"><code class="verb">tf2</code></span>
is
doing
behind
the
scenes.
                                                                                
<a 
 id="paragraph*.144"></a></p>
<!--l. 101--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-312000"></a>Viewing
the
Frames</span>
If
we
want
to
see
visually
what
is
going
on,
we
can
use
<span id="textcolor6846"><code class="verb">view_frames</code></span>
which
creates
a
diagram
of
the
frames
being
broadcast
by
<span id="textcolor6847"><code class="verb">tf2</code></span>
over
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>.
</p>                                                                                
<div class="warning">
<!--l. 108--><p class="noindent" >As
of
this
writing
<span id="textcolor6848"><code class="verb">view_frames</code></span>
only
works
on
Linux.
</p>                                                                                
</div>
<!--l. 1--><p class="noindent" >

</p>                                                          
<pre><div id="fancyvrb374" style='padding:20px;border-radius: 3px;'><a 
 id="x13-312002r87"></a>ros2<span id="textcolor6849"> </span>run<span id="textcolor6850"> </span>tf2_tools<span id="textcolor6851"> </span>view_frames</div></pre>
<div class="tcolorbox tcolorbox" id="tcolobox-112">                                                                                

                                                                                

 
<div class="tcolorbox-content"><pre><div id="fancyvrb375" style='padding:20px;border-radius: 3px;'><a 
 id="x13-312004r1"></a>Listening to tf data during 5 seconds... 
<a 
 id="x13-312006r2"></a>Generating graph in frames.pdf file...</div></pre>
 
</div> 
</div>                                                                       
<!--l. 113--><p class="noindent" >Here
a
<span id="textcolor6852"><code class="verb">tf2</code></span>
                                                                                
                                                                                
                                                                           
listener
is
listening
to
the
frames
which
are
being
broadcast
over
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
and
drawing
a
tree
of
how
the
frames
are
connected.
</p>                                                                                
<div class="knowledge">
<!--l. 118--><p class="noindent" >If
we
want
to
view
the
tree,
open
the
resulting
<span id="textcolor6853"><code class="verb">frames.pdf</code></span>
with
a
PDF
viewer.
</p>                                                                                
</div>
<!--l. 120--><p class="noindent" >Here
we
can
see
three
(<alert style="color: #821131;">3</alert>) frames
that
are
broadcast
by
<span id="textcolor6854"><code class="verb">tf2</code></span>:
</p>     
<blockquote class="quote">
<!--l. 123--><p class="noindent" ><span id="textcolor6855"><code class="verb">world</code></span>, <span id="textcolor6856"><code class="verb">turtle1</code></span>, and <span id="textcolor6857"><code class="verb">turtle2</code></span>.</p></blockquote>                                                     
<!--l. 126--><p class="noindent" >The
<span id="textcolor6858"><code class="verb">world</code></span>
frame
is
the
parent
of
the
<span id="textcolor6859"><code class="verb">turtle1</code></span>
and
                                                                                
                                                                                
                                                                           
<span id="textcolor6860"><code class="verb">turtle2</code></span>
frames. <span id="textcolor6861"><code class="verb">view_frames</code></span>
also
reports
some
diagnostic
information
about
when
the
oldest
and
most
recent
frame
transforms
were
received
and
how
fast
the
<span id="textcolor6862"><code class="verb">tf2</code></span>
frame
is
published
to
<span id="textcolor6863"><code class="verb">tf2</code></span>
for
debugging
purposes.
                                                                                
<a 
 id="paragraph*.145"></a></p>
<!--l. 131--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-313000"></a>Using
Echo</span>
<span id="textcolor6864"><code class="verb">tf2_echo</code></span>
reports
the
transform
between
any
two
(<alert style="color: #821131;">2</alert>) frames
broadcast
over
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>.
The
syntax
of
this
command
is
as
follows:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                        
<pre><div id="fancyvrb376" style='padding:20px;border-radius: 3px;'><a 
 id="x13-313002r100"></a>ros2<span id="textcolor6865"> </span>run<span id="textcolor6866"> </span>tf2_ros<span id="textcolor6867"> </span>tf2_echo<span id="textcolor6868"> </span><span id="textcolor6869">[</span>source_frame<span id="textcolor6870">]</span><span id="textcolor6871"> </span><span id="textcolor6872">[</span>target_frame<span id="textcolor6873">]</span></div></pre>
<!--l. 138--><p class="noindent" >Let’s
look
at
the
transform
of
                                                                                
                                                                                
                                                                              
the
<span id="textcolor6874"><code class="verb">turtle2</code></span>
frame
with
respect
to
<span id="textcolor6875"><code class="verb">turtle1</code></span>
frame
which
is
equivalent
to:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                  
<pre><div id="fancyvrb377" style='padding:20px;border-radius: 3px;'><a 
 id="x13-313004r106"></a>ros2<span id="textcolor6876"> </span>run<span id="textcolor6877"> </span>tf2_ros<span id="textcolor6878"> </span>tf2_echo<span id="textcolor6879"> </span>turtle2<span id="textcolor6880"> </span>turtle1</div></pre>
<div class="tcolorbox tcolorbox" id="tcolobox-113">                                                                                

                                                                                

 
<div class="tcolorbox-content"><pre><div id="fancyvrb378" style='padding:20px;border-radius: 3px;'><a 
 id="x13-313006r1"></a>At time 1683385337.850619099 
<a 
 id="x13-313008r2"></a>- Translation: [2.157, 0.901, 0.000] 
<a 
 id="x13-313010r3"></a>- Rotation: in Quaternion [0.000, 0.000, 0.172, 0.985] 
<a 
 id="x13-313012r4"></a>- Rotation: in RPY (radian) [0.000, -0.000, 0.345] 
<a 
 id="x13-313014r5"></a>- Rotation: in RPY (degree) [0.000, -0.000, 19.760] 
<a 
 id="x13-313016r6"></a>- Matrix: 
<a 
 id="x13-313018r7"></a>  0.941 -0.338  0.000  2.157 
<a 
 id="x13-313020r8"></a>  0.338  0.941  0.000  0.901 
<a 
 id="x13-313022r9"></a>  0.000  0.000  1.000  0.000 
<a 
 id="x13-313024r10"></a>  0.000  0.000  0.000  1.000 
<a 
 id="x13-313026r11"></a>At time 1683385338.841997774 
<a 
 id="x13-313028r12"></a>- Translation: [1.256, 0.216, 0.000] 
<a 
 id="x13-313030r13"></a>- Rotation: in Quaternion [0.000, 0.000, -0.016, 1.000] 
<a 
 id="x13-313032r14"></a>- Rotation: in RPY (radian) [0.000, 0.000, -0.032] 
<a 
 id="x13-313034r15"></a>- Rotation: in RPY (degree) [0.000, 0.000, -1.839] 
<a 
 id="x13-313036r16"></a>- Matrix: 
<a 
 id="x13-313038r17"></a>  0.999  0.032  0.000  1.256 
<a 
 id="x13-313040r18"></a> -0.032  0.999 -0.000  0.216 
<a 
 id="x13-313042r19"></a> -0.000  0.000  1.000  0.000 
<a 
 id="x13-313044r20"></a>  0.000  0.000  0.000  1.000</div></pre>
 
</div> 
</div>                                                                        
<!--l. 144--><p class="noindent" >We
will
see
the
transform
displayed
as
the
<span id="textcolor6881"><code class="verb">tf2_echo</code></span>
listener
receives
the
frames
broadcast
over
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>.
As
we
drive
our
turtle
around
we
will
see
the
transform
change
as
the
two
(<alert style="color: #821131;">2</alert>) turtles
move
relative
to
each
other.
                                                                                
<a 
 id="paragraph*.146"></a></p>
<!--l. 148--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-314000"></a>rviz2
and
tf2</span>
                                                                                
                                                                                
                                                                            
<span id="textcolor6882"><code class="verb">rviz2</code></span>
is
a
three-dimensional
visualization
platform
in
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>.
On
the
one
hand,
it
can
realize
the
graphical
display
of
external
information,
and
on
the
other
hand,
it
can
also
release
control
information
to
the
object
through
rviz,
so
as
to
realize
the
monitoring
and
control
of
the
robot.
It
is
also
useful
for
examining
<span id="textcolor6883"><code class="verb">tf2</code></span>
frames.
Let’s
look
at
our
turtle
frames
using
<span id="textcolor6884"><code class="verb">rviz2</code></span>
by
starting
it
                                                                                
                                                                                
                                                                             
with
a
configuration
file
using
the
<span id="textcolor6885"><code class="verb">-d</code></span>
option:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>             
<pre><div id="fancyvrb379" style='padding:20px;border-radius: 3px;'><a 
 id="x13-314002r137"></a>ros2<span id="textcolor6886"> </span>run<span id="textcolor6887"> </span>rviz2<span id="textcolor6888"> </span>rviz2<span id="textcolor6889"> </span>-d<span id="textcolor6890"> </span><span id="textcolor6891">\</span> 
<a 
 id="x13-314004r138"></a><span id="textcolor6892">     </span><span id="textcolor6893">$(</span>ros2<span id="textcolor6894"> </span>pkg<span id="textcolor6895"> </span>prefix<span id="textcolor6896"> </span>--share<span id="textcolor6897"> </span>turtle_tf2_py<span id="textcolor6898">)</span>/rviz/turtle_rviz.rviz</div></pre>
<!--l. 158--><p class="noindent" >In
the
side
bar
you
will
see
the
frames
broadcasted
by
tf2.
As
you
drive
the
turtle
around
you
will
see
the
frames
move
in
<span id="textcolor6899"><code class="verb">rviz</code></span>.
                                                                                
                                                                                
                                                                                
</p>
<!--l. 161--><p class="noindent" >
</p>                                                                      
<h3 class="sectionHead"><span class="titlemark">11.2</span>  <a 
 id="x13-31500011.2"></a>Writing
a
Static
Broadcaster</h3>
<!--l. 163--><p class="noindent" >Publishing
static
transforms
is
useful
to
define
the
relationship
between
a
robot
base
and
its
sensors
or
non-moving
parts.
</p>                                                                                
<!--l. 166--><p class="noindent" >
</p>     
<blockquote class="quote">
<!--l. 167--><p class="noindent" >For example, it is easiest to reason about laser scan measurements in a frame at the centre of the laser
scanner.</p></blockquote>                                                                    
<!--l. 171--><p class="noindent" >In
this
section,
we
will
be
covering
the
basics
of
static
transforms,
which
consists
of
two
(<alert style="color: #821131;">2</alert>) parts:
</p>     
<ul class="itemize1">
<li class="itemize">     
<!--l. 175--><p class="noindent" >In the first part we will write code to publish static transforms to tf2.
</p>     
</li>
<li class="itemize">     
<!--l. 176--><p class="noindent" >In the second part we will explain how to use the command-line <span id="textcolor6902"><code class="verb">static_transform_publisher</code></span> executable tool in
<span id="textcolor6903"><code class="verb">tf2_ros</code></span>.</p></li></ul>
                                                                                
                                                                                
                                                                              
<!--l. 180--><p class="noindent" >In
the
next
two
(<alert style="color: #821131;">2</alert>) sections
we
will
write
the
code
to
<span id="bold" style="font-weight:bold;">reproduce</span>
the
exercise
we
did
at
the
beginning
of
the
chapter.
                                                                                
<a 
 id="paragraph*.147"></a></p>
<!--l. 183--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-316000"></a>Creating
the
Package</span>
As
with
almost
all
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
applications,
we
first
need
to
create
a
package
will
be
used
for
this
section
and
the
following
ones.
The
package
called
<span id="textcolor6904"><code class="verb">learning_tf2_py</code></span>
will
depend
on:
</p>                                                                                
<!--l. 188--><p class="noindent" >
</p>     
<blockquote class="quote">
<!--l. 189--><p class="noindent" ><span id="textcolor6905"><code class="verb">geometry_msgs</code></span>, <span id="textcolor6906"><code class="verb">python3-numpy</code></span>, <span id="textcolor6907"><code class="verb">rclpy</code></span>, <span id="textcolor6908"><code class="verb">tf2_ros_py</code></span>, and <span id="textcolor6909"><code class="verb">turtlesim</code></span></p></blockquote>                                
<div class="warning">
                                                                                
                                                                                
                                                                             
<!--l. 194--><p class="noindent" >This
package
will
be
used
in
the
following
sections
as
well.
</p>                                                                                
</div>
<!--l. 196--><p class="noindent" >Open
a
new
terminal
and
source
your
<a 
href="MobileRoboticsLectureBookli2.html#glo:ros" class="glossary" >ROS</a>
installation
so
that
<span id="textcolor6910"><code class="verb">ros2</code></span>
commands
will
work.
Navigate
to
workspace’s
<span id="textcolor6911"><code class="verb">src</code></span>
folder
and
create
a
new
package:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>            
<pre><div id="fancyvrb380" style='padding:20px;border-radius: 3px;'><a 
 id="x13-316002r145"></a>ros2<span id="textcolor6912"> </span>pkg<span id="textcolor6913"> </span>create<span id="textcolor6914"> </span>--build-type<span id="textcolor6915"> </span>ament_python<span id="textcolor6916"> </span><span id="textcolor6917">\</span> 
<a 
 id="x13-316004r146"></a><span id="textcolor6918">     </span>--license<span id="textcolor6919"> </span>Apache-2.0<span id="textcolor6920"> </span><span id="textcolor6921">\</span> 
<a 
 id="x13-316006r147"></a><span id="textcolor6922">     </span>--<span id="textcolor6923"> </span>learning_tf2_py</div></pre>
<!--l. 201--><p class="noindent" >Once
the
command
has
been
executed,
our
terminal
will
return
a
message
verifying
the
creation
of
our
package
<span id="textcolor6924"><code class="verb">learning\_tf2\_py</code></span>
and
all
its
necessary
files
and
                                                                                
                                                                                
                                                                           
folders.
                                                                                
<a 
 id="paragraph*.148"></a></p>
<!--l. 204--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-317000"></a>Writing
a
Static
Broadcaster
Node</span>
We
will
start,
of
course,
by
first
creating
the
source
files.
Within
the
<span id="textcolor6925"><code class="verb">[</code></span>
/]src/learning_tf2_py/learning_tf2_py
directory
download
the
example
static
broadcaster
code
by
entering
the
following
command:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb381" style='padding:20px;border-radius: 3px;'><a 
 id="x13-317002r152"></a>wget<span id="textcolor6926"> </span>https://raw.githubusercontent.com/ros/geometry_tutorials/humble/turtle_tf2_py/turtle_tf2_py/static_turtle_tf2_broadcaster.py</div></pre>
<!--l. 212--><p class="noindent" >Now
let’s
open
the
file
called
<span id="textcolor6927"><code class="verb">static\_turtle\_tf2\_broadcaster.py</code></span>
and
have
a
look
at
it.
                                                                                
<a 
 id="paragraph*.149"></a></p>
<!--l. 215--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-318000"></a>Looking
at
the
Code</span>
Now
let’s
look
at
                                                                                
                                                                                
                                                                              
the
code
that
is
relevant
to
publishing
the
static
turtle
pose
to
<span id="textcolor6928"><code class="verb">tf2</code></span>.
The
first
lines
import
required
packages.
First
we
import
the
<span id="textcolor6929"><code class="verb">TransformStamped</code></span>
from
the
<span id="textcolor6930"><code class="verb">geometry_msgs</code></span>,
which
provides
us
a
template
for
the
message
that
we
will
publish
to
the
transformation
tree.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                              
<pre><div id="fancyvrb382" style='padding:20px;border-radius: 3px;'><a 
 id="x13-318002r260"></a><span id="textcolor6931">from</span><span id="textcolor6932"> </span><span id="textcolor6933">geometry_msgs</span><span id="textcolor6934">.</span><span id="textcolor6935">msg</span><span id="textcolor6936"> </span><span id="textcolor6937">import</span> <span id="textcolor6938">TransformStamped</span></div></pre>
<!--l. 224--><p class="noindent" >Afterwards,
<span id="textcolor6939"><code class="verb">rclpy</code></span>
is
imported
so
its
Node
class
can
be
used.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                   
<pre><div id="fancyvrb383" style='padding:20px;border-radius: 3px;'><a 
 id="x13-318004r265"></a><span id="textcolor6940">import</span><span id="textcolor6941"> </span><span id="textcolor6942">rclpy</span> 
<a 
 id="x13-318006r266"></a><span id="textcolor6943">from</span><span id="textcolor6944"> </span><span id="textcolor6945">rclpy</span><span id="textcolor6946">.</span><span id="textcolor6947">node</span><span id="textcolor6948"> </span><span id="textcolor6949">import</span> <span id="textcolor6950">Node</span></div></pre>
<!--l. 228--><p class="noindent" >The
<span id="textcolor6951"><code class="verb">tf2_ros</code></span>
package
provides
                                                                                
                                                                                
                                                                               
a
<span id="textcolor6952"><code class="verb">StaticTransformBroadcaster</code></span>
to
make
the
publishing
of
static
transforms
easy.
To
use
the
<span id="textcolor6953"><code class="verb">StaticTransformBroadcaster</code></span>,
we
need
to
import
it
from
the
<span id="textcolor6954"><code class="verb">tf2_ros</code></span>
module.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                         
<pre><div id="fancyvrb384" style='padding:20px;border-radius: 3px;'><a 
 id="x13-318008r271"></a><span id="textcolor6955">from</span><span id="textcolor6956"> </span><span id="textcolor6957">tf2_ros</span><span id="textcolor6958">.</span><span id="textcolor6959">static_transform_broadcaster</span><span id="textcolor6960"> </span><span id="textcolor6961">import</span> <span id="textcolor6962">StaticTransformBroadcaster</span></div></pre>
<!--l. 234--><p class="noindent" >The
<span id="textcolor6963"><code class="verb">StaticFramePublisher</code></span>
class
constructor
initializes
the
node
with
the
name
<span id="textcolor6964"><code class="verb">static_turtle_tf2_broadcaster</code></span>.
Then,
<span id="textcolor6965"><code class="verb">StaticTransformBroadcaster</code></span>
is
created,
which
will
send
one
static
transformation
upon
the
startup.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>          
<pre><div id="fancyvrb385" style='padding:20px;border-radius: 3px;'><a 
 id="x13-318010r276"></a><span id="textcolor6966">self</span><span id="textcolor6967">.</span><span id="textcolor6968">tf_static_broadcaster</span> <span id="textcolor6969">=</span> <span id="textcolor6970">StaticTransformBroadcaster</span><span id="textcolor6971">(</span><span id="textcolor6972">self</span><span id="textcolor6973">)</span> 
<a 
 id="x13-318012r277"></a><span id="textcolor6974">self</span><span id="textcolor6975">.</span><span id="textcolor6976">make_transforms</span><span id="textcolor6977">(</span><span id="textcolor6978">transformation</span><span id="textcolor6979">)</span></div></pre>
<!--l. 240--><p class="noindent" >Here
we
create
a
<span id="textcolor6980"><code class="verb">TransformStamped</code></span>
object,
which
will
be
the
message
                                                                                
                                                                                
                                                                              
we
will
send
over
once
populated.
Before
passing
the
actual
transform
values
we
need
to
give
it
the
appropriate
metadata.
</p>     
<ul class="itemize1">
<li class="itemize">     
<!--l. 245--><p class="noindent" >We need to give the transform being published a timestamp and well just stamp it with the current time,
<span id="textcolor6982"><code class="verb">self.get_clock().now()</code></span>
</p>     
</li>
<li class="itemize">     
<!--l. 247--><p class="noindent" >Then we need to set the name of the parent frame of the link were creating, in this case <span id="textcolor6984"><code class="verb">world</code></span>.
</p>     
</li>
<li class="itemize">     
<!--l. 248--><p class="noindent" >Finally, we need to set the name of the child frame of the link were creating</p></li></ul>                        
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb386" style='padding:20px;border-radius: 3px;'><a 
 id="x13-318014r282"></a><span id="textcolor6986">t</span> <span id="textcolor6987">=</span> <span id="textcolor6988">TransformStamped</span><span id="textcolor6989">(</span><span id="textcolor6990">)</span> 
<a 
 id="x13-318016r283"></a> 
<a 
 id="x13-318018r284"></a><span id="textcolor6991">t</span><span id="textcolor6992">.</span><span id="textcolor6993">header</span><span id="textcolor6994">.</span><span id="textcolor6995">stamp</span> <span id="textcolor6996">=</span> <span id="textcolor6997">self</span><span id="textcolor6998">.</span><span id="textcolor6999">get_clock</span><span id="textcolor7000">(</span><span id="textcolor7001">)</span><span id="textcolor7002">.</span><span id="textcolor7003">now</span><span id="textcolor7004">(</span><span id="textcolor7005">)</span><span id="textcolor7006">.</span><span id="textcolor7007">to_msg</span><span id="textcolor7008">(</span><span id="textcolor7009">)</span> 
<a 
 id="x13-318020r285"></a><span id="textcolor7010">t</span><span id="textcolor7011">.</span><span id="textcolor7012">header</span><span id="textcolor7013">.</span><span id="textcolor7014">frame_id</span> <span id="textcolor7015">=</span> <span id="textcolor7016">&#x0027;</span><span id="textcolor7017">world</span><span id="textcolor7018">&#x0027;</span> 
<a 
 id="x13-318022r286"></a><span id="textcolor7019">t</span><span id="textcolor7020">.</span><span id="textcolor7021">child_frame_id</span> <span id="textcolor7022">=</span> <span id="textcolor7023">transformation</span><span id="textcolor7024">[</span><span id="textcolor7025">1</span><span id="textcolor7026">]</span></div></pre>
<!--l. 253--><p class="noindent" >Here
we
populate
the
6D
pose
(translation
and
rotation)
of
the
turtle.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb387" style='padding:20px;border-radius: 3px;'><a 
 id="x13-318024r291"></a><span id="textcolor7027">t</span><span id="textcolor7028">.</span><span id="textcolor7029">transform</span><span id="textcolor7030">.</span><span id="textcolor7031">translation</span><span id="textcolor7032">.</span><span id="textcolor7033">x</span> <span id="textcolor7034">=</span> <span id="textcolor7035">float</span><span id="textcolor7036">(</span><span id="textcolor7037">transformation</span><span id="textcolor7038">[</span><span id="textcolor7039">2</span><span id="textcolor7040">]</span><span id="textcolor7041">)</span> 
<a 
 id="x13-318026r292"></a><span id="textcolor7042">t</span><span id="textcolor7043">.</span><span id="textcolor7044">transform</span><span id="textcolor7045">.</span><span id="textcolor7046">translation</span><span id="textcolor7047">.</span><span id="textcolor7048">y</span> <span id="textcolor7049">=</span> <span id="textcolor7050">float</span><span id="textcolor7051">(</span><span id="textcolor7052">transformation</span><span id="textcolor7053">[</span><span id="textcolor7054">3</span><span id="textcolor7055">]</span><span id="textcolor7056">)</span> 
<a 
 id="x13-318028r293"></a><span id="textcolor7057">t</span><span id="textcolor7058">.</span><span id="textcolor7059">transform</span><span id="textcolor7060">.</span><span id="textcolor7061">translation</span><span id="textcolor7062">.</span><span id="textcolor7063">z</span> <span id="textcolor7064">=</span> <span id="textcolor7065">float</span><span id="textcolor7066">(</span><span id="textcolor7067">transformation</span><span id="textcolor7068">[</span><span id="textcolor7069">4</span><span id="textcolor7070">]</span><span id="textcolor7071">)</span> 
<a 
 id="x13-318030r294"></a><span id="textcolor7072">quat</span> <span id="textcolor7073">=</span> <span id="textcolor7074">quaternion_from_euler</span><span id="textcolor7075">(</span> 
<a 
 id="x13-318032r295"></a>   <span id="textcolor7076">float</span><span id="textcolor7077">(</span><span id="textcolor7078">transformation</span><span id="textcolor7079">[</span><span id="textcolor7080">5</span><span id="textcolor7081">]</span><span id="textcolor7082">)</span><span id="textcolor7083">,</span> <span id="textcolor7084">float</span><span id="textcolor7085">(</span><span id="textcolor7086">transformation</span><span id="textcolor7087">[</span><span id="textcolor7088">6</span><span id="textcolor7089">]</span><span id="textcolor7090">)</span><span id="textcolor7091">,</span> <span id="textcolor7092">float</span><span id="textcolor7093">(</span><span id="textcolor7094">transformation</span><span id="textcolor7095">[</span><span id="textcolor7096">7</span><span id="textcolor7097">]</span><span id="textcolor7098">)</span><span id="textcolor7099">)</span> 
<a 
 id="x13-318034r296"></a><span id="textcolor7100">t</span><span id="textcolor7101">.</span><span id="textcolor7102">transform</span><span id="textcolor7103">.</span><span id="textcolor7104">rotation</span><span id="textcolor7105">.</span><span id="textcolor7106">x</span> <span id="textcolor7107">=</span> <span id="textcolor7108">quat</span><span id="textcolor7109">[</span><span id="textcolor7110">0</span><span id="textcolor7111">]</span> 
<a 
 id="x13-318036r297"></a><span id="textcolor7112">t</span><span id="textcolor7113">.</span><span id="textcolor7114">transform</span><span id="textcolor7115">.</span><span id="textcolor7116">rotation</span><span id="textcolor7117">.</span><span id="textcolor7118">y</span> <span id="textcolor7119">=</span> <span id="textcolor7120">quat</span><span id="textcolor7121">[</span><span id="textcolor7122">1</span><span id="textcolor7123">]</span> 
<a 
 id="x13-318038r298"></a><span id="textcolor7124">t</span><span id="textcolor7125">.</span><span id="textcolor7126">transform</span><span id="textcolor7127">.</span><span id="textcolor7128">rotation</span><span id="textcolor7129">.</span><span id="textcolor7130">z</span> <span id="textcolor7131">=</span> <span id="textcolor7132">quat</span><span id="textcolor7133">[</span><span id="textcolor7134">2</span><span id="textcolor7135">]</span> 
<a 
 id="x13-318040r299"></a><span id="textcolor7136">t</span><span id="textcolor7137">.</span><span id="textcolor7138">transform</span><span id="textcolor7139">.</span><span id="textcolor7140">rotation</span><span id="textcolor7141">.</span><span id="textcolor7142">w</span> <span id="textcolor7143">=</span> <span id="textcolor7144">quat</span><span id="textcolor7145">[</span><span id="textcolor7146">3</span><span id="textcolor7147">]</span></div></pre>
<!--l. 257--><p class="noindent" >Finally,
we
broadcast
static
transform
using
the
<span id="textcolor7148"><code class="verb">sendTransform()</code></span>
function.
</p>                                                                                
<!--l. 1--><p class="noindent" >
                                                                                
                                                                                

</p>                                                 
<pre><div id="fancyvrb388" style='padding:20px;border-radius: 3px;'><a 
 id="x13-318042r304"></a><span id="textcolor7149">self</span><span id="textcolor7150">.</span><span id="textcolor7151">tf_static_broadcaster</span><span id="textcolor7152">.</span><span id="textcolor7153">sendTransform</span><span id="textcolor7154">(</span><span id="textcolor7155">t</span><span id="textcolor7156">)</span></div></pre>
                                                                                
<a 
 id="paragraph*.150"></a>
<!--l. 261--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-319000"></a>Updating
the
Package
Information</span>
Navigate
one
level
back
to
the
<span id="textcolor7157"><code class="verb">src/learning\_tf2\_py</code></span>
directory,
where
the
<span id="textcolor7158"><code class="verb">setup.py</code></span>,
<span id="textcolor7159"><code class="verb">setup.cfg</code></span>,
and
<span id="textcolor7160"><code class="verb">package.xml</code></span>
files
have
been
created
for
you.
</p>                                                                            
<!--l. 266--><p class="noindent" >Open
<span id="textcolor7161"><code class="verb">package.xml</code></span>
and
make
sure
to
fill
in
the
&#x003C;description&#x003E;,
&#x003C;maintainer&#x003E;
and
&#x003C;license&#x003E;
tags:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb389" style='padding:20px;border-radius: 3px;'><a 
 id="x13-319002r311"></a><span id="textcolor7162">&lt;description</span><span id="textcolor7163">&gt;</span>Learning<span id="textcolor7164"> </span>tf2<span id="textcolor7165"> </span>with<span id="textcolor7166"> </span>rclpy<span id="textcolor7167">&lt;/description&gt;</span> 
<a 
 id="x13-319004r312"></a><span id="textcolor7168">&lt;maintainer</span><span id="textcolor7169"> </span><span id="textcolor7170">email=</span><span id="textcolor7171">"you@email.com"</span><span id="textcolor7172">&gt;</span>Your<span id="textcolor7173"> </span>Name<span id="textcolor7174">&lt;/maintainer&gt;</span> 
<a 
 id="x13-319006r313"></a><span id="textcolor7175">&lt;license</span><span id="textcolor7176">&gt;</span>Apache<span id="textcolor7177"> </span>License<span id="textcolor7178"> </span>2.0<span id="textcolor7179">&lt;/license&gt;</span></div></pre>
<!--l. 271--><p class="noindent" >After
the
lines
above,
add
the
following
dependencies
corresponding
to
your
nodes
import
statements:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb390" style='padding:20px;border-radius: 3px;'><a 
 id="x13-319008r318"></a><span id="textcolor7180">&lt;exec_depend</span><span id="textcolor7181">&gt;</span>geometry_msgs<span id="textcolor7182">&lt;/exec_depend&gt;</span> 
<a 
 id="x13-319010r319"></a><span id="textcolor7183">&lt;exec_depend</span><span id="textcolor7184">&gt;</span>python3-numpy<span id="textcolor7185">&lt;/exec_depend&gt;</span> 
<a 
 id="x13-319012r320"></a><span id="textcolor7186">&lt;exec_depend</span><span id="textcolor7187">&gt;</span>rclpy<span id="textcolor7188">&lt;/exec_depend&gt;</span> 
<a 
 id="x13-319014r321"></a><span id="textcolor7189">&lt;exec_depend</span><span id="textcolor7190">&gt;</span>tf2_ros_py<span id="textcolor7191">&lt;/exec_depend&gt;</span> 
<a 
 id="x13-319016r322"></a><span id="textcolor7192">&lt;exec_depend</span><span id="textcolor7193">&gt;</span>turtlesim<span id="textcolor7194">&lt;/exec_depend&gt;</span></div></pre>
                                                                                
                                                                                
                                                                             
<!--l. 275--><p class="noindent" >This
declares
the
required
<span id="textcolor7195"><code class="verb">geometry_msgs</code></span>,
<span id="textcolor7196"><code class="verb">python3-numpy</code></span>,
<span id="textcolor7197"><code class="verb">rclpy</code></span>,
<span id="textcolor7198"><code class="verb">tf2_ros_py</code></span>,
and
<span id="textcolor7199"><code class="verb">turtlesim</code></span>
dependencies
when
its
code
is
executed.
                                                                                
<a 
 id="paragraph*.151"></a></p>
<!--l. 278--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-320000"></a>Adding
an
Entry
Point</span>
To
allow
the
ros2
run
command
to
run
your
node,
you
must
add
the
entry
point
to
<span id="textcolor7200"><code class="verb">setup.py</code></span>.
Add
the
following
line
between
the
<span id="textcolor7201"><code class="verb">&#x0027;console_scripts&#x0027;:</code></span>
brackets:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                  
<pre><div id="fancyvrb391" style='padding:20px;border-radius: 3px;'><a 
 id="x13-320002r329"></a><span id="textcolor7202">&#x0027;</span><span id="textcolor7203">static_turtle_tf2_broadcaster = learning_tf2_py.static_turtle_tf2_broadcaster:main</span><span id="textcolor7204">&#x0027;</span><span id="textcolor7205">,</span></div></pre>
                                                                                
<a 
 id="paragraph*.152"></a>
<!--l. 285--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-321000"></a>Build</span>
Its
good
practice
to
run
rosdep
in
                                                                                
                                                                                
                                                                              
the
root
of
your
workspace
to
check
for
missing
dependencies
before
building:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                        
<pre><div id="fancyvrb392" style='padding:20px;border-radius: 3px;'><a 
 id="x13-321002r336"></a>rosdep<span id="textcolor7206"> </span>install<span id="textcolor7207"> </span>-i<span id="textcolor7208"> </span>--from-path<span id="textcolor7209"> </span>src<span id="textcolor7210"> </span>--rosdistro<span id="textcolor7211"> </span>humble<span id="textcolor7212"> </span>-y</div></pre>
<!--l. 292--><p class="noindent" >Still
in
the
root
of
your
workspace,
build
your
new
package:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                              
<pre><div id="fancyvrb393" style='padding:20px;border-radius: 3px;'><a 
 id="x13-321004r341"></a>colcon<span id="textcolor7213"> </span>build<span id="textcolor7214"> </span>--packages-select<span id="textcolor7215"> </span>learning_tf2_py</div></pre>
<!--l. 296--><p class="noindent" >Open
a
new
terminal,
navigate
to
the
root
of
your
workspace,
and
source
the
setup
files:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                                 
<pre><div id="fancyvrb394" style='padding:20px;border-radius: 3px;'><a 
 id="x13-321006r346"></a>.<span id="textcolor7216"> </span>install/setup.bash</div></pre>
                                                                                
<a 
 id="paragraph*.153"></a>
<!--l. 300--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-322000"></a>Run</span>
Now
run
the
<span id="textcolor7217"><code class="verb">static_turtle_tf2_broadcaster</code></span>
node:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                 
<pre><div id="fancyvrb395" style='padding:20px;border-radius: 3px;'><a 
 id="x13-322002r353"></a>ros2<span id="textcolor7218"> </span>run<span id="textcolor7219"> </span><span id="textcolor7220">\</span> 
<a 
 id="x13-322004r354"></a><span id="textcolor7221">     </span>learning_tf2_py<span id="textcolor7222"> </span>static_turtle_tf2_broadcaster<span id="textcolor7223"> </span>mystaticturtle<span id="textcolor7224"> </span><span id="textcolor7225">0</span><span id="textcolor7226"> </span><span id="textcolor7227">0</span><span id="textcolor7228"> </span><span id="textcolor7229">1</span><span id="textcolor7230"> </span><span id="textcolor7231">0</span><span id="textcolor7232"> </span><span id="textcolor7233">0</span><span id="textcolor7234"> </span><span id="textcolor7235">0</span></div></pre>
                                                                                
                                                                                
                                                                             
<!--l. 306--><p class="noindent" >This
sets
a
turtle
pose
broadcast
for
mystaticturtle
to
float
1
meter
above
the
ground.
</p>                                                                              
<!--l. 308--><p class="noindent" >We
can
now
check
that
the
static
transform
has
been
published
by
echoing
the
<span id="textcolor7236"><code class="verb">tf_static</code></span>
topic
If
everything
is
well
you
should
see
a
single
static
transform:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                             
<pre><div id="fancyvrb396" style='padding:20px;border-radius: 3px;'><a 
 id="x13-322006r359"></a>ros2<span id="textcolor7237"> </span>topic<span id="textcolor7238"> </span><span id="textcolor7239">echo</span><span id="textcolor7240"> </span>/tf_static</div></pre>
<div class="tcolorbox tcolorbox" id="tcolobox-114">                                                                                

                                                                                

 
<div class="tcolorbox-content"><pre><div id="fancyvrb397" style='padding:20px;border-radius: 3px;'><a 
 id="x13-322008r1"></a>transforms: 
<a 
 id="x13-322010r2"></a>- header: 
<a 
 id="x13-322012r3"></a>  stamp: 
<a 
 id="x13-322014r4"></a>     sec: 1622908754 
<a 
 id="x13-322016r5"></a>     nanosec: 208515730 
<a 
 id="x13-322018r6"></a>  frame_id: world 
<a 
 id="x13-322020r7"></a>child_frame_id: mystaticturtle 
<a 
 id="x13-322022r8"></a>transform: 
<a 
 id="x13-322024r9"></a>  translation: 
<a 
 id="x13-322026r10"></a>     x: 0.0 
<a 
 id="x13-322028r11"></a>     y: 0.0 
<a 
 id="x13-322030r12"></a>     z: 1.0 
<a 
 id="x13-322032r13"></a>  rotation: 
<a 
 id="x13-322034r14"></a>     x: 0.0 
<a 
 id="x13-322036r15"></a>     y: 0.0 
<a 
 id="x13-322038r16"></a>     z: 0.0 
<a 
 id="x13-322040r17"></a>     w: 1.0</div></pre>
 
</div> 
</div>                                                                          

                                                                             
<h5 class="likesubsubsectionHead"><a 
 id="x13-323000"></a>The
Proper
way
to
Publish
Static
Transforms</h5>
<!--l. 316--><p class="noindent" >This
tutorial
                                                                                
                                                                                
                                                                            
aimed
to
show
how
<span id="textcolor7241"><code class="verb">StaticTransformBroadcaster</code></span>
can
be
used
to
publish
static
transforms.
In
your
real
development
process
you
shouldnt
have
to
write
this
code
yourself
and
should
use
the
dedicated
<span id="textcolor7242"><code class="verb">tf2_ros</code></span>
tool
to
do
so.
<span id="textcolor7243"><code class="verb">tf2_ros</code></span>
provides
an
executable
named
<span id="textcolor7244"><code class="verb">static_transform_publisher</code></span>
that
can
be
used
either
as
a
commandline
tool
or
a
node
that
you
can
add
to
your
launchfiles.
</p>                                                                             
<!--l. 322--><p class="noindent" >The
following
command
publishes
a
static
coordinate
                                                                                
                                                                                
                                                                         
transform
to
<span id="textcolor7245"><code class="verb">tf2</code></span>
resulting
in
a
1
meter
offset
in
z
and
no
rotation
between
the
frames
world
and
mystaticturtle.
In
ROS
2,
roll/pitch/yaw
refers
to
rotation
in
radians
about
the
x/y/z-axis,
respectively.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb398" style='padding:20px;border-radius: 3px;'><a 
 id="x13-323002r387"></a>ros2<span id="textcolor7246"> </span>run<span id="textcolor7247"> </span>tf2_ros<span id="textcolor7248"> </span><span id="textcolor7249">\</span> 
<a 
 id="x13-323004r388"></a><span id="textcolor7250">    </span>static_transform_publisher<span id="textcolor7251"> </span><span id="textcolor7252">\</span> 
<a 
 id="x13-323006r389"></a><span id="textcolor7253">    </span>--x<span id="textcolor7254"> </span><span id="textcolor7255">0</span><span id="textcolor7256"> </span>--y<span id="textcolor7257"> </span><span id="textcolor7258">0</span><span id="textcolor7259"> </span>--z<span id="textcolor7260"> </span><span id="textcolor7261">1</span><span id="textcolor7262"> </span><span id="textcolor7263">\</span> 
<a 
 id="x13-323008r390"></a><span id="textcolor7264">    </span>--yaw<span id="textcolor7265"> </span><span id="textcolor7266">0</span><span id="textcolor7267"> </span>--pitch<span id="textcolor7268"> </span><span id="textcolor7269">0</span><span id="textcolor7270"> </span>--roll<span id="textcolor7271"> </span><span id="textcolor7272">0</span><span id="textcolor7273"> </span><span id="textcolor7274">\</span> 
<a 
 id="x13-323010r391"></a><span id="textcolor7275">    </span>--frame-id<span id="textcolor7276"> </span>world<span id="textcolor7277"> </span>--child-frame-id<span id="textcolor7278"> </span>mystaticturtle</div></pre>
<!--l. 328--><p class="noindent" >The
following
command
publishes
the
same
static
coordinate
transform
to
tf2,
but
using
quaternion
representation
for
the
rotation.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb399" style='padding:20px;border-radius: 3px;'><a 
 id="x13-323012r397"></a>ros2<span id="textcolor7279"> </span>run<span id="textcolor7280"> </span>tf2_ros<span id="textcolor7281"> </span><span id="textcolor7282">\</span> 
<a 
 id="x13-323014r398"></a><span id="textcolor7283">    </span>static_transform_publisher<span id="textcolor7284"> </span><span id="textcolor7285">\</span> 
<a 
 id="x13-323016r399"></a><span id="textcolor7286">    </span>--x<span id="textcolor7287"> </span><span id="textcolor7288">0</span><span id="textcolor7289"> </span>--y<span id="textcolor7290"> </span><span id="textcolor7291">0</span><span id="textcolor7292"> </span>--z<span id="textcolor7293"> </span><span id="textcolor7294">1</span><span id="textcolor7295"> </span><span id="textcolor7296">\</span> 
<a 
 id="x13-323018r400"></a><span id="textcolor7297">    </span>--qx<span id="textcolor7298"> </span><span id="textcolor7299">0</span><span id="textcolor7300"> </span>--qy<span id="textcolor7301"> </span><span id="textcolor7302">0</span><span id="textcolor7303"> </span>--qz<span id="textcolor7304"> </span><span id="textcolor7305">0</span><span id="textcolor7306"> </span>--qw<span id="textcolor7307"> </span><span id="textcolor7308">1</span><span id="textcolor7309"> </span><span id="textcolor7310">\</span> 
<a 
 id="x13-323020r401"></a><span id="textcolor7311">    </span>--frame-id<span id="textcolor7312"> </span>world<span id="textcolor7313"> </span>--child-frame-id<span id="textcolor7314"> </span>mystaticturtle</div></pre>
<!--l. 332--><p class="noindent" ><span id="textcolor7315"><code class="verb">static_transform_publisher</code></span>
is
designed
both
as
a
command-line
                                                                                
                                                                                
                                                                             
tool
for
manual
use,
as
well
as
for
use
within
launch
files
for
setting
static
transforms.
For
example:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb400" style='padding:20px;border-radius: 3px;'><a 
 id="x13-323022r406"></a><span id="textcolor7316">from</span><span id="textcolor7317"> </span><span id="textcolor7318">launch</span><span id="textcolor7319"> </span><span id="textcolor7320">import</span> <span id="textcolor7321">LaunchDescription</span> 
<a 
 id="x13-323024r407"></a><span id="textcolor7322">from</span><span id="textcolor7323"> </span><span id="textcolor7324">launch_ros</span><span id="textcolor7325">.</span><span id="textcolor7326">actions</span><span id="textcolor7327"> </span><span id="textcolor7328">import</span> <span id="textcolor7329">Node</span> 
<a 
 id="x13-323026r408"></a> 
<a 
 id="x13-323028r409"></a> 
<a 
 id="x13-323030r410"></a><span id="textcolor7330">def</span><span id="textcolor7331"> </span><span id="textcolor7332">generate_launch_description</span><span id="textcolor7333">(</span><span id="textcolor7334">)</span><span id="textcolor7335">:</span> 
<a 
 id="x13-323032r411"></a>   <span id="textcolor7336">return</span> <span id="textcolor7337">LaunchDescription</span><span id="textcolor7338">(</span><span id="textcolor7339">[</span> 
<a 
 id="x13-323034r412"></a>      <span id="textcolor7340">Node</span><span id="textcolor7341">(</span> 
<a 
 id="x13-323036r413"></a>         <span id="textcolor7342">package</span><span id="textcolor7343">=</span><span id="textcolor7344">&#x0027;</span><span id="textcolor7345">tf2_ros</span><span id="textcolor7346">&#x0027;</span><span id="textcolor7347">,</span> 
<a 
 id="x13-323038r414"></a>         <span id="textcolor7348">executable</span><span id="textcolor7349">=</span><span id="textcolor7350">&#x0027;</span><span id="textcolor7351">static_transform_publisher</span><span id="textcolor7352">&#x0027;</span><span id="textcolor7353">,</span> 
<a 
 id="x13-323040r415"></a>         <span id="textcolor7354">arguments</span><span id="textcolor7355">=</span><span id="textcolor7356">[</span> 
<a 
 id="x13-323042r416"></a>            <span id="textcolor7357">&#x0027;</span><span id="textcolor7358">--x</span><span id="textcolor7359">&#x0027;</span><span id="textcolor7360">,</span> <span id="textcolor7361">&#x0027;</span><span id="textcolor7362">0</span><span id="textcolor7363">&#x0027;</span><span id="textcolor7364">,</span> <span id="textcolor7365">&#x0027;</span><span id="textcolor7366">--y</span><span id="textcolor7367">&#x0027;</span><span id="textcolor7368">,</span> <span id="textcolor7369">&#x0027;</span><span id="textcolor7370">0</span><span id="textcolor7371">&#x0027;</span><span id="textcolor7372">,</span> <span id="textcolor7373">&#x0027;</span><span id="textcolor7374">--z</span><span id="textcolor7375">&#x0027;</span><span id="textcolor7376">,</span> <span id="textcolor7377">&#x0027;</span><span id="textcolor7378">1</span><span id="textcolor7379">&#x0027;</span><span id="textcolor7380">,</span> 
<a 
 id="x13-323044r417"></a>            <span id="textcolor7381">&#x0027;</span><span id="textcolor7382">--yaw</span><span id="textcolor7383">&#x0027;</span><span id="textcolor7384">,</span> <span id="textcolor7385">&#x0027;</span><span id="textcolor7386">0</span><span id="textcolor7387">&#x0027;</span><span id="textcolor7388">,</span> <span id="textcolor7389">&#x0027;</span><span id="textcolor7390">--pitch</span><span id="textcolor7391">&#x0027;</span><span id="textcolor7392">,</span> <span id="textcolor7393">&#x0027;</span><span id="textcolor7394">0</span><span id="textcolor7395">&#x0027;</span><span id="textcolor7396">,</span> <span id="textcolor7397">&#x0027;</span><span id="textcolor7398">--roll</span><span id="textcolor7399">&#x0027;</span><span id="textcolor7400">,</span> 
<a 
 id="x13-323046r418"></a>            <span id="textcolor7401">&#x0027;</span><span id="textcolor7402">0</span><span id="textcolor7403">&#x0027;</span><span id="textcolor7404">,</span> <span id="textcolor7405">&#x0027;</span><span id="textcolor7406">--frame-id</span><span id="textcolor7407">&#x0027;</span><span id="textcolor7408">,</span> <span id="textcolor7409">&#x0027;</span><span id="textcolor7410">world</span><span id="textcolor7411">&#x0027;</span><span id="textcolor7412">,</span> <span id="textcolor7413">&#x0027;</span><span id="textcolor7414">--child-frame-id</span><span id="textcolor7415">&#x0027;</span><span id="textcolor7416">,</span> <span id="textcolor7417">&#x0027;</span><span id="textcolor7418">mystaticturtle</span><span id="textcolor7419">&#x0027;</span><span id="textcolor7420">]</span> 
<a 
 id="x13-323048r419"></a>      <span id="textcolor7421">)</span><span id="textcolor7422">,</span> 
<a 
 id="x13-323050r420"></a>   <span id="textcolor7423">]</span><span id="textcolor7424">)</span></div></pre>
<!--l. 337--><p class="noindent" >Note
that
all
arguments
except
for
–frame-id
and
–child-frame-id
are
optional;
if
a
particular
option
isnt
specified,
then
the
identity
will
be
assumed.
                                                                                
                                                                                
                                                                                
</p>
<!--l. 340--><p class="noindent" >
</p>                                                                      
<h3 class="sectionHead"><span class="titlemark">11.3</span>  <a 
 id="x13-32400011.3"></a>Writing
a
Listener</h3>
                                                                                
<a 
 id="paragraph*.154"></a>
<!--l. 342--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-325000"></a>Writing
the
Listener
Node</span>
Lets
first
create
the
source
files.
Go
to
the
<span id="textcolor7425"><code class="verb">learning_tf2_py</code></span>
package
we
created
in
the
previous
tutorial.
Inside
the
<span id="textcolor7426"><code class="verb">src/learning\_tf2\_py/learning\_tf2\_py</code></span>
directory
download
the
example
listener
code
by
entering
the
following
command:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb401" style='padding:20px;border-radius: 3px;'><a 
 id="x13-325002r727"></a>wget<span id="textcolor7427"> </span>https://raw.githubusercontent.com/ros/geometry_tutorials/humble/turtle_tf2_py/turtle_tf2_py/turtle_tf2_listener.py</div></pre>
<!--l. 350--><p class="noindent" >Now
open
the
file
called
<span id="textcolor7428"><code class="verb">turtle_tf2_listener.py</code></span>
using
your
preferred
text
editor.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb402" style='padding:20px;border-radius: 3px;'><a 
 id="x13-325004r732"></a><span id="textcolor7429">import</span><span id="textcolor7430"> </span><span id="textcolor7431">math</span> 
<a 
 id="x13-325006r733"></a> 
<a 
 id="x13-325008r734"></a><span id="textcolor7432">from</span><span id="textcolor7433"> </span><span id="textcolor7434">geometry_msgs</span><span id="textcolor7435">.</span><span id="textcolor7436">msg</span><span id="textcolor7437"> </span><span id="textcolor7438">import</span> <span id="textcolor7439">Twist</span> 
<a 
 id="x13-325010r735"></a> 
<a 
 id="x13-325012r736"></a><span id="textcolor7440">import</span><span id="textcolor7441"> </span><span id="textcolor7442">rclpy</span> 
<a 
 id="x13-325014r737"></a><span id="textcolor7443">from</span><span id="textcolor7444"> </span><span id="textcolor7445">rclpy</span><span id="textcolor7446">.</span><span id="textcolor7447">node</span><span id="textcolor7448"> </span><span id="textcolor7449">import</span> <span id="textcolor7450">Node</span> 
<a 
 id="x13-325016r738"></a> 
<a 
 id="x13-325018r739"></a><span id="textcolor7451">from</span><span id="textcolor7452"> </span><span id="textcolor7453">tf2_ros</span><span id="textcolor7454"> </span><span id="textcolor7455">import</span> <span id="textcolor7456">TransformException</span> 
<a 
 id="x13-325020r740"></a><span id="textcolor7457">from</span><span id="textcolor7458"> </span><span id="textcolor7459">tf2_ros</span><span id="textcolor7460">.</span><span id="textcolor7461">buffer</span><span id="textcolor7462"> </span><span id="textcolor7463">import</span> <span id="textcolor7464">Buffer</span> 
<a 
 id="x13-325022r741"></a><span id="textcolor7465">from</span><span id="textcolor7466"> </span><span id="textcolor7467">tf2_ros</span><span id="textcolor7468">.</span><span id="textcolor7469">transform_listener</span><span id="textcolor7470"> </span><span id="textcolor7471">import</span> <span id="textcolor7472">TransformListener</span> 
<a 
 id="x13-325024r742"></a> 
<a 
 id="x13-325026r743"></a><span id="textcolor7473">from</span><span id="textcolor7474"> </span><span id="textcolor7475">turtlesim</span><span id="textcolor7476">.</span><span id="textcolor7477">srv</span><span id="textcolor7478"> </span><span id="textcolor7479">import</span> <span id="textcolor7480">Spawn</span> 
<a 
 id="x13-325028r744"></a> 
<a 
 id="x13-325030r745"></a> 
<a 
 id="x13-325032r746"></a><span id="textcolor7481">class</span><span id="textcolor7482"> </span><span id="textcolor7483">FrameListener</span><span id="textcolor7484">(</span><span id="textcolor7485">Node</span><span id="textcolor7486">)</span><span id="textcolor7487">:</span> 
<a 
 id="x13-325034r747"></a> 
<a 
 id="x13-325036r748"></a>   <span id="textcolor7488">def</span><span id="textcolor7489"> </span><span id="textcolor7490">__init__</span><span id="textcolor7491">(</span><span id="textcolor7492">self</span><span id="textcolor7493">)</span><span id="textcolor7494">:</span> 
<a 
 id="x13-325038r749"></a>      <span id="textcolor7495">super</span><span id="textcolor7496">(</span><span id="textcolor7497">)</span><span id="textcolor7498">.</span><span id="textcolor7499">__init__</span><span id="textcolor7500">(</span><span id="textcolor7501">&#x0027;</span><span id="textcolor7502">turtle_tf2_frame_listener</span><span id="textcolor7503">&#x0027;</span><span id="textcolor7504">)</span> 
<a 
 id="x13-325040r750"></a> 
<a 
 id="x13-325042r751"></a>      <span id="textcolor7505"># Declare and acquire `target_frame` parameter</span> 
<a 
 id="x13-325044r752"></a>      <span id="textcolor7506">self</span><span id="textcolor7507">.</span><span id="textcolor7508">target_frame</span> <span id="textcolor7509">=</span> <span id="textcolor7510">self</span><span id="textcolor7511">.</span><span id="textcolor7512">declare_parameter</span><span id="textcolor7513">(</span> 
<a 
 id="x13-325046r753"></a>       <span id="textcolor7514">&#x0027;</span><span id="textcolor7515">target_frame</span><span id="textcolor7516">&#x0027;</span><span id="textcolor7517">,</span> <span id="textcolor7518">&#x0027;</span><span id="textcolor7519">turtle1</span><span id="textcolor7520">&#x0027;</span><span id="textcolor7521">)</span><span id="textcolor7522">.</span><span id="textcolor7523">get_parameter_value</span><span id="textcolor7524">(</span><span id="textcolor7525">)</span><span id="textcolor7526">.</span><span id="textcolor7527">string_value</span> 
<a 
 id="x13-325048r754"></a> 
<a 
 id="x13-325050r755"></a>      <span id="textcolor7528">self</span><span id="textcolor7529">.</span><span id="textcolor7530">tf_buffer</span> <span id="textcolor7531">=</span> <span id="textcolor7532">Buffer</span><span id="textcolor7533">(</span><span id="textcolor7534">)</span> 
<a 
 id="x13-325052r756"></a>      <span id="textcolor7535">self</span><span id="textcolor7536">.</span><span id="textcolor7537">tf_listener</span> <span id="textcolor7538">=</span> <span id="textcolor7539">TransformListener</span><span id="textcolor7540">(</span><span id="textcolor7541">self</span><span id="textcolor7542">.</span><span id="textcolor7543">tf_buffer</span><span id="textcolor7544">,</span> <span id="textcolor7545">self</span><span id="textcolor7546">)</span> 
<a 
 id="x13-325054r757"></a> 
<a 
 id="x13-325056r758"></a>      <span id="textcolor7547"># Create a client to spawn a turtle</span> 
<a 
 id="x13-325058r759"></a>      <span id="textcolor7548">self</span><span id="textcolor7549">.</span><span id="textcolor7550">spawner</span> <span id="textcolor7551">=</span> <span id="textcolor7552">self</span><span id="textcolor7553">.</span><span id="textcolor7554">create_client</span><span id="textcolor7555">(</span><span id="textcolor7556">Spawn</span><span id="textcolor7557">,</span> <span id="textcolor7558">&#x0027;</span><span id="textcolor7559">spawn</span><span id="textcolor7560">&#x0027;</span><span id="textcolor7561">)</span> 
<a 
 id="x13-325060r760"></a>      <span id="textcolor7562"># Boolean values to store the information</span> 
<a 
 id="x13-325062r761"></a>      <span id="textcolor7563"># if the service for spawning turtle is available</span> 
<a 
 id="x13-325064r762"></a>      <span id="textcolor7564">self</span><span id="textcolor7565">.</span><span id="textcolor7566">turtle_spawning_service_ready</span> <span id="textcolor7567">=</span> <span id="textcolor7568">False</span> 
<a 
 id="x13-325066r763"></a>      <span id="textcolor7569"># if the turtle was successfully spawned</span> 
<a 
 id="x13-325068r764"></a>      <span id="textcolor7570">self</span><span id="textcolor7571">.</span><span id="textcolor7572">turtle_spawned</span> <span id="textcolor7573">=</span> <span id="textcolor7574">False</span> 
<a 
 id="x13-325070r765"></a> 
<a 
 id="x13-325072r766"></a>      <span id="textcolor7575"># Create turtle2 velocity publisher</span> 
<a 
 id="x13-325074r767"></a>      <span id="textcolor7576">self</span><span id="textcolor7577">.</span><span id="textcolor7578">publisher</span> <span id="textcolor7579">=</span> <span id="textcolor7580">self</span><span id="textcolor7581">.</span><span id="textcolor7582">create_publisher</span><span id="textcolor7583">(</span><span id="textcolor7584">Twist</span><span id="textcolor7585">,</span> <span id="textcolor7586">&#x0027;</span><span id="textcolor7587">turtle2/cmd_vel</span><span id="textcolor7588">&#x0027;</span><span id="textcolor7589">,</span> <span id="textcolor7590">1</span><span id="textcolor7591">)</span> 
<a 
 id="x13-325076r768"></a> 
<a 
 id="x13-325078r769"></a>      <span id="textcolor7592"># Call on_timer function every second</span> 
<a 
 id="x13-325080r770"></a>      <span id="textcolor7593">self</span><span id="textcolor7594">.</span><span id="textcolor7595">timer</span> <span id="textcolor7596">=</span> <span id="textcolor7597">self</span><span id="textcolor7598">.</span><span id="textcolor7599">create_timer</span><span id="textcolor7600">(</span><span id="textcolor7601">1.0</span><span id="textcolor7602">,</span> <span id="textcolor7603">self</span><span id="textcolor7604">.</span><span id="textcolor7605">on_timer</span><span id="textcolor7606">)</span> 
<a 
 id="x13-325082r771"></a> 
<a 
 id="x13-325084r772"></a>   <span id="textcolor7607">def</span><span id="textcolor7608"> </span><span id="textcolor7609">on_timer</span><span id="textcolor7610">(</span><span id="textcolor7611">self</span><span id="textcolor7612">)</span><span id="textcolor7613">:</span> 
<a 
 id="x13-325086r773"></a>      <span id="textcolor7614"># Store frame names in variables that will be used to</span> 
<a 
 id="x13-325088r774"></a>      <span id="textcolor7615"># compute transformations</span> 
<a 
 id="x13-325090r775"></a>      <span id="textcolor7616">from_frame_rel</span> <span id="textcolor7617">=</span> <span id="textcolor7618">self</span><span id="textcolor7619">.</span><span id="textcolor7620">target_frame</span> 
<a 
 id="x13-325092r776"></a>      <span id="textcolor7621">to_frame_rel</span> <span id="textcolor7622">=</span> <span id="textcolor7623">&#x0027;</span><span id="textcolor7624">turtle2</span><span id="textcolor7625">&#x0027;</span> 
<a 
 id="x13-325094r777"></a> 
<a 
 id="x13-325096r778"></a>      <span id="textcolor7626">if</span> <span id="textcolor7627">self</span><span id="textcolor7628">.</span><span id="textcolor7629">turtle_spawning_service_ready</span><span id="textcolor7630">:</span> 
<a 
 id="x13-325098r779"></a>         <span id="textcolor7631">if</span> <span id="textcolor7632">self</span><span id="textcolor7633">.</span><span id="textcolor7634">turtle_spawned</span><span id="textcolor7635">:</span> 
<a 
 id="x13-325100r780"></a>            <span id="textcolor7636"># Look up for the transformation between target_frame and turtle2 frames</span> 
<a 
 id="x13-325102r781"></a>            <span id="textcolor7637"># and send velocity commands for turtle2 to reach target_frame</span> 
<a 
 id="x13-325104r782"></a>            <span id="textcolor7638">try</span><span id="textcolor7639">:</span> 
<a 
 id="x13-325106r783"></a>              <span id="textcolor7640">t</span> <span id="textcolor7641">=</span> <span id="textcolor7642">self</span><span id="textcolor7643">.</span><span id="textcolor7644">tf_buffer</span><span id="textcolor7645">.</span><span id="textcolor7646">lookup_transform</span><span id="textcolor7647">(</span> 
<a 
 id="x13-325108r784"></a>                 <span id="textcolor7648">to_frame_rel</span><span id="textcolor7649">,</span> 
<a 
 id="x13-325110r785"></a>                 <span id="textcolor7650">from_frame_rel</span><span id="textcolor7651">,</span> 
<a 
 id="x13-325112r786"></a>                 <span id="textcolor7652">rclpy</span><span id="textcolor7653">.</span><span id="textcolor7654">time</span><span id="textcolor7655">.</span><span id="textcolor7656">Time</span><span id="textcolor7657">(</span><span id="textcolor7658">)</span><span id="textcolor7659">)</span> 
<a 
 id="x13-325114r787"></a>            <span id="textcolor7660">except</span> <span id="textcolor7661">TransformException</span> <span id="textcolor7662">as</span> <span id="textcolor7663">ex</span><span id="textcolor7664">:</span> 
<a 
 id="x13-325116r788"></a>              <span id="textcolor7665">self</span><span id="textcolor7666">.</span><span id="textcolor7667">get_logger</span><span id="textcolor7668">(</span><span id="textcolor7669">)</span><span id="textcolor7670">.</span><span id="textcolor7671">info</span><span id="textcolor7672">(</span> 
<a 
 id="x13-325118r789"></a>                 <span id="textcolor7673">f</span><span id="textcolor7674">&#x0027;</span><span id="textcolor7675">Could not transform </span><span id="textcolor7676">{</span><span id="textcolor7677">to_frame_rel</span><span id="textcolor7678">}</span><span id="textcolor7679"> to </span><span id="textcolor7680">{</span><span id="textcolor7681">from_frame_rel</span><span id="textcolor7682">}</span><span id="textcolor7683">: </span><span id="textcolor7684">{</span><span id="textcolor7685">ex</span><span id="textcolor7686">}</span><span id="textcolor7687">&#x0027;</span><span id="textcolor7688">)</span> 
<a 
 id="x13-325120r790"></a>              <span id="textcolor7689">return</span> 
<a 
 id="x13-325122r791"></a> 
<a 
 id="x13-325124r792"></a>            <span id="textcolor7690">msg</span> <span id="textcolor7691">=</span> <span id="textcolor7692">Twist</span><span id="textcolor7693">(</span><span id="textcolor7694">)</span> 
<a 
 id="x13-325126r793"></a>            <span id="textcolor7695">scale_rotation_rate</span> <span id="textcolor7696">=</span> <span id="textcolor7697">1.0</span> 
<a 
 id="x13-325128r794"></a>            <span id="textcolor7698">msg</span><span id="textcolor7699">.</span><span id="textcolor7700">angular</span><span id="textcolor7701">.</span><span id="textcolor7702">z</span> <span id="textcolor7703">=</span> <span id="textcolor7704">scale_rotation_rate</span> <span id="textcolor7705">*</span> <span id="textcolor7706">math</span><span id="textcolor7707">.</span><span id="textcolor7708">atan2</span><span id="textcolor7709">(</span> 
<a 
 id="x13-325130r795"></a>              <span id="textcolor7710">t</span><span id="textcolor7711">.</span><span id="textcolor7712">transform</span><span id="textcolor7713">.</span><span id="textcolor7714">translation</span><span id="textcolor7715">.</span><span id="textcolor7716">y</span><span id="textcolor7717">,</span> 
<a 
 id="x13-325132r796"></a>              <span id="textcolor7718">t</span><span id="textcolor7719">.</span><span id="textcolor7720">transform</span><span id="textcolor7721">.</span><span id="textcolor7722">translation</span><span id="textcolor7723">.</span><span id="textcolor7724">x</span><span id="textcolor7725">)</span> 
<a 
 id="x13-325134r797"></a> 
<a 
 id="x13-325136r798"></a>            <span id="textcolor7726">scale_forward_speed</span> <span id="textcolor7727">=</span> <span id="textcolor7728">0.5</span> 
<a 
 id="x13-325138r799"></a>            <span id="textcolor7729">msg</span><span id="textcolor7730">.</span><span id="textcolor7731">linear</span><span id="textcolor7732">.</span><span id="textcolor7733">x</span> <span id="textcolor7734">=</span> <span id="textcolor7735">scale_forward_speed</span> <span id="textcolor7736">*</span> <span id="textcolor7737">math</span><span id="textcolor7738">.</span><span id="textcolor7739">sqrt</span><span id="textcolor7740">(</span> 
<a 
 id="x13-325140r800"></a>              <span id="textcolor7741">t</span><span id="textcolor7742">.</span><span id="textcolor7743">transform</span><span id="textcolor7744">.</span><span id="textcolor7745">translation</span><span id="textcolor7746">.</span><span id="textcolor7747">x</span> <span id="textcolor7748">*</span><span id="textcolor7749">*</span> <span id="textcolor7750">2</span> <span id="textcolor7751">+</span> 
<a 
 id="x13-325142r801"></a>              <span id="textcolor7752">t</span><span id="textcolor7753">.</span><span id="textcolor7754">transform</span><span id="textcolor7755">.</span><span id="textcolor7756">translation</span><span id="textcolor7757">.</span><span id="textcolor7758">y</span> <span id="textcolor7759">*</span><span id="textcolor7760">*</span> <span id="textcolor7761">2</span><span id="textcolor7762">)</span> 
<a 
 id="x13-325144r802"></a> 
<a 
 id="x13-325146r803"></a>            <span id="textcolor7763">self</span><span id="textcolor7764">.</span><span id="textcolor7765">publisher</span><span id="textcolor7766">.</span><span id="textcolor7767">publish</span><span id="textcolor7768">(</span><span id="textcolor7769">msg</span><span id="textcolor7770">)</span> 
<a 
 id="x13-325148r804"></a>         <span id="textcolor7771">else</span><span id="textcolor7772">:</span> 
<a 
 id="x13-325150r805"></a>            <span id="textcolor7773">if</span> <span id="textcolor7774">self</span><span id="textcolor7775">.</span><span id="textcolor7776">result</span><span id="textcolor7777">.</span><span id="textcolor7778">done</span><span id="textcolor7779">(</span><span id="textcolor7780">)</span><span id="textcolor7781">:</span> 
<a 
 id="x13-325152r806"></a>              <span id="textcolor7782">self</span><span id="textcolor7783">.</span><span id="textcolor7784">get_logger</span><span id="textcolor7785">(</span><span id="textcolor7786">)</span><span id="textcolor7787">.</span><span id="textcolor7788">info</span><span id="textcolor7789">(</span> 
<a 
 id="x13-325154r807"></a>                 <span id="textcolor7790">f</span><span id="textcolor7791">&#x0027;</span><span id="textcolor7792">Successfully spawned </span><span id="textcolor7793">{</span><span id="textcolor7794">self</span><span id="textcolor7795">.</span><span id="textcolor7796">result</span><span id="textcolor7797">.</span><span id="textcolor7798">result</span><span id="textcolor7799">(</span><span id="textcolor7800">)</span><span id="textcolor7801">.</span><span id="textcolor7802">name</span><span id="textcolor7803">}</span><span id="textcolor7804">&#x0027;</span><span id="textcolor7805">)</span> 
<a 
 id="x13-325156r808"></a>              <span id="textcolor7806">self</span><span id="textcolor7807">.</span><span id="textcolor7808">turtle_spawned</span> <span id="textcolor7809">=</span> <span id="textcolor7810">True</span> 
<a 
 id="x13-325158r809"></a>            <span id="textcolor7811">else</span><span id="textcolor7812">:</span> 
<a 
 id="x13-325160r810"></a>              <span id="textcolor7813">self</span><span id="textcolor7814">.</span><span id="textcolor7815">get_logger</span><span id="textcolor7816">(</span><span id="textcolor7817">)</span><span id="textcolor7818">.</span><span id="textcolor7819">info</span><span id="textcolor7820">(</span><span id="textcolor7821">&#x0027;</span><span id="textcolor7822">Spawn is not finished</span><span id="textcolor7823">&#x0027;</span><span id="textcolor7824">)</span> 
<a 
 id="x13-325162r811"></a>      <span id="textcolor7825">else</span><span id="textcolor7826">:</span> 
<a 
 id="x13-325164r812"></a>         <span id="textcolor7827">if</span> <span id="textcolor7828">self</span><span id="textcolor7829">.</span><span id="textcolor7830">spawner</span><span id="textcolor7831">.</span><span id="textcolor7832">service_is_ready</span><span id="textcolor7833">(</span><span id="textcolor7834">)</span><span id="textcolor7835">:</span> 
<a 
 id="x13-325166r813"></a>            <span id="textcolor7836"># Initialize request with turtle name and coordinates</span> 
<a 
 id="x13-325168r814"></a>            <span id="textcolor7837"># Note that x, y and theta are defined as floats in turtlesim/srv/Spawn</span> 
<a 
 id="x13-325170r815"></a>            <span id="textcolor7838">request</span> <span id="textcolor7839">=</span> <span id="textcolor7840">Spawn</span><span id="textcolor7841">.</span><span id="textcolor7842">Request</span><span id="textcolor7843">(</span><span id="textcolor7844">)</span> 
<a 
 id="x13-325172r816"></a>            <span id="textcolor7845">request</span><span id="textcolor7846">.</span><span id="textcolor7847">name</span> <span id="textcolor7848">=</span> <span id="textcolor7849">&#x0027;</span><span id="textcolor7850">turtle2</span><span id="textcolor7851">&#x0027;</span> 
<a 
 id="x13-325174r817"></a>            <span id="textcolor7852">request</span><span id="textcolor7853">.</span><span id="textcolor7854">x</span> <span id="textcolor7855">=</span> <span id="textcolor7856">float</span><span id="textcolor7857">(</span><span id="textcolor7858">4</span><span id="textcolor7859">)</span> 
<a 
 id="x13-325176r818"></a>            <span id="textcolor7860">request</span><span id="textcolor7861">.</span><span id="textcolor7862">y</span> <span id="textcolor7863">=</span> <span id="textcolor7864">float</span><span id="textcolor7865">(</span><span id="textcolor7866">2</span><span id="textcolor7867">)</span> 
<a 
 id="x13-325178r819"></a>            <span id="textcolor7868">request</span><span id="textcolor7869">.</span><span id="textcolor7870">theta</span> <span id="textcolor7871">=</span> <span id="textcolor7872">float</span><span id="textcolor7873">(</span><span id="textcolor7874">0</span><span id="textcolor7875">)</span> 
<a 
 id="x13-325180r820"></a>            <span id="textcolor7876"># Call request</span> 
<a 
 id="x13-325182r821"></a>            <span id="textcolor7877">self</span><span id="textcolor7878">.</span><span id="textcolor7879">result</span> <span id="textcolor7880">=</span> <span id="textcolor7881">self</span><span id="textcolor7882">.</span><span id="textcolor7883">spawner</span><span id="textcolor7884">.</span><span id="textcolor7885">call_async</span><span id="textcolor7886">(</span><span id="textcolor7887">request</span><span id="textcolor7888">)</span> 
<a 
 id="x13-325184r822"></a>            <span id="textcolor7889">self</span><span id="textcolor7890">.</span><span id="textcolor7891">turtle_spawning_service_ready</span> <span id="textcolor7892">=</span> <span id="textcolor7893">True</span> 
<a 
 id="x13-325186r823"></a>         <span id="textcolor7894">else</span><span id="textcolor7895">:</span> 
<a 
 id="x13-325188r824"></a>            <span id="textcolor7896"># Check if the service is ready</span> 
<a 
 id="x13-325190r825"></a>            <span id="textcolor7897">self</span><span id="textcolor7898">.</span><span id="textcolor7899">get_logger</span><span id="textcolor7900">(</span><span id="textcolor7901">)</span><span id="textcolor7902">.</span><span id="textcolor7903">info</span><span id="textcolor7904">(</span><span id="textcolor7905">&#x0027;</span><span id="textcolor7906">Service is not ready</span><span id="textcolor7907">&#x0027;</span><span id="textcolor7908">)</span> 
<a 
 id="x13-325192r826"></a> 
<a 
 id="x13-325194r827"></a> 
<a 
 id="x13-325196r828"></a><span id="textcolor7909">def</span><span id="textcolor7910"> </span><span id="textcolor7911">main</span><span id="textcolor7912">(</span><span id="textcolor7913">)</span><span id="textcolor7914">:</span> 
<a 
 id="x13-325198r829"></a>   <span id="textcolor7915">rclpy</span><span id="textcolor7916">.</span><span id="textcolor7917">init</span><span id="textcolor7918">(</span><span id="textcolor7919">)</span> 
<a 
 id="x13-325200r830"></a>   <span id="textcolor7920">node</span> <span id="textcolor7921">=</span> <span id="textcolor7922">FrameListener</span><span id="textcolor7923">(</span><span id="textcolor7924">)</span> 
<a 
 id="x13-325202r831"></a>   <span id="textcolor7925">try</span><span id="textcolor7926">:</span> 
<a 
 id="x13-325204r832"></a>      <span id="textcolor7927">rclpy</span><span id="textcolor7928">.</span><span id="textcolor7929">spin</span><span id="textcolor7930">(</span><span id="textcolor7931">node</span><span id="textcolor7932">)</span> 
<a 
 id="x13-325206r833"></a>   <span id="textcolor7933">except</span> <span id="textcolor7934">KeyboardInterrupt</span><span id="textcolor7935">:</span> 
<a 
 id="x13-325208r834"></a>      <span id="textcolor7936">pass</span> 
<a 
 id="x13-325210r835"></a> 
<a 
 id="x13-325212r836"></a>   <span id="textcolor7937">rclpy</span><span id="textcolor7938">.</span><span id="textcolor7939">shutdown</span><span id="textcolor7940">(</span><span id="textcolor7941">)</span></div></pre>

                                                                                
                                                                                
                                                                                
<a 
 id="paragraph*.155"></a>
<!--l. 354--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-326000"></a>Examining
the
Code</span>
Now,
lets
take
a
look
at
the
code
that
is
relevant
to
get
access
to
frame
transformations.
The
<span id="textcolor7942"><code class="verb">tf2_ros</code></span>
package
provides
an
implementation
of
a
TransformListener
to
help
make
the
task
of
receiving
transforms
easier.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                       
<pre><div id="fancyvrb403" style='padding:20px;border-radius: 3px;'><a 
 id="x13-326002r843"></a><span id="textcolor7943">from</span><span id="textcolor7944"> </span><span id="textcolor7945">tf2_ros</span><span id="textcolor7946">.</span><span id="textcolor7947">transform_listener</span><span id="textcolor7948"> </span><span id="textcolor7949">import</span> <span id="textcolor7950">TransformListener</span></div></pre>
<!--l. 362--><p class="noindent" >Here,
we
create
a
TransformListener
object.
Once
the
listener
is
created,
it
starts
receiving
tf2
transformations
over
the
wire,
and
buffers
them
for
                                                                                
                                                                                
                                                                              
up
to
10
seconds.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                      
<pre><div id="fancyvrb404" style='padding:20px;border-radius: 3px;'><a 
 id="x13-326004r848"></a><span id="textcolor7951">self</span><span id="textcolor7952">.</span><span id="textcolor7953">tf_listener</span> <span id="textcolor7954">=</span> <span id="textcolor7955">TransformListener</span><span id="textcolor7956">(</span><span id="textcolor7957">self</span><span id="textcolor7958">.</span><span id="textcolor7959">tf_buffer</span><span id="textcolor7960">,</span> <span id="textcolor7961">self</span><span id="textcolor7962">)</span></div></pre>
<!--l. 367--><p class="noindent" >Finally,
we
query
the
listener
for
a
specific
transformation.
We
call
<span id="textcolor7963"><code class="verb">lookup_transform</code></span>
method
with
following
arguments:
</p>     
<ul class="itemize1">
<li class="itemize">     
<!--l. 371--><p class="noindent" >Target frame
</p>     
</li>
<li class="itemize">     
<!--l. 372--><p class="noindent" >Source frame
</p>     
</li>
<li class="itemize">     
<!--l. 373--><p class="noindent" >The time at which we want to transform</p></li></ul>                                         
<!--l. 376--><p class="noindent" >Providing
<span id="textcolor7967"><code class="verb">rclpy.time.Time()</code></span>
will
just
get
us
the
latest
available
transform.
All
this
is
wrapped
in
a
try-except
block
to
handle
possible
exceptions.

                                                                                
                                                                                
                                                                                
<a 
 id="paragraph*.156"></a></p>
<!--l. 379--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-327000"></a>Adding
an
Entry
Point</span>
To
allow
the
ros2
run
command
to
run
your
node,
you
must
add
the
entry
point
to
setup.py
(located
in
the
<span id="textcolor7968"><code class="verb">src/learning\_tf2\_py directory</code></span>
).
</p>                                                                             
<!--l. 384--><p class="noindent" >Add
the
following
line
between
the
<span id="textcolor7969"><code class="verb">&#x0027;console_scripts&#x0027;:</code></span>
brackets:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                 
<pre><div id="fancyvrb405" style='padding:20px;border-radius: 3px;'><a 
 id="x13-327002r863"></a><span id="textcolor7970">&#x0027;</span><span id="textcolor7971">turtle_tf2_listener = learning_tf2_py.turtle_tf2_listener:main</span><span id="textcolor7972">&#x0027;</span><span id="textcolor7973">,</span></div></pre>
                                                                                
<a 
 id="paragraph*.157"></a>
<!--l. 388--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-328000"></a>Updating
the
Launch
Files</span>
Open
the
launch
file
called
<span id="textcolor7974"><code class="verb">turtle_tf2_demo.launch.py</code></span>
in
the
<span id="textcolor7975"><code class="verb">src/learning\_tf2\_py/launch</code></span>
directory
with
your
text
editor,
add
two
new
                                                                                
                                                                                
                                                                            
nodes
to
the
launch
description,
add
a
launch
argument,
and
add
the
imports.
The
resulting
file
should
look
like:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb406" style='padding:20px;border-radius: 3px;'><a 
 id="x13-328002r870"></a><span id="textcolor7976">from</span><span id="textcolor7977"> </span><span id="textcolor7978">launch</span><span id="textcolor7979"> </span><span id="textcolor7980">import</span> <span id="textcolor7981">LaunchDescription</span> 
<a 
 id="x13-328004r871"></a><span id="textcolor7982">from</span><span id="textcolor7983"> </span><span id="textcolor7984">launch</span><span id="textcolor7985">.</span><span id="textcolor7986">actions</span><span id="textcolor7987"> </span><span id="textcolor7988">import</span> <span id="textcolor7989">DeclareLaunchArgument</span> 
<a 
 id="x13-328006r872"></a><span id="textcolor7990">from</span><span id="textcolor7991"> </span><span id="textcolor7992">launch</span><span id="textcolor7993">.</span><span id="textcolor7994">substitutions</span><span id="textcolor7995"> </span><span id="textcolor7996">import</span> <span id="textcolor7997">LaunchConfiguration</span> 
<a 
 id="x13-328008r873"></a> 
<a 
 id="x13-328010r874"></a><span id="textcolor7998">from</span><span id="textcolor7999"> </span><span id="textcolor8000">launch_ros</span><span id="textcolor8001">.</span><span id="textcolor8002">actions</span><span id="textcolor8003"> </span><span id="textcolor8004">import</span> <span id="textcolor8005">Node</span> 
<a 
 id="x13-328012r875"></a> 
<a 
 id="x13-328014r876"></a> 
<a 
 id="x13-328016r877"></a><span id="textcolor8006">def</span><span id="textcolor8007"> </span><span id="textcolor8008">generate_launch_description</span><span id="textcolor8009">(</span><span id="textcolor8010">)</span><span id="textcolor8011">:</span> 
<a 
 id="x13-328018r878"></a>   <span id="textcolor8012">return</span> <span id="textcolor8013">LaunchDescription</span><span id="textcolor8014">(</span><span id="textcolor8015">[</span> 
<a 
 id="x13-328020r879"></a>      <span id="textcolor8016">Node</span><span id="textcolor8017">(</span> 
<a 
 id="x13-328022r880"></a>         <span id="textcolor8018">package</span><span id="textcolor8019">=</span><span id="textcolor8020">&#x0027;</span><span id="textcolor8021">turtlesim</span><span id="textcolor8022">&#x0027;</span><span id="textcolor8023">,</span> 
<a 
 id="x13-328024r881"></a>         <span id="textcolor8024">executable</span><span id="textcolor8025">=</span><span id="textcolor8026">&#x0027;</span><span id="textcolor8027">turtlesim_node</span><span id="textcolor8028">&#x0027;</span><span id="textcolor8029">,</span> 
<a 
 id="x13-328026r882"></a>         <span id="textcolor8030">name</span><span id="textcolor8031">=</span><span id="textcolor8032">&#x0027;</span><span id="textcolor8033">sim</span><span id="textcolor8034">&#x0027;</span> 
<a 
 id="x13-328028r883"></a>      <span id="textcolor8035">)</span><span id="textcolor8036">,</span> 
<a 
 id="x13-328030r884"></a>      <span id="textcolor8037">Node</span><span id="textcolor8038">(</span> 
<a 
 id="x13-328032r885"></a>         <span id="textcolor8039">package</span><span id="textcolor8040">=</span><span id="textcolor8041">&#x0027;</span><span id="textcolor8042">learning_tf2_py</span><span id="textcolor8043">&#x0027;</span><span id="textcolor8044">,</span> 
<a 
 id="x13-328034r886"></a>         <span id="textcolor8045">executable</span><span id="textcolor8046">=</span><span id="textcolor8047">&#x0027;</span><span id="textcolor8048">turtle_tf2_broadcaster</span><span id="textcolor8049">&#x0027;</span><span id="textcolor8050">,</span> 
<a 
 id="x13-328036r887"></a>         <span id="textcolor8051">name</span><span id="textcolor8052">=</span><span id="textcolor8053">&#x0027;</span><span id="textcolor8054">broadcaster1</span><span id="textcolor8055">&#x0027;</span><span id="textcolor8056">,</span> 
<a 
 id="x13-328038r888"></a>         <span id="textcolor8057">parameters</span><span id="textcolor8058">=</span><span id="textcolor8059">[</span> 
<a 
 id="x13-328040r889"></a>            <span id="textcolor8060">{</span><span id="textcolor8061">&#x0027;</span><span id="textcolor8062">turtlename</span><span id="textcolor8063">&#x0027;</span><span id="textcolor8064">:</span> <span id="textcolor8065">&#x0027;</span><span id="textcolor8066">turtle1</span><span id="textcolor8067">&#x0027;</span><span id="textcolor8068">}</span> 
<a 
 id="x13-328042r890"></a>         <span id="textcolor8069">]</span> 
<a 
 id="x13-328044r891"></a>      <span id="textcolor8070">)</span><span id="textcolor8071">,</span> 
<a 
 id="x13-328046r892"></a>      <span id="textcolor8072">DeclareLaunchArgument</span><span id="textcolor8073">(</span> 
<a 
 id="x13-328048r893"></a>         <span id="textcolor8074">&#x0027;</span><span id="textcolor8075">target_frame</span><span id="textcolor8076">&#x0027;</span><span id="textcolor8077">,</span> <span id="textcolor8078">default_value</span><span id="textcolor8079">=</span><span id="textcolor8080">&#x0027;</span><span id="textcolor8081">turtle1</span><span id="textcolor8082">&#x0027;</span><span id="textcolor8083">,</span> 
<a 
 id="x13-328050r894"></a>         <span id="textcolor8084">description</span><span id="textcolor8085">=</span><span id="textcolor8086">&#x0027;</span><span id="textcolor8087">Target frame name.</span><span id="textcolor8088">&#x0027;</span> 
<a 
 id="x13-328052r895"></a>      <span id="textcolor8089">)</span><span id="textcolor8090">,</span> 
<a 
 id="x13-328054r896"></a>      <span id="textcolor8091">Node</span><span id="textcolor8092">(</span> 
<a 
 id="x13-328056r897"></a>         <span id="textcolor8093">package</span><span id="textcolor8094">=</span><span id="textcolor8095">&#x0027;</span><span id="textcolor8096">learning_tf2_py</span><span id="textcolor8097">&#x0027;</span><span id="textcolor8098">,</span> 
<a 
 id="x13-328058r898"></a>         <span id="textcolor8099">executable</span><span id="textcolor8100">=</span><span id="textcolor8101">&#x0027;</span><span id="textcolor8102">turtle_tf2_broadcaster</span><span id="textcolor8103">&#x0027;</span><span id="textcolor8104">,</span> 
<a 
 id="x13-328060r899"></a>         <span id="textcolor8105">name</span><span id="textcolor8106">=</span><span id="textcolor8107">&#x0027;</span><span id="textcolor8108">broadcaster2</span><span id="textcolor8109">&#x0027;</span><span id="textcolor8110">,</span> 
<a 
 id="x13-328062r900"></a>         <span id="textcolor8111">parameters</span><span id="textcolor8112">=</span><span id="textcolor8113">[</span> 
<a 
 id="x13-328064r901"></a>            <span id="textcolor8114">{</span><span id="textcolor8115">&#x0027;</span><span id="textcolor8116">turtlename</span><span id="textcolor8117">&#x0027;</span><span id="textcolor8118">:</span> <span id="textcolor8119">&#x0027;</span><span id="textcolor8120">turtle2</span><span id="textcolor8121">&#x0027;</span><span id="textcolor8122">}</span> 
<a 
 id="x13-328066r902"></a>         <span id="textcolor8123">]</span> 
<a 
 id="x13-328068r903"></a>      <span id="textcolor8124">)</span><span id="textcolor8125">,</span> 
<a 
 id="x13-328070r904"></a>      <span id="textcolor8126">Node</span><span id="textcolor8127">(</span> 
<a 
 id="x13-328072r905"></a>         <span id="textcolor8128">package</span><span id="textcolor8129">=</span><span id="textcolor8130">&#x0027;</span><span id="textcolor8131">learning_tf2_py</span><span id="textcolor8132">&#x0027;</span><span id="textcolor8133">,</span> 
<a 
 id="x13-328074r906"></a>         <span id="textcolor8134">executable</span><span id="textcolor8135">=</span><span id="textcolor8136">&#x0027;</span><span id="textcolor8137">turtle_tf2_listener</span><span id="textcolor8138">&#x0027;</span><span id="textcolor8139">,</span> 
<a 
 id="x13-328076r907"></a>         <span id="textcolor8140">name</span><span id="textcolor8141">=</span><span id="textcolor8142">&#x0027;</span><span id="textcolor8143">listener</span><span id="textcolor8144">&#x0027;</span><span id="textcolor8145">,</span> 
<a 
 id="x13-328078r908"></a>         <span id="textcolor8146">parameters</span><span id="textcolor8147">=</span><span id="textcolor8148">[</span> 
<a 
 id="x13-328080r909"></a>            <span id="textcolor8149">{</span><span id="textcolor8150">&#x0027;</span><span id="textcolor8151">target_frame</span><span id="textcolor8152">&#x0027;</span><span id="textcolor8153">:</span> <span id="textcolor8154">LaunchConfiguration</span><span id="textcolor8155">(</span><span id="textcolor8156">&#x0027;</span><span id="textcolor8157">target_frame</span><span id="textcolor8158">&#x0027;</span><span id="textcolor8159">)</span><span id="textcolor8160">}</span> 
<a 
 id="x13-328082r910"></a>         <span id="textcolor8161">]</span> 
<a 
 id="x13-328084r911"></a>      <span id="textcolor8162">)</span><span id="textcolor8163">,</span> 
<a 
 id="x13-328086r912"></a>   <span id="textcolor8164">]</span><span id="textcolor8165">)</span></div></pre>
<!--l. 397--><p class="noindent" >This
will
declare
a
<span id="textcolor8166"><code class="verb">target_frame</code></span>
launch
argument,
start
a
broadcaster
for
second
turtle
that
we
will
spawn
and
listener
that
will
subscribe
to
those
transformations.
                                                                                
<a 
 id="paragraph*.158"></a></p>
<!--l. 400--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-329000"></a>Build</span>
Run
<span id="textcolor8167"><code class="verb">rosdep</code></span>
in
the
root
of
your
workspace
to
check
for
missing
dependencies.
</p>                                                                                
<!--l. 1--><p class="noindent" >
                                                                                
                                                                                

</p>                                        
<pre><div id="fancyvrb407" style='padding:20px;border-radius: 3px;'><a 
 id="x13-329002r919"></a>rosdep<span id="textcolor8168"> </span>install<span id="textcolor8169"> </span>-i<span id="textcolor8170"> </span>--from-path<span id="textcolor8171"> </span>src<span id="textcolor8172"> </span>--rosdistro<span id="textcolor8173"> </span>humble<span id="textcolor8174"> </span>-y</div></pre>
<!--l. 406--><p class="noindent" >Still
in
the
root
of
your
workspace,
build
your
package:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                              
<pre><div id="fancyvrb408" style='padding:20px;border-radius: 3px;'><a 
 id="x13-329004r924"></a>colcon<span id="textcolor8175"> </span>build<span id="textcolor8176"> </span>--packages-select<span id="textcolor8177"> </span>learning_tf2_py</div></pre>
<!--l. 410--><p class="noindent" >Open
a
new
terminal,
navigate
to
the
root
of
your
workspace,
and
source
the
setup
files:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                                 
<pre><div id="fancyvrb409" style='padding:20px;border-radius: 3px;'><a 
 id="x13-329006r929"></a>.<span id="textcolor8178"> </span>install/setup.bash</div></pre>
                                                                                
<a 
 id="paragraph*.159"></a>
<!--l. 414--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-330000"></a>Run</span>
Now
youre
ready
to
start
your
full
turtle
demo:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                         
<pre><div id="fancyvrb410" style='padding:20px;border-radius: 3px;'><a 
 id="x13-330002r936"></a>ros2<span id="textcolor8179"> </span>launch<span id="textcolor8180"> </span>learning_tf2_py<span id="textcolor8181"> </span>turtle_tf2_demo.launch.py</div></pre>
<!--l. 420--><p class="noindent" >You
should
see
the
turtle
sim
with
two
turtles.
In
                                                                                
                                                                                
                                                                              
the
second
terminal
window
type
the
following
command:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                      
<pre><div id="fancyvrb411" style='padding:20px;border-radius: 3px;'><a 
 id="x13-330004r941"></a>ros2<span id="textcolor8182"> </span>run<span id="textcolor8183"> </span>turtlesim<span id="textcolor8184"> </span>turtle_teleop_key</div></pre>
<!--l. 424--><p class="noindent" >To
see
if
things
work,
simply
drive
around
the
first
turtle
using
the
arrow
keys
(make
sure
your
terminal
window
is
active,
not
your
simulator
window),
and
youll
see
the
second
turtle
following
the
first
one!
                                                                                
                                                                                
                                                                                
</p>
<!--l. 428--><p class="noindent" >
</p>                                                                       
<h3 class="sectionHead"><span class="titlemark">11.4</span>  <a 
 id="x13-33100011.4"></a>Adding
a
Frame</h3>
<!--l. 430--><p class="noindent" >Previously,
we’ve
recreated
the
turtle
demo
by
writing
a
tf2
broadcaster
and
a
tf2
listener.
This
tutorial
will
teach
you
how
to
add
extra
fixed
and
dynamic
frames
to
the
transformation
tree.
In
fact,
adding
a
frame
in
tf2
is
very
similar
to
creating
the
tf2
broadcaster,
but
this
example
will
show
you
some
additional
features
of
                                                                                
                                                                                
                                                                             
tf2.
</p>                                                                             
<!--l. 435--><p class="noindent" >For
many
tasks
related
to
transformations,
it
is
easier
to
think
inside
a
local
frame.
For
example,
it
is
easiest
to
reason
about
laser
scan
measurements
in
a
frame
at
the
center
of
the
laser
scanner.
tf2
allows
you
to
define
a
local
frame
for
each
sensor,
link,
or
joint
in
your
system.
When
transforming
from
one
frame
to
another,
tf2
will
take
care
of
all
                                                                                
                                                                                
                                                                              
the
hidden
intermediate
frame
transformations
that
are
introduced.
                                                                                
<a 
 id="paragraph*.160"></a></p>
<!--l. 441--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-332000"></a>Viewing
the
Tree</span>
tf2
builds
up
a
tree
structure
of
frames
and,
thus,
does
not
allow
a
closed
loop
in
the
frame
structure.
This
means
that
a
frame
only
has
one
single
parent,
but
it
can
have
multiple
children.
Currently,
our
tf2
tree
contains
three
frames:
world,
turtle1
and
turtle2.
The
two
turtle
frames
are
                                                                                
                                                                                
                                                                          
children
of
the
world
frame.
If
we
want
to
add
a
new
frame
to
tf2,
one
of
the
three
existing
frames
needs
to
be
the
parent
frame,
and
the
new
one
will
become
its
child
frame.
                                                                                
<a 
 id="paragraph*.161"></a></p>
<!--l. 450--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-333000"></a>Writing
the
Fixed
Frame
Broadcaster</span>
In
our
turtle
example,
well
add
a
new
frame
carrot1,
which
will
be
the
child
of
the
turtle1.
This
frame
will
serve
                                                                                
                                                                                
                                                                              
as
the
goal
for
the
second
turtle.
</p>                                                                             
<!--l. 455--><p class="noindent" >Lets
first
create
the
source
files.
Go
to
the
<span id="textcolor8185"><code class="verb">learning_tf2_py</code></span>
package
we
created
in
the
previous
tutorials.
Inside
the
<span id="textcolor8186"><code class="verb">src/learning_tf2_py/learning_tf2_py</code></span>
directory
download
the
fixed
frame
broadcaster
code
by
entering
the
following
command:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb412" style='padding:20px;border-radius: 3px;'><a 
 id="x13-333002r951"></a>wget<span id="textcolor8187"> </span>https://raw.githubusercontent.com/ros/geometry_tutorials/humble/turtle_tf2_py/turtle_tf2_py/fixed_frame_tf2_broadcaster.py</div></pre>
<!--l. 461--><p class="noindent" >Now
open
the
file
called
<span id="textcolor8188"><code class="verb">fixed_frame_tf2_broadcaster.py</code></span>.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb413" style='padding:20px;border-radius: 3px;'><a 
 id="x13-333004r957"></a><span id="textcolor8189">from</span><span id="textcolor8190"> </span><span id="textcolor8191">geometry_msgs</span><span id="textcolor8192">.</span><span id="textcolor8193">msg</span><span id="textcolor8194"> </span><span id="textcolor8195">import</span> <span id="textcolor8196">TransformStamped</span> 
<a 
 id="x13-333006r958"></a> 
<a 
 id="x13-333008r959"></a><span id="textcolor8197">import</span><span id="textcolor8198"> </span><span id="textcolor8199">rclpy</span> 
<a 
 id="x13-333010r960"></a><span id="textcolor8200">from</span><span id="textcolor8201"> </span><span id="textcolor8202">rclpy</span><span id="textcolor8203">.</span><span id="textcolor8204">node</span><span id="textcolor8205"> </span><span id="textcolor8206">import</span> <span id="textcolor8207">Node</span> 
<a 
 id="x13-333012r961"></a> 
<a 
 id="x13-333014r962"></a><span id="textcolor8208">from</span><span id="textcolor8209"> </span><span id="textcolor8210">tf2_ros</span><span id="textcolor8211"> </span><span id="textcolor8212">import</span> <span id="textcolor8213">TransformBroadcaster</span> 
<a 
 id="x13-333016r963"></a> 
<a 
 id="x13-333018r964"></a> 
<a 
 id="x13-333020r965"></a><span id="textcolor8214">class</span><span id="textcolor8215"> </span><span id="textcolor8216">FixedFrameBroadcaster</span><span id="textcolor8217">(</span><span id="textcolor8218">Node</span><span id="textcolor8219">)</span><span id="textcolor8220">:</span> 
<a 
 id="x13-333022r966"></a> 
<a 
 id="x13-333024r967"></a>  <span id="textcolor8221">def</span><span id="textcolor8222"> </span><span id="textcolor8223">__init__</span><span id="textcolor8224">(</span><span id="textcolor8225">self</span><span id="textcolor8226">)</span><span id="textcolor8227">:</span> 
<a 
 id="x13-333026r968"></a>     <span id="textcolor8228">super</span><span id="textcolor8229">(</span><span id="textcolor8230">)</span><span id="textcolor8231">.</span><span id="textcolor8232">__init__</span><span id="textcolor8233">(</span><span id="textcolor8234">&#x0027;</span><span id="textcolor8235">fixed_frame_tf2_broadcaster</span><span id="textcolor8236">&#x0027;</span><span id="textcolor8237">)</span> 
<a 
 id="x13-333028r969"></a>     <span id="textcolor8238">self</span><span id="textcolor8239">.</span><span id="textcolor8240">tf_broadcaster</span> <span id="textcolor8241">=</span> <span id="textcolor8242">TransformBroadcaster</span><span id="textcolor8243">(</span><span id="textcolor8244">self</span><span id="textcolor8245">)</span> 
<a 
 id="x13-333030r970"></a>     <span id="textcolor8246">self</span><span id="textcolor8247">.</span><span id="textcolor8248">timer</span> <span id="textcolor8249">=</span> <span id="textcolor8250">self</span><span id="textcolor8251">.</span><span id="textcolor8252">create_timer</span><span id="textcolor8253">(</span><span id="textcolor8254">0.1</span><span id="textcolor8255">,</span> <span id="textcolor8256">self</span><span id="textcolor8257">.</span><span id="textcolor8258">broadcast_timer_callback</span><span id="textcolor8259">)</span> 
<a 
 id="x13-333032r971"></a> 
<a 
 id="x13-333034r972"></a>  <span id="textcolor8260">def</span><span id="textcolor8261"> </span><span id="textcolor8262">broadcast_timer_callback</span><span id="textcolor8263">(</span><span id="textcolor8264">self</span><span id="textcolor8265">)</span><span id="textcolor8266">:</span> 
<a 
 id="x13-333036r973"></a>     <span id="textcolor8267">t</span> <span id="textcolor8268">=</span> <span id="textcolor8269">TransformStamped</span><span id="textcolor8270">(</span><span id="textcolor8271">)</span> 
<a 
 id="x13-333038r974"></a> 
<a 
 id="x13-333040r975"></a>     <span id="textcolor8272">t</span><span id="textcolor8273">.</span><span id="textcolor8274">header</span><span id="textcolor8275">.</span><span id="textcolor8276">stamp</span> <span id="textcolor8277">=</span> <span id="textcolor8278">self</span><span id="textcolor8279">.</span><span id="textcolor8280">get_clock</span><span id="textcolor8281">(</span><span id="textcolor8282">)</span><span id="textcolor8283">.</span><span id="textcolor8284">now</span><span id="textcolor8285">(</span><span id="textcolor8286">)</span><span id="textcolor8287">.</span><span id="textcolor8288">to_msg</span><span id="textcolor8289">(</span><span id="textcolor8290">)</span> 
<a 
 id="x13-333042r976"></a>     <span id="textcolor8291">t</span><span id="textcolor8292">.</span><span id="textcolor8293">header</span><span id="textcolor8294">.</span><span id="textcolor8295">frame_id</span> <span id="textcolor8296">=</span> <span id="textcolor8297">&#x0027;</span><span id="textcolor8298">turtle1</span><span id="textcolor8299">&#x0027;</span> 
<a 
 id="x13-333044r977"></a>     <span id="textcolor8300">t</span><span id="textcolor8301">.</span><span id="textcolor8302">child_frame_id</span> <span id="textcolor8303">=</span> <span id="textcolor8304">&#x0027;</span><span id="textcolor8305">carrot1</span><span id="textcolor8306">&#x0027;</span> 
<a 
 id="x13-333046r978"></a>     <span id="textcolor8307">t</span><span id="textcolor8308">.</span><span id="textcolor8309">transform</span><span id="textcolor8310">.</span><span id="textcolor8311">translation</span><span id="textcolor8312">.</span><span id="textcolor8313">x</span> <span id="textcolor8314">=</span> <span id="textcolor8315">0.0</span> 
<a 
 id="x13-333048r979"></a>     <span id="textcolor8316">t</span><span id="textcolor8317">.</span><span id="textcolor8318">transform</span><span id="textcolor8319">.</span><span id="textcolor8320">translation</span><span id="textcolor8321">.</span><span id="textcolor8322">y</span> <span id="textcolor8323">=</span> <span id="textcolor8324">2.0</span> 
<a 
 id="x13-333050r980"></a>     <span id="textcolor8325">t</span><span id="textcolor8326">.</span><span id="textcolor8327">transform</span><span id="textcolor8328">.</span><span id="textcolor8329">translation</span><span id="textcolor8330">.</span><span id="textcolor8331">z</span> <span id="textcolor8332">=</span> <span id="textcolor8333">0.0</span> 
<a 
 id="x13-333052r981"></a>     <span id="textcolor8334">t</span><span id="textcolor8335">.</span><span id="textcolor8336">transform</span><span id="textcolor8337">.</span><span id="textcolor8338">rotation</span><span id="textcolor8339">.</span><span id="textcolor8340">x</span> <span id="textcolor8341">=</span> <span id="textcolor8342">0.0</span> 
<a 
 id="x13-333054r982"></a>     <span id="textcolor8343">t</span><span id="textcolor8344">.</span><span id="textcolor8345">transform</span><span id="textcolor8346">.</span><span id="textcolor8347">rotation</span><span id="textcolor8348">.</span><span id="textcolor8349">y</span> <span id="textcolor8350">=</span> <span id="textcolor8351">0.0</span> 
<a 
 id="x13-333056r983"></a>     <span id="textcolor8352">t</span><span id="textcolor8353">.</span><span id="textcolor8354">transform</span><span id="textcolor8355">.</span><span id="textcolor8356">rotation</span><span id="textcolor8357">.</span><span id="textcolor8358">z</span> <span id="textcolor8359">=</span> <span id="textcolor8360">0.0</span> 
<a 
 id="x13-333058r984"></a>     <span id="textcolor8361">t</span><span id="textcolor8362">.</span><span id="textcolor8363">transform</span><span id="textcolor8364">.</span><span id="textcolor8365">rotation</span><span id="textcolor8366">.</span><span id="textcolor8367">w</span> <span id="textcolor8368">=</span> <span id="textcolor8369">1.0</span> 
<a 
 id="x13-333060r985"></a> 
<a 
 id="x13-333062r986"></a>     <span id="textcolor8370">self</span><span id="textcolor8371">.</span><span id="textcolor8372">tf_broadcaster</span><span id="textcolor8373">.</span><span id="textcolor8374">sendTransform</span><span id="textcolor8375">(</span><span id="textcolor8376">t</span><span id="textcolor8377">)</span> 
<a 
 id="x13-333064r987"></a> 
<a 
 id="x13-333066r988"></a> 
<a 
 id="x13-333068r989"></a><span id="textcolor8378">def</span><span id="textcolor8379"> </span><span id="textcolor8380">main</span><span id="textcolor8381">(</span><span id="textcolor8382">)</span><span id="textcolor8383">:</span> 
<a 
 id="x13-333070r990"></a>   <span id="textcolor8384">rclpy</span><span id="textcolor8385">.</span><span id="textcolor8386">init</span><span id="textcolor8387">(</span><span id="textcolor8388">)</span> 
<a 
 id="x13-333072r991"></a>   <span id="textcolor8389">node</span> <span id="textcolor8390">=</span> <span id="textcolor8391">FixedFrameBroadcaster</span><span id="textcolor8392">(</span><span id="textcolor8393">)</span> 
<a 
 id="x13-333074r992"></a>   <span id="textcolor8394">try</span><span id="textcolor8395">:</span> 
<a 
 id="x13-333076r993"></a>      <span id="textcolor8396">rclpy</span><span id="textcolor8397">.</span><span id="textcolor8398">spin</span><span id="textcolor8399">(</span><span id="textcolor8400">node</span><span id="textcolor8401">)</span> 
<a 
 id="x13-333078r994"></a>   <span id="textcolor8402">except</span> <span id="textcolor8403">KeyboardInterrupt</span><span id="textcolor8404">:</span> 
<a 
 id="x13-333080r995"></a>      <span id="textcolor8405">pass</span> 
<a 
 id="x13-333082r996"></a> 
<a 
 id="x13-333084r997"></a>   <span id="textcolor8406">rclpy</span><span id="textcolor8407">.</span><span id="textcolor8408">shutdown</span><span id="textcolor8409">(</span><span id="textcolor8410">)</span></div></pre>
<!--l. 465--><p class="noindent" >The
code
is
very
similar
to
the
tf2
broadcaster
tutorial
example
and
the
                                                                                
                                                                                
                                                                             
only
difference
is
that
the
transform
here
does
not
change
over
time.
                                                                                
<a 
 id="paragraph*.162"></a></p>
<!--l. 468--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-334000"></a>Examining
the
Code</span>
Lets
take
a
look
at
the
key
lines
in
this
piece
of
code.
Here
we
create
a
new
transform,
from
the
parent
turtle1
to
the
new
child
carrot1.
The
carrot1
frame
is
2
meters
offset
in
y
axis
in
terms
of
the
turtle1
frame.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb414" style='padding:20px;border-radius: 3px;'><a 
 id="x13-334002r1002"></a><span id="textcolor8411">t</span> <span id="textcolor8412">=</span> <span id="textcolor8413">TransformStamped</span><span id="textcolor8414">(</span><span id="textcolor8415">)</span> 
<a 
 id="x13-334004r1003"></a> 
<a 
 id="x13-334006r1004"></a><span id="textcolor8416">t</span><span id="textcolor8417">.</span><span id="textcolor8418">header</span><span id="textcolor8419">.</span><span id="textcolor8420">stamp</span> <span id="textcolor8421">=</span> <span id="textcolor8422">self</span><span id="textcolor8423">.</span><span id="textcolor8424">get_clock</span><span id="textcolor8425">(</span><span id="textcolor8426">)</span><span id="textcolor8427">.</span><span id="textcolor8428">now</span><span id="textcolor8429">(</span><span id="textcolor8430">)</span><span id="textcolor8431">.</span><span id="textcolor8432">to_msg</span><span id="textcolor8433">(</span><span id="textcolor8434">)</span> 
<a 
 id="x13-334008r1005"></a><span id="textcolor8435">t</span><span id="textcolor8436">.</span><span id="textcolor8437">header</span><span id="textcolor8438">.</span><span id="textcolor8439">frame_id</span> <span id="textcolor8440">=</span> <span id="textcolor8441">&#x0027;</span><span id="textcolor8442">turtle1</span><span id="textcolor8443">&#x0027;</span> 
<a 
 id="x13-334010r1006"></a><span id="textcolor8444">t</span><span id="textcolor8445">.</span><span id="textcolor8446">child_frame_id</span> <span id="textcolor8447">=</span> <span id="textcolor8448">&#x0027;</span><span id="textcolor8449">carrot1</span><span id="textcolor8450">&#x0027;</span> 
<a 
 id="x13-334012r1007"></a><span id="textcolor8451">t</span><span id="textcolor8452">.</span><span id="textcolor8453">transform</span><span id="textcolor8454">.</span><span id="textcolor8455">translation</span><span id="textcolor8456">.</span><span id="textcolor8457">x</span> <span id="textcolor8458">=</span> <span id="textcolor8459">0.0</span> 
<a 
 id="x13-334014r1008"></a><span id="textcolor8460">t</span><span id="textcolor8461">.</span><span id="textcolor8462">transform</span><span id="textcolor8463">.</span><span id="textcolor8464">translation</span><span id="textcolor8465">.</span><span id="textcolor8466">y</span> <span id="textcolor8467">=</span> <span id="textcolor8468">2.0</span> 
<a 
 id="x13-334016r1009"></a><span id="textcolor8469">t</span><span id="textcolor8470">.</span><span id="textcolor8471">transform</span><span id="textcolor8472">.</span><span id="textcolor8473">translation</span><span id="textcolor8474">.</span><span id="textcolor8475">z</span> <span id="textcolor8476">=</span> <span id="textcolor8477">0.0</span></div></pre>
                                                                                
                                                                                
                                                                                

<a 
 id="paragraph*.163"></a>                                                                           
<!--l. 476--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-335000"></a>Adding
an
Entry
Point</span>
To
allow
the
ros2
run
command
to
run
your
node,
you
must
add
the
entry
point
to
setup.py
(located
in
the
<span id="textcolor8478"><code class="verb">src/learning_tf2_py directory</code></span>).
</p>                                                                             
<!--l. 481--><p class="noindent" >Add
the
following
line
between
the
<span id="textcolor8479"><code class="verb">&#x0027;console_scripts&#x0027;:</code></span>
brackets:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                     
<pre><div id="fancyvrb415" style='padding:20px;border-radius: 3px;'><a 
 id="x13-335002r1014"></a><span id="textcolor8480">&#x0027;</span><span id="textcolor8481">fixed_frame_tf2_broadcaster = learning_tf2_py.fixed_frame_tf2_broadcaster:main</span><span id="textcolor8482">&#x0027;</span><span id="textcolor8483">,</span></div></pre>
                                                                                
<a 
 id="paragraph*.164"></a>
<!--l. 485--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-336000"></a>Writing
the
Launch
File</span>
Now
lets
create
a
launch
file
for
this
example.
With
your
text
editor,
create
a
new
                                                                                
                                                                                
                                                                              
file
called
<span id="textcolor8484"><code class="verb">turtle_tf2_fixed_frame_demo.launch.py</code></span>
in
the
<span id="textcolor8485"><code class="verb">src/learning\_tf2\_py/launch</code></span>
directory,
and
add
the
following
lines:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb416" style='padding:20px;border-radius: 3px;'><a 
 id="x13-336002r1020"></a><span id="textcolor8486">from</span><span id="textcolor8487"> </span><span id="textcolor8488">launch</span><span id="textcolor8489"> </span><span id="textcolor8490">import</span> <span id="textcolor8491">LaunchDescription</span> 
<a 
 id="x13-336004r1021"></a><span id="textcolor8492">from</span><span id="textcolor8493"> </span><span id="textcolor8494">launch</span><span id="textcolor8495">.</span><span id="textcolor8496">actions</span><span id="textcolor8497"> </span><span id="textcolor8498">import</span> <span id="textcolor8499">IncludeLaunchDescription</span> 
<a 
 id="x13-336006r1022"></a><span id="textcolor8500">from</span><span id="textcolor8501"> </span><span id="textcolor8502">launch</span><span id="textcolor8503">.</span><span id="textcolor8504">substitutions</span><span id="textcolor8505"> </span><span id="textcolor8506">import</span> <span id="textcolor8507">PathJoinSubstitution</span> 
<a 
 id="x13-336008r1023"></a><span id="textcolor8508">from</span><span id="textcolor8509"> </span><span id="textcolor8510">launch_ros</span><span id="textcolor8511">.</span><span id="textcolor8512">actions</span><span id="textcolor8513"> </span><span id="textcolor8514">import</span> <span id="textcolor8515">Node</span> 
<a 
 id="x13-336010r1024"></a><span id="textcolor8516">from</span><span id="textcolor8517"> </span><span id="textcolor8518">launch_ros</span><span id="textcolor8519">.</span><span id="textcolor8520">substitutions</span><span id="textcolor8521"> </span><span id="textcolor8522">import</span> <span id="textcolor8523">FindPackageShare</span> 
<a 
 id="x13-336012r1025"></a> 
<a 
 id="x13-336014r1026"></a> 
<a 
 id="x13-336016r1027"></a><span id="textcolor8524">def</span><span id="textcolor8525"> </span><span id="textcolor8526">generate_launch_description</span><span id="textcolor8527">(</span><span id="textcolor8528">)</span><span id="textcolor8529">:</span> 
<a 
 id="x13-336018r1028"></a>   <span id="textcolor8530">return</span> <span id="textcolor8531">LaunchDescription</span><span id="textcolor8532">(</span><span id="textcolor8533">[</span> 
<a 
 id="x13-336020r1029"></a>      <span id="textcolor8534">IncludeLaunchDescription</span><span id="textcolor8535">(</span> 
<a 
 id="x13-336022r1030"></a>         <span id="textcolor8536">PathJoinSubstitution</span><span id="textcolor8537">(</span><span id="textcolor8538">[</span> 
<a 
 id="x13-336024r1031"></a>            <span id="textcolor8539">FindPackageShare</span><span id="textcolor8540">(</span><span id="textcolor8541">&#x0027;</span><span id="textcolor8542">learning_tf2_py</span><span id="textcolor8543">&#x0027;</span><span id="textcolor8544">)</span><span id="textcolor8545">,</span> <span id="textcolor8546">&#x0027;</span><span id="textcolor8547">launch</span><span id="textcolor8548">&#x0027;</span><span id="textcolor8549">,</span> <span id="textcolor8550">&#x0027;</span><span id="textcolor8551">turtle_tf2_demo.launch.py</span><span id="textcolor8552">&#x0027;</span><span id="textcolor8553">]</span><span id="textcolor8554">)</span> 
<a 
 id="x13-336026r1032"></a>      <span id="textcolor8555">)</span><span id="textcolor8556">,</span> 
<a 
 id="x13-336028r1033"></a>      <span id="textcolor8557">Node</span><span id="textcolor8558">(</span> 
<a 
 id="x13-336030r1034"></a>         <span id="textcolor8559">package</span><span id="textcolor8560">=</span><span id="textcolor8561">&#x0027;</span><span id="textcolor8562">learning_tf2_py</span><span id="textcolor8563">&#x0027;</span><span id="textcolor8564">,</span> 
<a 
 id="x13-336032r1035"></a>         <span id="textcolor8565">executable</span><span id="textcolor8566">=</span><span id="textcolor8567">&#x0027;</span><span id="textcolor8568">fixed_frame_tf2_broadcaster</span><span id="textcolor8569">&#x0027;</span><span id="textcolor8570">,</span> 
<a 
 id="x13-336034r1036"></a>         <span id="textcolor8571">name</span><span id="textcolor8572">=</span><span id="textcolor8573">&#x0027;</span><span id="textcolor8574">fixed_broadcaster</span><span id="textcolor8575">&#x0027;</span><span id="textcolor8576">,</span> 
<a 
 id="x13-336036r1037"></a>      <span id="textcolor8577">)</span><span id="textcolor8578">,</span> 
<a 
 id="x13-336038r1038"></a>   <span id="textcolor8579">]</span><span id="textcolor8580">)</span></div></pre>
<!--l. 493--><p class="noindent" >This
launch
file
imports
the
required
packages
and
then
creates
a
<span id="textcolor8581"><code class="verb">demo_nodes</code></span>
variable
that
will
store
nodes
that
we
created
in
the
previous
tutorials
launch
file.
</p>                                                                             
<!--l. 496--><p class="noindent" >The
last
part
of
the
code
will
add
our
fixed
carrot1
frame
to
the
turtlesim
world
using
our
<span id="textcolor8582"><code class="verb">fixed_frame_tf2_broadcaster</code></span>
node.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb417" style='padding:20px;border-radius: 3px;'><a 
 id="x13-336040r1043"></a>      <span id="textcolor8583">Node</span><span id="textcolor8584">(</span> 
<a 
 id="x13-336042r1044"></a>         <span id="textcolor8585">package</span><span id="textcolor8586">=</span><span id="textcolor8587">&#x0027;</span><span id="textcolor8588">learning_tf2_py</span><span id="textcolor8589">&#x0027;</span><span id="textcolor8590">,</span> 
<a 
 id="x13-336044r1045"></a>         <span id="textcolor8591">executable</span><span id="textcolor8592">=</span><span id="textcolor8593">&#x0027;</span><span id="textcolor8594">fixed_frame_tf2_broadcaster</span><span id="textcolor8595">&#x0027;</span><span id="textcolor8596">,</span> 
<a 
 id="x13-336046r1046"></a>         <span id="textcolor8597">name</span><span id="textcolor8598">=</span><span id="textcolor8599">&#x0027;</span><span id="textcolor8600">fixed_broadcaster</span><span id="textcolor8601">&#x0027;</span><span id="textcolor8602">,</span> 
<a 
 id="x13-336048r1047"></a>      <span id="textcolor8603">)</span><span id="textcolor8604">,</span></div></pre>

                                                                                
                                                                                
                                                                                
<a 
 id="paragraph*.165"></a>
<!--l. 501--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-337000"></a>Build</span>
Run
rosdep
in
the
root
of
your
workspace
to
check
for
missing
dependencies.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                        
<pre><div id="fancyvrb418" style='padding:20px;border-radius: 3px;'><a 
 id="x13-337002r1054"></a>rosdep<span id="textcolor8605"> </span>install<span id="textcolor8606"> </span>-i<span id="textcolor8607"> </span>--from-path<span id="textcolor8608"> </span>src<span id="textcolor8609"> </span>--rosdistro<span id="textcolor8610"> </span>humble<span id="textcolor8611"> </span>-y</div></pre>
<!--l. 507--><p class="noindent" >Still
in
the
root
of
your
workspace,
build
your
package:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                              
<pre><div id="fancyvrb419" style='padding:20px;border-radius: 3px;'><a 
 id="x13-337004r1059"></a>colcon<span id="textcolor8612"> </span>build<span id="textcolor8613"> </span>--packages-select<span id="textcolor8614"> </span>learning_tf2_py</div></pre>
<!--l. 511--><p class="noindent" >Open
a
new
terminal,
navigate
to
the
root
of
your
workspace,
and
source
the
setup
files:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                                 
<pre><div id="fancyvrb420" style='padding:20px;border-radius: 3px;'><a 
 id="x13-337006r1064"></a>.<span id="textcolor8615"> </span>install/setup.bash</div></pre>
                                                                                
<a 
 id="paragraph*.166"></a>
<!--l. 515--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-338000"></a>Run</span>
Now
you
can
start
the
turtle
broadcaster
demo:
                                                                                
                                                                                
                                                                                
</p>
<!--l. 1--><p class="noindent" >

</p>                                 
<pre><div id="fancyvrb421" style='padding:20px;border-radius: 3px;'><a 
 id="x13-338002r1071"></a>ros2<span id="textcolor8616"> </span>launch<span id="textcolor8617"> </span>learning_tf2_py<span id="textcolor8618"> </span>turtle_tf2_fixed_frame_demo.launch.py</div></pre>
<!--l. 521--><p class="noindent" >You
should
notice
that
the
new
carrot1
frame
appeared
in
the
transformation
tree.
</p>                                                                               
<!--l. 523--><p class="noindent" >If
you
drive
the
first
turtle
around,
you
should
notice
that
the
behavior
didnt
change
from
the
previous
tutorial,
even
though
we
added
a
new
frame.
Thats
because
adding
an
extra
frame
does
not
affect
the
other
frames
and
our
listener
is
still
using
the
previously
defined
frames.
</p>                                                                         
<!--l. 527--><p class="noindent" >Therefore
if
                                                                                
                                                                                
                                                                              
we
want
our
second
turtle
to
follow
the
carrot
instead
of
the
first
turtle,
we
need
to
change
value
of
the
<span id="textcolor8619"><code class="verb">target_frame</code></span>.
This
can
be
done
two
ways.
One
way
is
to
pass
the
<span id="textcolor8620"><code class="verb">target_frame</code></span>
argument
to
the
launch
file
directly
from
the
console:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>        
<pre><div id="fancyvrb422" style='padding:20px;border-radius: 3px;'><a 
 id="x13-338004r1076"></a>ros2<span id="textcolor8621"> </span>launch<span id="textcolor8622"> </span>learning_tf2_py<span id="textcolor8623"> </span><span id="textcolor8624">\</span> 
<a 
 id="x13-338006r1077"></a><span id="textcolor8625">     </span>turtle_tf2_fixed_frame_demo.launch.py<span id="textcolor8626"> </span><span id="textcolor8627">\</span> 
<a 
 id="x13-338008r1078"></a><span id="textcolor8628">     </span>target_frame:<span id="textcolor8629">=</span>carrot1</div></pre>
<!--l. 533--><p class="noindent" >The
second
way
is
to
update
the
launch
file.
To
do
so,
open
the
<span id="textcolor8630"><code class="verb">turtle_tf2_fixed_frame_demo.launch.py</code></span>
file,
and
add
the
                                                                                
                                                                                
                                                              
<span id="textcolor8631"><code class="verb">&#x0027;target_frame&#x0027;: &#x0027;carrot1&#x0027;</code></span>
parameter
via
<span id="textcolor8632"><code class="verb">launch_arguments</code></span>argument.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb423" style='padding:20px;border-radius: 3px;'><a 
 id="x13-338010r1083"></a><span id="textcolor8633">def</span><span id="textcolor8634"> </span><span id="textcolor8635">generate_launch_description</span><span id="textcolor8636">(</span><span id="textcolor8637">)</span><span id="textcolor8638">:</span> 
<a 
 id="x13-338012r1084"></a>   <span id="textcolor8639">demo_nodes</span> <span id="textcolor8640">=</span> <span id="textcolor8641">IncludeLaunchDescription</span><span id="textcolor8642">(</span> 
<a 
 id="x13-338014r1085"></a>      <span id="textcolor8643">.</span><span id="textcolor8644">.</span><span id="textcolor8645">.</span><span id="textcolor8646">,</span> 
<a 
 id="x13-338016r1086"></a>      <span id="textcolor8647">launch_arguments</span><span id="textcolor8648">=</span><span id="textcolor8649">{</span><span id="textcolor8650">&#x0027;</span><span id="textcolor8651">target_frame</span><span id="textcolor8652">&#x0027;</span><span id="textcolor8653">:</span> <span id="textcolor8654">&#x0027;</span><span id="textcolor8655">carrot1</span><span id="textcolor8656">&#x0027;</span><span id="textcolor8657">}</span><span id="textcolor8658">.</span><span id="textcolor8659">items</span><span id="textcolor8660">(</span><span id="textcolor8661">)</span><span id="textcolor8662">,</span> 
<a 
 id="x13-338018r1087"></a>      <span id="textcolor8663">)</span></div></pre>
<!--l. 539--><p class="noindent" >Now
rebuild
the
package,
restart
the
<span id="textcolor8664"><code class="verb">turtle_tf2_fixed_frame_demo.launch.py</code></span>,
and
youll
see
the
second
turtle
following
the
carrot
instead
of
the
first
turtle!

</p>                                                                           
<h5 class="likesubsubsectionHead"><a 
 id="x13-339000"></a>Writing
the
Dynamic
Frame
Broadcaster</h5>
<!--l. 544--><p class="noindent" >The
extra
frame
we
published
in
this
tutorial
is
a
fixed
frame
that
doesnt
change
over
time
in
relation
to
the
parent
frame.
However,
if
you
want
                                                                                
                                                                                
                                                                              
to
publish
a
moving
frame
you
can
code
the
broadcaster
to
change
the
frame
over
time.
Lets
change
our
carrot1
frame
so
that
it
changes
relative
to
turtle1
frame
over
time.
Go
to
the
<span id="textcolor8665"><code class="verb">learning_tf2_py</code></span>
package
we
created
in
the
previous
tutorial.
Inside
the
<span id="textcolor8666"><code class="verb">src/learning\_tf2\_py/learning\_tf2\_py</code></span>
directory
download
the
dynamic
frame
broadcaster
code
by
entering
the
following
command:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb424" style='padding:20px;border-radius: 3px;'><a 
 id="x13-339002r1094"></a>wget<span id="textcolor8667"> </span>https://raw.githubusercontent.com/ros/geometry_tutorials/humble/turtle_tf2_py/turtle_tf2_py/dynamic_frame_tf2_broadcaster.py</div></pre>
<!--l. 553--><p class="noindent" >Now
open
the
file
called
<span id="textcolor8668"><code class="verb">dynamic_frame_tf2_broadcaster.py</code></span>:
                                                                                
                                                                                
                                                                                
</p>
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb425" style='padding:20px;border-radius: 3px;'><a 
 id="x13-339004r1099"></a><span id="textcolor8669">import</span><span id="textcolor8670"> </span><span id="textcolor8671">math</span> 
<a 
 id="x13-339006r1100"></a> 
<a 
 id="x13-339008r1101"></a><span id="textcolor8672">from</span><span id="textcolor8673"> </span><span id="textcolor8674">geometry_msgs</span><span id="textcolor8675">.</span><span id="textcolor8676">msg</span><span id="textcolor8677"> </span><span id="textcolor8678">import</span> <span id="textcolor8679">TransformStamped</span> 
<a 
 id="x13-339010r1102"></a> 
<a 
 id="x13-339012r1103"></a><span id="textcolor8680">import</span><span id="textcolor8681"> </span><span id="textcolor8682">rclpy</span> 
<a 
 id="x13-339014r1104"></a><span id="textcolor8683">from</span><span id="textcolor8684"> </span><span id="textcolor8685">rclpy</span><span id="textcolor8686">.</span><span id="textcolor8687">node</span><span id="textcolor8688"> </span><span id="textcolor8689">import</span> <span id="textcolor8690">Node</span> 
<a 
 id="x13-339016r1105"></a> 
<a 
 id="x13-339018r1106"></a><span id="textcolor8691">from</span><span id="textcolor8692"> </span><span id="textcolor8693">tf2_ros</span><span id="textcolor8694"> </span><span id="textcolor8695">import</span> <span id="textcolor8696">TransformBroadcaster</span> 
<a 
 id="x13-339020r1107"></a> 
<a 
 id="x13-339022r1108"></a> 
<a 
 id="x13-339024r1109"></a><span id="textcolor8697">class</span><span id="textcolor8698"> </span><span id="textcolor8699">DynamicFrameBroadcaster</span><span id="textcolor8700">(</span><span id="textcolor8701">Node</span><span id="textcolor8702">)</span><span id="textcolor8703">:</span> 
<a 
 id="x13-339026r1110"></a> 
<a 
 id="x13-339028r1111"></a>   <span id="textcolor8704">def</span><span id="textcolor8705"> </span><span id="textcolor8706">__init__</span><span id="textcolor8707">(</span><span id="textcolor8708">self</span><span id="textcolor8709">)</span><span id="textcolor8710">:</span> 
<a 
 id="x13-339030r1112"></a>      <span id="textcolor8711">super</span><span id="textcolor8712">(</span><span id="textcolor8713">)</span><span id="textcolor8714">.</span><span id="textcolor8715">__init__</span><span id="textcolor8716">(</span><span id="textcolor8717">&#x0027;</span><span id="textcolor8718">dynamic_frame_tf2_broadcaster</span><span id="textcolor8719">&#x0027;</span><span id="textcolor8720">)</span> 
<a 
 id="x13-339032r1113"></a>      <span id="textcolor8721">self</span><span id="textcolor8722">.</span><span id="textcolor8723">tf_broadcaster</span> <span id="textcolor8724">=</span> <span id="textcolor8725">TransformBroadcaster</span><span id="textcolor8726">(</span><span id="textcolor8727">self</span><span id="textcolor8728">)</span> 
<a 
 id="x13-339034r1114"></a>      <span id="textcolor8729">self</span><span id="textcolor8730">.</span><span id="textcolor8731">timer</span> <span id="textcolor8732">=</span> <span id="textcolor8733">self</span><span id="textcolor8734">.</span><span id="textcolor8735">create_timer</span><span id="textcolor8736">(</span><span id="textcolor8737">0.1</span><span id="textcolor8738">,</span> <span id="textcolor8739">self</span><span id="textcolor8740">.</span><span id="textcolor8741">broadcast_timer_callback</span><span id="textcolor8742">)</span> 
<a 
 id="x13-339036r1115"></a> 
<a 
 id="x13-339038r1116"></a>   <span id="textcolor8743">def</span><span id="textcolor8744"> </span><span id="textcolor8745">broadcast_timer_callback</span><span id="textcolor8746">(</span><span id="textcolor8747">self</span><span id="textcolor8748">)</span><span id="textcolor8749">:</span> 
<a 
 id="x13-339040r1117"></a>      <span id="textcolor8750">seconds</span><span id="textcolor8751">,</span> <span id="textcolor8752">_</span> <span id="textcolor8753">=</span> <span id="textcolor8754">self</span><span id="textcolor8755">.</span><span id="textcolor8756">get_clock</span><span id="textcolor8757">(</span><span id="textcolor8758">)</span><span id="textcolor8759">.</span><span id="textcolor8760">now</span><span id="textcolor8761">(</span><span id="textcolor8762">)</span><span id="textcolor8763">.</span><span id="textcolor8764">seconds_nanoseconds</span><span id="textcolor8765">(</span><span id="textcolor8766">)</span> 
<a 
 id="x13-339042r1118"></a>      <span id="textcolor8767">x</span> <span id="textcolor8768">=</span> <span id="textcolor8769">seconds</span> <span id="textcolor8770">*</span> <span id="textcolor8771">math</span><span id="textcolor8772">.</span><span id="textcolor8773">pi</span> 
<a 
 id="x13-339044r1119"></a> 
<a 
 id="x13-339046r1120"></a>      <span id="textcolor8774">t</span> <span id="textcolor8775">=</span> <span id="textcolor8776">TransformStamped</span><span id="textcolor8777">(</span><span id="textcolor8778">)</span> 
<a 
 id="x13-339048r1121"></a>      <span id="textcolor8779">t</span><span id="textcolor8780">.</span><span id="textcolor8781">header</span><span id="textcolor8782">.</span><span id="textcolor8783">stamp</span> <span id="textcolor8784">=</span> <span id="textcolor8785">self</span><span id="textcolor8786">.</span><span id="textcolor8787">get_clock</span><span id="textcolor8788">(</span><span id="textcolor8789">)</span><span id="textcolor8790">.</span><span id="textcolor8791">now</span><span id="textcolor8792">(</span><span id="textcolor8793">)</span><span id="textcolor8794">.</span><span id="textcolor8795">to_msg</span><span id="textcolor8796">(</span><span id="textcolor8797">)</span> 
<a 
 id="x13-339050r1122"></a>      <span id="textcolor8798">t</span><span id="textcolor8799">.</span><span id="textcolor8800">header</span><span id="textcolor8801">.</span><span id="textcolor8802">frame_id</span> <span id="textcolor8803">=</span> <span id="textcolor8804">&#x0027;</span><span id="textcolor8805">turtle1</span><span id="textcolor8806">&#x0027;</span> 
<a 
 id="x13-339052r1123"></a>      <span id="textcolor8807">t</span><span id="textcolor8808">.</span><span id="textcolor8809">child_frame_id</span> <span id="textcolor8810">=</span> <span id="textcolor8811">&#x0027;</span><span id="textcolor8812">carrot1</span><span id="textcolor8813">&#x0027;</span> 
<a 
 id="x13-339054r1124"></a>      <span id="textcolor8814">t</span><span id="textcolor8815">.</span><span id="textcolor8816">transform</span><span id="textcolor8817">.</span><span id="textcolor8818">translation</span><span id="textcolor8819">.</span><span id="textcolor8820">x</span> <span id="textcolor8821">=</span> <span id="textcolor8822">10</span> <span id="textcolor8823">*</span> <span id="textcolor8824">math</span><span id="textcolor8825">.</span><span id="textcolor8826">sin</span><span id="textcolor8827">(</span><span id="textcolor8828">x</span><span id="textcolor8829">)</span> 
<a 
 id="x13-339056r1125"></a>      <span id="textcolor8830">t</span><span id="textcolor8831">.</span><span id="textcolor8832">transform</span><span id="textcolor8833">.</span><span id="textcolor8834">translation</span><span id="textcolor8835">.</span><span id="textcolor8836">y</span> <span id="textcolor8837">=</span> <span id="textcolor8838">10</span> <span id="textcolor8839">*</span> <span id="textcolor8840">math</span><span id="textcolor8841">.</span><span id="textcolor8842">cos</span><span id="textcolor8843">(</span><span id="textcolor8844">x</span><span id="textcolor8845">)</span> 
<a 
 id="x13-339058r1126"></a>      <span id="textcolor8846">t</span><span id="textcolor8847">.</span><span id="textcolor8848">transform</span><span id="textcolor8849">.</span><span id="textcolor8850">translation</span><span id="textcolor8851">.</span><span id="textcolor8852">z</span> <span id="textcolor8853">=</span> <span id="textcolor8854">0.0</span> 
<a 
 id="x13-339060r1127"></a>      <span id="textcolor8855">t</span><span id="textcolor8856">.</span><span id="textcolor8857">transform</span><span id="textcolor8858">.</span><span id="textcolor8859">rotation</span><span id="textcolor8860">.</span><span id="textcolor8861">x</span> <span id="textcolor8862">=</span> <span id="textcolor8863">0.0</span> 
<a 
 id="x13-339062r1128"></a>      <span id="textcolor8864">t</span><span id="textcolor8865">.</span><span id="textcolor8866">transform</span><span id="textcolor8867">.</span><span id="textcolor8868">rotation</span><span id="textcolor8869">.</span><span id="textcolor8870">y</span> <span id="textcolor8871">=</span> <span id="textcolor8872">0.0</span> 
<a 
 id="x13-339064r1129"></a>      <span id="textcolor8873">t</span><span id="textcolor8874">.</span><span id="textcolor8875">transform</span><span id="textcolor8876">.</span><span id="textcolor8877">rotation</span><span id="textcolor8878">.</span><span id="textcolor8879">z</span> <span id="textcolor8880">=</span> <span id="textcolor8881">0.0</span> 
<a 
 id="x13-339066r1130"></a>      <span id="textcolor8882">t</span><span id="textcolor8883">.</span><span id="textcolor8884">transform</span><span id="textcolor8885">.</span><span id="textcolor8886">rotation</span><span id="textcolor8887">.</span><span id="textcolor8888">w</span> <span id="textcolor8889">=</span> <span id="textcolor8890">1.0</span> 
<a 
 id="x13-339068r1131"></a> 
<a 
 id="x13-339070r1132"></a>      <span id="textcolor8891">self</span><span id="textcolor8892">.</span><span id="textcolor8893">tf_broadcaster</span><span id="textcolor8894">.</span><span id="textcolor8895">sendTransform</span><span id="textcolor8896">(</span><span id="textcolor8897">t</span><span id="textcolor8898">)</span> 
<a 
 id="x13-339072r1133"></a> 
<a 
 id="x13-339074r1134"></a> 
<a 
 id="x13-339076r1135"></a><span id="textcolor8899">def</span><span id="textcolor8900"> </span><span id="textcolor8901">main</span><span id="textcolor8902">(</span><span id="textcolor8903">)</span><span id="textcolor8904">:</span> 
<a 
 id="x13-339078r1136"></a>   <span id="textcolor8905">rclpy</span><span id="textcolor8906">.</span><span id="textcolor8907">init</span><span id="textcolor8908">(</span><span id="textcolor8909">)</span> 
<a 
 id="x13-339080r1137"></a>   <span id="textcolor8910">node</span> <span id="textcolor8911">=</span> <span id="textcolor8912">DynamicFrameBroadcaster</span><span id="textcolor8913">(</span><span id="textcolor8914">)</span> 
<a 
 id="x13-339082r1138"></a>   <span id="textcolor8915">try</span><span id="textcolor8916">:</span> 
<a 
 id="x13-339084r1139"></a>      <span id="textcolor8917">rclpy</span><span id="textcolor8918">.</span><span id="textcolor8919">spin</span><span id="textcolor8920">(</span><span id="textcolor8921">node</span><span id="textcolor8922">)</span> 
<a 
 id="x13-339086r1140"></a>   <span id="textcolor8923">except</span> <span id="textcolor8924">KeyboardInterrupt</span><span id="textcolor8925">:</span> 
<a 
 id="x13-339088r1141"></a>      <span id="textcolor8926">pass</span> 
<a 
 id="x13-339090r1142"></a> 
<a 
 id="x13-339092r1143"></a>   <span id="textcolor8927">rclpy</span><span id="textcolor8928">.</span><span id="textcolor8929">shutdown</span><span id="textcolor8930">(</span><span id="textcolor8931">)</span></div></pre>
                                                                                
<a 
 id="paragraph*.167"></a>
<!--l. 557--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-340000"></a>Examining
the
Code</span>
Instead
of
a
fixed
definition
of
our
x
and
y
offsets,
we
are
using
the
sin()
and
cos()
functions
on
the
current
time
so
that
the
offset
of
carrot1
is
constantly
changing.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb426" style='padding:20px;border-radius: 3px;'><a 
 id="x13-340002r1150"></a>seconds,<span id="textcolor8932"> </span><span id="textcolor8933">_</span><span id="textcolor8934"> </span><span id="textcolor8935">=</span><span id="textcolor8936"> </span>self.get_clock<span id="textcolor8937">(</span><span id="textcolor8938">)</span>.now<span id="textcolor8939">(</span><span id="textcolor8940">)</span>.seconds_nanoseconds<span id="textcolor8941">(</span><span id="textcolor8942">)</span> 
<a 
 id="x13-340004r1151"></a><span id="textcolor8943">x</span><span id="textcolor8944"> </span><span id="textcolor8945">=</span><span id="textcolor8946"> </span>seconds<span id="textcolor8947"> </span>*<span id="textcolor8948"> </span>math.pi 
<a 
 id="x13-340006r1152"></a>... 
<a 
 id="x13-340008r1153"></a>t.transform.translation.x<span id="textcolor8949"> </span><span id="textcolor8950">=</span><span id="textcolor8951"> </span><span id="textcolor8952">10</span><span id="textcolor8953"> </span>*<span id="textcolor8954"> </span>math.sin<span id="textcolor8955">(</span>x<span id="textcolor8956">)</span> 
<a 
 id="x13-340010r1154"></a>t.transform.translation.y<span id="textcolor8957"> </span><span id="textcolor8958">=</span><span id="textcolor8959"> </span><span id="textcolor8960">10</span><span id="textcolor8961"> </span>*<span id="textcolor8962"> </span>math.cos<span id="textcolor8963">(</span>x<span id="textcolor8964">)</span></div></pre>
                                                                                
<a 
 id="paragraph*.168"></a>
<!--l. 564--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-341000"></a>Adding
an
Entry
Point</span>
To
allow
the
ros2
run
command
to
run
your
node,
you
                                                                                
                                                                                
                                                                            
must
add
the
entry
point
to
setup.py
(located
in
the
<span id="textcolor8965"><code class="verb">src/learning\_tf2\_py</code></span>
directory).
</p>                                                                             
<!--l. 569--><p class="noindent" >Add
the
following
line
between
the
<span id="textcolor8966"><code class="verb">&#x0027;console_scripts&#x0027;:</code></span>
brackets:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                  
<pre><div id="fancyvrb427" style='padding:20px;border-radius: 3px;'><a 
 id="x13-341002r1161"></a><span id="textcolor8967">&#x0027;</span><span id="textcolor8968">dynamic_frame_tf2_broadcaster = learning_tf2_py.dynamic_frame_tf2_broadcaster:main</span><span id="textcolor8969">&#x0027;</span><span id="textcolor8970">,</span></div></pre>
                                                                                
<a 
 id="paragraph*.169"></a>
<!--l. 573--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-342000"></a>Writing
the
Launch
File</span>
To
test
this
code,
create
a
new
launch
file
<span id="textcolor8971"><code class="verb">turtle_tf2_dynamic_frame_demo.launch.py</code></span>
in
the
<span id="textcolor8972"><code class="verb">src/learning\_tf2\_py/launch</code></span>
directory
and
paste
the
following
code:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb428" style='padding:20px;border-radius: 3px;'><a 
 id="x13-342002r1168"></a><span id="textcolor8973">from</span><span id="textcolor8974"> </span><span id="textcolor8975">launch</span><span id="textcolor8976"> </span><span id="textcolor8977">import</span> <span id="textcolor8978">LaunchDescription</span> 
<a 
 id="x13-342004r1169"></a><span id="textcolor8979">from</span><span id="textcolor8980"> </span><span id="textcolor8981">launch</span><span id="textcolor8982">.</span><span id="textcolor8983">actions</span><span id="textcolor8984"> </span><span id="textcolor8985">import</span> <span id="textcolor8986">IncludeLaunchDescription</span> 
<a 
 id="x13-342006r1170"></a><span id="textcolor8987">from</span><span id="textcolor8988"> </span><span id="textcolor8989">launch</span><span id="textcolor8990">.</span><span id="textcolor8991">substitutions</span><span id="textcolor8992"> </span><span id="textcolor8993">import</span> <span id="textcolor8994">PathJoinSubstitution</span> 
<a 
 id="x13-342008r1171"></a><span id="textcolor8995">from</span><span id="textcolor8996"> </span><span id="textcolor8997">launch_ros</span><span id="textcolor8998">.</span><span id="textcolor8999">actions</span><span id="textcolor9000"> </span><span id="textcolor9001">import</span> <span id="textcolor9002">Node</span> 
<a 
 id="x13-342010r1172"></a><span id="textcolor9003">from</span><span id="textcolor9004"> </span><span id="textcolor9005">launch_ros</span><span id="textcolor9006">.</span><span id="textcolor9007">substitutions</span><span id="textcolor9008"> </span><span id="textcolor9009">import</span> <span id="textcolor9010">FindPackageShare</span> 
<a 
 id="x13-342012r1173"></a> 
<a 
 id="x13-342014r1174"></a> 
<a 
 id="x13-342016r1175"></a><span id="textcolor9011">def</span><span id="textcolor9012"> </span><span id="textcolor9013">generate_launch_description</span><span id="textcolor9014">(</span><span id="textcolor9015">)</span><span id="textcolor9016">:</span> 
<a 
 id="x13-342018r1176"></a>   <span id="textcolor9017">return</span> <span id="textcolor9018">LaunchDescription</span><span id="textcolor9019">(</span><span id="textcolor9020">[</span> 
<a 
 id="x13-342020r1177"></a>      <span id="textcolor9021">IncludeLaunchDescription</span><span id="textcolor9022">(</span> 
<a 
 id="x13-342022r1178"></a>         <span id="textcolor9023">PathJoinSubstitution</span><span id="textcolor9024">(</span><span id="textcolor9025">[</span> 
<a 
 id="x13-342024r1179"></a>            <span id="textcolor9026">FindPackageShare</span><span id="textcolor9027">(</span><span id="textcolor9028">&#x0027;</span><span id="textcolor9029">learning_tf2_py</span><span id="textcolor9030">&#x0027;</span><span id="textcolor9031">)</span><span id="textcolor9032">,</span> <span id="textcolor9033">&#x0027;</span><span id="textcolor9034">launch</span><span id="textcolor9035">&#x0027;</span><span id="textcolor9036">,</span> <span id="textcolor9037">&#x0027;</span><span id="textcolor9038">turtle_tf2_demo.launch.py</span><span id="textcolor9039">&#x0027;</span><span id="textcolor9040">]</span><span id="textcolor9041">)</span><span id="textcolor9042">,</span> 
<a 
 id="x13-342026r1180"></a>         <span id="textcolor9043">launch_arguments</span><span id="textcolor9044">=</span><span id="textcolor9045">{</span><span id="textcolor9046">&#x0027;</span><span id="textcolor9047">target_frame</span><span id="textcolor9048">&#x0027;</span><span id="textcolor9049">:</span> <span id="textcolor9050">&#x0027;</span><span id="textcolor9051">carrot1</span><span id="textcolor9052">&#x0027;</span><span id="textcolor9053">}</span><span id="textcolor9054">.</span><span id="textcolor9055">items</span><span id="textcolor9056">(</span><span id="textcolor9057">)</span><span id="textcolor9058">,</span> 
<a 
 id="x13-342028r1181"></a>      <span id="textcolor9059">)</span><span id="textcolor9060">,</span> 
<a 
 id="x13-342030r1182"></a>      <span id="textcolor9061">Node</span><span id="textcolor9062">(</span> 
<a 
 id="x13-342032r1183"></a>         <span id="textcolor9063">package</span><span id="textcolor9064">=</span><span id="textcolor9065">&#x0027;</span><span id="textcolor9066">learning_tf2_py</span><span id="textcolor9067">&#x0027;</span><span id="textcolor9068">,</span> 
<a 
 id="x13-342034r1184"></a>         <span id="textcolor9069">executable</span><span id="textcolor9070">=</span><span id="textcolor9071">&#x0027;</span><span id="textcolor9072">dynamic_frame_tf2_broadcaster</span><span id="textcolor9073">&#x0027;</span><span id="textcolor9074">,</span> 
<a 
 id="x13-342036r1185"></a>         <span id="textcolor9075">name</span><span id="textcolor9076">=</span><span id="textcolor9077">&#x0027;</span><span id="textcolor9078">dynamic_broadcaster</span><span id="textcolor9079">&#x0027;</span><span id="textcolor9080">,</span> 
<a 
 id="x13-342038r1186"></a>      <span id="textcolor9081">)</span><span id="textcolor9082">,</span> 
<a 
 id="x13-342040r1187"></a>   <span id="textcolor9083">]</span><span id="textcolor9084">)</span></div></pre>
                                                                                
<a 
 id="paragraph*.170"></a>
<!--l. 580--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-343000"></a>Buld</span>
Run
rosdep
in
the
root
of
                                                                                
                                                                                
                                                                             
your
workspace
to
check
for
missing
dependencies.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                        
<pre><div id="fancyvrb429" style='padding:20px;border-radius: 3px;'><a 
 id="x13-343002r1194"></a>rosdep<span id="textcolor9085"> </span>install<span id="textcolor9086"> </span>-i<span id="textcolor9087"> </span>--from-path<span id="textcolor9088"> </span>src<span id="textcolor9089"> </span>--rosdistro<span id="textcolor9090"> </span>humble<span id="textcolor9091"> </span>-y</div></pre>
<!--l. 586--><p class="noindent" >Still
in
the
root
of
your
workspace,
build
your
package:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                              
<pre><div id="fancyvrb430" style='padding:20px;border-radius: 3px;'><a 
 id="x13-343004r1199"></a>colcon<span id="textcolor9092"> </span>build<span id="textcolor9093"> </span>--packages-select<span id="textcolor9094"> </span>learning_tf2_py</div></pre>
<!--l. 590--><p class="noindent" >Open
a
new
terminal,
navigate
to
the
root
of
your
workspace,
and
source
the
setup
files:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                                 
<pre><div id="fancyvrb431" style='padding:20px;border-radius: 3px;'><a 
 id="x13-343006r1204"></a>.<span id="textcolor9095"> </span>install/setup.bash</div></pre>
                                                                                
<a 
 id="paragraph*.171"></a>
<!--l. 594--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-344000"></a>Run</span>
Now
you
can
start
the
dynamic
frame
demo:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                               
<pre><div id="fancyvrb432" style='padding:20px;border-radius: 3px;'><a 
 id="x13-344002r1211"></a>ros2<span id="textcolor9096"> </span>launch<span id="textcolor9097"> </span>learning_tf2_py<span id="textcolor9098"> </span>turtle_tf2_dynamic_frame_demo.launch.py</div></pre>
                                                                                
                                                                                
                                                                             
<!--l. 600--><p class="noindent" >You
should
see
that
the
second
turtle
is
following
the
carrots
position
that
is
constantly
changing.
                                                                                
                                                                                
                                                                                
</p>
<!--l. 602--><p class="noindent" >
</p>                                                                      
<h3 class="sectionHead"><span class="titlemark">11.5</span>  <a 
 id="x13-34500011.5"></a>Writing
a
Broadcaster</h3>
                                                                                
<a 
 id="paragraph*.172"></a>
<!--l. 604--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-346000"></a>Writing
the
Broadaster
Node</span>
Lets
first
create
the
source
files.
Go
to
the
<span id="textcolor9099"><code class="verb">learning_tf2_py</code></span>
package
we
created
in
the
previous
tutorial.
Inside
the
<span id="textcolor9100"><code class="verb">[</code></span>
/]src/learning_tf2_py/learning_tf2_py
directory
download
the
example
broadcaster
code
by
entering
the
following
command:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb433" style='padding:20px;border-radius: 3px;'><a 
 id="x13-346002r432"></a>wget<span id="textcolor9101"> </span>https://raw.githubusercontent.com/ros/geometry_tutorials/humble/turtle_tf2_py/turtle_tf2_py/turtle_tf2_broadcaster.py</div></pre>
<!--l. 612--><p class="noindent" >Now
open
the
file
called
<span id="textcolor9102"><code class="verb">turtle_tf2_broadcaster.py</code></span>
using
your
preferred
text
editor.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb434" style='padding:20px;border-radius: 3px;'><a 
 id="x13-346004r437"></a><span id="textcolor9103">import</span><span id="textcolor9104"> </span><span id="textcolor9105">math</span> 
<a 
 id="x13-346006r438"></a> 
<a 
 id="x13-346008r439"></a><span id="textcolor9106">from</span><span id="textcolor9107"> </span><span id="textcolor9108">geometry_msgs</span><span id="textcolor9109">.</span><span id="textcolor9110">msg</span><span id="textcolor9111"> </span><span id="textcolor9112">import</span> <span id="textcolor9113">TransformStamped</span> 
<a 
 id="x13-346010r440"></a> 
<a 
 id="x13-346012r441"></a><span id="textcolor9114">import</span><span id="textcolor9115"> </span><span id="textcolor9116">numpy</span><span id="textcolor9117"> </span><span id="textcolor9118">as</span><span id="textcolor9119"> </span><span id="textcolor9120">np</span> 
<a 
 id="x13-346014r442"></a> 
<a 
 id="x13-346016r443"></a><span id="textcolor9121">import</span><span id="textcolor9122"> </span><span id="textcolor9123">rclpy</span> 
<a 
 id="x13-346018r444"></a><span id="textcolor9124">from</span><span id="textcolor9125"> </span><span id="textcolor9126">rclpy</span><span id="textcolor9127">.</span><span id="textcolor9128">node</span><span id="textcolor9129"> </span><span id="textcolor9130">import</span> <span id="textcolor9131">Node</span> 
<a 
 id="x13-346020r445"></a> 
<a 
 id="x13-346022r446"></a><span id="textcolor9132">from</span><span id="textcolor9133"> </span><span id="textcolor9134">tf2_ros</span><span id="textcolor9135"> </span><span id="textcolor9136">import</span> <span id="textcolor9137">TransformBroadcaster</span> 
<a 
 id="x13-346024r447"></a> 
<a 
 id="x13-346026r448"></a><span id="textcolor9138">from</span><span id="textcolor9139"> </span><span id="textcolor9140">turtlesim</span><span id="textcolor9141">.</span><span id="textcolor9142">msg</span><span id="textcolor9143"> </span><span id="textcolor9144">import</span> <span id="textcolor9145">Pose</span> 
<a 
 id="x13-346028r449"></a> 
<a 
 id="x13-346030r450"></a> 
<a 
 id="x13-346032r451"></a><span id="textcolor9146">def</span><span id="textcolor9147"> </span><span id="textcolor9148">quaternion_from_euler</span><span id="textcolor9149">(</span><span id="textcolor9150">ai</span><span id="textcolor9151">,</span> <span id="textcolor9152">aj</span><span id="textcolor9153">,</span> <span id="textcolor9154">ak</span><span id="textcolor9155">)</span><span id="textcolor9156">:</span> 
<a 
 id="x13-346034r452"></a>   <span id="textcolor9157">ai</span> <span id="textcolor9158">/</span><span id="textcolor9159">=</span> <span id="textcolor9160">2.0</span> 
<a 
 id="x13-346036r453"></a>   <span id="textcolor9161">aj</span> <span id="textcolor9162">/</span><span id="textcolor9163">=</span> <span id="textcolor9164">2.0</span> 
<a 
 id="x13-346038r454"></a>   <span id="textcolor9165">ak</span> <span id="textcolor9166">/</span><span id="textcolor9167">=</span> <span id="textcolor9168">2.0</span> 
<a 
 id="x13-346040r455"></a>   <span id="textcolor9169">ci</span> <span id="textcolor9170">=</span> <span id="textcolor9171">math</span><span id="textcolor9172">.</span><span id="textcolor9173">cos</span><span id="textcolor9174">(</span><span id="textcolor9175">ai</span><span id="textcolor9176">)</span> 
<a 
 id="x13-346042r456"></a>   <span id="textcolor9177">si</span> <span id="textcolor9178">=</span> <span id="textcolor9179">math</span><span id="textcolor9180">.</span><span id="textcolor9181">sin</span><span id="textcolor9182">(</span><span id="textcolor9183">ai</span><span id="textcolor9184">)</span> 
<a 
 id="x13-346044r457"></a>   <span id="textcolor9185">cj</span> <span id="textcolor9186">=</span> <span id="textcolor9187">math</span><span id="textcolor9188">.</span><span id="textcolor9189">cos</span><span id="textcolor9190">(</span><span id="textcolor9191">aj</span><span id="textcolor9192">)</span> 
<a 
 id="x13-346046r458"></a>   <span id="textcolor9193">sj</span> <span id="textcolor9194">=</span> <span id="textcolor9195">math</span><span id="textcolor9196">.</span><span id="textcolor9197">sin</span><span id="textcolor9198">(</span><span id="textcolor9199">aj</span><span id="textcolor9200">)</span> 
<a 
 id="x13-346048r459"></a>   <span id="textcolor9201">ck</span> <span id="textcolor9202">=</span> <span id="textcolor9203">math</span><span id="textcolor9204">.</span><span id="textcolor9205">cos</span><span id="textcolor9206">(</span><span id="textcolor9207">ak</span><span id="textcolor9208">)</span> 
<a 
 id="x13-346050r460"></a>   <span id="textcolor9209">sk</span> <span id="textcolor9210">=</span> <span id="textcolor9211">math</span><span id="textcolor9212">.</span><span id="textcolor9213">sin</span><span id="textcolor9214">(</span><span id="textcolor9215">ak</span><span id="textcolor9216">)</span> 
<a 
 id="x13-346052r461"></a>   <span id="textcolor9217">cc</span> <span id="textcolor9218">=</span> <span id="textcolor9219">ci</span><span id="textcolor9220">*</span><span id="textcolor9221">ck</span> 
<a 
 id="x13-346054r462"></a>   <span id="textcolor9222">cs</span> <span id="textcolor9223">=</span> <span id="textcolor9224">ci</span><span id="textcolor9225">*</span><span id="textcolor9226">sk</span> 
<a 
 id="x13-346056r463"></a>   <span id="textcolor9227">sc</span> <span id="textcolor9228">=</span> <span id="textcolor9229">si</span><span id="textcolor9230">*</span><span id="textcolor9231">ck</span> 
<a 
 id="x13-346058r464"></a>   <span id="textcolor9232">ss</span> <span id="textcolor9233">=</span> <span id="textcolor9234">si</span><span id="textcolor9235">*</span><span id="textcolor9236">sk</span> 
<a 
 id="x13-346060r465"></a> 
<a 
 id="x13-346062r466"></a>   <span id="textcolor9237">q</span> <span id="textcolor9238">=</span> <span id="textcolor9239">np</span><span id="textcolor9240">.</span><span id="textcolor9241">empty</span><span id="textcolor9242">(</span><span id="textcolor9243">(</span><span id="textcolor9244">4</span><span id="textcolor9245">,</span> <span id="textcolor9246">)</span><span id="textcolor9247">)</span> 
<a 
 id="x13-346064r467"></a>   <span id="textcolor9248">q</span><span id="textcolor9249">[</span><span id="textcolor9250">0</span><span id="textcolor9251">]</span> <span id="textcolor9252">=</span> <span id="textcolor9253">cj</span><span id="textcolor9254">*</span><span id="textcolor9255">sc</span> <span id="textcolor9256">-</span> <span id="textcolor9257">sj</span><span id="textcolor9258">*</span><span id="textcolor9259">cs</span> 
<a 
 id="x13-346066r468"></a>   <span id="textcolor9260">q</span><span id="textcolor9261">[</span><span id="textcolor9262">1</span><span id="textcolor9263">]</span> <span id="textcolor9264">=</span> <span id="textcolor9265">cj</span><span id="textcolor9266">*</span><span id="textcolor9267">ss</span> <span id="textcolor9268">+</span> <span id="textcolor9269">sj</span><span id="textcolor9270">*</span><span id="textcolor9271">cc</span> 
<a 
 id="x13-346068r469"></a>   <span id="textcolor9272">q</span><span id="textcolor9273">[</span><span id="textcolor9274">2</span><span id="textcolor9275">]</span> <span id="textcolor9276">=</span> <span id="textcolor9277">cj</span><span id="textcolor9278">*</span><span id="textcolor9279">cs</span> <span id="textcolor9280">-</span> <span id="textcolor9281">sj</span><span id="textcolor9282">*</span><span id="textcolor9283">sc</span> 
<a 
 id="x13-346070r470"></a>   <span id="textcolor9284">q</span><span id="textcolor9285">[</span><span id="textcolor9286">3</span><span id="textcolor9287">]</span> <span id="textcolor9288">=</span> <span id="textcolor9289">cj</span><span id="textcolor9290">*</span><span id="textcolor9291">cc</span> <span id="textcolor9292">+</span> <span id="textcolor9293">sj</span><span id="textcolor9294">*</span><span id="textcolor9295">ss</span> 
<a 
 id="x13-346072r471"></a> 
<a 
 id="x13-346074r472"></a>   <span id="textcolor9296">return</span> <span id="textcolor9297">q</span> 
<a 
 id="x13-346076r473"></a> 
<a 
 id="x13-346078r474"></a> 
<a 
 id="x13-346080r475"></a><span id="textcolor9298">class</span><span id="textcolor9299"> </span><span id="textcolor9300">FramePublisher</span><span id="textcolor9301">(</span><span id="textcolor9302">Node</span><span id="textcolor9303">)</span><span id="textcolor9304">:</span> 
<a 
 id="x13-346082r476"></a> 
<a 
 id="x13-346084r477"></a>   <span id="textcolor9305">def</span><span id="textcolor9306"> </span><span id="textcolor9307">__init__</span><span id="textcolor9308">(</span><span id="textcolor9309">self</span><span id="textcolor9310">)</span><span id="textcolor9311">:</span> 
<a 
 id="x13-346086r478"></a>      <span id="textcolor9312">super</span><span id="textcolor9313">(</span><span id="textcolor9314">)</span><span id="textcolor9315">.</span><span id="textcolor9316">__init__</span><span id="textcolor9317">(</span><span id="textcolor9318">&#x0027;</span><span id="textcolor9319">turtle_tf2_frame_publisher</span><span id="textcolor9320">&#x0027;</span><span id="textcolor9321">)</span> 
<a 
 id="x13-346088r479"></a> 
<a 
 id="x13-346090r480"></a>      <span id="textcolor9322"># Declare and acquire `turtlename` parameter</span> 
<a 
 id="x13-346092r481"></a>      <span id="textcolor9323">self</span><span id="textcolor9324">.</span><span id="textcolor9325">turtlename</span> <span id="textcolor9326">=</span> <span id="textcolor9327">self</span><span id="textcolor9328">.</span><span id="textcolor9329">declare_parameter</span><span id="textcolor9330">(</span> 
<a 
 id="x13-346094r482"></a>       <span id="textcolor9331">&#x0027;</span><span id="textcolor9332">turtlename</span><span id="textcolor9333">&#x0027;</span><span id="textcolor9334">,</span> <span id="textcolor9335">&#x0027;</span><span id="textcolor9336">turtle</span><span id="textcolor9337">&#x0027;</span><span id="textcolor9338">)</span><span id="textcolor9339">.</span><span id="textcolor9340">get_parameter_value</span><span id="textcolor9341">(</span><span id="textcolor9342">)</span><span id="textcolor9343">.</span><span id="textcolor9344">string_value</span> 
<a 
 id="x13-346096r483"></a> 
<a 
 id="x13-346098r484"></a>      <span id="textcolor9345"># Initialize the transform broadcaster</span> 
<a 
 id="x13-346100r485"></a>      <span id="textcolor9346">self</span><span id="textcolor9347">.</span><span id="textcolor9348">tf_broadcaster</span> <span id="textcolor9349">=</span> <span id="textcolor9350">TransformBroadcaster</span><span id="textcolor9351">(</span><span id="textcolor9352">self</span><span id="textcolor9353">)</span> 
<a 
 id="x13-346102r486"></a> 
<a 
 id="x13-346104r487"></a>      <span id="textcolor9354"># Subscribe to a turtle{1}{2}/pose topic and call handle_turtle_pose</span> 
<a 
 id="x13-346106r488"></a>      <span id="textcolor9355"># callback function on each message</span> 
<a 
 id="x13-346108r489"></a>      <span id="textcolor9356">self</span><span id="textcolor9357">.</span><span id="textcolor9358">subscription</span> <span id="textcolor9359">=</span> <span id="textcolor9360">self</span><span id="textcolor9361">.</span><span id="textcolor9362">create_subscription</span><span id="textcolor9363">(</span> 
<a 
 id="x13-346110r490"></a>         <span id="textcolor9364">Pose</span><span id="textcolor9365">,</span> 
<a 
 id="x13-346112r491"></a>         <span id="textcolor9366">f</span><span id="textcolor9367">&#x0027;</span><span id="textcolor9368">/</span><span id="textcolor9369">{</span><span id="textcolor9370">self</span><span id="textcolor9371">.</span><span id="textcolor9372">turtlename</span><span id="textcolor9373">}</span><span id="textcolor9374">/pose</span><span id="textcolor9375">&#x0027;</span><span id="textcolor9376">,</span> 
<a 
 id="x13-346114r492"></a>         <span id="textcolor9377">self</span><span id="textcolor9378">.</span><span id="textcolor9379">handle_turtle_pose</span><span id="textcolor9380">,</span> 
<a 
 id="x13-346116r493"></a>         <span id="textcolor9381">1</span><span id="textcolor9382">)</span> 
<a 
 id="x13-346118r494"></a>      <span id="textcolor9383">self</span><span id="textcolor9384">.</span><span id="textcolor9385">subscription</span>  <span id="textcolor9386"># prevent unused variable warning</span> 
<a 
 id="x13-346120r495"></a> 
<a 
 id="x13-346122r496"></a>   <span id="textcolor9387">def</span><span id="textcolor9388"> </span><span id="textcolor9389">handle_turtle_pose</span><span id="textcolor9390">(</span><span id="textcolor9391">self</span><span id="textcolor9392">,</span> <span id="textcolor9393">msg</span><span id="textcolor9394">)</span><span id="textcolor9395">:</span> 
<a 
 id="x13-346124r497"></a>      <span id="textcolor9396">t</span> <span id="textcolor9397">=</span> <span id="textcolor9398">TransformStamped</span><span id="textcolor9399">(</span><span id="textcolor9400">)</span> 
<a 
 id="x13-346126r498"></a> 
<a 
 id="x13-346128r499"></a>      <span id="textcolor9401"># Read message content and assign it to</span> 
<a 
 id="x13-346130r500"></a>      <span id="textcolor9402"># corresponding tf variables</span> 
<a 
 id="x13-346132r501"></a>      <span id="textcolor9403">t</span><span id="textcolor9404">.</span><span id="textcolor9405">header</span><span id="textcolor9406">.</span><span id="textcolor9407">stamp</span> <span id="textcolor9408">=</span> <span id="textcolor9409">self</span><span id="textcolor9410">.</span><span id="textcolor9411">get_clock</span><span id="textcolor9412">(</span><span id="textcolor9413">)</span><span id="textcolor9414">.</span><span id="textcolor9415">now</span><span id="textcolor9416">(</span><span id="textcolor9417">)</span><span id="textcolor9418">.</span><span id="textcolor9419">to_msg</span><span id="textcolor9420">(</span><span id="textcolor9421">)</span> 
<a 
 id="x13-346134r502"></a>      <span id="textcolor9422">t</span><span id="textcolor9423">.</span><span id="textcolor9424">header</span><span id="textcolor9425">.</span><span id="textcolor9426">frame_id</span> <span id="textcolor9427">=</span> <span id="textcolor9428">&#x0027;</span><span id="textcolor9429">world</span><span id="textcolor9430">&#x0027;</span> 
<a 
 id="x13-346136r503"></a>      <span id="textcolor9431">t</span><span id="textcolor9432">.</span><span id="textcolor9433">child_frame_id</span> <span id="textcolor9434">=</span> <span id="textcolor9435">self</span><span id="textcolor9436">.</span><span id="textcolor9437">turtlename</span> 
<a 
 id="x13-346138r504"></a> 
<a 
 id="x13-346140r505"></a>      <span id="textcolor9438"># Turtle only exists in 2D, thus we get x and y translation</span> 
<a 
 id="x13-346142r506"></a>      <span id="textcolor9439"># coordinates from the message and set the z coordinate to 0</span> 
<a 
 id="x13-346144r507"></a>      <span id="textcolor9440">t</span><span id="textcolor9441">.</span><span id="textcolor9442">transform</span><span id="textcolor9443">.</span><span id="textcolor9444">translation</span><span id="textcolor9445">.</span><span id="textcolor9446">x</span> <span id="textcolor9447">=</span> <span id="textcolor9448">msg</span><span id="textcolor9449">.</span><span id="textcolor9450">x</span> 
<a 
 id="x13-346146r508"></a>      <span id="textcolor9451">t</span><span id="textcolor9452">.</span><span id="textcolor9453">transform</span><span id="textcolor9454">.</span><span id="textcolor9455">translation</span><span id="textcolor9456">.</span><span id="textcolor9457">y</span> <span id="textcolor9458">=</span> <span id="textcolor9459">msg</span><span id="textcolor9460">.</span><span id="textcolor9461">y</span> 
<a 
 id="x13-346148r509"></a>      <span id="textcolor9462">t</span><span id="textcolor9463">.</span><span id="textcolor9464">transform</span><span id="textcolor9465">.</span><span id="textcolor9466">translation</span><span id="textcolor9467">.</span><span id="textcolor9468">z</span> <span id="textcolor9469">=</span> <span id="textcolor9470">0.0</span> 
<a 
 id="x13-346150r510"></a> 
<a 
 id="x13-346152r511"></a>      <span id="textcolor9471"># For the same reason, turtle can only rotate around one axis</span> 
<a 
 id="x13-346154r512"></a>      <span id="textcolor9472"># and this why we set rotation in x and y to 0 and obtain</span> 
<a 
 id="x13-346156r513"></a>      <span id="textcolor9473"># rotation in z axis from the message</span> 
<a 
 id="x13-346158r514"></a>      <span id="textcolor9474">q</span> <span id="textcolor9475">=</span> <span id="textcolor9476">quaternion_from_euler</span><span id="textcolor9477">(</span><span id="textcolor9478">0</span><span id="textcolor9479">,</span> <span id="textcolor9480">0</span><span id="textcolor9481">,</span> <span id="textcolor9482">msg</span><span id="textcolor9483">.</span><span id="textcolor9484">theta</span><span id="textcolor9485">)</span> 
<a 
 id="x13-346160r515"></a>      <span id="textcolor9486">t</span><span id="textcolor9487">.</span><span id="textcolor9488">transform</span><span id="textcolor9489">.</span><span id="textcolor9490">rotation</span><span id="textcolor9491">.</span><span id="textcolor9492">x</span> <span id="textcolor9493">=</span> <span id="textcolor9494">q</span><span id="textcolor9495">[</span><span id="textcolor9496">0</span><span id="textcolor9497">]</span> 
<a 
 id="x13-346162r516"></a>      <span id="textcolor9498">t</span><span id="textcolor9499">.</span><span id="textcolor9500">transform</span><span id="textcolor9501">.</span><span id="textcolor9502">rotation</span><span id="textcolor9503">.</span><span id="textcolor9504">y</span> <span id="textcolor9505">=</span> <span id="textcolor9506">q</span><span id="textcolor9507">[</span><span id="textcolor9508">1</span><span id="textcolor9509">]</span> 
<a 
 id="x13-346164r517"></a>      <span id="textcolor9510">t</span><span id="textcolor9511">.</span><span id="textcolor9512">transform</span><span id="textcolor9513">.</span><span id="textcolor9514">rotation</span><span id="textcolor9515">.</span><span id="textcolor9516">z</span> <span id="textcolor9517">=</span> <span id="textcolor9518">q</span><span id="textcolor9519">[</span><span id="textcolor9520">2</span><span id="textcolor9521">]</span> 
<a 
 id="x13-346166r518"></a>      <span id="textcolor9522">t</span><span id="textcolor9523">.</span><span id="textcolor9524">transform</span><span id="textcolor9525">.</span><span id="textcolor9526">rotation</span><span id="textcolor9527">.</span><span id="textcolor9528">w</span> <span id="textcolor9529">=</span> <span id="textcolor9530">q</span><span id="textcolor9531">[</span><span id="textcolor9532">3</span><span id="textcolor9533">]</span> 
<a 
 id="x13-346168r519"></a> 
<a 
 id="x13-346170r520"></a>      <span id="textcolor9534"># Send the transformation</span> 
<a 
 id="x13-346172r521"></a>      <span id="textcolor9535">self</span><span id="textcolor9536">.</span><span id="textcolor9537">tf_broadcaster</span><span id="textcolor9538">.</span><span id="textcolor9539">sendTransform</span><span id="textcolor9540">(</span><span id="textcolor9541">t</span><span id="textcolor9542">)</span> 
<a 
 id="x13-346174r522"></a> 
<a 
 id="x13-346176r523"></a> 
<a 
 id="x13-346178r524"></a><span id="textcolor9543">def</span><span id="textcolor9544"> </span><span id="textcolor9545">main</span><span id="textcolor9546">(</span><span id="textcolor9547">)</span><span id="textcolor9548">:</span> 
<a 
 id="x13-346180r525"></a>   <span id="textcolor9549">rclpy</span><span id="textcolor9550">.</span><span id="textcolor9551">init</span><span id="textcolor9552">(</span><span id="textcolor9553">)</span> 
<a 
 id="x13-346182r526"></a>   <span id="textcolor9554">node</span> <span id="textcolor9555">=</span> <span id="textcolor9556">FramePublisher</span><span id="textcolor9557">(</span><span id="textcolor9558">)</span> 
<a 
 id="x13-346184r527"></a>   <span id="textcolor9559">try</span><span id="textcolor9560">:</span> 
<a 
 id="x13-346186r528"></a>      <span id="textcolor9561">rclpy</span><span id="textcolor9562">.</span><span id="textcolor9563">spin</span><span id="textcolor9564">(</span><span id="textcolor9565">node</span><span id="textcolor9566">)</span> 
<a 
 id="x13-346188r529"></a>   <span id="textcolor9567">except</span> <span id="textcolor9568">KeyboardInterrupt</span><span id="textcolor9569">:</span> 
<a 
 id="x13-346190r530"></a>      <span id="textcolor9570">pass</span> 
<a 
 id="x13-346192r531"></a> 
<a 
 id="x13-346194r532"></a>   <span id="textcolor9571">rclpy</span><span id="textcolor9572">.</span><span id="textcolor9573">shutdown</span><span id="textcolor9574">(</span><span id="textcolor9575">)</span></div></pre>
                                                                                
                                                                                
                                                                                

<a 
 id="paragraph*.173"></a>                                                                         
<!--l. 616--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-347000"></a>Examining
the
Code</span>
Now,
lets
take
a
look
at
the
code
that
is
relevant
to
publishing
the
turtle
pose
to
tf2.
Firstly,
we
define
and
acquire
a
single
parameter
<span id="textcolor9576"><code class="verb">turtlename</code></span>,
which
specifies
a
turtle
name,
e.g.
<span id="textcolor9577"><code class="verb">turtle1</code></span>
or
<span id="textcolor9578"><code class="verb">turtle2</code></span>.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>       
<pre><div id="fancyvrb435" style='padding:20px;border-radius: 3px;'><a 
 id="x13-347002r539"></a><span id="textcolor9579">self</span><span id="textcolor9580">.</span><span id="textcolor9581">turtlename</span> <span id="textcolor9582">=</span> <span id="textcolor9583">self</span><span id="textcolor9584">.</span><span id="textcolor9585">declare_parameter</span><span id="textcolor9586">(</span> 
<a 
 id="x13-347004r540"></a>  <span id="textcolor9587">&#x0027;</span><span id="textcolor9588">turtlename</span><span id="textcolor9589">&#x0027;</span><span id="textcolor9590">,</span> <span id="textcolor9591">&#x0027;</span><span id="textcolor9592">turtle</span><span id="textcolor9593">&#x0027;</span><span id="textcolor9594">)</span><span id="textcolor9595">.</span><span id="textcolor9596">get_parameter_value</span><span id="textcolor9597">(</span><span id="textcolor9598">)</span><span id="textcolor9599">.</span><span id="textcolor9600">string_value</span></div></pre>
<!--l. 624--><p class="noindent" >Afterward,
the
node
subscribes
to
topic
<span id="textcolor9601"><code class="verb">{self.turtlename}/pose</code></span>
and
runs
function
<span id="textcolor9602"><code class="verb">handle_turtle_pose</code></span>
on
every
incoming
message.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb436" style='padding:20px;border-radius: 3px;'><a 
 id="x13-347006r545"></a><span id="textcolor9603">self</span> <span id="textcolor9604">.</span><span id="textcolor9605">subscription</span> <span id="textcolor9606">=</span> <span id="textcolor9607">self</span><span id="textcolor9608">.</span><span id="textcolor9609">create_subscription</span><span id="textcolor9610">(</span> 
<a 
 id="x13-347008r546"></a>   <span id="textcolor9611">Pose</span><span id="textcolor9612">,</span> 
<a 
 id="x13-347010r547"></a>   <span id="textcolor9613">f</span><span id="textcolor9614">&#x0027;</span><span id="textcolor9615">/</span><span id="textcolor9616">{</span><span id="textcolor9617">self</span><span id="textcolor9618">.</span><span id="textcolor9619">turtlename</span><span id="textcolor9620">}</span><span id="textcolor9621">/pose</span><span id="textcolor9622">&#x0027;</span><span id="textcolor9623">,</span> 
<a 
 id="x13-347012r548"></a>   <span id="textcolor9624">self</span><span id="textcolor9625">.</span><span id="textcolor9626">handle_turtle_pose</span><span id="textcolor9627">,</span> 
<a 
 id="x13-347014r549"></a>   <span id="textcolor9628">1</span><span id="textcolor9629">)</span></div></pre>
                                                                                
                                                                                
                                                                            
<!--l. 629--><p class="noindent" >Now,
we
create
a
TransformStamped
object
and
give
it
the
appropriate
metadata.
</p>     
<ul class="itemize1">
<li class="itemize">     
<!--l. 632--><p class="noindent" >We need to give the transform being published a timestamp, and well just stamp it with the current time by
calling <span id="textcolor9631"><code class="verb">self.get_clock().now()</code></span>. This will return the current time used by the Node.
</p>     
</li>
<li class="itemize">     
<!--l. 635--><p class="noindent" >Then we need to set the name of the parent frame of the link were creating, in this case world.
</p>     
</li>
<li class="itemize">     
<!--l. 637--><p class="noindent" >Finally, we need to set the name of the child node of the link were creating, in this case this is the name of the
turtle itself.</p></li></ul>                                                                
<!--l. 641--><p class="noindent" >The
handler
function
for
the
turtle
pose
message
broadcasts
this
turtles
translation
and
rotation,
and
publishes
it
as
a
transform
from
frame
world
to
frame
<span id="textcolor9634"><code class="verb">turtleX</code></span>.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb437" style='padding:20px;border-radius: 3px;'><a 
 id="x13-347016r554"></a><span id="textcolor9635">t</span> <span id="textcolor9636">=</span> <span id="textcolor9637">TransformStamped</span><span id="textcolor9638">(</span><span id="textcolor9639">)</span> 
<a 
 id="x13-347018r555"></a> 
<a 
 id="x13-347020r556"></a><span id="textcolor9640"># Read message content and assign it to</span> 
<a 
 id="x13-347022r557"></a><span id="textcolor9641"># corresponding tf variables</span> 
<a 
 id="x13-347024r558"></a><span id="textcolor9642">t</span><span id="textcolor9643">.</span><span id="textcolor9644">header</span><span id="textcolor9645">.</span><span id="textcolor9646">stamp</span> <span id="textcolor9647">=</span> <span id="textcolor9648">self</span><span id="textcolor9649">.</span><span id="textcolor9650">get_clock</span><span id="textcolor9651">(</span><span id="textcolor9652">)</span><span id="textcolor9653">.</span><span id="textcolor9654">now</span><span id="textcolor9655">(</span><span id="textcolor9656">)</span><span id="textcolor9657">.</span><span id="textcolor9658">to_msg</span><span id="textcolor9659">(</span><span id="textcolor9660">)</span> 
<a 
 id="x13-347026r559"></a><span id="textcolor9661">t</span><span id="textcolor9662">.</span><span id="textcolor9663">header</span><span id="textcolor9664">.</span><span id="textcolor9665">frame_id</span> <span id="textcolor9666">=</span> <span id="textcolor9667">&#x0027;</span><span id="textcolor9668">world</span><span id="textcolor9669">&#x0027;</span> 
<a 
 id="x13-347028r560"></a><span id="textcolor9670">t</span><span id="textcolor9671">.</span><span id="textcolor9672">child_frame_id</span> <span id="textcolor9673">=</span> <span id="textcolor9674">self</span><span id="textcolor9675">.</span><span id="textcolor9676">turtlename</span></div></pre>
<!--l. 646--><p class="noindent" >Here
we
copy
the
information
from
the
                                                                                
                                                                                
                                                                              
3D
turtle
pose
into
the
3D
transform.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb438" style='padding:20px;border-radius: 3px;'><a 
 id="x13-347030r565"></a><span id="textcolor9677"># Turtle only exists in 2D, thus we get x and y translation</span> 
<a 
 id="x13-347032r566"></a><span id="textcolor9678"># coordinates from the message and set the z coordinate to 0</span> 
<a 
 id="x13-347034r567"></a><span id="textcolor9679">t</span><span id="textcolor9680">.</span><span id="textcolor9681">transform</span><span id="textcolor9682">.</span><span id="textcolor9683">translation</span><span id="textcolor9684">.</span><span id="textcolor9685">x</span> <span id="textcolor9686">=</span> <span id="textcolor9687">msg</span><span id="textcolor9688">.</span><span id="textcolor9689">x</span> 
<a 
 id="x13-347036r568"></a><span id="textcolor9690">t</span><span id="textcolor9691">.</span><span id="textcolor9692">transform</span><span id="textcolor9693">.</span><span id="textcolor9694">translation</span><span id="textcolor9695">.</span><span id="textcolor9696">y</span> <span id="textcolor9697">=</span> <span id="textcolor9698">msg</span><span id="textcolor9699">.</span><span id="textcolor9700">y</span> 
<a 
 id="x13-347038r569"></a><span id="textcolor9701">t</span><span id="textcolor9702">.</span><span id="textcolor9703">transform</span><span id="textcolor9704">.</span><span id="textcolor9705">translation</span><span id="textcolor9706">.</span><span id="textcolor9707">z</span> <span id="textcolor9708">=</span> <span id="textcolor9709">0.0</span> 
<a 
 id="x13-347040r570"></a> 
<a 
 id="x13-347042r571"></a><span id="textcolor9710"># For the same reason, turtle can only rotate around one axis</span> 
<a 
 id="x13-347044r572"></a><span id="textcolor9711"># and this why we set rotation in x and y to 0 and obtain</span> 
<a 
 id="x13-347046r573"></a><span id="textcolor9712"># rotation in z axis from the message</span> 
<a 
 id="x13-347048r574"></a><span id="textcolor9713">q</span> <span id="textcolor9714">=</span> <span id="textcolor9715">quaternion_from_euler</span><span id="textcolor9716">(</span><span id="textcolor9717">0</span><span id="textcolor9718">,</span> <span id="textcolor9719">0</span><span id="textcolor9720">,</span> <span id="textcolor9721">msg</span><span id="textcolor9722">.</span><span id="textcolor9723">theta</span><span id="textcolor9724">)</span> 
<a 
 id="x13-347050r575"></a><span id="textcolor9725">t</span><span id="textcolor9726">.</span><span id="textcolor9727">transform</span><span id="textcolor9728">.</span><span id="textcolor9729">rotation</span><span id="textcolor9730">.</span><span id="textcolor9731">x</span> <span id="textcolor9732">=</span> <span id="textcolor9733">q</span><span id="textcolor9734">[</span><span id="textcolor9735">0</span><span id="textcolor9736">]</span> 
<a 
 id="x13-347052r576"></a><span id="textcolor9737">t</span><span id="textcolor9738">.</span><span id="textcolor9739">transform</span><span id="textcolor9740">.</span><span id="textcolor9741">rotation</span><span id="textcolor9742">.</span><span id="textcolor9743">y</span> <span id="textcolor9744">=</span> <span id="textcolor9745">q</span><span id="textcolor9746">[</span><span id="textcolor9747">1</span><span id="textcolor9748">]</span> 
<a 
 id="x13-347054r577"></a><span id="textcolor9749">t</span><span id="textcolor9750">.</span><span id="textcolor9751">transform</span><span id="textcolor9752">.</span><span id="textcolor9753">rotation</span><span id="textcolor9754">.</span><span id="textcolor9755">z</span> <span id="textcolor9756">=</span> <span id="textcolor9757">q</span><span id="textcolor9758">[</span><span id="textcolor9759">2</span><span id="textcolor9760">]</span> 
<a 
 id="x13-347056r578"></a><span id="textcolor9761">t</span><span id="textcolor9762">.</span><span id="textcolor9763">transform</span><span id="textcolor9764">.</span><span id="textcolor9765">rotation</span><span id="textcolor9766">.</span><span id="textcolor9767">w</span> <span id="textcolor9768">=</span> <span id="textcolor9769">q</span><span id="textcolor9770">[</span><span id="textcolor9771">3</span><span id="textcolor9772">]</span></div></pre>
<!--l. 650--><p class="noindent" >Finally
we
take
the
transform
that
we
constructed
and
pass
it
to
the
sendTransform
method
of
the
TransformBroadcaster
that
will
take
care
of
broadcasting.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                    
<pre><div id="fancyvrb439" style='padding:20px;border-radius: 3px;'><a 
 id="x13-347058r583"></a><span id="textcolor9773"># Send the transformation</span> 
<a 
 id="x13-347060r584"></a><span id="textcolor9774">self</span><span id="textcolor9775">.</span><span id="textcolor9776">tf_broadcaster</span><span id="textcolor9777">.</span><span id="textcolor9778">sendTransform</span><span id="textcolor9779">(</span><span id="textcolor9780">t</span><span id="textcolor9781">)</span></div></pre>
                                                                                
<a 
 id="paragraph*.174"></a>
<!--l. 655--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-348000"></a>Adding
an
Entry
Point</span>
To
allow
the
ros2
run
command
to
run
your
node,
you
must
add
the
entry
point
to
setup.py
                                                                                
                                                                                
                                                                             
</p>
<!--l. 660--><p class="noindent" >Add
the
following
line
between
the
<span id="textcolor9782"><code class="verb">&#x0027;console_scripts&#x0027;:</code></span>
brackets:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                    
<pre><div id="fancyvrb440" style='padding:20px;border-radius: 3px;'><a 
 id="x13-348002r591"></a><span id="textcolor9783"># Send the transformation</span> 
<a 
 id="x13-348004r592"></a><span id="textcolor9784">self</span><span id="textcolor9785">.</span><span id="textcolor9786">tf_broadcaster</span><span id="textcolor9787">.</span><span id="textcolor9788">sendTransform</span><span id="textcolor9789">(</span><span id="textcolor9790">t</span><span id="textcolor9791">)</span></div></pre>
                                                                                
<a 
 id="paragraph*.175"></a>
<!--l. 664--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-349000"></a>Writing
the
Launch
File</span>
Now
create
a
launch
file
for
this
demo.
Create
a
launch
folder
in
the
<span id="textcolor9792"><code class="verb">src/learning\_tf2\_py</code></span>
directory.
With
your
text
editor,
create
a
new
file
called
<span id="textcolor9793"><code class="verb">turtle\_tf2\_demo.launch.py</code></span>
in
the
launch
folder,
and
add
the
following
lines:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
<pre><div id="fancyvrb441" style='padding:20px;border-radius: 3px;'><a 
 id="x13-349002r599"></a><span id="textcolor9794">from</span><span id="textcolor9795"> </span><span id="textcolor9796">launch</span><span id="textcolor9797"> </span><span id="textcolor9798">import</span> <span id="textcolor9799">LaunchDescription</span> 
<a 
 id="x13-349004r600"></a><span id="textcolor9800">from</span><span id="textcolor9801"> </span><span id="textcolor9802">launch_ros</span><span id="textcolor9803">.</span><span id="textcolor9804">actions</span><span id="textcolor9805"> </span><span id="textcolor9806">import</span> <span id="textcolor9807">Node</span> 
<a 
 id="x13-349006r601"></a> 
<a 
 id="x13-349008r602"></a> 
<a 
 id="x13-349010r603"></a><span id="textcolor9808">def</span><span id="textcolor9809"> </span><span id="textcolor9810">generate_launch_description</span><span id="textcolor9811">(</span><span id="textcolor9812">)</span><span id="textcolor9813">:</span> 
<a 
 id="x13-349012r604"></a>   <span id="textcolor9814">return</span> <span id="textcolor9815">LaunchDescription</span><span id="textcolor9816">(</span><span id="textcolor9817">[</span> 
<a 
 id="x13-349014r605"></a>      <span id="textcolor9818">Node</span><span id="textcolor9819">(</span> 
<a 
 id="x13-349016r606"></a>         <span id="textcolor9820">package</span><span id="textcolor9821">=</span><span id="textcolor9822">&#x0027;</span><span id="textcolor9823">turtlesim</span><span id="textcolor9824">&#x0027;</span><span id="textcolor9825">,</span> 
<a 
 id="x13-349018r607"></a>         <span id="textcolor9826">executable</span><span id="textcolor9827">=</span><span id="textcolor9828">&#x0027;</span><span id="textcolor9829">turtlesim_node</span><span id="textcolor9830">&#x0027;</span><span id="textcolor9831">,</span> 
<a 
 id="x13-349020r608"></a>         <span id="textcolor9832">name</span><span id="textcolor9833">=</span><span id="textcolor9834">&#x0027;</span><span id="textcolor9835">sim</span><span id="textcolor9836">&#x0027;</span> 
<a 
 id="x13-349022r609"></a>      <span id="textcolor9837">)</span><span id="textcolor9838">,</span> 
<a 
 id="x13-349024r610"></a>      <span id="textcolor9839">Node</span><span id="textcolor9840">(</span> 
<a 
 id="x13-349026r611"></a>         <span id="textcolor9841">package</span><span id="textcolor9842">=</span><span id="textcolor9843">&#x0027;</span><span id="textcolor9844">learning_tf2_py</span><span id="textcolor9845">&#x0027;</span><span id="textcolor9846">,</span> 
<a 
 id="x13-349028r612"></a>         <span id="textcolor9847">executable</span><span id="textcolor9848">=</span><span id="textcolor9849">&#x0027;</span><span id="textcolor9850">turtle_tf2_broadcaster</span><span id="textcolor9851">&#x0027;</span><span id="textcolor9852">,</span> 
<a 
 id="x13-349030r613"></a>         <span id="textcolor9853">name</span><span id="textcolor9854">=</span><span id="textcolor9855">&#x0027;</span><span id="textcolor9856">broadcaster1</span><span id="textcolor9857">&#x0027;</span><span id="textcolor9858">,</span> 
<a 
 id="x13-349032r614"></a>         <span id="textcolor9859">parameters</span><span id="textcolor9860">=</span><span id="textcolor9861">[</span> 
<a 
 id="x13-349034r615"></a>            <span id="textcolor9862">{</span><span id="textcolor9863">&#x0027;</span><span id="textcolor9864">turtlename</span><span id="textcolor9865">&#x0027;</span><span id="textcolor9866">:</span> <span id="textcolor9867">&#x0027;</span><span id="textcolor9868">turtle1</span><span id="textcolor9869">&#x0027;</span><span id="textcolor9870">}</span> 
<a 
 id="x13-349036r616"></a>         <span id="textcolor9871">]</span> 
<a 
 id="x13-349038r617"></a>      <span id="textcolor9872">)</span><span id="textcolor9873">,</span> 
<a 
 id="x13-349040r618"></a>   <span id="textcolor9874">]</span><span id="textcolor9875">)</span></div></pre>
                                                                                
<a 
 id="paragraph*.176"></a>
<!--l. 672--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-350000"></a>Examining
the
Code</span>
                                                                                
                                                                                
                                                                            
First
we
import
required
modules
from
the
launch
and
<span id="textcolor9876"><code class="verb">launch_ros</code></span>
packages.
It
should
be
noted
that
launch
is
a
generic
launching
framework
(not
ROS
2
specific)
and
<span id="textcolor9877"><code class="verb">launch_ros</code></span>
has
ROS
2
specific
things,
like
nodes
that
we
import
here.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                            
<pre><div id="fancyvrb442" style='padding:20px;border-radius: 3px;'><a 
 id="x13-350002r625"></a><span id="textcolor9878">from</span><span id="textcolor9879"> </span><span id="textcolor9880">launch</span><span id="textcolor9881"> </span><span id="textcolor9882">import</span> <span id="textcolor9883">LaunchDescription</span> 
<a 
 id="x13-350004r626"></a><span id="textcolor9884">from</span><span id="textcolor9885"> </span><span id="textcolor9886">launch_ros</span><span id="textcolor9887">.</span><span id="textcolor9888">actions</span><span id="textcolor9889"> </span><span id="textcolor9890">import</span> <span id="textcolor9891">Node</span></div></pre>
<!--l. 680--><p class="noindent" >Now
we
run
our
nodes
that
start
the
turtlesim
simulation
and
broadcast
turtle1
state
to
the
tf2
using
our
<span id="textcolor9892"><code class="verb">turtle_tf2_broadcaster</code></span>
node.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>
                                                                                
                                                                                
<pre><div id="fancyvrb443" style='padding:20px;border-radius: 3px;'><a 
 id="x13-350006r631"></a>      <span id="textcolor9893">Node</span><span id="textcolor9894">(</span> 
<a 
 id="x13-350008r632"></a>         <span id="textcolor9895">package</span><span id="textcolor9896">=</span><span id="textcolor9897">&#x0027;</span><span id="textcolor9898">turtlesim</span><span id="textcolor9899">&#x0027;</span><span id="textcolor9900">,</span> 
<a 
 id="x13-350010r633"></a>         <span id="textcolor9901">executable</span><span id="textcolor9902">=</span><span id="textcolor9903">&#x0027;</span><span id="textcolor9904">turtlesim_node</span><span id="textcolor9905">&#x0027;</span><span id="textcolor9906">,</span> 
<a 
 id="x13-350012r634"></a>         <span id="textcolor9907">name</span><span id="textcolor9908">=</span><span id="textcolor9909">&#x0027;</span><span id="textcolor9910">sim</span><span id="textcolor9911">&#x0027;</span> 
<a 
 id="x13-350014r635"></a>      <span id="textcolor9912">)</span><span id="textcolor9913">,</span> 
<a 
 id="x13-350016r636"></a>      <span id="textcolor9914">Node</span><span id="textcolor9915">(</span> 
<a 
 id="x13-350018r637"></a>         <span id="textcolor9916">package</span><span id="textcolor9917">=</span><span id="textcolor9918">&#x0027;</span><span id="textcolor9919">learning_tf2_py</span><span id="textcolor9920">&#x0027;</span><span id="textcolor9921">,</span> 
<a 
 id="x13-350020r638"></a>         <span id="textcolor9922">executable</span><span id="textcolor9923">=</span><span id="textcolor9924">&#x0027;</span><span id="textcolor9925">turtle_tf2_broadcaster</span><span id="textcolor9926">&#x0027;</span><span id="textcolor9927">,</span> 
<a 
 id="x13-350022r639"></a>         <span id="textcolor9928">name</span><span id="textcolor9929">=</span><span id="textcolor9930">&#x0027;</span><span id="textcolor9931">broadcaster1</span><span id="textcolor9932">&#x0027;</span><span id="textcolor9933">,</span> 
<a 
 id="x13-350024r640"></a>         <span id="textcolor9934">parameters</span><span id="textcolor9935">=</span><span id="textcolor9936">[</span> 
<a 
 id="x13-350026r641"></a>            <span id="textcolor9937">{</span><span id="textcolor9938">&#x0027;</span><span id="textcolor9939">turtlename</span><span id="textcolor9940">&#x0027;</span><span id="textcolor9941">:</span> <span id="textcolor9942">&#x0027;</span><span id="textcolor9943">turtle1</span><span id="textcolor9944">&#x0027;</span><span id="textcolor9945">}</span> 
<a 
 id="x13-350028r642"></a>         <span id="textcolor9946">]</span> 
<a 
 id="x13-350030r643"></a>      <span id="textcolor9947">)</span><span id="textcolor9948">,</span></div></pre>
                                                                                
<a 
 id="paragraph*.177"></a>
<!--l. 685--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-351000"></a>Adding
Dependencies</span>
Navigate
one
level
back
to
the
<span id="textcolor9949"><code class="verb">learning_tf2_py</code></span>
directory,
where
the
setup.py,
setup.cfg,
and
package.xml
files
are
located.
</p>                                                                            
<!--l. 690--><p class="noindent" >Open
package.xml
with
your
text
editor.
Add
the
following
dependencies
corresponding
to
your
launch
files
import
statements:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                             
<pre><div id="fancyvrb444" style='padding:20px;border-radius: 3px;'><a 
 id="x13-351002r650"></a><span id="textcolor9950">&lt;exec_depend</span><span id="textcolor9951">&gt;</span>launch<span id="textcolor9952">&lt;/exec_depend&gt;</span> 
<a 
 id="x13-351004r651"></a><span id="textcolor9953">&lt;exec_depend</span><span id="textcolor9954">&gt;</span>launch_ros<span id="textcolor9955">&lt;/exec_depend&gt;</span></div></pre>
<!--l. 695--><p class="noindent" >This
declares
the
additional
required
launch
and
<span id="textcolor9956"><code class="verb">launch_ros</code></span>
dependencies
when
its
code
is
executed.
</p>                                                                            
<!--l. 698--><p class="noindent" >Make
sure
to
save
the
file.

                                                                                
                                                                                
                                                                                
<a 
 id="paragraph*.178"></a></p>
<!--l. 700--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-352000"></a>Updating
Setup
File</span>
Reopen
setup.py
and
add
the
line
so
that
the
launch
files
from
the
<span id="textcolor9957"><code class="verb">launch/</code></span>
folder
will
be
installed.
The
<span id="textcolor9958"><code class="verb">data_files</code></span>
field
should
now
look
like
this:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>              
<pre><div id="fancyvrb445" style='padding:20px;border-radius: 3px;'><a 
 id="x13-352002r658"></a><span id="textcolor9959">data_files</span><span id="textcolor9960">=</span><span id="textcolor9961">[</span> 
<a 
 id="x13-352004r659"></a>    <span id="textcolor9962">.</span><span id="textcolor9963">.</span><span id="textcolor9964">.</span> 
<a 
 id="x13-352006r660"></a>    <span id="textcolor9965">(</span><span id="textcolor9966">os</span><span id="textcolor9967">.</span><span id="textcolor9968">path</span><span id="textcolor9969">.</span><span id="textcolor9970">join</span><span id="textcolor9971">(</span><span id="textcolor9972">&#x0027;</span><span id="textcolor9973">share</span><span id="textcolor9974">&#x0027;</span><span id="textcolor9975">,</span> <span id="textcolor9976">package_name</span><span id="textcolor9977">,</span> <span id="textcolor9978">&#x0027;</span><span id="textcolor9979">launch</span><span id="textcolor9980">&#x0027;</span><span id="textcolor9981">)</span><span id="textcolor9982">,</span> <span id="textcolor9983">glob</span><span id="textcolor9984">(</span><span id="textcolor9985">&#x0027;</span><span id="textcolor9986">launch/*</span><span id="textcolor9987">&#x0027;</span><span id="textcolor9988">)</span><span id="textcolor9989">)</span><span id="textcolor9990">,</span> 
<a 
 id="x13-352008r661"></a><span id="textcolor9991">]</span><span id="textcolor9992">,</span></div></pre>
<!--l. 707--><p class="noindent" >Also
add
the
appropriate
imports
at
the
top
of
the
file:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                          
<pre><div id="fancyvrb446" style='padding:20px;border-radius: 3px;'><a 
 id="x13-352010r666"></a><span id="textcolor9993">import</span><span id="textcolor9994"> </span><span id="textcolor9995">os</span> 
<a 
 id="x13-352012r667"></a><span id="textcolor9996">from</span><span id="textcolor9997"> </span><span id="textcolor9998">glob</span><span id="textcolor9999"> </span><span id="textcolor10000">import</span> <span id="textcolor10001">glob</span></div></pre>
                                                                                
<a 
 id="paragraph*.179"></a>
<!--l. 711--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-353000"></a>Build</span>
Run
rosdep
in
the
root
of
your
workspace
to
check
for
                                                                                
                                                                                
                                                                           
missing
dependencies.
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                        
<pre><div id="fancyvrb447" style='padding:20px;border-radius: 3px;'><a 
 id="x13-353002r674"></a>rosdep<span id="textcolor10002"> </span>install<span id="textcolor10003"> </span>-i<span id="textcolor10004"> </span>--from-path<span id="textcolor10005"> </span>src<span id="textcolor10006"> </span>--rosdistro<span id="textcolor10007"> </span>humble<span id="textcolor10008"> </span>-y</div></pre>
<!--l. 717--><p class="noindent" >Still
in
the
root
of
your
workspace,
build
your
package:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                              
<pre><div id="fancyvrb448" style='padding:20px;border-radius: 3px;'><a 
 id="x13-353004r679"></a>colcon<span id="textcolor10009"> </span>build<span id="textcolor10010"> </span>--packages-select<span id="textcolor10011"> </span>learning_tf2_py</div></pre>
<!--l. 721--><p class="noindent" >Open
a
new
terminal,
navigate
to
the
root
of
your
workspace,
and
source
the
setup
files:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                                 
<pre><div id="fancyvrb449" style='padding:20px;border-radius: 3px;'><a 
 id="x13-353006r684"></a>.<span id="textcolor10012"> </span>install/setup.bash</div></pre>
                                                                                
<a 
 id="paragraph*.180"></a>
<!--l. 725--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-354000"></a>Run</span>
Now
run
the
launch
file
that
will
start
the
turtlesim
simulation
node
and
<span id="textcolor10013"><code class="verb">turtle_tf2_broadcaster</code></span>
node:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                         
<pre><div id="fancyvrb450" style='padding:20px;border-radius: 3px;'><a 
 id="x13-354002r691"></a>ros2<span id="textcolor10014"> </span>launch<span id="textcolor10015"> </span>learning_tf2_py<span id="textcolor10016"> </span>turtle_tf2_demo.launch.py</div></pre>
                                                                                
                                                                                
                                                                              
<!--l. 732--><p class="noindent" >In
the
second
terminal
window
type
the
following
command:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                      
<pre><div id="fancyvrb451" style='padding:20px;border-radius: 3px;'><a 
 id="x13-354004r696"></a>ros2<span id="textcolor10017"> </span>run<span id="textcolor10018"> </span>turtlesim<span id="textcolor10019"> </span>turtle_teleop_key</div></pre>
<!--l. 736--><p class="noindent" >You
will
now
see
that
the
turtlesim
simulation
has
started
with
one
turtle
that
you
can
control.
Now,
use
the
<span id="textcolor10020"><code class="verb">tf2_echo</code></span>
tool
to
check
if
the
turtle
pose
is
actually
getting
broadcast
to
tf2:
</p>                                                                                
<!--l. 1--><p class="noindent" >

</p>                                                   
<pre><div id="fancyvrb452" style='padding:20px;border-radius: 3px;'><a 
 id="x13-354006r701"></a>ros2<span id="textcolor10021"> </span>run<span id="textcolor10022"> </span>tf2_ros<span id="textcolor10023"> </span>tf2_echo<span id="textcolor10024"> </span>world<span id="textcolor10025"> </span>turtle1</div></pre>
<!--l. 741--><p class="noindent" >This
should
show
you
the
pose
of
the
first
turtle.
Drive
around
the
turtle
using
                                                                                
                                                                                
                                                                              
the
arrow
keys
(make
sure
your
<span id="textcolor10026"><code class="verb">turtle_teleop_key</code></span>
terminal
window
is
active,
not
your
simulator
window).
In
your
console
output
you
will
see
something
similar
to
this:
</p>                                                                                
<div class="tcolorbox tcolorbox" id="tcolobox-115">
                                                                                

     
 
<div class="tcolorbox-content">
<pre><div id="fancyvrb453" style='padding:20px;border-radius: 3px;'><a 
 id="x13-354008r1"></a>At time 1714913843.708748879 
<a 
 id="x13-354010r2"></a>- Translation: [4.541, 3.889, 0.000] 
<a 
 id="x13-354012r3"></a>- Rotation: in Quaternion [0.000, 0.000, 0.999, -0.035] 
<a 
 id="x13-354014r4"></a>- Rotation: in RPY (radian) [0.000, -0.000, -3.072] 
<a 
 id="x13-354016r5"></a>- Rotation: in RPY (degree) [0.000, -0.000, -176.013] 
<a 
 id="x13-354018r6"></a>- Matrix: 
<a 
 id="x13-354020r7"></a> -0.998  0.070  0.000  4.541 
<a 
 id="x13-354022r8"></a> -0.070 -0.998  0.000  3.889 
<a 
 id="x13-354024r9"></a>  0.000  0.000  1.000  0.000 
<a 
 id="x13-354026r10"></a>  0.000  0.000  0.000  1.000</div></pre>
 
</div> 
</div>
<!--l. 747--><p class="noindent" >If you run <span id="textcolor10027"><code class="verb">tf2_echo</code></span> for the transform between the world and turtle2, you should not see a transform, because the second turtle is
not there yet. However, as soon as we add the second turtle in the next tutorial, the pose of turtle2 will be broadcast to tf2.
</p></article></div>
</article></div>
                                                                                
                                                                                
                                                                                
                                                                                
<!--l. 1--><p class="noindent" >
                                                                                
                                                                                
</p><!--l. 1--><p class="noindent" ><a 
 id="likesection.181"></a><a 
 id="x13-354027x"></a>
                                                                                
                                                                                
</p>
<!--l. 1--><div class="crosslinks"><p class="noindent"><a 
href="MobileRoboticsLectureBookli2.html" >NEXT</a><a 
href="MobileRoboticsLectureBookch10.html" >PREV</a><a 
href="index.html" >TOP</a></p></div>
<!--l. 1--><p class="noindent" ><a 
 id="tailMobileRoboticsLectureBookch11.html"></a></p> 
</body> 
</html>
